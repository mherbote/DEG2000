'D  E  G  2  0  0  0   Version 4.4'     MACRO-80 3.44   09-Dec-81       PAGE    1


                                        title   'D  E  G  2  0  0  0   Version 4.4'
                                        page
'D  E  G  2  0  0  0   Version 4.4'     MACRO-80 3.44   09-Dec-81       PAGE    1-1


                                
                                ;**********************************************************************
                                ;  B e t r i e b s s y s t e m     D  E  G  2  0  0  0   Version 4.4
                                ;                                  ---------------------------------
                                ;
                                ;  Systemteil:                     DEG2000 - BIOS
                                ;**********************************************************************
                                ;
                                ;----------------------------------------------------------------------
                                ;  Bearbeiter:   Marcus Herbote     K SOB  /  NILES wtz
                                ;  Stand     :   08. Mai 1986
                                ;----------------------------------------------------------------------
                                ;  Hinweis zur Implementierung auf  Standard - TAP2/TAP3:
                                ;
                                ;     Folgende Routinen aus dem DEG2000-Betriebssystem Version 1.2
                                ;  werden benutzt
                                ;
                                ;  physischer Teil  Kassettenroutine --- EPROM 40, 44, 48
                                ;  physischer Teil  Tastatur routine --- EPROM 6C
                                ;  physischer Teil  Lochband routine --- EPROM 70
                                ;  physischer Teil  Drucker  routine --- EPROM 7C
                                ;----------------------------------------------------------------------
                                ;  Inhalt
                                ;
                                ;  ..  - generierungsangaben
                                ;  ..  - sprungtabelle
                                ;  ..  - interruptadressen und - behandlungen
                                ;  ..  - speicherumschaltungen
                                ;  ..  - status konsole und drucker
                                ;  ..  - konsoleingabe
                                ;  ..  - konsolausgabe
                                ;  ..  - druckerausgabe
                                ;  ..  - lesereingabe
                                ;  ..  - stanzerausgabe
                                ;  ..  - read / write  hilfsroutinen
                                ;  ..  - read / write
                                ;  ..  - read / write  tpa-disk
                                ;  ..  - read / write  kassetten geblockt
                                ;  ..  - kassettenroutinen laden/entladen/positionieren
                                ;  ..  - boot / wboot
                                ;  ..  - kassettenbedienung laden/entladen
                                ;  ..  - hardwarebeschreibungen
                                ;  ..  - e/a tabellen
                                ;  ..  - arbeitszellen
                                ;
                                ;----------------------------------------------------------------------
                                ;
                                        page    86
'D  E  G  2  0  0  0   Version 4.4'     MACRO-80 3.44   09-Dec-81       PAGE    1-2


                                
                                ;       Laufwerksaufteilung   DEG2000 ---  S Y S 4
                                ;       ==============================================
                                ;
                                ;        A      -       TPA - Disk
                                ;       ----------------------------------------------
                                ;        B      -       Kassettenlaufwerk 1
                                ;        C      -       Kassettenlaufwerk 2
                                ;
                                ;       *D      -       Kassettenlaufwerk 3
                                ;       *E      -       Kassettenlaufwerk 4
                                ;
                                ;       *F      -       Kassettenlaufwerk 5
                                ;       *G      -       Kassettenlaufwerk 6
                                ;       ----------------------------------------------
                                ;       *H      -       Mini     Diskette 1
                                ;       *I      -       Mini     Diskette 2
                                ;       *J      -       Mini     Diskette 3
                                ;       *K      -       Mini     Diskette 4
                                ;       ----------------------------------------------
                                ;       *L      -       Standard Diskette 1
                                ;       *M      -       Standard Diskette 2
                                ;       ----------------------------------------------
                                ;       *N      -       Zentralstation
                                ;       *O      -       T R A M   - Pseudodisk
                                ;       *P      -       16k - PFS - Pseudodisk
                                ;
                                ;       *       Besagt, dass entsprechendes Laufwerk
                                ;               bei der Systemgenerierung ein- bzw. ausgeschlossen
                                ;               werden kann.
                                        .z80
                                
                                        page    
'D  E  G  2  0  0  0   Version 4.4'     MACRO-80 3.44   09-Dec-81       PAGE    1-3


                                
                         C              include EQ.MAC
                         C      ;       title   08.Mai 86     DEG2000-BIOS    Version 4.4
                         C      ;
  0000                   C      false   equ     0
  FFFF                   C      true    equ     not false
                         C      ;
                         C      ;
  0000                   C      talt    equ     false           ; false  ...    Tastatur 763x
                         C                                                      ; true   ...    Tastatur 760x
  0000                   C      dr54    equ     false           ; system mit drucker <> 1154
                         C      ;
                         C      ;
  0000                   C      orig    equ     00000h
  F400                   C      abios   equ     0f400h
  9600                   C      sbios   equ     09600h
  0C00                   C      abiosl  equ     00c00h          ;  3   k
  6A00                   C      sbiosl  equ     06a00h          ; 26,5 k
  8000                   C      gosys0  equ     08000h
                         C      ;
  3000                   C      bsanf   equ     03000h          ; bildschirmadresse
  0018                   C      maxz    equ     24                      ; zeilenanzahl
  0050                   C      maxs    equ     80                      ; spaltenanzahl
                         C      ;
  00C0                   C      sbst    equ     0c0h            ; adresse der speicherblocksteuerung
  0000                   C      str             equ     000h            ; System    -TRAM
  0008                   C      atr             equ     008h            ; Anwender  -TRAM
  0028                   C      pdtr    equ     028h            ; PseudoDisk-TRAM
  0004                   C      pdta    equ     4                       ; PseudoDisk-TRAM - Anzahl
                         C      ;
                         C      ;       tastaturroutine
                         C      ;
  00A0                   C      ptast   equ     0a0h            ; basisadresse der ansteuerung
  4000                   C      ttinit  equ     04000h          ; basisadresse der grundroutinen
                         C      ;
                         C      ;       druckerroutine
                         C      ;
  4026                   C      dinit   equ     04026h          ; initialisierungsroutine
  4029                   C      dout    equ     04029h          ; zeichenausgaberoutine
  0F70                   C      eadr    equ     00f70h          ; e/a-tabelle
                         C      ;
                         C      ;       lochbandleser
                         C      ;
  4030                   C      lbl             equ     04030h          ; zeicheneingaberoutine
  0FA0                   C      ealbl   equ     00fa0h          ; e/a-tabelle
                         C      ;
                         C      ;       lochbandstanzer
                         C      ;
  4033                   C      lbs             equ     04033h          ; zeichenausgaberoutine
  0F80                   C      ealbs   equ     00f80h          ; e/a-tabelle
                         C      ;
                         C      ; robotron kassettenroutine
                         C      ;
  000C                   C      kmbvers equ     12                      ; kmb bamos version 1.2
  0003                   C      anzakb  equ     3                       ; drei doppellaufwerke k 5221
  0030                   C      pkmb    equ     30h                     ; basisadresse akb
                         C       if anzakb gt 1
  0038                   C      pkmb2   equ     38h
                         C       endif
                         C       if anzakb gt 2
  0058                   C      pkmb3   equ     58h
                         C       endif
  4040                   C      kmbrob  equ     04040h          ; eintrittsadresse in bamos kmb
  4043                   C      kmbruc  equ     04043H
  4046                   C      kmbini  equ     04046H
                         C      ;kmbruc equ     kmbrob+6adh     ; eintrittsadresse bereitroutine        ;???
                         C      ;kmbini equ     kmbrob+965h     ; eintrittsadresse initialisierung      ;???
                         C      ;
                         C      ; puffer fuer kassettenpufferung
                         C      ;
  D000                   C      dir1    equ     0d000h          ; puffer fuer directory
  D800                   C      dir2    equ     dir1+800h
                         C       if anzakb gt 1
  E000                   C      dir3    equ     dir2+800h
  E800                   C      dir4    equ     dir3+800h
                         C       endif
                         C       if anzakb gt 2
  F000                   C      dir5    equ     dir4+800h
  F800                   C      dir6    equ     dir5+800h
                         C       endif
  2800                   C      kasbu1  equ     02800h          ; puffer fuer hostblock
'D  E  G  2  0  0  0   Version 4.4'     MACRO-80 3.44   09-Dec-81       PAGE    1-4


  2900                   C      kasbu2  equ     kasbu1+100h
                         C       if anzakb gt 1
  2A00                   C      kasbu3  equ     kasbu2+100h
  2B00                   C      kasbu4  equ     kasbu3+100h
                         C       endif
                         C       if anzakb gt 2
  2C00                   C      kasbu5  equ     kasbu4+100h
  2D00                   C      kasbu6  equ     kasbu5+100h
                         C       endif
                         C      ;
                         C      ;       speicherverteilung aBIOS
                         C      ;
                         C      ;  F400  :  abios        abios             3,0 k
                         C      ;  E600  :  abios-0e00   bdos              3,5 k
                         C      ;  DE00  :  abios-1600   ccp               2,0 k
                         C      ;   ...  :                tpa_bereich
                         C      ;   100  :                tpa
                         C      ;
                         C      mbootm  macro
                         C              defb    1ah,'  59k       S Y S 4 . 4   release 1   T A P 2 / T A P 3'
                         C              defb    cr,lf,'(128k)      D E G  2000   vom 8.Mai 86 ',lf,lf
                         C              endm
                         C      ;
                         C      ;
  FFFF                   C      s1eq    equ     true            ; generierung der datei "S1.COM"
  FFFF                   C      pipeq   equ     true            ; generierung der datei "A:PIP.SUB"
                         C      ;
                         C       if s1eq
                         C       s1com  macro
                         C       ;                                      ;       .phase 0000H
                         C              ld      hl,0116H        ; LD    HL,MEM1
                         C              ld      bc,005C0H       ; LD    BC,005C0H
                         C              otir                    ; OTIR
                         C              ld      hl,011BH        ; LD    HL,COPS
                         C              ld      de,08000H       ; LD    DE,08000H
                         C              ld      bc,0000FH       ; LD    BC,MEM3-B1
                         C              jp      08000H          ; JP    08000H
                         C      ;                                       ;MEM1:
                         C               defb   0F0H
                         C               defb   001H    ; einen Bereich umschalten
                         C               defb   008H    ; HS Bereich 
                         C               defb   001H    ; Standardbereich
                         C               defb   0FFH
                         C      ;                                       ;COPS:  .phase 08000H
                         C      ;                                       ;B1 EQU $
                         C              ld      hl,0800BH       ; LD    HL,MEM2
                         C              ld      bc,004C0H       ; LD    BC,004C0H
                         C              otir                    ; OTIR
                         C              jp      0000H           ; Sprung zur Version 1.2
                         C      ;                                       ;B2 EQU $
                         C      ;                                       ;MEM2:
                         C              defb    0F0H
                         C              defb    003H    ; Bereichsumschaltung
                         C              defb    4               ; Sys_12
                         C              defb    0FFH
                         C              endm
                         C       endif
                         C      ; 
                         C       if pipeq
                         C      dirg    macro
                         C              defb    '$1:pip p:=$1:xsub.com',cr,lf
                         C              defb    'go p:s.com=$1:submit.com',cr,lf
                         C              defb    'go p:=$1:kini.com',cr,lf
                         C              defb    'go p:=$1:power.com',cr,lf
                         C              defb    'go o:=$1:m80.com',cr,lf
                         C              defb    'go o:=$1:l80.com',cr,lf
                         C              defb    'era pip.sub',cr,lf
                         C              defb    01ah
                         C              endm
                         C       endif
                         C      ;
                         C      ;
  0000                   C      mindk   equ     false
  0000                   C      stadk   equ     false
  0000                   C      zst             equ     false
  0000                   C      tramdk  equ     false
  0000                   C      opsdk   equ     false
                         C      ;
                         C       if opsdk
                         C      zsm     macro
                         C      zsm:    defb    043h,047h,000h,000h,053h,057h,05bh,000h
                         C              endm
'D  E  G  2  0  0  0   Version 4.4'     MACRO-80 3.44   09-Dec-81       PAGE    1-5


                         C       endif
                         C      ;
                         C      ;
  00CD                   C      eq.sys  equ     0cdh            ; ruecksprung in DEG2000 Version 1.2
  00CE                   C      eq.bsd  equ     0ceh            ; hardcopy
  00FF                   C      eq.cap  equ     0ffh            ; PTAS / STAS
  00FE                   C      eq.hex  equ     0feh            ; hexadezimale eingabe eines zeichens
  00FD                   C      eq.lr0  equ     0fdh            ; druckerreset
  00FC                   C      eq.lw   equ     0fch            ; A := neue laufwerksnummer
  0000                   C      eq.gra  equ     000h            ; groesse des geraetes A festlegen  ;080h
  0081                   C      eq.le1  equ     081h            ; laden/entladen kassettenlw 1
  0082                   C      eq.le2  equ     082h            ; laden/entladen kassettenlw 2
                         C       if anzakb gt 1
  008C                   C      eq.le3  equ     08ch            ; laden/entladen kassettenlw 3
  008C                   C      eq.le4  equ     08ch            ; laden/entladen kassettenlw 4
                         C       endif
                         C       if anzakb gt 2
  008C                   C      eq.le5  equ     08ch            ; laden/entladen kassettenlw 5
  008C                   C      eq.le6  equ     08ch            ; laden/entladen kassettenlw 6
                         C       endif
  0087                   C      eq.sio  equ     087h            ; initialisieren ATS-SIO-Kanal A bzw. B
  0088                   C      eq.ini  equ     088h            ; initialisieren laufwerk O , P
  0089                   C      eq.scp  equ     089h            ; monitor SCP
  008A                   C      eq.bcu  equ     08ah            ; monitor BCU
  008B                   C      eq.deg  equ     08bh            ; monitor DEG-SYS4
                                        page    
'D  E  G  2  0  0  0   Version 4.4'     MACRO-80 3.44   09-Dec-81       PAGE    1-6


                                
                                ;       generierungsangaben
                                ;       ===================
                                ;
  000D                          cr      equ     0dh
  000A                          lf      equ     0ah
  000C                          ff      equ     0ch
  0009                          tab     equ     09h
  001B                          esc     equ     1bh
                                ;
  0040                          zeil    equ     orig+40h        ; adresse der zeilennummer
  0041                          spalt   equ     orig+41h        ; adresse der spaltennummer
                                
                                ;       parameter fuer blockung (stehen in den e/a-tabellen)
                                ;       ====================================================
                                ;
                                ;blklog equ     8               ; anzahl der recorde in einem logischen block
                                ;cpmspt equ     16              ; sector per track
                                ;blksiz equ     2               ; anzahl der recorde in einem hostblock
                                ;                               ;   (potenz von 2!!!)
                                ;secshf equ     1               ; 2**secshf = blksiz
                                ;secmsk equ     1               ; schneidet secshf bits hinten heraus
                                ;
  0004                          erranz  equ     4               ; anzahl der fehlerwiederholungen
                                ;
  0043                          lwa     equ     orig+43h        ; laufwerksnummer laufwerk A
                                ;
  0044                          datum   equ     orig+44h        ; aktuelles Datum tag/monat/jahr
                                ;
  DE00                          CCP     equ     0DE00h
                                
                                        title   'Start: 0000H nach LOAD'
                                        page
'Start: 0000H nach LOAD'        MACRO-80 3.44   09-Dec-81       PAGE    1-7


                                
                                ; ===  Start: 0000H nach LOAD =====================================================================
                                ;
                                ; /---  Start: Verschieben der verschiedenen Bereiche --------------------------------------------\
                                ;  wird von SYS 1.2 mit dem Befehl "S4  " angesprungen
  0000*                         start:  
                                ;       hl      ;abios -Adresse in SYS1.2 fuer 'S4  ' eintragen
  0000*   11 F400                       ld      de,abios
  0003*   73                            ld      (hl),e
  0004*   23                            inc     hl
  0005*   72                            ld      (hl),d
                                
  0006*   01 04C0                       ld      bc,004C0h       ;HS-bereich auf "System" unschalten
  0009*   21 0066*                      ld      hl,start1
  000C*   ED B3                         otir
                                        
  000E*   21 7F00                       ld      hl,sbios-01700h ; SYS4- Speicherbereich loeschen
  0011*   11 7F01                       ld      de,sbios-01700h+1
  0014*   01 80FF                       ld      bc,01700h+sbiosl-1
  0017*   36 00                         ld      (hl),0
  0019*   ED B0                         ldir
                                
  001B*   21 1E00                       ld      hl,1E00h        ;CCP und BDOS nach oben kopieren
  001E*   11 DE00                       ld      de,CCP
  0021*   01 1600                       ld      bc,0800H+0E00H
  0024*   ED B0                         ldir
  0026*   21 1E00                       ld      hl,1E00h        ;CCP und BDOS unten loeschen
  0029*   36 00                         ld      (hl),00h
  002B*   11 1E01                       ld      de,1E01h
  002E*   01 15FF                       ld      bc,0800H+0E00H-1
  0031*   ED B0                         ldir
                                
  0033*   21 006A*                      ld      hl,sbios1       ; BIOS - Teil laden
  0036*   11 9600                       ld      de,sbios
  0039*   01 185B                       ld      bc,abios2-sbios1
  003C*   ED B0                         ldir
  003E*   21 006A*                      ld      hl,sbios1       ; BIOS - Teil loeschen
  0041*   36 00                         ld      (hl),00h
  0043*   11 006B*                      ld      de,sbios1+1
  0046*   01 185A                       ld      bc,abios2-sbios1-1
  0049*   ED B0                         ldir
                                
  004B*   21 18C5*                      ld      hl,gosys2       ; Sprung zur Version 1.2
  004E*   11 8000                       ld      de,gosys0
  0051*   01 0013                       ld      bc,gosys3-gosys2
  0054*   ED B0                         ldir
  0056*   21 18C5*                      ld      hl,gosys2       ; Sprung zur Version 1.2 loeschen
  0059*   36 00                         ld      (hl),00h
  005B*   11 18C6*                      ld      de,gosys2+1
  005E*   01 0012                       ld      bc,gosys3-gosys2-1
  0061*   ED B0                         ldir
  0063*   C3 973B                       jp      boot00
                                
  0066*                         start1: 
  0066*   F0                            DB      0F0H    ;Startbyte
  0067*   03                            DB      003H    ;wahl
  0068*   07                            DB      007H    ;RDIR
  0069*   FF                            DB      0FFH    ;Endbyte
                                ; \---  Ende : Verschieben der verschiedenen Bereiche --------------------------------------------/
                                
                                        title   's  B I O S'
                                        page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-8


                                
                                ; /---  Start: sBIOS -----------------------------------------------------------------------------\
                                ;       org     start+100h-3
  006A*                         sbios1::
                                        .phase  sbios           ; 9600H
                                
                                ;       stackrettung
                                ;       ============
                                ;
  9600                          reta::
  9600    E3                            ex      (sp),hl
  9601    D5                            push    de
  9602    C5                            push    bc
  9603    DD E5                         push    ix
  9605    FD E5                         push    iy
  9607    E9                            jp      (hl)
                                ;
  9608                          retu::
  9608    E1                            pop     hl
  9609    FD E1                         pop     iy
  960B    DD E1                         pop     ix
  960D    C1                            pop     bc
  960E    D1                            pop     de
  960F    E3                            ex      (sp),hl
  9610                          return::
  9610    C9                        ret
                                ;
  9611                          um2ee::
  9611    CD 9608                       call    retu
  9614    C3 F639                       jp      um2e
                                
                                ;       Sprungverteiler-Routine             '???
                                ;       =======================
                                ;
  9617                          iodisp::
  9617    E1                            pop     hl
  9618    C5                            push    bc
  9619    D5                            push    de
  961A    7E                            ld      a,(hl)
  961B    23                            inc     hl
  961C    47                            ld      b,a
  961D    B7                            or      a
  961E    CD 96C1                       call    setp0
  9621    3A 0003                       ld      a,(orig+3)
  9624    CD 96D3                       call    resp0
  9627    28 03                         jr      z,iodis2
  9629                          iodis1:
  9629    1F                            rra
  962A    10 FD                         djnz    iodis1
  962C                          iodis2:
  962C    E6 03                         and     3
  962E    17                            rla
  962F    4F                            ld      c,a
  9630    09                            add     hl,bc
  9631    5E                            ld      e,(hl)
  9632    23                            inc     hl
  9633    56                            ld      d,(hl)
  9634    EB                            ex      de,hl
  9635    D1                            pop     de
  9636    C1                            pop     bc
  9637    E9                            jp      (hl)
                                
                                ;       dph-adresse laden
                                ;       =================
                                ;
  9638                          ldhldp:
  9638    21 F7F8                       ld      hl,dpha
  963B    CD 96C1                       call    setp0
  963E    3A 0043                       ld      a,(lwa)
  9641    CD 96D3                       call    resp0
  9644    BB                            cp      e
  9645    C8                            ret     z
  9646    7B                            ld      a,e
  9647    87                            add     a,a
  9648    16 00                         ld      d,0
  964A    5F                            ld      e,a
  964B    19                            add     hl,de
  964C    C9                            ret
                                
                         C              include UM.MAC
                         C      ;       speicherumschaltungen fuer DEG2000-BIOS     08.05.86
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-9


                         C      ;       ====================================================
                         C      ;
                         C      um      macro
                         C      ;
                         C      um1::
                         C              ld      (hlret),hl      ; HL retten
                         C              pop     hl              ; RET-Adresse ==> HL
                         C      um1r1:
                         C              ld      (s1ret),sp      ; SP retten                (s3ret),sp
                         C      um1r2:
                         C              ld      sp,s1neu        ; SP neu laden             sp,s3neu
                         C              push    hl              ; HL ==> Stack
                         C              ld      hl,(hlret)      ; HL wieder herstellen
                         C      um1r3:
                         C              nop                     ;                          jp resp0
                         C              nop
                         C              nop
                         C              push    bc
                         C              push    hl
                         C              ld      bc,004C0h
                         C              ld      hl,um1r4
                         C              otir
                         C              pop     hl
                         C              pop     bc
                         C              ret
                         C      um1r4:
                         C              DB      0F0H    ;Startbyte
                         C              DB      003H    ;wahl   0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F
                         C              DB      001H    ;um1   {0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0}
                         C              DB      0FFH    ;Endbyte
                         C      ;
                         C      ;
                         C      um2::
                         C              nop                     ;                          jp setp0
                         C              nop
                         C              nop
                         C              push    af
                         C              push    bc
                         C              push    de
                         C              push    hl
                         C              ld      bc,004C0h
                         C              ld      hl,um21
                         C              otir
                         C              pop     hl
                         C              pop     de
                         C              pop     bc
                         C              pop     af
                         C              ret
                         C      um21:
                         C              DB      0F0H    ;Startbyte
                         C              DB      003H    ;wahl   0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F
                         C              DB      002H    ;um2   {4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0}
                         C              DB      0FFH    ;Endbyte
                         C      ;
                         C      ;
                         C      um2e:
                         C              call    um2
                         C      um2er:
                         C              ld      sp,(s1ret)
                         C              ret
                         C              endm
                         C      ;
                         C      ;
                         C      ;
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-10


                         C      
                         C      ;
                         C      ;
                         C      ;
  964D                   C      skmb::
  964D    F5             C              push    af
  964E    AF             C              xor     a
  964F    ED 47          C              ld      i,a
  9651    F1             C              pop     af
  9652    C9             C              ret
                         C      ;
  9653                   C      rkmb::
  9653    F5             C              push    af
  9654    3E F4          C              ld      a,high abios
  9656    ED 47          C              ld      i,a
  9658    F1             C              pop     af
  9659    C9             C              ret
                         C      ;
                         C      ;
  965A                   C      sdir::
  965A    22 F936        C              ld      (hlret),hl      ; HL retten
  965D    E1             C              pop     hl              ; RET-Adresse ==> HL
  965E    ED 73 0C90     C              ld      (s2ret),sp      ; SP retten
  9662    31 0C90        C              ld      sp,s2neu        ; SP neu laden
  9665    E5             C              push    hl              ; HL ==> Stack
  9666    2A F936        C              ld      hl,(hlret)      ; HL wieder herstellen
  9669    C5             C              push    bc
  966A    E5             C              push    hl
  966B    01 06C0        C              ld      bc,006C0h
  966E    21 9676        C              ld      hl,sdir1
  9671    ED B3          C              otir
  9673    E1             C              pop     hl
  9674    C1             C              pop     bc
  9675    C9             C              ret
  9676                   C      sdir1:
  9676    F0             C              DB      0F0H    ;Startbyte
  9677    04             C              DB      004H    ;wahl 
  9678    0D             C              DB      00DH    ;D000-FFFF
  9679    0F             C              DB      00FH
  967A    04             C              DB      004H    ;sdir  4
  967B    FF             C              DB      0FFH    ;Endbyte
                         C      ;
  967C                   C      rdir::
  967C    C5             C              push    bc
  967D    E5             C              push    hl
  967E    01 06C0        C              ld      bc,006C0h
  9681    21 9695        C              ld      hl,rdir1
  9684    ED B3          C              otir
  9686    E1             C              pop     hl
  9687    C1             C              pop     bc
  9688    22 F936        C              ld      (hlret),hl      ; HL retten
  968B    E1             C              pop     hl              ; RET-Adresse ==> HL
  968C    ED 7B 0C90     C              ld      sp,(s2ret)      ; SP alt laden
  9690    E5             C              push    hl              ; HL ==> Stack
  9691    2A F936        C              ld      hl,(hlret)      ; HL wieder herstellen
  9694    C9             C              ret
  9695                   C      rdir1:
  9695    F0             C              DB      0F0H    ;Startbyte
  9696    04             C              DB      004H    ;wahl
  9697    0D             C              DB      00DH    ;D000-FFFF
  9698    0F             C              DB      00FH
  9699    00             C              DB      000H    ;rdir  0
  969A    FF             C              DB      0FFH    ;Endbyte
                         C      ;
                         C      ;
  969B                   C      setla::                 ; Laufwerk A zuschalten System 0-8
  969B    C5             C              push    bc
  969C    E5             C              push    hl
  969D    01 06C0        C              ld      bc,006C0h
  96A0    21 96A8        C              ld      hl,setla1
  96A3    ED B3          C              otir
  96A5    E1             C              pop     hl
  96A6    C1             C              pop     bc
  96A7    C9             C              ret
  96A8                   C      setla1:
  96A8    F0             C              DB      0F0H    ;Startbyte
  96A9    04             C              DB      004H    ;wahl
  96AA    00             C              DB      000H    ;bereich von
  96AB    07             C              DB      007H    ;bereich bis
  96AC    00             C              DB      000H    ;"System" Laufwerk A
  96AD    FF             C              DB      0FFH    ;Endbyte
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-11


                         C      ;
  96AE                   C      resla::                 ; Laufwerk A wegschalten System 0-8
  96AE    C5             C              push    bc
  96AF    E5             C              push    hl
  96B0    01 06C0        C              ld      bc,006C0h
  96B3    21 96BB        C              ld      hl,resla1
  96B6    ED B3          C              otir
  96B8    E1             C              pop     hl
  96B9    C1             C              pop     bc
  96BA    C9             C              ret
  96BB                   C      resla1: 
  96BB    F0             C              DB      0F0H    ;Startbyte
  96BC    04             C              DB      004H    ;wahl
  96BD    00             C              DB      000H    ;bereich von
  96BE    07             C              DB      007H    ;bereich bis
  96BF    01             C              DB      001H    ;"System"
  96C0    FF             C              DB      0FFH    ;Endbyte
                         C      ;
                         C      ;
                         C      ;setlp::        
                         C              ; ld    (hlret),hl      ; HL retten
                         C              ; pop   hl              ; RET-Adresse ==> HL
                         C              ; ld    (s2ret),sp      ; SP retten
                         C              ; ld    sp,s2neu        ; SP neu laden
                         C              ; push  hl              ; HL ==> Stack
                         C              ; ld    hl,(hlret)      ; HL wieder herstellen
                         C              ; push  bc
                         C              ; push  de
                         C              ; push  af
                         C              ; ld    bc,0c000h+str   ; System  -TRAM (C000H-FFFFH) wegschalten
                         C              ; ld    e,4
                         C              ; call  up31
                         C              ; out   (sbst+4),a      ; RESET-Sperre aus
                         C              ; pop   af              ; zusatz-PFS                   zuschalten
                         C              ; out   (sbst+2),a
                         C              ; out   (sbst+3),a      ; RESET-Sperre ein
                         C              ; pop   de
                         C              ; pop   bc
                         C              ; ret
                         C      ;
                         C      ;reslp::
                         C              ; push  af
                         C              ; push  bc
                         C              ; push  de
                         C              ; out   (sbst+4),a      ; RESET-Sperre aus
                         C              ; xor   a               ; zusatz-PFS                  wegschalten
                         C              ; out   (sbst+2),a
                         C              ; out   (sbst+3),a      ; RESET-Sperre ein
                         C              ; ld    bc,0c000h+str   ; System  -TRAM (C000H-FFFFH)  zuschalten
                         C              ; ld    e,4
                         C              ; call  up21
                         C              ; pop   de
                         C              ; pop   bc
                         C              ; pop   af
                         C              ; ld    (hlret),hl      ; HL retten
                         C              ; pop   hl              ; RET-Adresse ==> HL
                         C              ; ld    sp,(s2ret)      ; SP alt laden
                         C              ; push  hl              ; HL ==> Stack
                         C              ; ld    hl,(hlret)      ; HL wieder herstellen
                         C              ; ret
                         C      ;
                         C      ;
  96C1                   C      setp0::
  96C1    C5             C              push    bc
  96C2    E5             C              push    hl
  96C3    01 05C0        C              ld      bc,005C0h
  96C6    21 96CE        C              ld      hl,setp1
  96C9    ED B3          C              otir
  96CB    E1             C              pop     hl
  96CC    C1             C              pop     bc
  96CD    C9             C              ret
  96CE                   C      setp1:
  96CE    F0             C              DB      0F0H    ;Startbyte
  96CF    01             C              DB      001H    ;wahl
  96D0    00             C              DB      000H    ;Bereich
  96D1    04             C              DB      004H    ;BereichNr              "Anwender"
  96D2    FF             C              DB      0FFH    ;Endbyte
                         C      ;
  96D3                   C      resp0::
  96D3    C5             C              push    bc
  96D4    E5             C              push    hl
  96D5    01 05C0        C              ld      bc,005C0h
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-12


  96D8    21 96E0        C              ld      hl,resp1
  96DB    ED B3          C              otir
  96DD    E1             C              pop     hl
  96DE    C1             C              pop     bc
  96DF    C9             C              ret
  96E0                   C      resp1:
  96E0    F0             C              DB      0F0H    ;Startbyte
  96E1    01             C              DB      001H    ;wahl
  96E2    00             C              DB      000H    ;Bereich
  96E3    00             C              DB      000H    ;BereichNr              "System"        001H?
  96E4    FF             C              DB      0FFH    ;Endbyte
                         C      ;
                         C      ;
                         C      ;
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-13


                         C      
  96E5                   C      um11:
  96E5    3E C3          C              ld      a,0c3h
  96E7    32 F60D        C              ld      (um1r3),a
  96EA    21 96D3        C              ld      hl,resp0
  96ED    22 F60E        C              ld      (um1r3+1),hl
  96F0    32 F621        C              ld      (um2),a
  96F3    21 96C1        C              ld      hl,setp0
  96F6    22 F622        C              ld      (um2+1),hl
  96F9    21 FCC3        C              ld      hl,s3ret
  96FC    22 F604        C              ld      (um1r1+2),hl
  96FF    22 F63E        C              ld      (um2er+2),hl
  9702    22 F5AE        C              ld      (br271+2),hl
  9705    22 F5FB        C              ld      (getpf2+2),hl
  9708    21 FCC1        C              ld      hl,s3neu
  970B    22 F607        C              ld      (um1r2+1),hl
  970E    C9             C              ret
                         C      ;
  970F                   C      um12:
  970F    AF             C              xor     a
  9710    32 F60D        C              ld      (um1r3+0),a
  9713    32 F60E        C              ld      (um1r3+1),a
  9716    32 F60F        C              ld      (um1r3+2),a
  9719    32 F621        C              ld      (um2+0),a
  971C    32 F622        C              ld      (um2+1),a
  971F    32 F623        C              ld      (um2+2),a
  9722    21 FCC1        C              ld      hl,s1ret
  9725    22 F604        C              ld      (um1r1+2),hl
  9728    22 F63E        C              ld      (um2er+2),hl
  972B    22 F5AE        C              ld      (br271+2),hl
  972E    22 F5FB        C              ld      (getpf2+2),hl
  9731    21 FC41        C              ld      hl,s1neu
  9734    22 F607        C              ld      (um1r2+1),hl
  9737    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
                         C       if not opsdk
                         C      opsmac  macro
                         C      gdma    equ     $
                         C      s2neu   equ     gdma+128+10h
                         C      s2ret   equ     s2neu
                         C              endm
                         C       endif
                         C       if not tramdk
  9738    00             C      ttanz:: defb    0
  9739    00             C      tram::  defb    0
  973A    00             C      ttrk::  defb    0
                         C       endif
                         C      ;
                         C      ;
                         C      gosys   macro
                         C              jp      0
                         C              endm
                         C      ;
                         C      gosys1  macro
                         C              push    bc
                         C              push    hl
                         C              ld      bc,004C0h
                         C              ld      hl,$+10
                         C              otir
                         C              pop     hl
                         C              pop     bc
                         C              jp      0
                         C      ;
                         C              DB      0F0H    ;Startbyte
                         C              DB      003H    ;wahl
                         C              DB      003H    ;GoSys1
                         C              DB      0FFH    ;Endbyte
                         C              endm
                         C      ;
                         C      ;
                         C      ;
                                        page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-14


                                
                                ;       kaltstart
                                ;       =========
                                ;
  973B                          boot00::
  973B    21 0000'                      ld      hl,start        ; unterste Bytes loeschen
  973E    36 00                         ld      (hl),00h
  9740    11 0001'                      ld      de,start+1
  9743    01 0069                       ld      bc,sbios1-start-1
  9746    ED B0                         ldir
                                
  9748    21 A91A                       ld      hl,biosxx+(op12-op11)   ;aBIOS - Teil laden     ===> F400h
  974B    11 F400                       ld      de,abios
  974E    01 0541                       ld      bc,abios2-abios1
  9751    ED B0                         ldir
  9753    21 A91A                       ld      hl,biosxx+(op12-op11)   ;aBIOS - Teil loeschen
  9756    36 00                         ld      (hl),00h
  9758    11 A91B                       ld      de,biosxx+(op12-op11)+1
  975B    01 0540                       ld      bc,abios2-abios1-1
  975E    ED B0                         ldir
                                
  9760                          boot::  
  9760    31 FBC1                       ld      sp,spber
  9763    ED 73 FCC1                    ld      (s1ret),sp
  9767    F3                            di
  9768    CD F5FE                       call    um1             ; speicherumschaltungen initialisieren
  976B    CD 96C1                       call    setp0
  976E    21 0003                       ld      hl,orig+3
  9771    36 95                         ld      (hl),95h        ; iobyte
  9773    23                            inc     hl
  9774    36 00                         ld      (hl),0          ; default dev.
  9776    CD 96D3                       call    resp0
                                
  9779    CD 9870                       call    dirdel  ;Laufwerk A initialisieren
                                
  977C    AF                            xor     a               ; bildschirm initialisieren
  977D    32 F930                       ld      (qrmode),a
  9780    32 F931                       ld      (qroll),a
  9783    32 F932                       ld      (qesc),a
  9786    21 3000                       ld      hl,bsanf
  9789    22 F92E                       ld      (bsaddr),hl
  978C    21 99CC                       ld      hl,bootms
  978F    06 63                         ld      b,bootme-bootms
  9791    C5                    boot03: push    bc
  9792    7E                            ld      a,(hl)
  9793    23                            inc     hl
  9794    4F                            ld      c,a
  9795    E5                            push    hl
  9796    CD 9FDC                       call    co.ch
  9799    E1                            pop     hl
  979A    C1                            pop     bc
  979B    10 F4                         djnz    boot03
                                                                ; geraetezustand initialisieren
                                                                ; =============================
  979D    21 F7F8                       ld      hl,dpha         ; geraete a bis p entladen
  97A0    06 20                         ld      b,32
  97A2    36 00                 boot05: ld      (hl),0
  97A4    23                            inc     hl
  97A5    10 FB                         djnz    boot05
  97A7    21 F788                       ld      hl,dphad        ; a ist tpa-disk
  97AA    22 F7F8                       ld      (dpha),hl
  97AD    21 F768                       ld      hl,ixtab1
  97B0    11 F748                       ld      de,ixtab
  97B3    01 0020                       ld      bc,32
  97B6    ED B0                         ldir
  97B8    AF                            xor     a               ; a ist a
  97B9    CD 96C1                       call    setp0
  97BC    32 0043                       ld      (lwa),a
  97BF    CD 96D3                       call    resp0
                                                                ; kassetten initialisieren
                                ;       call    skmb            ; ========================
                                ;       ld      ix,eatab1               ; physische KMBG-Routinen
                                ;       call    kmbini
                                ;  if anzakb gt 1
                                ;       ld      ix,eatab3
                                ;       call    kmbini
                                ;  endif
                                ;  if anzakb gt 2
                                ;       ld      ix,eatab5
                                ;       call    kmbini
                                ;  endif
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-15


                                ;       call    rkmb
  97C2    3E 10                         ld      a,10h           ; status nicht bereit setzen
  97C4    32 F64B                       ld      (eatab1),a
  97C7    32 F676                       ld      (eatab2),a
                                 if anzakb gt 1
  97CA    32 F6A1                       ld      (eatab3),a
  97CD    32 F6CC                       ld      (eatab4),a
                                 endif
                                 if anzakb gt 2
  97D0    32 F6F7                       ld      (eatab5),a
  97D3    32 F722                       ld      (eatab6),a
                                 endif
                                                                ; gereate kaltinitialisierung
                                                                ; ===========================
  97D6    CD 9F75                       call    ci.kalt         ; Tastatur
                                 if mindk or stadk
                                        call    fl.kalt         ; Floppy initialisieren
                                 endif
                                 if zst or tramdk or opsdk
                                        call    md.kalt         ; simulierten disk initialisieren
                                 endif
  97D9    AF                            xor     a
  97DA    32 F938                       ld      (sverz),a
  97DD    32 F939                       ld      (sschr),a
  97E0    32 F668                       ld      (eatab1+gelade),a
  97E3    32 F693                       ld      (eatab2+gelade),a
                                 if anzakb gt 1
  97E6    32 F6BE                       ld      (eatab3+gelade),a
  97E9    32 F6E9                       ld      (eatab4+gelade),a
                                 endif
                                 if anzakb gt 2
  97EC    32 F714                       ld      (eatab5+gelade),a
  97EF    32 F73F                       ld      (eatab6+gelade),a
                                 endif
  97F2    21 DE00                       ld      hl,abios-1600h  ; CCP und BDOS -Kopie erstellen
  97F5    11 8000                       ld      de,08000h
  97F8    01 1600                       ld      bc,01600h
  97FB    ED B0                         ldir
                                ;
                                ;
                                ;
                                        page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-16


                                
                                ;       warmstart
                                ;       =========
                                ;
  97FD    F3                    wboot:: di
  97FE    31 FBC1                       ld      sp,spber
  9801    CD 970F                       call    um12
  9804    21 DE00                       ld      hl,abios-1600h
  9807    E5                            push    hl
  9808    ED 73 FCC1                    ld      (s1ret),sp
  980C    01 0080                       ld      bc,80h
  980F    CD F58C                       call    setdma
                                                                ; geraete warminitialisierung
  9812    CD 9F75                       call    ci.warm         ; ===========================
                                 if mindk or stadk
                                        call    fl.warm         ; zum motor ausschalten
                                 endif
                                 if zst or tramdk or opsdk
                                        call    md.warm
                                 endif
  9815    AF                            xor     a
  9816    32 F930                       ld      (qrmode),a
  9819    3E 01                         ld      a,1             ; kassettenladen/-entladen erlauben
  981B    32 F935                       ld      (syste),a
  981E    21 8000                       ld      hl,08000h       ; CCP und BDOS restaurieren
  9821    11 DE00                       ld      de,abios-1600h
  9824    01 0800                       ld      bc,00800h
  9827    ED B0                         ldir
  9829    D5                            push    de
  982A    01 0E00                       ld      bc,00e00h
  982D    ED B0                         ldir
  982F    21 9A2F                       ld      hl,serial
  9832    D1                            pop     de
  9833    01 0006                       ld      bc,6
  9836    ED B0                         ldir
  9838    CD 96C1                       call    setp0
  983B    3A 0003                       ld      a,(orig+3)
  983E    32 9A38                       ld      (iobyt),a
  9841    3A 0004                       ld      a,(orig+4)      ; pruefen, ob current dev. gueltig ist
  9844    57                            ld      d,a
  9845    4F                            ld      c,a
  9846    06 00                         ld      b,0
  9848    21 F7F8                       ld      hl,dpha
  984B    09                            add     hl,bc
  984C    09                            add     hl,bc
  984D    7E                            ld      a,(hl)
  984E    23                            inc     hl
  984F    B6                            or      (hl)
  9850    28 01                         jr      z,m104          ; -> nicht gueltige current dev.
  9852    7A                            ld      a,d
  9853    32 9A39               m104:   ld      (cudev),a       ; aktuelles geraet
  9856    21 9A35                       ld      hl,syspa
  9859    11 0000                       ld      de,orig+0
  985C    01 0023                       ld      bc,const-syspa
  985F    ED B0                         ldir
  9861    CD 96D3                       call    resp0
  9864    4F                            ld      c,a
  9865    3E F4                         ld      a,high abios    ; interruptsystem setzen
  9867    ED 47                         ld      i,a
  9869    ED 5E                         im 2
  986B    FB                            ei
  986C    79                            ld      a,c
  986D    C3 F639                       jp      um2e            ; ===> CCP
                                ;
                                ;
                                ;
                                        page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-17


                                
                                                                ; verzeichnis geraet A loeschen
  9870    3E 00                 dirdel: ld      a,str           ; =============================
  9872    32 9739                       ld      (tram),a
  9875    AF                            xor     a
  9876    32 973A                       ld      (ttrk),a
  9879    CD 969B                       call    setla
  987C    21 3000                       ld      hl,3000h
  987F    11 3001                       ld      de,3001h
  9882    01 07FF                       ld      bc,7ffh
  9885    36 E5                         ld      (hl),0e5h
  9887    E5                            push    hl
  9888    E5                            push    hl
  9889    ED B0                         ldir    
  988B    E1                            pop     hl              ; verzeichnis fuer GO.COM (PIP.SUB)
  988C    E5                            push    hl
  988D    E5                            push    hl
  988E    D1                            pop     de
  988F    13                            inc     de
                                
                                 if s1eq and pipeq
  9890    01 005F                       ld      bc,5fh 
                                 endif
                                 if (s1eq and not pipeq) or (pipeq and not s1eq)
                                        ld      bc,3fh
                                 endif
                                 if not s1eq and not pipeq
                                        ld      bc,1fh
                                 endif
  9893    36 00                         ld      (hl),0
  9895    ED B0                         ldir
                                ; ===   
  9897    D1                            pop     de
  9898    D5                            push    de
  9899    21 98EC                       ld      hl,dirgo        ;Verzeichniseintrag fuer 'GO.COM'
  989C    01 000C                       ld      bc,12
  989F    ED B0                         ldir
  98A1    E1                            pop     hl
                                
                                 if s1eq        ;Verzeichniseintrag fuer 'S1.COM'
  98A2    11 0020                       ld      de,32
  98A5    19                            add     hl,de
  98A6    E5                            push    hl
  98A7    EB                            ex      de,hl
  98A8    21 98F8                       ld      hl,dirs1
  98AB    01 0011                       ld      bc,dirs11-dirs1
  98AE    ED B0                         ldir
  98B0    E1                            pop     hl
                                 endif  
                                
                                 if pipeq       ;Verzeichniseintrag fuer 'PIP.SUB'
  98B1    11 0020                       ld      de,32
  98B4    19                            add     hl,de
  98B5    E5                            push    hl
  98B6    EB                            ex      de,hl
  98B7    21 9931                       ld      hl,dirgo1
  98BA    01 0011                       ld      bc,dirg11-dirgo1
  98BD    ED B0                         ldir
  98BF    E1                            pop     hl
                                 endif
                                ; ===
  98C0    11 0800                       ld      de,800h
                                 if s1eq        ;Daten fuer 'S1.COM'
  98C3    E1                            pop     hl
  98C4    19                            add     hl,de
  98C5    E5                            push    hl
  98C6    EB                            ex      de,hl
  98C7    21 9909                       ld      hl,dirs11
  98CA    01 0028                       ld      bc,dirs12-dirs11
  98CD    ED B0                         ldir
  98CF    3A 9907                       ld      a,(dirs1+15)    ; 16
  98D2    47                            ld      b,a
  98D3    21 0000                       ld      hl,0
  98D6    11 0400                       ld      de,0400H        ;80H
  98D9                          s1a:
  98D9    19                            add     hl,de
  98DA    10 FD                         djnz    s1a
  98DC    EB                            ex      de,hl
                                 endif
                                
                                 if pipeq       ;Daten fuer 'PIP.SUB'
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-18


  98DD    E1                            pop     hl
  98DE    19                            add     hl,de
  98DF    EB                            ex      de,hl
  98E0    21 9942                       ld      hl,dirg11
  98E3    01 008A                       ld      bc,dirg12-dirg11
  98E6    ED B0                         ldir
                                 endif
  98E8    CD 96AE                       call    resla
  98EB    C9                            ret
                                ;
  98EC    00 47 4F 20           dirgo:  defb    0,'GO      ',0c3h,'OM'
  98F0    20 20 20 20           
  98F4    20 C3 4F 4D           
                                ;
                                 if s1eq 
  98F8    00 53 31 20           dirs1:  defb    0,'S1      ',0c3h,'OM',0,0,0,1,2
  98FC    20 20 20 20           
  9900    20 C3 4F 4D           
  9904    00 00 00 01           
  9908    02                    
  9909                          dirs11: s1com
  9909    21 0116         +             ld      hl,0116H        ; LD    HL,MEM1
  990C    01 05C0         +             ld      bc,005C0H       ; LD    BC,005C0H
  990F    ED B3           +             otir                    ; OTIR
  9911    21 011B         +             ld      hl,011BH        ; LD    HL,COPS
  9914    11 8000         +             ld      de,08000H       ; LD    DE,08000H
  9917    01 000F         +             ld      bc,0000FH       ; LD    BC,MEM3-B1
  991A    C3 8000         +             jp      08000H          ; JP    08000H
  991D    F0              +              defb   0F0H
  991E    01              +              defb   001H    ; einen Bereich umschalten
  991F    08              +              defb   008H    ; HS Bereich 
  9920    01              +              defb   001H    ; Standardbereich
  9921    FF              +              defb   0FFH
  9922    21 800B         +             ld      hl,0800BH       ; LD    HL,MEM2
  9925    01 04C0         +             ld      bc,004C0H       ; LD    BC,004C0H
  9928    ED B3           +             otir                    ; OTIR
  992A    C3 0000         +             jp      0000H           ; Sprung zur Version 1.2
  992D    F0              +             defb    0F0H
  992E    03              +             defb    003H    ; Bereichsumschaltung
  992F    04              +             defb    4               ; Sys_12
  9930    FF              +             defb    0FFH
  9931                          dirs12:
                                 endif
                                ;
                                 if pipeq
  9931    00 50 49 50           dirgo1: defb    0,'PIP     SUB',0,0,0,2,10
  9935    20 20 20 20           
  9939    20 53 55 42           
  993D    00 00 00 02           
  9941    0A                    
  9942                          dirg11: dirg
  9942    24 31 3A 70     +             defb    '$1:pip p:=$1:xsub.com',cr,lf
  9946    69 70 20 70     +     
  994A    3A 3D 24 31     +     
  994E    3A 78 73 75     +     
  9952    62 2E 63 6F     +     
  9956    6D 0D 0A        +     
  9959    67 6F 20 70     +             defb    'go p:s.com=$1:submit.com',cr,lf
  995D    3A 73 2E 63     +     
  9961    6F 6D 3D 24     +     
  9965    31 3A 73 75     +     
  9969    62 6D 69 74     +     
  996D    2E 63 6F 6D     +     
  9971    0D 0A           +     
  9973    67 6F 20 70     +             defb    'go p:=$1:kini.com',cr,lf
  9977    3A 3D 24 31     +     
  997B    3A 6B 69 6E     +     
  997F    69 2E 63 6F     +     
  9983    6D 0D 0A        +     
  9986    67 6F 20 70     +             defb    'go p:=$1:power.com',cr,lf
  998A    3A 3D 24 31     +     
  998E    3A 70 6F 77     +     
  9992    65 72 2E 63     +     
  9996    6F 6D 0D 0A     +     
  999A    67 6F 20 6F     +             defb    'go o:=$1:m80.com',cr,lf
  999E    3A 3D 24 31     +     
  99A2    3A 6D 38 30     +     
  99A6    2E 63 6F 6D     +     
  99AA    0D 0A           +     
  99AC    67 6F 20 6F     +             defb    'go o:=$1:l80.com',cr,lf
  99B0    3A 3D 24 31     +     
  99B4    3A 6C 38 30     +     
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-19


  99B8    2E 63 6F 6D     +     
  99BC    0D 0A           +     
  99BE    65 72 61 20     +             defb    'era pip.sub',cr,lf
  99C2    70 69 70 2E     +     
  99C6    73 75 62 0D     +     
  99CA    0A              +     
  99CB    1A              +             defb    01ah
  99CC                          dirg12:
                                 endif
                                ;
  99CC                          bootms: mbootm
  99CC    1A 20 20 35     +             defb    1ah,'  59k       S Y S 4 . 4   release 1   T A P 2 / T A P 3'
  99D0    39 6B 20 20     +     
  99D4    20 20 20 20     +     
  99D8    20 53 20 59     +     
  99DC    20 53 20 34     +     
  99E0    20 2E 20 34     +     
  99E4    20 20 20 72     +     
  99E8    65 6C 65 61     +     
  99EC    73 65 20 31     +     
  99F0    20 20 20 54     +     
  99F4    20 41 20 50     +     
  99F8    20 32 20 2F     +     
  99FC    20 54 20 41     +     
  9A00    20 50 20 33     +     
  9A04    0D 0A 28 31     +             defb    cr,lf,'(128k)      D E G  2000   vom 8.Mai 86 ',lf,lf
  9A08    32 38 6B 29     +     
  9A0C    20 20 20 20     +     
  9A10    20 20 44 20     +     
  9A14    45 20 47 20     +     
  9A18    20 32 30 30     +     
  9A1C    30 20 20 20     +     
  9A20    76 6F 6D 20     +     
  9A24    38 2E 4D 61     +     
  9A28    69 20 38 36     +     
  9A2C    20 0A 0A        +     
  9A2F                          bootme:
  9A2F    00 16 00 00           serial: defb    0,16h,0,0,0,0a5h
  9A33    00 A5                 
                                                                ; Werte stehen nach Init ab Adresse 0000   
                                                                ; ======================================
  9A35    C3 F403               syspa:  jp      abios+3         ; -> wboot
  9A38    95                    iobyt:  defb    095h            ; list=lpt:/punch=ptp:/reader=ptr:/console=crt:
  9A39    00                    cudev:  defb    0               ; current device
  9A3A    C3                            defb    0c3h            ; jp .
  9A3B    E606                  cubdos: defw    abios-0e00h+6   ;  . BDOS
                                ;
  9A3D    C3 F5DC                       jp      ukmb            ; 0008h eintritt bamos kmb
  9A40    C3 F5E2                       jp      uend            ; 000bh warten auf kmb-bereitschaft
  9A43    C3 F5E8                       jp      ugetp           ; 000eh aus kmb-puffer in ram laden
  9A46    FA41                          defw    kmbpuf          ; 0011h adresse eines hilfspuffers
  9A48    F64B                          defw    eatab1          ; 0013h adresse e/a-tabelle 1
  9A4A    F676                          defw    eatab2          ; 0015h adresse e/a-tabelle 2
  9A4C    C3 F5FE                       jp      um1             ; 0017h zuschalten  Version 1.2/Stackumsch.
  9A4F    C3 F639                       jp      um2e            ; 001ah wegschalten Version 1.2/Stackumsch.
  9A52    C3 F60D                       jp      um1r3           ; 001dh zuschalten  Version 1.2
  9A55    C3 F621                       jp      um2             ; 0020h wegschalten Version 1.2
                                ;
                                ;
                                ;
                                        page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-20


                                
                                ;       consol-status
                                ;       =============
                                ;
  9A58                          const::
  9A58    CD 9600                       call    reta            ; iobyte  00 00 00 xx
  9A5B    CD 9617                       call    iodisp          ;    0, 1, 3  crt:
  9A5E    00                            defb    0               ;    2        bat:
  9A5F    9A67                          defw    const0
  9A61    9A67                          defw    const1
  9A63    9ECE                          defw    reads1
  9A65    9A67                          defw    const3
  9A67                          const0:
  9A67                          const1:
  9A67                          const3:
  9A67    CD 9A6D                       call    ciber
  9A6A    C3 9611                       jp      um2ee
                                ;
  9A6D                          ciber::                         ; liefert a = ff wenn taste gedrueckt ist
  9A6D    CD 9F79                       call    ci.sta          ; liefert zero cond. wenn taste gedrueckt ist
  9A70    20 0F                         jr      nz,m002
  9A72    3A F938                       ld      a,(sverz)       ; es ist eine taste gedruckt, jedoch
  9A75    B7                            or      a               ; beim schnellschreiben verzoegern
  9A76    28 06                         jr      z,m001          ;   -> kein schnellschreiben
  9A78    3D                            dec     a
  9A79    32 F938                       ld      (sverz),a
  9A7C    AF                            xor     a               ; keine taste gedrueckt
  9A7D    C9                            ret
                                ;
  9A7E    AF                    m001:   xor     a               ; es ist eine taste gedrueckt
  9A7F    3D                            dec     a
  9A80    C9                            ret
                                ;
  9A81    AF                    m002:   xor     a               ; es ist keine taste gedrueckt
  9A82    32 F938                       ld      (sverz),a       ; kein weiteres verzoegern
  9A85    32 F939                       ld      (sschr),a       ; kein weiteres schnellschreiben
  9A88    C9                    m003:   ret
                                ;       consol eingabe
                                ;       ==============
                                ;
                                 if talt
                                zklein: defw    100h
                                zgros:  defw    800h
                                 else
  9A89    0200                  zklein: defw    200h            ; wartezeit fuer schnellschreiben
  9A8B    2000                  zgros:  defw    2000h
                                 endif
                                ;
                                systa   macro   mark
                                        jp      nz,mark
                                        ld      a,(syste)
                                        dec     a
                                        ld      a,' '
                                        jp      nz,c18          ; --> nicht erlaubt
                                        endm
                                ;
  9A8D                          conin::                         ; iobyte:  00 00 00 xx
  9A8D    CD 9600                       call    reta            ;   0, 1, 3  crt:
  9A90    CD 9617                       call    iodisp          ;   2        bat:
  9A93    00                            defb    0
  9A94    9A9C                          defw    conin0
  9A96    9A9C                          defw    conin1
  9A98    9EE2                          defw    reade1
  9A9A    9A9C                          defw    conin3
  9A9C                          conin0:
  9A9C                          conin1:
  9A9C    CD 9AA2               conin3: call    ci
  9A9F    C3 9611                       jp      um2ee
                                ;
  9AA2                          ci::
  9AA2    AF                            xor     a
  9AA3    32 F938                       ld      (sverz),a       ; damit ciber nicht verzoegert
  9AA6    CD 9A6D                       call    ciber
  9AA9    28 0C                         jr      z,m012          ; -> taste nicht gedrueckt
  9AAB    3A F939                       ld      a,(sschr)
  9AAE    B7                            or      a
  9AAF    28 06                         jr      z,m012
  9AB1    ED 5B 9A89                    ld      de,(zklein)
  9AB5    18 04                         jr      m013
  9AB7    ED 5B 9A8B            m012:   ld      de,(zgros)
  9ABB    CD 9A6D               m013:   call    ciber           ; warten bis taste gedrueckt ist
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-21


  9ABE    28 FB                         jr      z,m013
  9AC0    CD 9F7F                       call    ci.ch           ; zeichen uebernehmen
                                ;
  9AC3    CD 9A6D               m014:   call    ciber
  9AC6    28 0A                         jr      z,m015          ; -> taste wurde losgelassen
  9AC8    1D                            dec     e
  9AC9    20 F8                         jr      nz,m014
  9ACB    15                            dec     d
  9ACC    20 F5                         jr      nz,m014
                                ;
  9ACE    3E FF                         ld      a,0ffh          ; es beginnt schnellschreiben
  9AD0    18 01                         jr      m016
  9AD2    AF                    m015:   xor     a               ; kein schnellschreiben
  9AD3    32 F939               m016:   ld      (sschr),a
  9AD6    32 F938                       ld      (sverz),a
                                        page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-22


                                
                                ;       bearbeitung der sondertasten
                                ;       ============================
                                ;
                                ;   1. eq.sys   zurueck ins urbetriebssystem (falls vorhanden)
                                ;   2. eq.hex   hexadezimale eingabe eines zeichens
                                ;   3. eq.lr0   druckerreset
                                ;   4. eq.lw    laufwerk A auf anderes phys. definieren
                                ;   5. eq.cap   buchstaben gross/kleinschaltung aendern
                                ;   6. eq.gra   geraet A initialisieren
                                ;   7. eq.le1   laden/entladen geraet 1
                                ;   8. eq.le2           "             2
                                ;   9. eq.le3           "             3
                                ;      ...
                                ;  14. eq.sio   leser-/stanzer-Kanal auf ATS-Kanal A bzw. B schalten
                                ;  15. eq.ini   init. laufwerk O , P
                                ;  16. eq.scp   monitorsteuerung SCP
                                ;  17. eq.bcu   monitorsteuerung BCU
                                ;  18. eq.deg   monitorsteuerung DEG
                                ;  19. eq.bsd   bildschirm drucken
                                ;
  9AD9    78                            ld      a,b
                                ;
                                 if eq.sys ne 0
  9ADA    FE CD                         cp      eq.sys          ; S Y S ?
  9ADC    C2 9AEB                       jp      nz,c03          ; -------
  9ADF    3A F935                       ld      a,(syste)
  9AE2    3D                            dec     a
  9AE3    3E 1B                         ld      a,1bh
  9AE5    C2 9E3B                       jp      nz,c18          ; --> Taste entspricht der ESC-Taste
                                        gosys                   ; zurueck ins urbetriebssystem
  9AE8    C3 0000         +             jp      0
                                 endif
                                ;
  9AEB                          c03:
                                 if eq.cap ne 0
  9AEB    FE FF                         cp      eq.cap          ; E 0 ?
  9AED    20 0B                         jr      nz,c08          ; -----
  9AEF    3A F933                       ld      a,(umsch)       ; standard shiftposition aendern
  9AF2    EE 20                         xor     20h
  9AF4    32 F933                       ld      (umsch),a
  9AF7    C3 9AA2                       jp      ci
                                 endif
                                ;
  9AFA                          c08:
                                 if eq.hex ne 0
  9AFA    FE FE                         cp      eq.hex          ; E 1 ?
  9AFC    20 10                         jr      nz,c04          ; -----
  9AFE    CD 9E44                       call    cbit4           ; hexaeingabe eines zeichens
  9B01    B7                            or      a
  9B02    17                            rla
  9B03    17                            rla
  9B04    17                            rla
  9B05    17                            rla
  9B06    4F                            ld      c,a
  9B07    CD 9E44                       call    cbit4
  9B0A    81                            add     a,c
  9B0B    C3 9E3B                       jp      c18
                                 endif
                                ;
  9B0E                          c04:
                                 if eq.lr0 ne 0
  9B0E    FE FD                         cp      eq.lr0          ; E 2 ?
                                        systa   c06             ; -----
  9B10    C2 9BA5         +             jp      nz,c06
  9B13    3A F935         +             ld      a,(syste)
  9B16    3D              +             dec     a
  9B17    3E 20           +             ld      a,' '
  9B19    C2 9E3B         +             jp      nz,c18          ; --> nicht erlaubt
  9B1C    31 FBC1                       ld      sp,spber        ; druckerinitialisierung
  9B1F    CD 96E5                       call    um11
  9B22    CD 96C1                       call    setp0
  9B25    11 9B7E               lr011:  ld      de,lrtxt
  9B28    0E 09                         ld      c,9
  9B2A    CD 0005                       call    5
  9B2D    11 F93A                       ld      de,ccppuf
  9B30    0E 0A                         ld      c,10
  9B32    CD 0005                       call    5
  9B35    3A F93B                       ld      a,(ccppuf+1)    ; laenge der eingabe
  9B38    FE 03                         cp      3
  9B3A    20 E9                         jr      nz,lr011
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-23


  9B3C    3A F93C                       ld      a,(ccppuf+2)
  9B3F    DD 21 0F73                    ld      ix,eadr+3
  9B43    06 00                         ld      b,0
  9B45    FE 30                         cp      '0'
  9B47    28 06                         jr      z,lr012
  9B49    FE 32                         cp      '2'
  9B4B    20 02                         jr      nz,lr012
  9B4D    CB C0                         set     0,b
  9B4F    3A F93D               lr012:  ld      a,(ccppuf+3)
  9B52    FE 36                         cp      '6'
  9B54    28 06                         jr      z,lr014
  9B56    FE 38                         cp      '8'
  9B58    20 02                         jr      nz,lr014
  9B5A    CB C8                         set     1,b
  9B5C    3A F93E               lr014:  ld      a,(ccppuf+4)
  9B5F    FE 4F                         cp      'O'
  9B61    28 08                         jr      z,lr016
  9B63    FE 4D                         cp      'M'
  9B65    20 04                         jr      nz,lr016
  9B67    3E FF                         ld      a,-1
  9B69    18 01                         jr      lr017
  9B6B    AF                    lr016:  xor     a
  9B6C    CD 96D3               lr017:  call    resp0
  9B6F    DD 70 04                      ld      (ix+4),b
  9B72    DD 77 0C                      ld      (ix+12),a
  9B75    CD A2D9                       call    lo.reset        ; druckerreset
  9B78    CD 96D3               p0::    call    resp0
  9B7B    C3 97FD                       jp      wboot
  9B7E    0D 0A 44 72           lrtxt:  defb    cr,lf,'Drucker - Parameter { 0|2 6|8 O|M } $'
  9B82    75 63 6B 65           
  9B86    72 20 2D 20           
  9B8A    50 61 72 61           
  9B8E    6D 65 74 65           
  9B92    72 20 7B 20           
  9B96    30 7C 32 20           
  9B9A    36 7C 38 20           
  9B9E    4F 7C 4D 20           
  9BA2    7D 20 24              
                                 endif
                                ;
  9BA5                          c06:
                                 if eq.lw ne 0
  9BA5    FE FC                         cp      eq.lw           ; E 3 ?
                                        systa   c07             ; -----
  9BA7    C2 9C59         +             jp      nz,c07
  9BAA    3A F935         +             ld      a,(syste)
  9BAD    3D              +             dec     a
  9BAE    3E 20           +             ld      a,' '
  9BB0    C2 9E3B         +             jp      nz,c18          ; --> nicht erlaubt
  9BB3    31 FBC1                       ld      sp,spber        ; laufwerk A austauschen
  9BB6    CD 96E5                       call    um11
  9BB9    CD 96C1                       call    setp0
  9BBC    11 9C34                       ld      de,defa
  9BBF    0E 09                         ld      c,9
  9BC1    CD 0005                       call    5               ; eingabe anfordern
  9BC4    11 F93A                       ld      de,ccppuf
  9BC7    0E 0A                         ld      c,10
  9BC9    CD 0005                       call    5               ; eingabe
  9BCC    3A F93B                       ld      a,(ccppuf+1)    ; laenge der eingabe
  9BCF    B7                            or      a
  9BD0    28 24                         jr      z,c069
  9BD2    3A F93C                       ld      a,(ccppuf+2)    ; laufwerksangabe
  9BD5    FE 71                         cp      'q'
  9BD7    30 1D                         jr      nc,c069
  9BD9    FE 61                         cp      'a'
  9BDB    38 04                         jr      c,c062
  9BDD    D6 20                         sub     20h
  9BDF    18 08                         jr      c061
  9BE1    FE 51                 c062:   cp      'Q'
  9BE3    30 11                         jr      nc,c069
  9BE5    FE 41                         cp      'A'
  9BE7    38 0D                         jr      c,c069
  9BE9    D6 41                 c061:   sub     41h
  9BEB    F5                            push    af
  9BEC    CD 9C1E                       call    exch2
  9BEF    F1                            pop     af
  9BF0    32 0043                       ld      (lwa),a
  9BF3    CD 9C1E                       call    exch2
  9BF6    3A 0043               c069:   ld      a,(lwa)
  9BF9    C6 41                         add     a,41h
  9BFB    32 9C51                       ld      (defa2+12),a
  9BFE    11 9C45                       ld      de,defa2
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-24


  9C01    0E 09                         ld      c,9
  9C03    CD 0005                       call    5
  9C06    C3 9B78                       jp      p0
                                ;
  9C09    7E                    exch:   ld      a,(hl)
  9C0A    EB                            ex      de,hl
  9C0B    46                            ld      b,(hl)
  9C0C    77                            ld      (hl),a
  9C0D    EB                            ex      de,hl
  9C0E    70                            ld      (hl),b
  9C0F    C9                            ret
  9C10    E5                    exch1:  push    hl
  9C11    D1                            pop     de
  9C12    09                            add     hl,bc
  9C13    CD 9C09                       call    exch
  9C16    23                            inc     hl
  9C17    13                            inc     de
  9C18    CD 9C09                       call    exch
  9C1B    06 00                         ld      b,0
  9C1D    C9                            ret
  9C1E    3A 0043               exch2:  ld      a,(lwa)
  9C21    B7                            or      a
  9C22    C8                            ret     z
  9C23    87                            add     a,a
  9C24    06 00                         ld      b,0
  9C26    4F                            ld      c,a
  9C27    21 F748                       ld      hl,ixtab
  9C2A    CD 9C10                       call    exch1
  9C2D    21 F7F8                       ld      hl,dpha
  9C30    CD 9C10                       call    exch1
  9C33    C9                            ret
  9C34    0D 0A 4C 61           defa:   defb    cr,lf,'Laufwerk A := $'
  9C38    75 66 77 65           
  9C3C    72 6B 20 41           
  9C40    20 3A 3D 20           
  9C44    24                    
  9C45    0D 0A 0A 4C           defa2:  defb    cr,lf,lf,'Laufwerk . <=> A$'
  9C49    61 75 66 77           
  9C4D    65 72 6B 20           
  9C51    2E 20 3C 3D           
  9C55    3E 20 41 24           
                                 endif
                                ;
  9C59                          c07:
                                 if eq.gra ne 0
                                        cp      eq.gra          ; pf1?
                                        systa   c09             ; ----
                                        ld      sp,spber        ; geraet A initialisieren
                                        call    um11
                                        call    setp0
                                        ld      de,setams
                                        ld      c,9
                                        call    5
                                        ld      de,ccppuf
                                        ld      c,10
                                        call    5
                                        ld      a,(ccppuf+1) ; laenge der eingabe
                                        or      a
                                        jr      z,c082       ; keine eingabe ---> laufwerk A nicht init.
                                        ld      a,(ccppuf+2) ; eingabe = "j" bzw. "J"
                                        cp      'j'
                                        jr      z,c081       ; JA
                                        cp      'J'
                                        jr      nz,c082      ; NEIN
                                c081:
                                        call    resp0
                                        call    dirdel
                                c082:
                                        jp      p0
                                setams:
                                        defb    cr,lf,'Laufwerk A initialisieren {J|N} ? $'
                                 endif
                                ;
  9C59                          c09:
  9C59    FE 81                         cp      eq.le1          ; pf2?
  9C5B    20 2D                         jr      nz,c10          ; ----
  9C5D    DD 21 F64B                    ld      ix,eatab1       ; kassettenlaufwerk 1
  9C61    1E 01                         ld      e,1
  9C63    CD 9638                       call    ldhldp
  9C66    11 F798                       ld      de,dphc1
                                ;
  9C69                          km.le:
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-25


  9C69    E5                            push    hl              ; kassette laden/entladen
  9C6A    D5                            push    de
  9C6B    DD 7E 1D                      ld      a,(ix+gelade)
  9C6E    B7                            or      a
  9C6F    20 0C                         jr      nz,km.le1       ; -> entladen
  9C71    CD A53C                       call    clad            ; laden
  9C74    D1                            pop     de
  9C75    E1                            pop     hl
  9C76    20 0F                         jr      nz,km.le2       ; -> fehler beim laden
  9C78    73                            ld      (hl),e          ; geraet als geladen in dph-tabelle eintragen
  9C79    23                            inc     hl
  9C7A    72                            ld      (hl),d
  9C7B    18 0A                         jr      km.le2
                                ;
  9C7D                          km.le1:
  9C7D    CD A58E                       call    centl           ; b entladen
  9C80    D1                            pop     de
  9C81    E1                            pop     hl
  9C82    36 00                         ld      (hl),0          ; geraet aus dph-tabelle streichen
  9C84    23                            inc     hl
  9C85    36 00                         ld      (hl),0
  9C87                          km.le2:
  9C87    C3 9AA2                       jp      ci
                                ;
  9C8A                          c10:
  9C8A    FE 82                         cp      eq.le2          ; pf3?
  9C8C    20 0E                         jr      nz,c11          ; ----
  9C8E    DD 21 F676                    ld      ix,eatab2       ; kassettenlaufwerk 2
  9C92    1E 02                         ld      e,2
  9C94    CD 9638                       call    ldhldp
  9C97    11 F7A8                       ld      de,dphc2
  9C9A    18 CD                         jr      km.le
                                ;
  9C9C                          c11:
                                 if anzakb gt 1
  9C9C    FE 8C                         cp      eq.le3          ; pf4?
  9C9E    20 0E                         jr      nz,c12          ; ----
  9CA0    DD 21 F6A1                    ld      ix,eatab3       ; kassettenlaufwerk 3
  9CA4    1E 03                         ld      e,3
  9CA6    CD 9638                       call    ldhldp
  9CA9    11 F7B8                       ld      de,dphc3
  9CAC    18 BB                         jr      km.le
                                ;
  9CAE                          c12:
  9CAE    FE 8C                         cp      eq.le4          ; pf5?
  9CB0    20 0E                         jr      nz,c13          ; ----
  9CB2    DD 21 F6CC                    ld      ix,eatab4       ; kassettenlaufwerk 4
  9CB6    1E 04                         ld      e,4
  9CB8    CD 9638                       call    ldhldp
  9CBB    11 F7C8                       ld      de,dphc4
  9CBE    18 A9                         jr      km.le
                                 endif
                                ;
  9CC0                          c13:
                                 if anzakb gt 2
  9CC0    FE 8C                         cp      eq.le5          ; pf6?
  9CC2    20 0E                         jr      nz,c14          ; ----
  9CC4    DD 21 F6F7                    ld      ix,eatab5       ; kassettenlaufwerk 5
  9CC8    1E 05                         ld      e,5
  9CCA    CD 9638                       call    ldhldp
  9CCD    11 F7D8                       ld      de,dphc5
  9CD0    18 97                         jr      km.le
                                ;
  9CD2                          c14:
  9CD2    FE 8C                         cp      eq.le6          ; pf7?
  9CD4    20 0E                         jr      nz,c17          ; ----
  9CD6    DD 21 F722                    ld      ix,eatab6       ; kassettenlaufwerk 6
  9CDA    1E 06                         ld      e,6
  9CDC    CD 9638                       call    ldhldp
  9CDF    11 F7E8                       ld      de,dphc6
  9CE2    18 85                         jr      km.le
                                 endif
                                ;
  9CE4                          c17:
                                 if eq.sio ne 0
  9CE4    FE 87                         cp      eq.sio          ; pf8?
                                        systa   c189            ; ----
  9CE6    C2 9D5F         +             jp      nz,c189
  9CE9    3A F935         +             ld      a,(syste)
  9CEC    3D              +             dec     a
  9CED    3E 20           +             ld      a,' '
  9CEF    C2 9E3B         +             jp      nz,c18          ; --> nicht erlaubt
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-26


  9CF2    31 FBC1                       ld      sp,spber        ; init. ATS-Kanal A bzw. B
  9CF5    CD 96E5                       call    um11
  9CF8    CD 96C1                       call    setp0
  9CFB    11 9D48                       ld      de,siot1
  9CFE    0E 09                         ld      c,9
  9D00    CD 0005                       call    5
  9D03    11 F93A                       ld      de,ccppuf
  9D06    0E 0A                         ld      c,10
  9D08    CD 0005                       call    5
  9D0B    3A F93B                       ld      a,(ccppuf+1)
  9D0E    B7                            or      a
  9D0F    CA 0000                       jp      z,0
  9D12    3A F93C                       ld      a,(ccppuf+2)
  9D15    FE 61                         cp      'a'
  9D17    28 0F                         jr      z,sioa
  9D19    FE 41                         cp      'A'
  9D1B    28 0B                         jr      z,sioa
  9D1D    FE 62                         cp      'b'
  9D1F    28 17                         jr      z,siob
  9D21    FE 42                         cp      'B'
  9D23    28 13                         jr      z,siob
  9D25    C3 9B78                       jp      p0
                                ;
  9D28                          sioa:
  9D28    CD A34B                       call    ri.ata
  9D2B    3A 0003                       ld      a,(3)
  9D2E    E6 C3                         and     11000011b
  9D30    F6 28                         or      00101000b
  9D32    32 0003                       ld      (3),a
  9D35    C3 9B78                       jp      p0
  9D38                          siob:
  9D38    CD A36C                       call    ri.atb
  9D3B    3A 0003                       ld      a,(3)
  9D3E    E6 C3                         and     11000011b
  9D40    F6 3C                         or      00111100b
  9D42    32 0003                       ld      (3),a
  9D45    C3 9B78                       jp      p0
  9D48    0D 0A 41 54           siot1:  defb    cr,lf,'ATS-Kanal { A|B } : $'
  9D4C    53 2D 4B 61           
  9D50    6E 61 6C 20           
  9D54    7B 20 41 7C           
  9D58    42 20 7D 20           
  9D5C    3A 20 24              
                                 endif
                                ;
  9D5F                          c189:
                                 if eq.ini ne 0   and   ( tramdk or opsdk )
                                        cp      eq.ini          ; pf9?
                                        systa   c175            ; ----
                                        ld      sp,spber        ; init. laufwerk O , P
                                        call    um11
                                        call    setp0
                                        ld      de,int1
                                        ld      c,9
                                        call    5
                                        ld      de,ccppuf
                                        ld      c,10
                                        call    5               ; eingabe des laufwerkes
                                        ld      a,(ccppuf+1)
                                        or      a
                                        jp      z,0
                                        ld      a,(ccppuf+2)    ; laufwerksangabe
                                        cp      'o'
                                        jr      z,ino1
                                        cp      'O'
                                        jr      z,ino1
                                        cp      'p'
                                        jr      z,inp3
                                        cp      'P'
                                        jr      z,inp3
                                        jp      p0
                                ino1:
                                 if tramdk
                                        call    md.ino
                                 endif
                                        jp      p0
                                inp3:
                                 if opsdk
                                        call    md.inp
                                 endif
                                        jp      p0
                                int1:   db      cr,lf,'Init Laufwerk { O|P } : $'
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-27


                                 endif
                                ;
  9D5F                          c175:
                                 if eq.scp ne 0
  9D5F    FE 89                         cp      eq.scp          ; pf10
                                        systa   c170            ; -----
  9D61    C2 9D95         +             jp      nz,c170
  9D64    3A F935         +             ld      a,(syste)
  9D67    3D              +             dec     a
  9D68    3E 20           +             ld      a,' '
  9D6A    C2 9E3B         +             jp      nz,c18          ; --> nicht erlaubt
  9D6D    31 FBC1                       ld      sp,spber        ; monitor SCP
  9D70    CD 96E5                       call    um11
  9D73    CD 96C1                       call    setp0
  9D76    CD A272                       call    co.scp
  9D79    11 9D84                       ld      de,mon3
  9D7C    0E 09                         ld      c,9
  9D7E    CD 0005                       call    5
  9D81    C3 9B78                       jp      p0
  9D84    0D 0A 6D 6F           mon3:   db      cr,lf,'monitor  S C P$'
  9D88    6E 69 74 6F           
  9D8C    72 20 20 53           
  9D90    20 43 20 50           
  9D94    24                    
                                 endif
                                ;
  9D95                          c170:
                                 if eq.bcu ne 0
  9D95    FE 8A                         cp      eq.bcu          ; pf11?
                                        systa   c173            ; -----
  9D97    C2 9DCB         +             jp      nz,c173
  9D9A    3A F935         +             ld      a,(syste)
  9D9D    3D              +             dec     a
  9D9E    3E 20           +             ld      a,' '
  9DA0    C2 9E3B         +             jp      nz,c18          ; --> nicht erlaubt
  9DA3    31 FBC1                       ld      sp,spber        ; monitor BCU
  9DA6    CD 96E5                       call    um11
  9DA9    CD 96C1                       call    setp0
  9DAC    CD A273                       call    co.bcu
  9DAF    11 9DBA                       ld      de,mon1
  9DB2    0E 09                         ld      c,9
  9DB4    CD 0005                       call    5
  9DB7    C3 9B78                       jp      p0
  9DBA    0D 0A 6D 6F           mon1:   db      cr,lf,'monitor  B C U$'
  9DBE    6E 69 74 6F           
  9DC2    72 20 20 42           
  9DC6    20 43 20 55           
  9DCA    24                    
                                 endif
                                ;
  9DCB                          c173:
                                 if eq.deg ne 0
  9DCB    FE 8B                         cp      eq.deg          ; pf12?
                                        systa   c174            ; -----
  9DCD    C2 9E01         +             jp      nz,c174
  9DD0    3A F935         +             ld      a,(syste)
  9DD3    3D              +             dec     a
  9DD4    3E 20           +             ld      a,' '
  9DD6    C2 9E3B         +             jp      nz,c18          ; --> nicht erlaubt
  9DD9    31 FBC1                       ld      sp,spber        ; monitor DEG
  9DDC    CD 96E5                       call    um11
  9DDF    CD 96C1                       call    setp0
  9DE2    CD A2A6                       call    co.deg
  9DE5    11 9DF0                       ld      de,mon2
  9DE8    0E 09                         ld      c,9
  9DEA    CD 0005                       call    5
  9DED    C3 9B78                       jp      p0
  9DF0    0D 0A 6D 6F           mon2:   db      cr,lf,'monitor  D E G$'
  9DF4    6E 69 74 6F           
  9DF8    72 20 20 44           
  9DFC    20 45 20 47           
  9E00    24                    
                                 endif
                                ;
  9E01                          c174:
                                 if eq.bsd ne 0
  9E01    FE CE                         cp      eq.bsd          ; H C P ?
  9E03    20 36                         jr      nz,c18          ; -------
  9E05    06 18                         ld      b,maxz          ; bildschirminhalt ausdrucken
  9E07    21 3000                       ld      hl,bsanf
  9E0A                          c171:
  9E0A    C5                            push    bc
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-28


  9E0B    E5                            push    hl
  9E0C    3E 0A                         ld      a,lf
  9E0E    4F                            ld      c,a
  9E0F    CD A2EF                       call    lo.ch
  9E12    3E 0D                         ld      a,cr
  9E14    4F                            ld      c,a
  9E15    CD A2EF                       call    lo.ch
  9E18    E1                            pop     hl
  9E19    06 50                         ld      b,maxs
  9E1B                          c172:
  9E1B    C5                            push    bc
  9E1C    7E                            ld      a,(hl)
  9E1D    23                            inc     hl
  9E1E    E5                            push    hl
  9E1F    E6 7F                         and     07fh
  9E21    4F                            ld      c,a
  9E22    CD A2EF                       call    lo.ch
  9E25    E1                            pop     hl
  9E26    C1                            pop     bc
  9E27    10 F2                         djnz    c172
  9E29    C1                            pop     bc
  9E2A    10 DE                         djnz    c171
  9E2C    3E 0A                         ld      a,lf
  9E2E    4F                            ld      c,a
  9E2F    CD A2EF                       call    lo.ch
  9E32    3E 0D                         ld      a,cr
  9E34    4F                            ld      c,a
  9E35    CD A2EF                       call    lo.ch
  9E38    C3 9AA2                       jp      ci
                                 endif
                                ;
  9E3B                          c18:
  9E3B    47                            ld      b,a
  9E3C    AF                            xor     a
  9E3D    32 F935                       ld      (syste),a
  9E40    78                            ld      a,b
  9E41    E6 7F                         and     07fh            ; paritaet loeschen
  9E43    C9                            ret
                                ;
                                ;----------------------------------------------------------------------
                                ;
                                 if eq.hex ne 0
  9E44                          cbit4:
  9E44    C5                            push    bc
  9E45    AF                            xor     a
  9E46    32 F938                       ld      (sverz),a
  9E49                          cbit41:
  9E49    CD 9A6D                       call    ciber           ; warten bis taste losgelassen
  9E4C    20 FB                         jr      nz,cbit41
  9E4E                          cbit42:
  9E4E    CD 9A6D                       call    ciber           ; warten bis taste gedrueckt
  9E51    28 FB                         jr      z,cbit42
                                ;
  9E53    CD 9F7F                       call    ci.ch           ; zeichen uebernehmen
  9E56    47                            ld      b,a
  9E57                          cbit43:
  9E57    CD 9A6D                       call    ciber           ; warten bis taste losgelassen
  9E5A    20 FB                         jr      nz,cbit43
  9E5C    78                            ld      a,b
  9E5D    E6 7F                         and     7fh
  9E5F    FE 41                         cp      41h
  9E61    38 02                         jr      c,cbit44
  9E63    D6 07                         sub     7
  9E65                          cbit44:
  9E65    D6 30                         sub     30h
  9E67    E6 0F                         and     0fh
  9E69    C1                            pop     bc
  9E6A    C9                            ret
                                 endif
                                ;
                                ;
                                ;
                                        page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-29


                                
                                ;       console ausgabe
                                ;       ===============
                                ;
  9E6B                          conou::                ; iobyte:   00 00 00 xx
  9E6B    CD 9600                       call    reta   ;   0, 1  crt:
  9E6E    F5                            push    af     ;   2     bat:
  9E6F    CD 9617                       call    iodisp ;   3     crt: + lpt:
  9E72    00                            defb    0
  9E73    9E7B                          defw    conou0
  9E75    9E7B                          defw    conou1
  9E77    9EA3                          defw    listx
  9E79    9E82                          defw    conou3
  9E7B                          conou0:
  9E7B                          conou1:
  9E7B    CD 9FDC                       call    co.ch
  9E7E    F1                            pop     af
  9E7F    C3 9611                       jp      um2ee
  9E82                          conou3:
  9E82    CD 9FDC                       call    co.ch
  9E85    CD A2EF                       call    lo.ch
  9E88    F1                            pop     af
  9E89    C3 9611                       jp      um2ee
                                
                                ;       drucker ausgabe
                                ;       ===============
                                ;
  9E8C                          listst::
  9E8C    CD 9600                       call    reta
  9E8F    CD 9617                       call    iodisp
  9E92    06                            defb    6
  9E93    9E9B                          defw    lsst0
  9E95    9E9B                          defw    lsst1
  9E97    9E9B                          defw    lsst2
  9E99    9E9B                          defw    lsst3
  9E9B                          lsst0:
  9E9B                          lsst1:
  9E9B                          lsst2:
  9E9B                          lsst3:
  9E9B    AF                            xor     a       ; immer bereit
  9E9C    C3 9611                       jp      um2ee
                                ;
  9E9F                          list::                  ; iobyte:  xx 00 00 00
  9E9F    CD 9600                       call    reta    ;   0                   ATS-Kanal A
  9EA2    F5                            push    af      ;   1        crt:
  9EA3                          listx:
  9EA3    CD 9617                       call    iodisp  ;   2        lpt:
  9EA6    06                            defb    6       ;   3                   ATS-Kanal B
  9EA7    9EAF                          defw    list0
  9EA9    9EB6                          defw    list1
  9EAB    9EBD                          defw    list2
  9EAD    9EC4                          defw    list3
  9EAF                          list0:
  9EAF    CD A3A1                       call    pu1.ch
  9EB2    F1                            pop     af
  9EB3    C3 9611                       jp      um2ee
  9EB6                          list1:
  9EB6    CD 9FDC                       call    co.ch
  9EB9    F1                            pop     af
  9EBA    C3 9611                       jp      um2ee
  9EBD                          list2:
  9EBD    CD A2EF                       call    lo.ch
  9EC0    F1                            pop     af
  9EC1    C3 9611                       jp      um2ee
  9EC4                          list3:
  9EC4    CD A3B6                       call    pu2.ch
  9EC7    F1                            pop     af
  9EC8    C3 9611                       jp      um2ee
                                ;
                                ;
                                ;
                                        page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-30


                                
                                ;       leser eingabe
                                ;       =============
                                ;
  9ECB                          readst::
  9ECB    CD 9600                       call    reta
  9ECE                          reads1:
  9ECE    CD 9617                       call    iodisp
  9ED1    02                            defb    2
  9ED2    9EDA                          defw    rdst0
  9ED4    9EDA                          defw    rdst1
  9ED6    9EDA                          defw    rdst2
  9ED8    9EDA                          defw    rdst3
  9EDA                          rdst0:
  9EDA                          rdst1:
  9EDA                          rdst2:
  9EDA                          rdst3:
  9EDA    AF                            xor     a
  9EDB    3D                            dec     a
  9EDC    C3 9611                       jp      um2ee
                                ;
  9EDF                          reader::               ; iobyte:   00 00 xx 00
  9EDF    CD 9600                       call    reta   ;   0     crt:
  9EE2                          reade1:
  9EE2    CD 9617                       call    iodisp ;   1     ptr:
  9EE5    02                            defb    2      ;   2      ur1:  ATS-Kanal A
  9EE6    9EEE                          defw    read0  ;   3      ur2:  ATS-Kanal B
  9EE8    9EF4                          defw    read1
  9EEA    9EFC                          defw    read2
  9EEC    9F02                          defw    read3
  9EEE                          read0:
  9EEE    CD 9F7F                       call    ci.ch
  9EF1    C3 9611                       jp      um2ee
  9EF4                          read1:
  9EF4    CD A301                       call    ri.ch
  9EF7    E6 7F                         and     7fh
  9EF9    C3 9611                       jp      um2ee
  9EFC                          read2:
  9EFC    CD A313                       call    ri1.ch
  9EFF    C3 9611                       jp      um2ee
  9F02                          read3:
  9F02    CD A32F                       call    ri2.ch
  9F05    C3 9611                       jp      um2ee
                                
                                ;       stanzer ausgabe
                                ;       ===============
                                ;
  9F08                          punch::                 ; iobyte:   00 xx 00 00
  9F08    CD 9600                       call    reta    ;   0        crt:
  9F0B    F5                            push    af      ;   1        ptp:
  9F0C    CD 9617                       call    iodisp  ;   2        up1:       ATS-Kanal A
  9F0F    04                            defb    4       ;   3        up2:       ATS-Kanal B
  9F10    9F18                          defw    punch0
  9F12    9F1F                          defw    punch1
  9F14    9F26                          defw    punch2
  9F16    9F2D                          defw    punch3
  9F18                          punch0:
  9F18    CD 9FDC                       call    co.ch
  9F1B    F1                            pop     af
  9F1C    C3 9611                       jp      um2ee
  9F1F                          punch1:
  9F1F    CD A38F                       call    pu.ch
  9F22    F1                            pop     af
  9F23    C3 9611                       jp      um2ee
  9F26                          punch2:
  9F26    CD A3A1                       call    pu1.ch
  9F29    F1                            pop     af
  9F2A    C3 9611                       jp      um2ee
  9F2D                          punch3:
  9F2D    CD A3B6                       call    pu2.ch
  9F30    F1                            pop     af
  9F31    C3 9611                       jp      um2ee
                                ;
                                ;
                                ;
                                        page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-31


                                
                         C              include CI.MAC
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-32


                         C      
                         C      ;       tastaturbedienung ueber DEG2000 Version 1.2  ---  EPROM 6C
                         C      ;       ==========================================================
                         C      ;
  4003                   C      tta1    equ     ttinit+3
  4006                   C      tta2    equ     ttinit+6
  400C                   C      ttfe    equ     ttinit+12
  4015                   C      ttbel   equ     ttinit+15h
                         C      ;
  9F34    FF             C      umerk:  defb    0ffh
                         C      ;
                         C      ;
                         C      ta      macro   up
                         C              ld      a,ptast
                         C              call    up
                         C              endm
                         C      ;
                         C      ;
  9F35                   C      tinit::
                         C              ta      ttinit
  9F35    3E A0          C+             ld      a,ptast
  9F37    CD 4000        C+             call    ttinit
  9F3A    C9             C              ret
                         C      ;
                         C      ;
  9F3B                   C      ta1::
                         C              ta      tta1
  9F3B    3E A0          C+             ld      a,ptast
  9F3D    CD 4003        C+             call    tta1
  9F40    32 9F34        C              ld      (umerk),a
  9F43    C9             C              ret
                         C      ;
                         C      ;
  9F44                   C      ta2::
                         C              ta      tta2
  9F44    3E A0          C+             ld      a,ptast
  9F46    CD 4006        C+             call    tta2
  9F49    C5             C              push    bc
  9F4A    47             C              ld      b,a
                         C       if not talt
  9F4B    3A 9F34        C              ld      a,(umerk)
  9F4E    CB 57          C              bit     2,a
  9F50    20 14          C              jr      nz,ta21
                         C       endif
  9F52    78             C              ld      a,b
                         C       if talt
                         C              cp      0eeh            ; Test auf CTRL- ^ (1EH)
                         C              jr      z,ta23
                         C              cp      0f0h            ; Test auf CTRL- Zeichen
                         C              jr      nc,ta21
                         C              cp      0d0h
                         C              jr      c,ta21
                         C              sub     0d0h
                         C       else
  9F53    FE 5E          C              cp      05eh            ; Test auf CTRL- ^ (1EH)
  9F55    28 0C          C              jr      z,ta23
  9F57    FE 60          C              cp      060h            ; Test auf CTRL- Zeichen
  9F59    30 0B          C              jr      nc,ta21
  9F5B    FE 40          C              cp      40h
  9F5D    38 07          C              jr      c,ta21
  9F5F    D6 40          C              sub     40h
                         C       endif
  9F61    18 02          C              jr      ta22
                         C      ;
  9F63                   C      ta23:
  9F63    3E EE          C              ld      a,0eeh
  9F65                   C      ta22:
  9F65    47             C              ld      b,a
  9F66                   C      ta21:
  9F66    78             C              ld      a,b
  9F67    C1             C              pop     bc
  9F68    C9             C              ret
                         C      ;
                         C      ;
  9F69                   C      tfe::
                         C              ta      ttfe
  9F69    3E A0          C+             ld      a,ptast
  9F6B    CD 400C        C+             call    ttfe
  9F6E    C9             C              ret
                         C      ;
                         C      ;
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-33


  9F6F                   C      tbel::
                         C              ta      ttbel
  9F6F    3E A0          C+             ld      a,ptast
  9F71    CD 4015        C+             call    ttbel
  9F74    C9             C              ret
                         C      ;
                         C      ;
  9F75                   C      ci.kalt::
  9F75                   C      ci.warm::
  9F75    CD 9F35        C              call    tinit
  9F78    C9             C              ret
                         C      ;
                         C      ;
  9F79                   C      ci.sta::
  9F79    C5             C              push    bc
  9F7A    CD 9F3B        C              call    ta1             ; taste       gedrueckt --> z=1
  9F7D    C1             C              pop     bc
  9F7E    C9             C              ret                     ; taste nicht gedrueckt --> z=0
                         C      ;
                         C      ;
  9F7F                   C      ci.ch::
  9F7F    CD 9F44        C              call    ta2
  9F82    21 9FBA        C              ld      hl,degtab
  9F85    01 0011        C              ld      bc,degend-degtab
  9F88    ED B1          C              cpir
  9F8A    20 07          C              jr      nz,ci1
  9F8C    01 0010        C              ld      bc,cpmtab-degtab-1
  9F8F    09             C              add     hl,bc
  9F90    7E             C              ld      a,(hl)
  9F91    18 1F          C              jr      ci5
  9F93                   C      ci1:
  9F93    F5             C              push    af
  9F94    3A 9F34        C              ld      a,(umerk)
  9F97    CB 57          C              bit     2,a
  9F99    C1             C              pop     bc
  9F9A    78             C              ld      a,b
  9F9B    28 15          C              jr      z,ci5
  9F9D                   C      ci2:
  9F9D    FE 41          C              cp      41h             ; gross- / kleinumwandlung
  9F9F    38 04          C              jr      c,ci3
  9FA1    FE 5B          C              cp      5bh
  9FA3    38 08          C              jr      c,ci4
  9FA5                   C      ci3:
  9FA5    FE 61          C              cp      61h
  9FA7    38 09          C              jr      c,ci5
  9FA9    FE 7B          C              cp      7bh
  9FAB    30 05          C              jr      nc,ci5
  9FAD                   C      ci4:
  9FAD    47             C              ld      b,a
  9FAE    3A F933        C              ld      a,(umsch)       ; maske fuer umwandlung
  9FB1    A8             C              xor     b
  9FB2                   C      ci5:
  9FB2    47             C              ld      b,a
  9FB3    C9             C              ret
                         C      ;
                         C      ;
  9FB4                   C      ci.bell::
  9FB4    06 40          C              ld      b,40h
  9FB6    CD 9F6F        C              call    tbel
  9FB9    C9             C              ret
                         C      ;       umschluesseltabelle
                         C      ;       ===================
                         C      ;
  9FBA                   C      degtab:
  9FBA    1E F0 F1 CF    C              defb    01eh,0f0h,0f1h,0cfh,0f2h,0f3h
  9FBE    F2 F3          C      
  9FC0    F4 F5 F6 F7    C              defb    0f4h,0f5h,0f6h,0f7h,0f8h,0f9h
  9FC4    F8 F9          C      
  9FC6    EE FA FB B0    C              defb    0eeh,0fah,0fbh,0b0h,0cch
  9FCA    CC             C      
  9FCB                   C      degend:
  9FCB                   C      cpmtab:
  9FCB    0D 16 7F 13    C              defb    00dh,016h,07fh,013h,00eh,019h
  9FCF    0E 19          C      
  9FD1    17 05 12 08    C              defb    017h,005h,012h,008h,00ch,004h
  9FD5    0C 04          C      
  9FD7    1E 1A 18 03    C              defb    01eh,01ah,018h,003h,012h
  9FDB    12             C      
                         C      ;
                         C      ;
                                ;       
                                
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-34


                                
                         C              include CO.MAC
                         C      ;       direkte cursorbedienung bei monitor  DEG
                         C      ;       ========================================
                         C      ;
                         C      ;  1b 01,0d  CR    zum Zeilenanfang
                         C      ;  1b 02,0a  LF    Kursor eine Zeile tiefer; evt. rollen
                         C      ;  1b 1e     HOME  Kursor in Zeile 1, Spalte 1
                         C      ;  08        BS    setzt Kursor eine Position zurueck; in homepos. wirkungslos
                         C      ;  1b 10     EOS   loescht den Bildschirm ab Kursorpos. bis Bildschirmende
                         C      ;  1b 0b     UP    setzt den Kursor zyklisch eine Zeile hoeher
                         C      ;  1b 0c     RIGHT setzt den Kursor zyklische eine Position weiter
                         C      ;  1b 1f     NL    setzt Kursor in die naechste Zeile auf den Anfang
                         C      ;  09        TAB   setzt Kursor auf naechste durch 8 teilbare Position
                         C      ;  1a        CLEAR loescht den gesamten Bildschirm und setzt Kursor home
                         C      ;  1b ':'    EOS   loescht den Bildschirm und laesst Kursor unveraendert
                         C      ;  1b 'R'    DELL  stellt Kursor auf Z.anf., loescht die Zeile und rollt Z. nach
                         C      ;  1b 'E'    INSL  stellt Kursor auf Z.anf., rollt Zeilen eins tiefer und loescht die Zeile
                         C      ;  1b 'T'    EOL   loescht die Zeile ab Kursorposition bis Zeilenende
                         C      ;  1b '=' rc POS   positioniert den Kursor auf Zeile r-20h und Spalte c-20h
                         C      ;  1b '1'    SRMOD setzt speziellen Rollmodus
                         C      ;  1b '0'    RRMOD setzt normalen   Rollmodus
                         C      ;
  9FDC                   C      co.ch::
  9FDC    CD 96C1        C              call    setp0
  9FDF    CD A264        C              call    rescur
  9FE2    C5             C              push    bc              ; zeichen in c muss erhalten bleiben
  9FE3    79             C              ld      a,c
  9FE4    21 F932        C              ld      hl,qesc
  9FE7    CB 46          C              bit     qesc0,(hl)      ; lauft steuerfolge?
  9FE9    20 0C          C              jr      nz,co.c2        ; -> ja
  9FEB    FE 1B          C              cp      esc             ; beginnt steuerfolge?
  9FED    C2 A06F        C              jp      nz,co.c10               ; -> nein
  9FF0    CB C6          C              set     qesc0,(hl)      ; es beginnt steuerfolge
  9FF2                   C      co.c1:
  9FF2    CB 8E          C              res     qesc1,(hl)      ;                              "set       /BCU"
  9FF4    C3 A0AD        C              jp      co.c16          ;                              "   co.c3+3/BCU"
                         C      ;
  9FF7                   C      co.c2:
  9FF7    CB 4E          C              bit     qesc1,(hl)      ; ist steuerzeichen schon eingetroffen?
  9FF9                   C      co.c3:
  9FF9    C2 A04A        C              jp      nz,co.c4        ; -> ja, es folgt r oder c     "jp        /BCU"
  9FFC    FE 3D          C              cp      '='             ; nein, es folgt steuerzeichen "res 2,(hl)/BCU"
  9FFE    CA A068        C              jp      z,co.c9         ; -> 1b '=' rc                 "jp co.c16 /BCU"
  A001    CD A22C        C              call    evtrol          ; evtl. verzoegertes rollen ausfuehren
  A004    CB 86          C              res     qesc0,(hl)      ; bearbeitung der steuerfolge beendet
  A006    FE 54          C              cp      'T'
  A008    CA A141        C              jp      z,eol           ; -> EOL
  A00B    FE 45          C              cp      'E'
  A00D    CA A153        C              jp      z,insl          ; -> INS LINE
  A010    FE 52          C              cp      'R'
  A012    CA A179        C              jp      z,dell          ; -> DEL LINE
  A015    FE 3A          C              cp      ':'
  A017    CA A1AC        C              jp      z,eos           ; -> EOS
  A01A    FE 1F          C              cp      1fh             ; nl
  A01C    CA A0C8        C              jp      z,co.nl
  A01F    FE 01          C              cp      1               ; cr-ersatz
  A021    CA A0C2        C              jp      z,co.cr
  A024    FE 02          C              cp      2               ; lf-ersatz
  A026    CA A0B5        C              jp      z,co.lf
  A029    FE 1E          C              cp      1eh             ; home
  A02B    CA A0D4        C              jp      z,co.hom
  A02E    FE 10          C              cp      10h             ; eos
  A030    CA A099        C              jp      z,co.c13
  A033    FE 0B          C              cp      0bh             ; up
  A035    CA A125        C              jp      z,co.up
  A038    FE 0C          C              cp      0ch             ; right
  A03A    CA A132        C              jp      z,co.rg
  A03D    FE 31          C              cp      '1'             ; spezieller Rollmodus an
  A03F    CA A1B7        C              jp      z,sroll
  A042    FE 30          C              cp      '0'             ; normaler   Rollmodus an
  A044    CA A1BF        C              jp      z,nroll
  A047    C3 A08F        C              jp      co.c12          ; -> nicht auswertbares steuerzeichen
                         C      ;
  A04A                   C      co.c4:
  A04A    CB 56          C              bit     qesc2,(hl)      ; 1b '=' r c
  A04C    CB D6          C              set     qesc2,(hl)
  A04E    20 09          C              jr      nz,co.c6        ; -> es ist c eingetroffen
  A050                   C      co.c5:
  A050    D6 20          C              sub     20h             ;                              "nop       /BCU"
  A052    38 0C          C              jr      c,co.c7         ; -> zeile war <= 1fh
  A054    32 0040        C              ld      (zeil),a
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-35


  A057    18 09          C              jr      co.c8
  A059                   C      co.c6:
  A059    D6 20          C              sub     20h             ;                              "nop       /BCU"
  A05B    38 03          C              jr      c,co.c7         ; -> spalte war <= 1fh
  A05D    32 0041        C              ld      (spalt),a
  A060                   C      co.c7:
  A060    CB 86          C              res     qesc0,(hl)      ; bearbeitung ist beendet
  A062                   C      co.c8:
  A062    CD A1D3        C              call    bsadr
  A065    C3 A0A9        C              jp      co.c15
                         C      ;
  A068                   C      co.c9:
  A068    CB CE          C              set     qesc1,(hl)
  A06A    CB 96          C              res     qesc2,(hl)      ; es wird r erwartet
  A06C    C3 A0A9        C              jp      co.c15
                         C      ;
                         C      ;
  A06F                   C      co.c10:
  A06F    CD A22C        C              call    evtrol          ; evtl. verzoegertes rollen ausfuehren
  A072    FE 07          C              cp      7               ; bell
  A074    CA A0CE        C              jp      z,co.bel
  A077    FE 08          C              cp      8               ; backspace
  A079    CA A0F2        C              jp      z,co.bs
  A07C    FE 0A          C              cp      lf              ; lf
  A07E    CA A0B5        C              jp      z,co.lf
  A081    FE 0D          C              cp      cr              ; cr
  A083    CA A0C2        C              jp      z,co.cr
  A086    FE 09          C              cp      tab
  A088    28 53          C              jr      z,co.tb
  A08A                   C      co.c11:
  A08A    FE 1A          C              cp      1ah             ; clear                        "   0ch    /BCU"
  A08C    CA A118        C              jp      z,co.cle
  A08F                   C      co.c12:
  A08F    2A F92E        C              ld      hl,(bsaddr)
  A092    77             C              ld      (hl),a          ; zeichen auf bildschirm schreiben
  A093    CD A1C2        C              call    incad           ; schreiben in letzte pos. rollt nicht!!
  A096    C3 A0AD        C              jp      co.c16
                         C      ;
  A099                   C      co.c13:
  A099    2A F92E        C              ld      hl,(bsaddr)     ; eos ab cursorposition
  A09C                   C      co.c14:
  A09C    36 20          C              ld      (hl),20h
  A09E    23             C              inc     hl
  A09F    7C             C              ld      a,h
  A0A0    FE 37          C              cp      high (bsanf+maxz*maxs)
  A0A2    20 F8          C              jr      nz,co.c14
  A0A4    7D             C              ld      a,l
  A0A5    FE 80          C              cp      low (bsanf+maxz*maxs)
  A0A7    20 F3          C              jr      nz,co.c14
  A0A9                   C      co.c15:
  A0A9    AF             C              xor     a
  A0AA    32 F931        C              ld      (qroll),a
  A0AD                   C      co.c16:
  A0AD    C1             C              pop     bc
  A0AE    CD A242        C              call    setcur
  A0B1    CD 96D3        C              call    resp0
  A0B4    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-36


                         C      
  A0B5                   C      co.lf:
  A0B5    21 0040        C              ld      hl,zeil         ; lf
  A0B8    34             C              inc     (hl)
  A0B9                   C      colf1:
  A0B9    CD A1D3        C              call    bsadr           ; evtl. rollen ausfuehren
  A0BC    CD A22C        C              call    evtrol
  A0BF    C3 A0AD        C              jp      co.c16
                         C      ;
                         C      ;
  A0C2                   C      co.cr:
  A0C2    AF             C              xor     a               ; cr
  A0C3    32 0041        C              ld      (spalt),a
  A0C6    18 F1          C              jr      colf1
                         C      ;
                         C      ;
  A0C8                   C      co.nl:
  A0C8    21 0040        C              ld      hl,zeil         ; nl
  A0CB    34             C              inc     (hl)
  A0CC    18 F4          C              jr      co.cr
                         C      ;
                         C      ;
  A0CE                   C      co.bel:
  A0CE    CD 9FB4        C              call    ci.bell
  A0D1    C3 A0AD        C              jp      co.c16
                         C      ;
                         C      ;
  A0D4                   C      co.hom:
  A0D4    AF             C              xor     a               ; home
  A0D5    32 0040        C              ld      (zeil),a
  A0D8    32 0041        C              ld      (spalt),a
  A0DB    18 DC          C              jr      colf1
                         C      ;
                         C      ;
  A0DD                   C      co.tb:
  A0DD    2A F92E        C              ld      hl,(bsaddr)     ; tab
  A0E0    36 20          C              ld      (hl),20h
  A0E2    CD A1C2        C              call    incad
  A0E5    3A 0041        C              ld      a,(spalt)
  A0E8    E6 07          C              and     7
  A0EA    CA A0AD        C              jp      z,co.c16
  A0ED    CD A22C        C              call    evtrol          ; evtl. verzoegertes rollen ausfuehren
  A0F0    18 EB          C              jr      co.tb
                         C      ;
                         C      ;
  A0F2                   C      co.bs:
  A0F2    3A 0041        C              ld      a,(spalt)       ; backspace
  A0F5    B7             C              or      a
  A0F6    28 0E          C              jr      z,cobs2
  A0F8    3D             C              dec     a
  A0F9    32 0041        C              ld      (spalt),a
  A0FC                   C      cobs1:
  A0FC    2A F92E        C              ld      hl,(bsaddr)
  A0FF    2B             C              dec     hl
  A100    22 F92E        C              ld      (bsaddr),hl
  A103    C3 A0A9        C              jp      co.c15
                         C      ;
  A106                   C      cobs2:
  A106    3A 0040        C              ld      a,(zeil)
  A109    B7             C              or      a
  A10A    CA A0A9        C              jp      z,co.c15        ; -> bs nicht ausfuehrbar, da homeposition
  A10D    3D             C              dec     a
  A10E    32 0040        C              ld      (zeil),a
  A111    3E 4F          C              ld      a,maxs-1
  A113    32 0041        C              ld      (spalt),a
  A116    18 E4          C              jr      cobs1
                         C      ;
                         C      ;
  A118                   C      co.cle:
  A118    AF             C              xor     a               ; clear
  A119    32 0040        C              ld      (zeil),a
  A11C    32 0041        C              ld      (spalt),a
  A11F    CD A1D3        C              call    bsadr
  A122    C3 A099        C              jp      co.c13
                         C      ;
                         C      ;
  A125                   C      co.up:
  A125    21 0040        C              ld      hl,zeil         ; up
  A128    7E             C              ld      a,(hl)
  A129    B7             C              or      a
  A12A    20 02          C              jr      nz,coup1        ; -> cursor stand nicht in 1. zeile
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-37


  A12C    36 18          C              ld      (hl),maxz
  A12E                   C      coup1:
  A12E    35             C              dec     (hl)
  A12F    C3 A0B9        C              jp      colf1
                         C      ;
                         C      ;
  A132                   C      co.rg:
  A132    3A 0041        C              ld      a,(spalt)       ; right zyklisch in zeile
  A135    3C             C              inc     a
  A136    FE 50          C              cp      maxs
  A138    20 01          C              jr      nz,corg1
  A13A    AF             C              xor     a
  A13B                   C      corg1:
  A13B    32 0041        C              ld      (spalt),a
  A13E    C3 A0B9        C              jp      colf1
                         C      ;
                         C      ;
  A141                   C      eol:
  A141    21 0041        C              ld      hl,spalt        ; EOL
  A144    3E 50          C              ld      a,maxs
  A146    96             C              sub     (hl)
  A147    47             C              ld      b,a
  A148    2A F92E        C              ld      hl,(bsaddr)
  A14B                   C      eol1:
  A14B    36 20          C              ld      (hl),20h
  A14D    23             C              inc     hl
  A14E    10 FB          C              djnz    eol1
  A150    C3 A0A9        C              jp      co.c15
                         C      ;
                         C      ;
  A153                   C      insl:
  A153    AF             C              xor     a               ; INS LINE
  A154    32 0041        C              ld      (spalt),a
  A157    CD A1D3        C              call    bsadr
  A15A    21 0040        C              ld      hl,zeil
  A15D    3E 18          C              ld      a,maxz
  A15F    96             C              sub     (hl)
  A160    3D             C              dec     a
  A161    28 DE          C              jr      z,eol           ; -> kursor stand in letzter zeile; diese loeschen
  A163    47             C              ld      b,a
  A164    21 0000        C              ld      hl,0
  A167    11 0050        C              ld      de,maxs
  A16A                   C      insl1:
  A16A    19             C              add     hl,de           ; anzahl der zeilen bestimmen, die nach
  A16B    10 FD          C              djnz    insl1           ; unten gerollt werden muessen
  A16D    44             C              ld      b,h
  A16E    4D             C              ld      c,l
  A16F    21 372F        C              ld      hl,bsanf+maxz*maxs-1-maxs
  A172    11 377F        C              ld      de,bsanf+maxz*maxs-1
  A175    ED B8          C              lddr
  A177    18 C8          C              jr      eol             ; -> zeile loeschen, in der cursor steht
                         C      ;
                         C      ;
  A179                   C      dell:
  A179    AF             C              xor     a               ; DEL LINE
  A17A    32 0041        C              ld      (spalt),a
  A17D    CD A1D3        C              call    bsadr
  A180    21 0040        C              ld      hl,zeil
  A183    3E 18          C              ld      a,maxz
  A185    96             C              sub     (hl)
  A186    3D             C              dec     a
  A187    28 13          C              jr      z,dell2         ; -> kursor stand in letzter zeile
  A189    47             C              ld      b,a
  A18A    21 0000        C              ld      hl,0
  A18D    11 0050        C              ld      de,maxs
  A190                   C      dell1:
  A190    19             C              add     hl,de           ; anzahl der zeilen bestimmen, die nach
  A191    10 FD          C              djnz    dell1           ; oben gerollt werden muessen
  A193    44             C              ld      b,h
  A194    4D             C              ld      c,l
  A195    2A F92E        C              ld      hl,(bsaddr)
  A198    EB             C              ex      de,hl
  A199    19             C              add     hl,de
  A19A    ED B0          C              ldir
  A19C                   C      dell2:
  A19C    21 3730        C              ld      hl,bsanf+maxz*maxs-maxs ; letzte zeile loeschen
  A19F    11 3731        C              ld      de,bsanf+maxz*maxs-maxs+1
  A1A2    01 004F        C              ld      bc,maxs-1
  A1A5                   C      dell3:
  A1A5    36 20          C              ld      (hl),20h
  A1A7    ED B0          C              ldir
  A1A9    C3 A0A9        C              jp      co.c15
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-38


                         C      ;
                         C      ;
  A1AC                   C      eos:
  A1AC    21 3000        C              ld      hl,bsanf        ; eos, cursor bleibt unveraendert
  A1AF    11 3001        C              ld      de,bsanf+1
  A1B2    01 077F        C              ld      bc,maxz*maxs-1
  A1B5    18 EE          C              jr      dell3
                         C      ;
                         C      ;
  A1B7                   C      sroll:
  A1B7    3E 01          C              ld      a,1             ; spezieller rollmodus an
  A1B9                   C      sroll1:
  A1B9    32 F930        C              ld      (qrmode),a
  A1BC    C3 A0AD        C              jp      co.c16
                         C      ;
  A1BF                   C      nroll:
  A1BF    AF             C              xor     a               ; normaler   rollmodus an
  A1C0    18 F7          C              jr      sroll1
                         C      ;
                         C      ;
                         C      ;
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-39


                         C      
  A1C2                   C      incad:
  A1C2    21 0041        C              ld      hl,spalt
  A1C5    34             C              inc     (hl)
  A1C6    7E             C              ld      a,(hl)
  A1C7    FE 50          C              cp      maxs
  A1C9    20 08          C              jr      nz,bsadr
  A1CB    AF             C              xor     a
  A1CC    77             C              ld      (hl),a
  A1CD    21 0040        C              ld      hl,zeil
  A1D0    34             C              inc     (hl)
  A1D1    18 00          C              jr      bsadr
                         C      
                         C      ; die position zeil/spalt durch evtl. rollen in den bildschirmbereich
                         C      ; bringen und physische adresse der position berechnen; dabei rollen
                         C      ; in letzter position verzoegern, statt dessen qroll stellen, damit vor
                         C      ; der naechsten ausgabe oder setcur gerollt werden kann
                         C      ;
  A1D3                   C      bsadr:
  A1D3    F5             C              push    af
  A1D4    C5             C              push    bc
  A1D5    D5             C              push    de
  A1D6    3A 0040        C              ld      a,(zeil)
  A1D9                   C      bsad1:
  A1D9    FE 18          C              cp      maxz
  A1DB    38 15          C              jr      c,bsad4
  A1DD    28 05          C              jr      z,bsad3         ; -> es koennte letzte position gewesen sein
  A1DF                   C      bsad2:
  A1DF    CD A211        C              call    bsrol
  A1E2    18 F5          C              jr      bsad1
  A1E4                   C      bsad3:
  A1E4    3A 0041        C              ld      a,(spalt)       ; ist spalte = 0?
  A1E7    B7             C              or      a
  A1E8    3E 18          C              ld      a,maxz
  A1EA    20 F3          C              jr      nz,bsad2        ; -> nein, rollen
  A1EC    3D             C              dec     a
  A1ED    21 F931        C              ld      hl,qroll        ; rollmerker setzen
  A1F0    36 01          C              ld      (hl),1
  A1F2                   C      bsad4:
  A1F2    47             C              ld      b,a             ; physische adresse berechnen
  A1F3    21 0000        C              ld      hl,0
  A1F6    11 0050        C              ld      de,maxs
  A1F9    B7             C              or      a
  A1FA    28 03          C              jr      z,bsad6
  A1FC                   C      bsad5:
  A1FC    19             C              add     hl,de
  A1FD    10 FD          C              djnz    bsad5
  A1FF                   C      bsad6:
  A1FF    3A 0041        C              ld      a,(spalt)
  A202    4F             C              ld      c,a
  A203    06 00          C              ld      b,0
  A205    09             C              add     hl,bc
  A206    01 3000        C              ld      bc,bsanf
  A209    09             C              add     hl,bc
  A20A    D1             C              pop     de
  A20B    C1             C              pop     bc
  A20C    F1             C              pop     af
  A20D    22 F92E        C              ld      (bsaddr),hl
  A210    C9             C              ret
                         C      ;
                         C      ;
  A211                   C      bsrol:
  A211    11 3000        C              ld      de,bsanf        ; bild hochschieben
  A214    21 3050        C              ld      hl,bsanf+maxs
  A217    01 0730        C              ld      bc,maxs*(maxz-1)
  A21A    ED B0          C              ldir
  A21C    62             C              ld      h,d
  A21D    6B             C              ld      l,e
  A21E    13             C              inc     de              ; letzte zeile loeschen
  A21F    01 004F        C              ld      bc,maxs-1
  A222    36 20          C              ld      (hl),20h
  A224    ED B0          C              ldir
  A226    21 0040        C              ld      hl,zeil
  A229    35             C              dec     (hl)
  A22A    7E             C              ld      a,(hl)
  A22B    C9             C              ret
                         C      ;
                         C      ;
  A22C                   C      evtrol:
  A22C    E5             C              push    hl
  A22D    21 F931        C              ld      hl,qroll
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-40


  A230    CB 46          C              bit     0,(hl)
  A232    CB 86          C              res     0,(hl)
  A234    E1             C              pop     hl
  A235    C8             C              ret     z
  A236    F5             C              push    af
  A237    C5             C              push    bc
  A238    D5             C              push    de
  A239    E5             C              push    hl
  A23A    CD A211        C              call    bsrol
  A23D    E1             C              pop     hl
  A23E    D1             C              pop     de
  A23F    C1             C              pop     bc
  A240    F1             C              pop     af
  A241    C9             C              ret
                         C      ;
                         C      ;
  A242                   C      setcur:
  A242    E5             C              push    hl
  A243    21 F930        C              ld      hl,qrmode
  A246    CB 46          C              bit     0,(hl)
  A248    CC A22C        C              call    z,evtrol        ; evtl. verzoegertes rollen ausfuehren
  A24B    2A F92E        C              ld      hl,(bsaddr)
                         C              ; set   7,(hl)
  A24E    C5             C              push    bc
  A24F    22 A261        C              ld      (setcur2),hl
  A252    21 A25D        C              ld      hl,setcur1
  A255    01 0740        C              ld      bc,0740H
  A258    ED B3          C              otir
  A25A    C1             C              pop     bc
  A25B    E1             C              pop     hl
  A25C    C9             C              ret
                         C      ;
  A25D                   C      setcur1:
  A25D    F0             C              DB      0F0H
  A25E    04             C              DB      004H    ;Cursor Ein mit HL
  A25F    3000           C              DW      bsanf
  A261                   C      setcur2:
  A261    0000           C              DW      0
  A263    FF             C              DB      0FFH
                         C      ;
                         C      ;
  A264                   C      rescur:
  A264    E5             C              push    hl
  A265    C5             C              push    bc
                         C              ;ld     hl,(bsaddr)
                         C              ; res   7,(hl)
  A266    21 A26F        C              ld      hl,rescur1
  A269    01 0340        C              ld      bc,0340H
  A26C    C1             C              pop     bc
  A26D    E1             C              pop     hl
  A26E    C9             C              ret
                         C      ;
  A26F                   C      rescur1:
  A26F    F0             C              DB      0F0H
  A270    02             C              DB      002H    ;Cursor Aus
  A271    FF             C              DB      0FFH
                         C      ;
                         C      ;
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-41


                         C      
  A272                   C      co.scp: 
  A272    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
  A273                   C      co.bcu:
  A273    3E CE          C              ld      a,0ceh          ;set 1,(hl)
  A275    32 9FF3        C              ld      (co.c1+1),a
  A278    21 9FFC        C              ld      hl,co.c3+3
  A27B    22 9FF5        C              ld      (co.c1+3),hl
  A27E    3E C3          C              ld      a,0c3h          ;jp
  A280    32 9FF9        C              ld      (co.c3),a
  A283    21 96CB        C              ld      hl,096cbh       ;res 2,(hl)
  A286    22 9FFC        C              ld      (co.c3+3),hl
  A289    3E C3          C              ld      a,0c3h          ;jp
  A28B    32 9FFE        C              ld      (co.c3+5),a
  A28E    21 A0AD        C              ld      hl,co.c16
  A291    22 9FFF        C              ld      (co.c3+6),hl
  A294    21 0000        C              ld      hl,0
  A297    22 A050        C              ld      (co.c5),hl
  A29A    22 A059        C              ld      (co.c6),hl
  A29D    3E 0C          C              ld      a,00ch
  A29F    32 A08B        C              ld      (co.c11+1),a
  A2A2    32 99CC        C              ld      (bootms),a
  A2A5    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
  A2A6                   C      co.deg:
  A2A6    3E 8E          C              ld      a,08eh          ;res 1,(hl)
  A2A8    32 9FF3        C              ld      (co.c1+1),a
  A2AB    21 A0AD        C              ld      hl,co.c16
  A2AE    22 9FF5        C              ld      (co.c1+3),hl
  A2B1    3E C2          C              ld      a,0c2h          ;jp nz,
  A2B3    32 9FF9        C              ld      (co.c3),a
  A2B6    21 3DFE        C              ld      hl,03dfeh       ;cp '='
  A2B9    22 9FFC        C              ld      (co.c3+3),hl
  A2BC    3E CA          C              ld      a,0cah          ;jp z,
  A2BE    32 9FFE        C              ld      (co.c3+5),a
  A2C1    21 A068        C              ld      hl,co.c9
  A2C4    22 9FFF        C              ld      (co.c3+6),hl
  A2C7    21 20D6        C              ld      hl,020d6h       ;sub 20h
  A2CA    22 A050        C              ld      (co.c5),hl
  A2CD    22 A059        C              ld      (co.c6),hl
  A2D0    3E 1A          C              ld      a,01ah
  A2D2    32 A08B        C              ld      (co.c11+1),a
  A2D5    32 99CC        C              ld      (bootms),a
  A2D8    C9             C              ret
                         C      ;
                         C      ;
                                
                                
                                
                         C              include LO.MAC
                         C      ; druckerausgabe ueber   DEG2000 Version 1.2 ---  EPROM 7C
                         C      ; --------------------------------------------------------
                         C      ;
  A2D9                   C      lo.reset::
  A2D9    DD E5          C              push    ix
  A2DB    CD 964D        C              call    skmb
  A2DE    DD 21 0F73     C              ld      ix,eadr+3
  A2E2    DD 36 03 58    C              ld      (ix+3),058h             ;l(ir)
  A2E6    CD 4026        C              call    dinit
  A2E9    CD 9653        C              call    rkmb
  A2EC    DD E1          C              pop     ix
  A2EE    C9             C              ret
                         C      ;
  A2EF                   C      lo.ch:
  A2EF    DD E5          C              push    ix
  A2F1    CD 964D        C              call    skmb
  A2F4    DD 21 0F73     C              ld      ix,eadr+3
                         C       if dr54
                         C              push    af
                         C              ld      a,c
                         C              cp      00dh
                         C              jr      z,loch1
                         C              cp      00ah
                         C              jr      nz,loch2
                         C              ld      c,01eh
                         C      loch2:
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-42


                         C       endif
  A2F8    CD 4029        C              call    dout
                         C       if dr54
                         C      loch1:  pop     af
                         C       endif
  A2FB    CD 9653        C              call    rkmb
  A2FE    DD E1          C              pop     ix
  A300    C9             C              ret
                         C      ;
                                
                                
                                
                         C              include RI.MAC
                         C      ; lochbandleserbedienung ueber  DEG2000 Version 1.2  --- EPROM 70
                         C      ; ---------------------------------------------------------------
                         C      ;
  A301    DD E5          C      ri.ch:: push    ix
  A303    CD 964D        C              call    skmb
  A306    DD 21 0FA3     C              ld      ix,ealbl+3
  A30A    CD 4030        C              call    lbl
  A30D    CD 9653        C              call    rkmb
  A310    DD E1          C              pop     ix
  A312    C9             C              ret
                         C      ;
                         C      ; S I O -  uebertragung ueber die ATS
                         C      ; -----------------------------------
                         C      ;
                         C       if eq.sio ne 0
  A313                   C      ri1.ch::                        ;ATS-Kanal A (Passiv)
  A313    C5             C              push    bc
  A314    E5             C              push    hl
                         C              rept    4               ;SIO-Empfangspuffer leeren
                         C              in      a,(ptast+10h)
                         C              endm
  A315    DB B0          C+             in      a,(ptast+10h)
  A317    DB B0          C+             in      a,(ptast+10h)
  A319    DB B0          C+             in      a,(ptast+10h)
  A31B    DB B0          C+             in      a,(ptast+10h)
  A31D    3E 10          C              ld      a,010h          ;Bereitschaftszeichen ausgeben
  A31F    D3 B0          C              out     (ptast+10h),a
  A321    AF             C      ri.ch1: xor     a               ;warten auf Eingabezeichen
  A322    D3 B1          C              out     (ptast+11h),a
  A324    DB B1          C              in      a,(ptast+11h)
  A326    CB 47          C              bit     0,a
  A328    28 F7          C              jr      z,ri.ch1
  A32A    DB B0          C              in      a,(ptast+10h)   ;Eingabezeichen einlesen
  A32C    E1             C              pop     hl
  A32D    C1             C              pop     bc
  A32E    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
  A32F                   C      ri2.ch::                        ;ATS-Kanal B (Aktiv)
  A32F    C5             C              push    bc
  A330    E5             C              push    hl
                         C              rept    4               ;SIO-Empfangspuffer leeren
                         C              in      a,(ptast+12h)
                         C              endm
  A331    DB B2          C+             in      a,(ptast+12h)
  A333    DB B2          C+             in      a,(ptast+12h)
  A335    DB B2          C+             in      a,(ptast+12h)
  A337    DB B2          C+             in      a,(ptast+12h)
  A339    3E 10          C              ld      a,010h          ;Bereitschaftszeichen ausgeben
  A33B    D3 B2          C              out     (ptast+12h),a
  A33D    AF             C      ri.ch2: xor     a               ;warten auf Eingabezeichen
  A33E    D3 B3          C              out     (ptast+13h),a
  A340    DB B3          C              in      a,(ptast+13h)
  A342    CB 47          C              bit     0,a
  A344    28 F7          C              jr      z,ri.ch2
  A346    DB B2          C              in      a,(ptast+12h)   ;Eingabezeichen einlesen
  A348    E1             C              pop     hl
  A349    C1             C              pop     bc
  A34A    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
  A34B                   C      ri.ata::
  A34B    21 A384        C              ld      hl,ri.siot      ;SIO initialisieren
  A34E    06 09          C              ld      b,9
  A350    0E B1          C              ld      c,ptast+11h
  A352    ED B3          C              otir
  A354    06 02          C              ld      b,2             ;CTC initialisieren
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-43


  A356    0E B8          C              ld      c,ptast+18h
  A358    ED B3          C              otir
  A35A    21 A38D        C              ld      hl,ri.ctct
  A35D    06 02          C              ld      b,2
  A35F    0E B9          C              ld      c,ptast+19h
  A361    ED B3          C              otir
                         C              rept    4               ;SIO-Empfangspuffer leeren
                         C              in      a,(ptast+10h)
                         C              endm
  A363    DB B0          C+             in      a,(ptast+10h)
  A365    DB B0          C+             in      a,(ptast+10h)
  A367    DB B0          C+             in      a,(ptast+10h)
  A369    DB B0          C+             in      a,(ptast+10h)
  A36B    C9             C              ret
                         C      ;
  A36C                   C      ri.atb::
  A36C    21 A384        C              ld      hl,ri.siot      ;SIO initialisieren
  A36F    06 09          C              ld      b,9
  A371    0E 13          C              ld      c,13h
  A373    ED B3          C              otir
  A375    06 02          C              ld      b,2             ;CTC initialisieren
  A377    0E BA          C              ld      c,ptast+1ah
  A379    ED B3          C              otir
                         C              rept    4               ;SIO-Empfangspuffer leeren
                         C              in      a,(ptast+12h)
                         C              endm
  A37B    DB B2          C+             in      a,(ptast+12h)
  A37D    DB B2          C+             in      a,(ptast+12h)
  A37F    DB B2          C+             in      a,(ptast+12h)
  A381    DB B2          C+             in      a,(ptast+12h)
  A383    C9             C              ret
                         C      ;
  A384    D0 04 44 01    C      ri.siot:db      0d0h,4,44h,1,0,3,0c1h,35h,68h
  A388    00 03 C1 35    C      
  A38C    68             C      
  A38D    07 01          C      ri.ctct:db      7,1
                         C      ;
                         C      ;
                         C       else
                         C      ri1.ch::
                         C      ri2.ch::
                         C              ld      a,01ah
                         C              ret
                         C       endif
                         C      ;
                                
                                
                                
                         C              include PU.MAC
                         C      ; lochbandstanzerbedienung ueber  DEG2000 Version 1.2  ---  EPROM 70
                         C      ; ------------------------------------------------------------------
                         C      ;
  A38F    DD E5          C      pu.ch:: push    ix
  A391    CD 964D        C              call    skmb
  A394    DD 21 0F83     C              ld      ix,ealbs+3
  A398    CD 4033        C              call    lbs
  A39B    CD 9653        C              call    rkmb
  A39E    DD E1          C              pop     ix
  A3A0    C9             C              ret
                         C      ;
                         C      ; S I O -  uebertragung ueber ATS
                         C      ; -------------------------------
                         C      ;
                         C       if eq.sio ne 0
  A3A1                   C      pu1.ch::                        ;ATS-Kanal A (Passiv)
  A3A1    F5             C              push    af
  A3A2    AF             C      pu.ch1: xor     a               ;warten auf Bereitschaftszeichen
  A3A3    D3 B1          C              out     (ptast+11h),a
  A3A5    DB B1          C              in      a,(ptast+11h)
  A3A7    CB 47          C              bit     0,a
  A3A9    28 F7          C              jr      z,pu.ch1
  A3AB    DB B0          C              in      a,(ptast+10h)
  A3AD    FE 10          C              cp      010h
  A3AF    20 F1          C              jr      nz,pu.ch1
  A3B1    79             C              ld      a,c             ;Ausgabezeichen ausgeben
  A3B2    D3 B0          C              out     (ptast+10h),a
  A3B4    F1             C              pop     af
  A3B5    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
  A3B6                   C      pu2.ch::                        ;ATS-Kanal B (Aktiv)
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-44


  A3B6    F5             C              push    af
  A3B7    AF             C      pu.ch2: xor     a               ;warten auf Bereitschaftszeichen
  A3B8    D3 B3          C              out     (ptast+13h),a
  A3BA    DB B3          C              in      a,(ptast+13h)
  A3BC    CB 47          C              bit     0,a
  A3BE    28 F7          C              jr      z,pu.ch2
  A3C0    DB B2          C              in      a,(ptast+12h)
  A3C2    FE 10          C              cp      10h
  A3C4    20 F1          C              jr      nz,pu.ch2
  A3C6    79             C              ld      a,c             ;Ausgabezeichen ausgeben
  A3C7    D3 B2          C              out     (ptast+12h),a
  A3C9    F1             C              pop     af
  A3CA    C9             C              ret
                         C      ;
                         C      ;
                         C       else
                         C      pu1.ch::
                         C      pu2.ch::
                         C              ret
                         C       endif
                         C      ;
                                ;
                                ;
                                ;
                                        page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-45


                                
                                ;       massespeicher lesen/schreiben
                                ;       =============================
                                ;
                                ;       aufteilung auf die physischen geraete
                                ;
  A3CB    CD 9600               write:: call    reta
  A3CE    CD F55A                       call    setix
  A3D1    28 0B                         jr      z,wr15
  A3D3    DD 6E FE                      ld      l,(ix-ixwr)
  A3D6    DD 66 FF                      ld      h,(ix-ixwr+1)
  A3D9    CD A3FE                       call    callhl          ; writeroutine aufrufen
  A3DC    18 02                         jr      wr16
  A3DE    3E 01                 wr15:   ld      a,1             ; fehler: falsches geraet
  A3E0    C3 9611               wr16:   jp      um2ee
                                ;
                                ;
  A3E3    CD 9600               read::  call    reta
  A3E6    CD F55A                       call    setix
  A3E9    28 0E                         jr      z,read15        ; -> geraet nicht vorhanden
  A3EB    DD 6E FC                      ld      l,(ix-ixrd)
  A3EE    DD 66 FD                      ld      h,(ix-ixrd+1)
  A3F1    CD A3FE                       call    callhl          ; readroutine aufrufen
  A3F4    CD 9608                       call    retu
  A3F7    18 02                         jr      read16
  A3F9    3E 01                 read15: ld      a,1
  A3FB    C3 F597               read16: jp      br270           ; ===> aBIOS
                                ;
  A3FE    E9                    callhl::jp      (hl)
                                ;
                                ;
                                ;
                                        page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-46


                                
                                ;       lesen / schreiben geraet A
                                ;       ==========================
                                ;
  A3FF    3E 01                 wrmem0::ld      a,1
  A401    C9                            ret                     ; schreibfehler
  A402    CD A431               wrmem:: call    hsadr           ; hs-adresse des simulierten floppy-sektors
  A405    38 F8                         jr      c,wrmem0
  A407    EB                            ex      de,hl
  A408    21 F9C1                       ld      hl,dmma
  A40B    01 0080               m04:    ld      bc,128          ; vom sim.disk in den hs uebertragen
  A40E    CD 969B                       call    setla
  A411    ED B0                         ldir
  A413    CD 96AE                       call    resla
  A416    AF                    m041:   xor     a
  A417    C9                            ret
                                ;
  A418    CD A431               rdmem:: call    hsadr
  A41B    38 E2                         jr      c,wrmem0
  A41D    11 F9C1                       ld      de,dmma
  A420    18 E9                         jr      m04
  A422    21 F9C1               rdmem0::ld      hl,dmma
  A425    5D                            ld      e,l
  A426    54                            ld      d,h
  A427    13                            inc     de
  A428    36 E5                         ld      (hl),0e5h
  A42A    01 007F                       ld      bc,127
  A42D    ED B0                         ldir
  A42F    18 E5                         jr      m041
                                ;
  A431    ED 5B F923            hsadr:: ld      de,(trk)
  A435    7B                            ld      a,e
  A436    FE 08                         cp      8
  A438    3F                            ccf
  A439    D8                            ret     c
  A43A    32 973A                       ld      (ttrk),a
  A43D    3E 00                         ld      a,str
  A43F    32 9739                       ld      (tram),a
  A442    2A F925                       ld      hl,(sec)
                                        rept    7
                                        add     hl,hl
                                        endm
  A445    29              +             add     hl,hl
  A446    29              +             add     hl,hl
  A447    29              +             add     hl,hl
  A448    29              +             add     hl,hl
  A449    29              +             add     hl,hl
  A44A    29              +             add     hl,hl
  A44B    29              +             add     hl,hl
  A44C    11 2F80                       ld      de,02f80h
  A44F    19                            add     hl,de
  A450    37                            scf
  A451    3F                            ccf
  A452    C9                            ret
                                ;
                                ;
                                ;
                         C              include KR.MAC
                         C      ;       lesen / schreiben kassetten geblockt
                         C      ;       ====================================
                         C      ;       schreiben
                         C      ;       ---------
                         C      ;
  A453    DD 7E 1D       C      wrkmb:: ld      a,(ix+gelade)   ; test, ob kassette noch geladen ist
  A456    B7             C              or      a
  A457    28 2A          C              jr      z,wrk02         ; -> nein
  A459    3A F923        C              ld      a,(trk)
  A45C    B7             C              or      a
  A45D    C2 A7D2        C              jp      nz,block        ; -> nicht nach dir im hs schreiben
  A460    21 F9C1        C              ld      hl,dmma
  A463    11 0C00        C              ld      de,gdma
  A466    01 0080        C              ld      bc,128
  A469    ED B0          C              ldir
  A46B    CD A51D        C              call    diradr
  A46E    EB             C              ex      de,hl           ; in dpuf schreiben
  A46F    21 0C00        C              ld      hl,gdma
  A472    DD 36 0F 01    C              ld      (ix+eadzei),1   ; es wurde in directory geschrieben
  A476    01 0080        C              ld      bc,128
  A479    CD 965A        C      wrk01:  call    sdir            ;ld     a,(hl)
  A47C    ED B0          C              ldir            ;set12
  A47E    CD 967C        C              call    rdir    ;ld     (de),a
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-47


                         C                              ;res12
                         C                              ;inc    hl
                         C                              ;inc    de
                         C                              ;djnz   wrk01
  A481    AF             C              xor     a
  A482    C9             C              ret
                         C      ;
  A483    AF             C      wrk02:  xor     a
  A484    3C             C              inc     a
  A485    C9             C              ret
                         C      ;
  A486    CD A510        C      hwrkmb: call    cposx
  A489    20 F8          C              jr      nz,wrk02        ; -> fehler melden
  A48B    DD 36 09 01    C              ld      (ix+ealen),1
  A48F    DD 36 0A 00    C              ld      (ix+ealen+1),0
  A493    DD 7E 12       C              ld      a,(ix+hstbuf)
  A496    DD 77 07       C              ld      (ix+eaadr),a
  A499    DD 7E 13       C              ld      a,(ix+hstbuf+1)
  A49C    DD 77 08       C              ld      (ix+eaadr+1),a
                         C       if kmbvers eq 13
                         C              ld      a,80h           ; schreiben ohne fehlerwiederholung
                         C       else
  A49F    3E 00          C              ld      a,0             ; schreiben mit fehlerwiederholung
                         C       endif
  A4A1    CD A796        C              call    kmb
  A4A4    C8             C              ret     z               ; -> alles ok
  A4A5    3A F92C        C              ld      a,(rderr)       ; weiterer versuch?
  A4A8    3D             C              dec     a
  A4A9    32 F92C        C              ld      (rderr),a
  A4AC    20 D8          C              jr      nz,hwrkmb
  A4AE    18 D3          C              jr      wrk02           ; -> nein
                         C      ;
                         C      ;
                         C      ;
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-48


                         C      
                         C      ;       lesen
                         C      ;       -----
                         C      ;
  A4B0    DD 7E 1D       C      rdkmb:: ld      a,(ix+gelade)   ; test, ob kassette noch geladen ist
  A4B3    B7             C              or      a
  A4B4    28 CD          C              jr      z,wrk02
  A4B6    3A F923        C              ld      a,(trk)
  A4B9    B7             C              or      a
  A4BA    C2 A7C6        C              jp      nz,deblck       ; -> nicht aus hs lesen
  A4BD    11 0C00        C              ld      de,gdma         ; aus dpuf lesen
  A4C0    CD A51D        C              call    diradr
  A4C3    01 0080        C              ld      bc,128
  A4C6    CD 965A        C      rdk01:  call    sdir    ;set12
  A4C9    ED B0          C              ldir            ;ld     a,(hl)
  A4CB    CD 967C        C              call    rdir    ;res12
  A4CE    21 0C00        C              ld      hl,gdma ;ld     (de),a
  A4D1    11 F9C1        C              ld      de,dmma ;inc    hl
  A4D4    01 0080        C              ld      bc,128  ;inc    de
  A4D7    ED B0          C              ldir            ;djnz   rdk01
  A4D9    AF             C              xor     a
  A4DA    C9             C              ret
                         C      ;
  A4DB    CD A510        C      hrdkmb: call    cposx
  A4DE    20 0E          C              jr      nz,rdk03        ; -> fehler melden
  A4E0    CD A624        C              call    lesen
  A4E3    28 0C          C              jr      z,rdk04
  A4E5    3A F92C        C      rdk02:  ld      a,(rderr)       ; weitere versuch?
  A4E8    3D             C              dec     a
  A4E9    32 F92C        C              ld      (rderr),a
  A4EC    20 ED          C              jr      nz,hrdkmb       ; -> ja
  A4EE    AF             C      rdk03:  xor     a               ; fehler melden
  A4EF    3C             C              inc     a
  A4F0    C9             C              ret
  A4F1    DD 7E 09       C      rdk04:  ld      a,(ix+ealen)
  A4F4    FE 01          C              cp      1
  A4F6    20 ED          C              jr      nz,rdk02
  A4F8    47             C              ld      b,a
  A4F9    DD 7E 0A       C              ld      a,(ix+ealen+1)
  A4FC    B7             C              or      a
  A4FD    20 E6          C              jr      nz,rdk02
  A4FF    4F             C              ld      c,a
  A500    DD 6E 07       C              ld      l,(ix+eaadr)
  A503    DD 66 08       C              ld      h,(ix+eaadr+1)
  A506    DD 5E 12       C              ld      e,(ix+hstbuf)
  A509    DD 56 13       C              ld      d,(ix+hstbuf+1)
  A50C    ED B0          C              ldir
  A50E    AF             C              xor     a
  A50F    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
                         C              page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-49


                         C      
                         C      ;       unterprogramme lesen/schreiben
                         C      ;       ------------------------------
                         C      ;
  A510    DD 6E 16       C      cposx:  ld      l,(ix+hstsec)
  A513    DD 66 14       C              ld      h,(ix+hsttrk)
  A516    22 A7C0        C              ld      (was),hl
  A519    CD A671        C              call    cpos
  A51C    C9             C              ret
                         C      ;
  A51D    3A F923        C      diradr: ld      a,(trk)         ; in hl diradr bilden
  A520    6F             C              ld      l,a
  A521    26 00          C              ld      h,0
                         C              rept    4               ; 16 * trk
                         C              add     hl,hl
                         C              endm
  A523    29             C+             add     hl,hl
  A524    29             C+             add     hl,hl
  A525    29             C+             add     hl,hl
  A526    29             C+             add     hl,hl
  A527    ED 4B F925     C              ld      bc,(sec)
  A52B    0B             C              dec     bc
  A52C    09             C              add     hl,bc           ; 16 * trk + sec - 1
                         C              rept    7
                         C              add     hl,hl
                         C              endm
  A52D    29             C+             add     hl,hl
  A52E    29             C+             add     hl,hl
  A52F    29             C+             add     hl,hl
  A530    29             C+             add     hl,hl
  A531    29             C+             add     hl,hl
  A532    29             C+             add     hl,hl
  A533    29             C+             add     hl,hl
  A534    DD 4E 0D       C              ld      c,(ix+eadpuf)   ; bc = dpuf
  A537    DD 46 0E       C              ld      b,(ix+eadpuf+1)
  A53A    09             C              add     hl,bc
  A53B    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
                         C              page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-50


                         C      
                         C      ;       kassettenroutinen   laden / entladen / positionieren
                         C      ;       ====================================================
                         C      ;       kassette laden geblockt
                         C      ;       -----------------------
                         C      ;
  A53C    3E 31          C      clad:   ld      a,31h           ; reservieren ein
  A53E    CD A796        C              call    kmb
  A541    DD CB 00 66    C              bit     4,(ix+eastat)
  A545    20 3C          C              jr      nz,sp26
                         C      ;
  A547    CD A610        C              call    rucksp          ; rueckspulen
  A54A    CD A618        C              call    endruc          ; auf ende warten
                         C      ;
  A54D    CD A65A        C              call    filpar
  A550    D5             C      sp21:   push    de              ; dirpufferadresse
  A551    CD A8E1        C              call    readhst         ; 8 mal 256 byte lesen
  A554    D1             C              pop     de
  A555    20 29          C              jr      nz,sp25         ; -> fehler
  A557    DD 6E 12       C              ld      l,(ix+hstbuf)
  A55A    DD 66 13       C              ld      h,(ix+hstbuf+1)
  A55D    01 0100        C              ld      bc,256
  A560    CD 965A        C              call    sdir
  A563    ED B0          C              ldir                    ; von hostbuf auf cpu in dirbuf uebertr.
  A565    CD 967C        C              call    rdir
  A568    DD 34 16       C              inc     (ix+hstsec)
  A56B    DD CB 16 5E    C              bit     3,(ix+hstsec)   ; 0/8 schon erreicht?
  A56F    28 DF          C              jr      z,sp21          ; -> nein
                         C      ;
  A571    AF             C              xor     a               ; laden ok
  A572    DD 77 0F       C              ld      (ix+eadzei),a   ; in directory wurde noch nicht geschrieben
  A575    DD 77 17       C              ld      (ix+hstact),a   ; host buffer inactive
  A578    DD 77 19       C              ld      (ix+unacnt),a   ; no unallocated recs
  A57B    DD 36 1D 01    C              ld      (ix+gelade),1   ; kassette ist geladen
  A57F    C9             C              ret
                         C      ;
                         C      ;--------------------------------
                         C      ;
  A580    CD A610        C      sp25:   call    rucksp          ; fehler beim laden
  A583    3E 41          C      sp26:   ld      a,41h           ; reservieren aus
  A585    CD A796        C              call    kmb
  A588    AF             C              xor     a
  A589    DD 77 1D       C              ld      (ix+gelade),a   ; kassette ist nicht geladen
  A58C    3C             C              inc     a
  A58D    C9             C              ret
                         C      
                         C      ;       kassette entladen geblockt
                         C      ;       --------------------------
                         C      ;
  A58E    DD 7E 17       C      centl:  ld      a,(ix+hstact)   ; ist puffer aktiv?
  A591    B7             C              or      a
  A592    28 1B          C              jr      z,sp301         ; -> nein
  A594    DD 7E 18       C              ld      a,(ix+hstwrt)   ; wurde in puffer geschrieben?
  A597    B7             C              or      a
  A598    28 15          C              jr      z,sp301
  A59A    CD A8D4        C              call    writehst        ; ja, puffer entleeren
  A59D    28 10          C              jr      z,sp301
  A59F    21 A5ED        C              ld      hl,ceerro
  A5A2    06 23          C              ld      b,ceerre-ceerro
  A5A4    C5             C      centle: push    bc
  A5A5    4E             C              ld      c,(hl)
  A5A6    23             C              inc     hl
  A5A7    E5             C              push    hl
  A5A8    CD 9FDC        C              call    co.ch
  A5AB    E1             C              pop     hl
  A5AC    C1             C              pop     bc
  A5AD    10 F5          C              djnz    centle
  A5AF    DD 7E 0F       C      sp301:  ld      a,(ix+eadzei)   ; wurde directory veraendert?
  A5B2    B7             C              or      a
  A5B3    28 2B          C              jr      z,sp32          ; -> nein
  A5B5    CD A610        C              call    rucksp          ; rueckspulen
  A5B8    CD A618        C              call    endruc          ; auf ende warten
  A5BB    CD A65A        C              call    filpar
  A5BE    EB             C              ex      de,hl           ; dirpufferadresse
  A5BF    DD 5E 12       C      sp31:   ld      e,(ix+hstbuf)   ; aus dirpuffer in host buffer uebertragen
  A5C2    DD 56 13       C              ld      d,(ix+hstbuf+1)
  A5C5    01 0100        C              ld      bc,256
  A5C8    CD 965A        C              call    sdir
  A5CB    ED B0          C              ldir                    ; aus dirbuf in hostbuf auf cpu uebertragen
  A5CD    CD 967C        C              call    rdir
  A5D0    E5             C              push    hl
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-51


  A5D1    CD A8D4        C              call    writehst
  A5D4    E1             C              pop     hl
  A5D5    20 A9          C              jr      nz,sp25         ; -> fehler
  A5D7    DD 34 16       C              inc     (ix+hstsec)
  A5DA    DD CB 16 5E    C              bit     3,(ix+hstsec)   ; 0/8 erreicht?
  A5DE    28 DF          C              jr      z,sp31          ; -> nein
                         C      ;
  A5E0    CD A610        C      sp32:   call    rucksp          ; rueckspulen
  A5E3    3E 41          C              ld      a,41h           ; reservieren aus
  A5E5    CD A796        C              call    kmb
  A5E8    DD 36 1D 00    C              ld      (ix+gelade),0   ; kassette ist nicht geladen
  A5EC    C9             C              ret
                         C      ;
  A5ED    0A 46 65 68    C      ceerro: defb    lf,'Fehler beim Entladen des Puffers',cr,lf
  A5F1    6C 65 72 20    C      
  A5F5    62 65 69 6D    C      
  A5F9    20 45 6E 74    C      
  A5FD    6C 61 64 65    C      
  A601    6E 20 64 65    C      
  A605    73 20 50 75    C      
  A609    66 66 65 72    C      
  A60D    73 0D 0A       C      
  A610                   C      ceerre:
                         C      ;
                         C      ;
                         C      ;
                         C              page    
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-52


                         C      
                         C      ;       up's
                         C      ;       ----
                         C      ;
  A610    3E 21          C      rucksp: ld      a,21h
  A612    CD A796        C              call    kmb
  A615    20 F9          C              jr      nz,rucksp
  A617    C9             C              ret
  A618    CD 964D        C      endruc: call    skmb 
  A61B    CD 4043        C      edruc:  call    kmbruc          ; kmb-bereitroutine
  A61E    38 FB          C              jr      c,edruc         ; -> nicht bereit
  A620    CD 9653        C              call    rkmb
  A623    C9             C              ret
                         C      ;
  A624    AF             C      lesen:  xor     a
  A625    32 A7C5        C              ld      (richtu),a
                         C       if kmbvers eq 13
                         C              ld      a,82h           ; lesen ohne fehlerwiederholung
                         C       else
  A628    3E 02          C              ld      a,2
                         C       endif
  A62A    CD A796        C              call    kmb
  A62D    C9             C              ret
  A62E    DD 7E 09       C      konlen: ld      a,(ix+ealen)
  A631    B8             C              cp      b
  A632    C0             C              ret     nz
  A633    DD 7E 0A       C              ld      a,(ix+ealen+1)
  A636    B9             C              cp      c
  A637    C9             C              ret
                         C      ;
  A638    C5             C      konsent:push    bc
  A639    01 000C        C              ld      bc,12
  A63C    CD A62E        C              call    konlen
  A63F    C1             C              pop     bc
  A640    C0             C              ret     nz
  A641    E5             C              push    hl
  A642    DD 6E 07       C              ld      l,(ix+eaadr)    ; iy := (adr)
  A645    DD 66 08       C              ld      h,(ix+eaadr+1)
  A648    22 A7C3        C              ld      (arb),hl
  A64B    FD 2A A7C3     C              ld      iy,(arb)
  A64F    E1             C              pop     hl
  A650    FD 7E 01       C              ld      a,(iy+1)
  A653    BA             C              cp      d
  A654    C0             C              ret     nz
  A655    FD 7E 02       C              ld      a,(iy+2)
  A658    BB             C              cp      e
  A659    C9             C              ret
                         C      ;
  A65A    DD 36 16 00    C      filpar: ld      (ix+hstsec),0
  A65E    DD 36 14 00    C              ld      (ix+hsttrk),0
  A662    DD 36 10 00    C              ld      (ix+eawovo),0
  A666    DD 36 11 00    C              ld      (ix+eawovo+1),0
  A66A    DD 5E 0D       C              ld      e,(ix+eadpuf)
  A66D    DD 56 0E       C              ld      d,(ix+eadpuf+1)
  A670    C9             C              ret
                         C      
                         C      ;       kassette positionieren
                         C      ;       ----------------------
                         C      ;
  A671    3E 04          C      cpos:   ld      a,erranz        ; nach erranz fehlversuchen abbruch
  A673    32 A7C2        C              ld      (errcou),a
  A676    ED 4B A7C0     C      sp40:   ld      bc,(was)
  A67A    DD 5E 10       C              ld      e,(ix+eawovo)
  A67D    DD 56 11       C              ld      d,(ix+eawovo+1)
  A680    7B             C              ld      a,e             ; steht mb vor bandmarke?
  A681    FE 08          C              cp      8
  A683    38 06          C              jr      c,sp41
  A685    CD A624        C              call    lesen           ; ja
  A688    14             C              inc     d
  A689    1E 00          C              ld      e,0
  A68B    78             C      sp41:   ld      a,b
  A68C    BA             C              cp      d
  A68D    20 4F          C              jr      nz,sp45
  A68F    79             C              ld      a,c
  A690    BB             C              cp      e
  A691    20 1F          C              jr      nz,sp43
                         C                              ; === was = wovor
  A693    CD A624        C              call    lesen
  A696    20 0E          C              jr      nz,sp42         ; -> fehler: beim lesen
  A698    CD A638        C              call    konsent
  A69B    20 09          C              jr      nz,sp42         ; -> fehler: mb stand an falscher stelle
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-53


  A69D    1C             C              inc     e
  A69E    DD 73 10       C              ld      (ix+eawovo),e
  A6A1    DD 72 11       C              ld      (ix+eawovo+1),d
  A6A4    AF             C              xor     a
  A6A5    C9             C              ret
                         C      ;
  A6A6    CD A73B        C      sp42:   call    fehler          ; fehlerbehandlung
  A6A9    21 A7C2        C              ld      hl,errcou       ; nochmaliger versuch?
  A6AC    35             C              dec     (hl)
  A6AD    20 C7          C              jr      nz,sp40         ; -> ja
  A6AF    AF             C              xor     a               ; fehler zurueckmelden
  A6B0    3C             C              inc     a
  A6B1    C9             C              ret
                         C      ;
  A6B2    79             C      sp43:   ld      a,c
  A6B3    BB             C              cp      e
  A6B4    30 16          C              jr      nc,sp44
                         C                              ; === was.blk = wovor.blk  and  was.rec < wovor.rec
  A6B6    3E 01          C              ld      a,1
  A6B8    32 A7C5        C              ld      (richtu),a
  A6BB    3E 15          C              ld      a,15h           ; 2 bloecke ruecksetzen
  A6BD    CD A796        C              call    kmb
  A6C0    20 E4          C              jr      nz,sp42         ; -> fehler: beim record ruecksetzen
  A6C2    3E 15          C              ld      a,15h
  A6C4    CD A796        C              call    kmb
  A6C7    20 DD          C              jr      nz,sp42         ; -> fehler: beim record ruecksetzen
  A6C9    1D             C              dec     e               ; wovor.rec := wovor.rec - 1
  A6CA    18 BF          C              jr      sp41
                         C                              ; === was.blk = wovor.blk  and  was.rec > wovor.rec
  A6CC    CD A624        C      sp44:   call    lesen
  A6CF    20 D5          C              jr      nz,sp42         ; -> fehler: beim lesen
  A6D1    CD A638        C              call    konsent
  A6D4    20 D0          C              jr      nz,sp42         ; -> fehler: mb stand an falscher stelle
  A6D6    CD A624        C              call    lesen
  A6D9    20 CB          C              jr      nz,sp42         ; -> fehler: beim lesen
  A6DB    1C             C              inc     e               ; wovor.rec := wovor.rec + 1
  A6DC    18 AD          C              jr      sp41
                         C      ;
  A6DE    30 23          C      sp45:   jr      nc,sp46
                         C                              ; === was.blk < wovor.blk
  A6E0    7A             C              ld      a,d
  A6E1    90             C              sub     b
  A6E2    F5             C              push    af
  A6E3    3A A7C2        C              ld      a,(errcou)      ; falls nur noch erranz/2 Versuche ausstehen
  A6E6    FE 02          C              cp      erranz/2        ; um eine bandmarke mehr zuruecksetzen
  A6E8    38 03          C              jr      c,sp451
  A6EA    F1             C              pop     af
  A6EB    3C             C              inc     a
  A6EC    F5             C              push    af
  A6ED    F1             C      sp451:  pop     af              ; evtl. bei bedarf inc a
  A6EE    3C             C              inc     a
  A6EF    DD 77 0A       C              ld      (ix+eabm),a     ; (anzbm) := wovor - was + 1
  A6F2    3E 01          C              ld      a,1
  A6F4    32 A7C5        C              ld      (richtu),a
  A6F7    3E 75          C              ld      a,75h           ; um wovor-was+1 bm ruecksetzen
  A6F9    CD A796        C              call    kmb
  A6FC    20 A8          C              jr      nz,sp42         ; -> fehler: beim bm-ruecksetzen
  A6FE    50             C              ld      d,b
  A6FF    AF             C              xor     a
  A700    5F             C              ld      e,a             ; wovor := was.blk / 0
  A701    18 88          C              jr      sp41
                         C      ;
  A703    7A             C      sp46:   ld      a,d
  A704    3C             C              inc     a
  A705    B8             C              cp      b
  A706    20 15          C              jr      nz,sp48
                         C                              ; === was.blk = wovor.blk+1
  A708    CD A624        C      sp47:   call    lesen
  A70B    20 99          C              jr      nz,sp42         ; -> fehler: beim lesen
  A70D    C5             C              push    bc
  A70E    01 0000        C              ld      bc,0
  A711    CD A62E        C              call    konlen
  A714    C1             C              pop     bc
  A715    20 F1          C              jr      nz,sp47         ; -> keine bandmarke, weitermachen
  A717    14             C              inc     d
  A718    AF             C              xor     a
  A719    5F             C              ld      e,a             ; wovor := wovor.blk+1 / 0
  A71A    C3 A68B        C              jp      sp41
                         C                              ; === was.blk > wovor.blk+1
  A71D    3A A7C2        C      sp48:   ld      a,(errcou)      ; falls nur noch erranz/2 fehlversuche
  A720    FE 02          C              cp      erranz/2        ; langsam vorpositionieren
  A722    38 E4          C              jr      c,sp47
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-54


  A724    78             C              ld      a,b
  A725    92             C              sub     d
  A726    DD 77 0A       C              ld      (ix+eabm),a     ; (anzbm) := was - wovor
  A729    AF             C              xor     a
  A72A    32 A7C5        C              ld      (richtu),a
  A72D    3E 71          C              ld      a,71h           ; um was-wovor bm vorsetzen
  A72F    CD A796        C              call    kmb
  A732    C2 A6A6        C              jp      nz,sp42         ; -> fehler: beim bm-vorsetzen
  A735    50             C              ld      d,b
  A736    AF             C              xor     a
  A737    5F             C              ld      e,a             ; wovor := was.blk / 0
  A738    C3 A68B        C              jp      sp41
                         C      ;
  A73B    3E 16          C      fehler: ld      a,16h           ; fehlerbehandlung
  A73D    DD BE 01       C              cp      (ix+eafehl)     ; ----------------
  A740    20 21          C              jr      nz,fehl01       ; ende der aufzeichnungen auf dieser seite
  A742    3A A7C5        C              ld      a,(richtu)
  A745    B7             C              or      a
  A746    28 12          C              jr      z,fehl00
  A748    CD A610        C              call    rucksp          ; am anfang zur sicherheit ruckspulen
  A74B    CD A618        C              call    endruc
  A74E    3E 41          C              ld      a,41h           ; reservieren aus
  A750    CD A796        C              call    kmb
  A753    3E 31          C              ld      a,31h           ; reservieren ein
  A755    CD A796        C              call    kmb
  A758    18 09          C              jr      fehl01
  A75A    06 10          C      fehl00: ld      b,10h           ; um 16 saetze zuruecksetzen
  A75C    3E 0F          C      fehl0a: ld      a,15
  A75E    CD A796        C              call    kmb
  A761    10 F9          C              djnz    fehl0a
  A763    CD A624        C      fehl01: call    lesen
  A766    20 D3          C              jr      nz,fehler
  A768    01 000C        C              ld      bc,12
  A76B    CD A62E        C              call    konlen          ;   solange lesen bis sent gefunden
  A76E    20 CB          C              jr      nz,fehler       ;   dann vor sent setzen und wovor
  A770    DD 6E 07       C              ld      l,(ix+eaadr)    ; iy := (adr)
  A773    DD 66 08       C              ld      h,(ix+eaadr+1)
  A776    22 A7C3        C              ld      (arb),hl
  A779    FD 2A A7C3     C              ld      iy,(arb)
  A77D    FD 56 01       C              ld      d,(iy+1)
  A780    FD 5E 02       C              ld      e,(iy+2)
  A783    DD 73 10       C              ld      (ix+eawovo),e
  A786    DD 72 11       C              ld      (ix+eawovo+1),d
  A789    3E 01          C              ld      a,1
  A78B    32 A7C5        C              ld      (richtu),a
  A78E    3E 15          C              ld      a,15h
  A790    CD A796        C              call    kmb             ; einen record ruecksetzen
  A793    20 A6          C              jr      nz,fehler       ; -> fehler: beim record ruecksetzen
  A795    C9             C              ret
                         C      ;
  A796    DD 77 04       C      kmb::   ld      (ix+eakom),a    ; (kom) := a
  A799    C5             C              push    bc
  A79A    D5             C              push    de
  A79B    E5             C              push    hl
  A79C    AF             C              xor     a
  A79D    32 A7BF        C              ld      (kmwart),a
  A7A0    CD 964D        C              call    skmb
  A7A3    CD 4040        C              call    kmbrob
  A7A6    3A A7BF        C      kmb01:  ld      a,(kmwart)
  A7A9    B7             C              or      a
  A7AA    28 FA          C              jr      z,kmb01
  A7AC    CD 9653        C              call    rkmb
                         C      ;
  A7AF    E1             C      kmb02:  pop     hl
  A7B0    D1             C              pop     de
  A7B1    C1             C              pop     bc
  A7B2    DD CB 00 7E    C              bit     7,(ix+eastat)
  A7B6    C9             C              ret
                         C      ;
  A7B7    F5             C      kmbep:  push    af
  A7B8    3E 01          C              ld      a,1
  A7BA    32 A7BF        C              ld      (kmwart),a
  A7BD    F1             C              pop     af
  A7BE    C9             C              ret
                         C      ;
                         C      ;
                         C      ;
  A7BF    00             C      kmwart::defb    0               ; 0 - kmb arbeitet noch; 1 - kmb fertig
  A7C0    0000           C      was::   defw    0
  A7C2    00             C      errcou::defb    0               ; zaehler fuer fehlversuche
  A7C3    0000           C      arb::   defw    0
  A7C5    00             C      richtu::defb    0               ; 0 - es wurde vorwaerts   gelesen
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-55


                         C                                      ; 1 - es wurde rueckwaerts gelesen
                         C      ;
                         C      ;
                         C      ;
                                
                                 if mindk or stadk
                                ;       include FL.MAC
                                 ; floppytreiber fuer mini- und standarddisketten
                                ; ----------------------------------------------
                                ;
                                fl.kalt:
                                fl.warm:
                                        ret
                                ;
                                 endif
                                
                                 if zst or tramdk or opsdk
                                        include MD.MAC
                                 endif
                                
                         C              include BK.MAC
  0001                   C      wrdir   equ     1               ; write to directory
  0002                   C      wrual   equ     2               ; write to unallocated
                         C      ;********************************
                         C      ;
                         C      ;   eintritt deblocking
                         C      ;      ix zeigt auf parametertab.
                         C      ;
                         C      ;********************************
  A7C6    3E 01          C      deblck: ld      a,1
  A7C8    32 F928        C              ld      (readop),a      ; read operation
  A7CB    3E 02          C              ld      a,wrual
  A7CD    32 F92A        C              ld      (wrtype),a      ; treat as unalloc
  A7D0    18 5F          C              jr      alloc
                         C      ;********************************
                         C      ;
                         C      ;   eintritt blocking
                         C      ;      ix zeigt auf parametertab.
                         C      ;
                         C      ;********************************
  A7D2    AF             C      block:  xor     a
  A7D3    32 F928        C              ld      (readop),a      ; write operation
  A7D6    79             C              ld      a,c
  A7D7    32 F92A        C              ld      (wrtype),a      ; writetype
  A7DA    FE 02          C              cp      wrual
  A7DC    20 18          C              jr      nz,chkuna
                         C      ;;;;    ld      a,(sec)         ; write to unallocated
                         C      ;;;;    dec     a
                         C      ;;;;    ld      c,a
  A7DE    DD 7E 22       C              ld      a,(ix+blklog)
                         C      ;;;;    push    af
                         C      ;;;;    dec     a
                         C      ;;;;    and     c
                         C      ;;;;    ld      c,a
                         C      ;;;;    pop     af
                         C      ;;;;    sub     c
  A7E1    DD 77 19       C              ld      (ix+unacnt),a
  A7E4    3A F923        C              ld      a,(trk)
  A7E7    DD 77 1A       C              ld      (ix+unatrk),a
  A7EA    3A F924        C              ld      a,(trk+1)
  A7ED    DD 77 1B       C              ld      (ix+unatrk+1),a
  A7F0    3A F925        C              ld      a,(sec)
  A7F3    DD 77 1C       C              ld      (ix+unasec),a
  A7F6    DD 7E 19       C      chkuna: ld      a,(ix+unacnt)   ; any unallocated remain?
  A7F9    B7             C              or      a
  A7FA    28 35          C              jr      z,alloc         ; -> no
  A7FC    DD 35 19       C              dec     (ix+unacnt)     ; unallocated records remain
  A7FF    3A F923        C              ld      a,(trk)
  A802    DD BE 1A       C              cp      (ix+unatrk)
  A805    20 2A          C              jr      nz,alloc        ; -> not the same track
  A807    3A F924        C              ld      a,(trk+1)
  A80A    DD BE 1B       C              cp      (ix+unatrk+1)
  A80D    20 22          C              jr      nz,alloc        ; -> not the same track
  A80F    3A F925        C              ld      a,(sec)
  A812    DD BE 1C       C              cp      (ix+unasec)
  A815    20 1A          C              jr      nz,alloc        ; -> not the same sector
  A817    DD 34 1C       C              inc     (ix+unasec)     ; match, incr. for future
  A81A    DD BE 23       C              cp      (ix+cpmspt)     ; in SYS4 sind sek. von 1 bis cpmspt nummeriert
  A81D    38 0C          C              jr      c,noovf
  A81F    DD 36 1C 01    C              ld      (ix+unasec),1   ; track overflow
  A823    DD 34 1A       C              inc     (ix+unatrk)
  A826    20 03          C              jr      nz,noovf
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-56


  A828    DD 34 1B       C              inc     (ix+unatrk+1)
  A82B    AF             C      noovf:  xor     a               ; match found, mark as unnecessary read
  A82C    32 F929        C              ld      (rsflag),a
  A82F    18 09          C              jr      rwoper
                         C      ;
  A831    DD 36 19 00    C      alloc:  ld      (ix+unacnt),0
  A835    3E 01          C              ld      a,1
  A837    32 F929        C              ld      (rsflag),a      ; mark as must preread
  A83A    AF             C      rwoper: xor     a
  A83B    32 F92B        C              ld      (erflag),a      ; no errors (yet)
  A83E    DD 7E 24       C              ld      a,(ix+secshf)
  A841    47             C              ld      b,a
  A842    3A F925        C              ld      a,(sec)
  A845    3D             C              dec     a
  A846    CB 3F          C      rwop01: srl     a
  A848    10 FC          C              djnz    rwop01
  A84A    32 F92D        C              ld      (sechst),a
  A84D    DD 7E 17       C              ld      a,(ix+hstact)   ; host buffer active?
  A850    DD 36 17 01    C              ld      (ix+hstact),1
  A854    B7             C              or      a
  A855    28 1F          C              jr      z,filhst        ; -> no
  A857    3A F923        C              ld      a,(trk)         ; propper sector in buffer?
  A85A    DD BE 14       C              cp      (ix+hsttrk)
  A85D    20 10          C              jr      nz,nomatch
  A85F    3A F924        C              ld      a,(trk+1)
  A862    DD BE 15       C              cp      (ix+hsttrk+1)
  A865    20 08          C              jr      nz,nomatch
  A867    3A F92D        C              ld      a,(sechst)
  A86A    DD BE 16       C              cp      (ix+hstsec)
  A86D    28 24          C              jr      z,match
  A86F    DD 7E 18       C      nomatch:ld      a,(ix+hstwrt)   ; host written?
  A872    B7             C              or      a
  A873    C4 A8D4        C              call    nz,writehst     ; yes, write host buffer
  A876    3A F92D        C      filhst: ld      a,(sechst)
  A879    DD 77 16       C              ld      (ix+hstsec),a
  A87C    3A F923        C              ld      a,(trk)
  A87F    DD 77 14       C              ld      (ix+hsttrk),a
  A882    3A F924        C              ld      a,(trk+1)
  A885    DD 77 15       C              ld      (ix+hsttrk+1),a
  A888    DD 36 18 00    C              ld      (ix+hstwrt),0   ; no pending write
  A88C    3A F929        C              ld      a,(rsflag)
  A88F    B7             C              or      a
  A890    C4 A8E1        C              call    nz,readhst      ; read host buffer
  A893    3A F925        C      match:  ld      a,(sec)
  A896    3D             C              dec     a
  A897    DD A6 25       C              and     (ix+secmsk)
  A89A    6F             C              ld      l,a
  A89B    26 00          C              ld      h,0
                         C              rept    7
                         C              add     hl,hl
                         C              endm
  A89D    29             C+             add     hl,hl
  A89E    29             C+             add     hl,hl
  A89F    29             C+             add     hl,hl
  A8A0    29             C+             add     hl,hl
  A8A1    29             C+             add     hl,hl
  A8A2    29             C+             add     hl,hl
  A8A3    29             C+             add     hl,hl
  A8A4    DD 5E 12       C              ld      e,(ix+hstbuf)
  A8A7    DD 56 13       C              ld      d,(ix+hstbuf+1)
  A8AA    19             C              add     hl,de
  A8AB    11 F9C1        C              ld      de,dmma
  A8AE    01 0080        C              ld      bc,128
  A8B1    3A F928        C              ld      a,(readop)      ; which way?
  A8B4    B7             C              or      a
  A8B5    20 05          C              jr      nz,wmove        ; -> read
  A8B7    DD 36 18 01    C              ld      (ix+hstwrt),1   ; host buffer written
  A8BB    EB             C              ex      de,hl
  A8BC    ED B0          C      wmove:  ldir
                         C                      ;ld a,(hl) uebertragen nach hostbuffer auf cpu-karte
                         C                      ;ld     (de),a
                         C                      ;inc    hl
                         C                      ;inc    de
                         C                      ;djnz   wmove
                         C                      ;jr     retmov
                         C                      ;
                         C                      ;rmove:: set12 uebertragen vom hostbuffer auf cpu-karte
                         C                      ;ld     a,(hl)
                         C                      ;res12
                         C                      ;ld     (de),a
                         C                      ;inc    hl
                         C                      ;inc    de
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-57


                         C                      ;djnz   rmove
  A8BE    3A F92A        C      retmov: ld      a,(wrtype)      ; write type to directory?
  A8C1    FE 01          C              cp      wrdir
  A8C3    3A F92B        C              ld      a,(erflag)
  A8C6    C0             C              ret     nz              ; -> no
  A8C7    B7             C              or      a               ; errors?
  A8C8    C0             C              ret     nz              ; -> yes
  A8C9    CD A8D4        C              call    writehst
  A8CC    DD 36 18 00    C              ld      (ix+hstwrt),0
  A8D0    3A F92B        C              ld      a,(erflag)
  A8D3    C9             C              ret
                         C      
                         C      ;       up's fuer host read/write
                         C      ;       -------------------------
                         C      ;
  A8D4                   C      writehst:
  A8D4    3E 04          C              ld      a,erranz        ; erranz fehlversuche
  A8D6    32 F92C        C              ld      (rderr),a
  A8D9    DD 6E 20       C              ld      l,(ix+hwr)
  A8DC    DD 66 21       C              ld      h,(ix+hwr+1)
  A8DF    18 0B          C              jr      rdh01
                         C      ;
  A8E1                   C      readhst:
  A8E1    3E 04          C              ld      a,erranz        ; erranz fehlversuche
  A8E3    32 F92C        C              ld      (rderr),a
  A8E6    DD 6E 1E       C              ld      l,(ix+hrd)
  A8E9    DD 66 1F       C              ld      h,(ix+hrd+1)
  A8EC    CD A3FE        C      rdh01:  call    callhl
  A8EF    3E 00          C              ld      a,0
  A8F1    28 01          C              jr      z,rdh02
  A8F3    3C             C              inc     a
  A8F4    32 F92B        C      rdh02:  ld      (erflag),a
  A8F7    C9             C              ret
                         C      ;
                                ;
                                ;
                                ;
                                        page
's  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-58


                                
                                ;       user-unterprogramme
                                ;       ===================
                                ;
                                ; erhaelt in IX die adresse der e/a-tabelle
                                ;         in A  das kmb-kommando
                                ; fuehrt dann das kmb-kommando aus und wartet auf die beendigung
                                ;
  A8F8    CD A796               kmbuse::call    kmb
  A8FB    C3 F639                       jp      um2e
                                
                                ; erhaelt in IX die adresse der e/a-tabelle
                                ; wartet dann auf das ende des rueckspulens
                                ;
  A8FE    CD A618               enduse::call    endruc
  A901    C3 F639                       jp      um2e
                                
                                ; erhaelt in IX die adresse der e/a-tabelle
                                ;         in DE die adresse des zielbereiches, in den aus dem kassetten-
                                ;               puffer der e/a-tabelle uebertragen werden soll
                                ; uebertraegt dann aus dem kmb-puffer in den nutzerpuffer
                                ;
  A904    D5                    getpuf: push    de
  A905    DD 6E 07                      ld      l,(ix+eaadr)
  A908    DD 66 08                      ld      h,(ix+eaadr+1)
  A90B    DD 46 09                      ld      b,(ix+ealen)
  A90E    DD 4E 0A                      ld      c,(ix+ealen+1)
  A911    11 FA41                       ld      de,kmbpuf
  A914    ED B0                         ldir
  A916    D1                            pop     de
  A917    C3 F5EE                       jp      getpf1
                                ;
                                ;
                                ;
                                ;       defw    $
                                ;       defb    'S44L'
                                ;       ld      hl,abios-1700h          ; aBIOS - Speicherbereich loeschen
                                ;       ld      de,abios-1700h+1
                                ;       ld      bc,1700h+abiosl-1
                                ;       ld      (hl),0
                                ;       ldir
                                ;       ld      hl,biosxx+(op12-op11)   ; aBIOS - Teil laden
                                ;       ld      de,abios
                                ;       ld      bc,abios2-abios1
                                ;       ldir
                                ;       jp      0000bh
                                ;
                                ;       defw    $
                                ;       defb    'SYS4'
                                ;       jp      abios
  A91A                          biosxx::
                                        .dephase
  1384*                         sbios2::
                                ; \---  Ende : sBIOS -----------------------------------------------------------------------------/
                                        title   'opsmac'
                                        page
'opsmac'        MACRO-80 3.44   09-Dec-81       PAGE    1-59


                                
                                ; /---  Start: opsmac ----------------------------------------------------------------------------\
                                ;
                                ;
  1384*                         op11::
                                        .phase  00c00h
                                        opsmac
                                        .dephase
  1384*                         op12::
                                ;
                                ;
                                ;
                                ; \---  Ende : opsmac ----------------------------------------------------------------------------/
                                        title   'a  B I O S'
                                        page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-60


                                
                                ; /---  Start: aBIOS -----------------------------------------------------------------------------\
                                ;       B I O S   -   Sprungverteiler
                                ;       =============================
                                ;
  1384*                         abios1::
                                        .phase  abios           ;F400H
                                ;
  F400    C3 F500                       jp      br00            ;boot
  F403    C3 F506                       jp      br03            ;wboot
  F406    C3 F50C                       jp      br06            ;const
  F409    C3 F512                       jp      br09            ;conin
  F40C    C3 F518                       jp      br0c            ;conout
  F40F    C3 F51E                       jp      br0f            ;list
  F412    C3 F524                       jp      br12            ;punch
  F415    C3 F52A                       jp      br15            ;reader
  F418    C3 F530                       jp      br18            ;home
  F41B    C3 F56F                       jp      br1b            ;seldsk
  F41E    C3 F582                       jp      br1e            ;settrk
  F421    C3 F587                       jp      br21            ;setsec
  F424    C3 F58C                       jp      br24            ;setdma
  F427    C3 F591                       jp      br27            ;read
  F42A    C3 F5B1                       jp      br2a            ;write
  F42D    C3 F5C8                       jp      br2d            ;listst
  F430    C3 F5CE                       jp      br30            ;sectrn
                                ;
  F433    C3 F586                       jp      rtn             ;xx33
  F436    C3 F586                       jp      rtn             ;xx36
  F439    C3 F586                       jp      rtn             ;xx39
  F43C    C3 F586                       jp      rtn             ;xx3c
  F43F    C3 F586                       jp      rtn             ;xx3f
  F442    C3 F586                       jp      rtn             ;xx42
  F445    C3 F586                       jp      rtn             ;xx45
                                ;
                                ;       interrupt sprungtabelle (beginnt auf xx48h)
                                ;       =======================
                                ;
                                ;       include IT.MAC
  F448                                  defs    0b8h
                                ;
                                        page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-61


                                
                                ;       Verbindungsroutinen zu den eigentlichen BIOS-Routinen
                                ;       =====================================================
                                ;
  F500    CD F5FE               br00::  call    um1
  F503    C3 9760                       jp      boot
                                ;
  F506    CD F5FE               br03::  call    um1
  F509    C3 97FD                       jp      wboot
                                ;
  F50C    CD F5FE               br06::  call    um1
  F50F    C3 9A58                       jp      const
                                ;
  F512    CD F5FE               br09::  call    um1
  F515    C3 9A8D                       jp      conin
                                ;
  F518    CD F5FE               br0c::  call    um1
  F51B    C3 9E6B                       jp      conou
                                ;
  F51E    CD F5FE               br0f::  call    um1
  F521    C3 9E9F                       jp      list
                                ;
  F524    CD F5FE               br12::  call    um1
  F527    C3 9F08                       jp      punch
                                ;
  F52A    CD F5FE               br15::  call    um1
  F52D    C3 9EDF                       jp      reader
                                ;
  F530    CD F5FE               br18::  call    um1
  F533    CD 9600               home::  call    reta            ; head home
  F536    01 0000                       ld      bc,0
  F539    CD F582                       call    settrk
  F53C    CD F55A                       call    setix
  F53F    28 16                         jr      z,home1         ; -> geraet nicht vorhanden
  F541    DD 7E FB                      ld      a,(ix-isblk)    ; arbeitet geraet mit blockung?
  F544    B7                            or      a
  F545    28 10                         jr      z,home1         ; -> nein
  F547    DD 7E 17                      ld      a,(ix+hstact)   ; ist hostbuffer aktiv?
  F54A    B7                            or      a
  F54B    28 0A                         jr      z,home1         ; -> nein
  F54D    DD 7E 18                      ld      a,(ix+hstwrt)   ; wurde in hostbuffer geschrieben?
  F550    B7                            or      a
  F551    20 04                         jr      nz,home1        ; -> ja
  F553    DD 36 17 00                   ld      (ix+hstact),0   ; flush hostbuffer
  F557    C3 9611               home1:  jp      um2ee
                                ;
  F55A    3A F927               setix:  ld      a,(dev)         ; e/a-tabellenadresse nach ix laden
  F55D    5F                            ld      e,a
  F55E    16 00                         ld      d,0
  F560    21 F748                       ld      hl,ixtab
  F563    19                            add     hl,de
  F564    19                            add     hl,de
  F565    5E                            ld      e,(hl)
  F566    23                            inc     hl
  F567    56                            ld      d,(hl)
  F568    7B                            ld      a,e
  F569    B2                            or      d
  F56A    C8                            ret     z               ; -> geraet nicht vorhanden
  F56B    D5                            push    de
  F56C    DD E1                         pop     ix
  F56E    C9                            ret
                                ;
  F56F                          br1b::
  F56F    79                    seldsk::ld      a,c             ; select disk
  F570    C5                            push    bc
  F571    32 F927                       ld      (dev),a
  F574    87                            add     a,a
  F575    4F                            ld      c,a
  F576    06 00                         ld      b,0
  F578    21 F7F8                       ld      hl,dpha
  F57B    09                            add     hl,bc
  F57C    7E                            ld      a,(hl)
  F57D    23                            inc     hl
  F57E    66                            ld      h,(hl)
  F57F    6F                            ld      l,a
  F580    C1                            pop     bc
  F581    C9                            ret
                                ;
  F582                          br1e::  
  F582    ED 43 F923            settrk::ld      (trk),bc        ; set track
  F586    C9                    rtn::   ret
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-62


                                ;
  F587                          br21::
  F587    ED 43 F925            setsec::ld      (sec),bc        ; set sector
  F58B    C9                            ret
                                ;
  F58C                          br24::
  F58C    ED 43 F921            setdma::ld      (dma),bc        ; set memory address
  F590    C9                            ret
                                ;
  F591    CD F5FE               br27::  call    um1
  F594    C3 A3E3                       jp      read
  F597    CD F621               br270:  call    um2
  F59A    C5                            push    bc
  F59B    D5                            push    de
  F59C    E5                            push    hl
  F59D    21 F9C1                       ld      hl,dmma
  F5A0    ED 5B F921                    ld      de,(dma)
  F5A4    01 0080                       ld      bc,128
  F5A7    ED B0                         ldir
  F5A9    E1                            pop     hl
  F5AA    D1                            pop     de
  F5AB    C1                            pop     bc
  F5AC    ED 7B FCC1            br271:  ld      sp,(s1ret)
  F5B0    C9                            ret
                                ;
  F5B1    C5                    br2a::  push    bc
  F5B2    D5                            push    de
  F5B3    E5                            push    hl
  F5B4    2A F921                       ld      hl,(dma)
  F5B7    11 F9C1                       ld      de,dmma
  F5BA    01 0080                       ld      bc,128
  F5BD    ED B0                         ldir
  F5BF    E1                            pop     hl
  F5C0    D1                            pop     de
  F5C1    C1                            pop     bc
  F5C2    CD F5FE                       call    um1
  F5C5    C3 A3CB                       jp      write
                                ;
  F5C8    CD F5FE               br2d::  call    um1
  F5CB    C3 9E8C                       jp      listst
                                ;
  F5CE                          br30::
  F5CE    7A                    sectrn::ld      a,d             ; translate sector
  F5CF    B3                            or      e               ; wenn de=0, dann keine transformation
  F5D0    28 06                         jr      z,sectr1
  F5D2    EB                            ex      de,hl
  F5D3    09                            add     hl,bc
  F5D4    6E                            ld      l,(hl)
  F5D5    26 00                         ld      h,0
  F5D7    C9                            ret
  F5D8    60                    sectr1: ld      h,b
  F5D9    69                            ld      l,c
  F5DA    23                            inc     hl
  F5DB    C9                            ret
                                ;
  F5DC    CD F5FE               ukmb::  call    um1
  F5DF    C3 A8F8                       jp      kmbuse
                                ;
  F5E2    CD F5FE               uend::  call    um1
  F5E5    C3 A8FE                       jp      enduse
                                ;
  F5E8    CD F5FE               ugetp:: call    um1
  F5EB    C3 A904                       jp      getpuf
  F5EE    CD F621               getpf1: call    um2
  F5F1    21 FA41                       ld      hl,kmbpuf
  F5F4    01 0100                       ld      bc,256
  F5F7    ED B0                         ldir
  F5F9    ED 7B FCC1            getpf2: ld      sp,(s1ret)
  F5FD    C9                            ret
                                ;
                                ;
                                ;
                                        page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-63


                                
                                ; Umschaltroutinen zwischen System- und AnwenderSpeicherbereich
                                ; =============================================================
                                ;
                                        um
  F5FE                    +     um1::
  F5FE    22 F936         +             ld      (hlret),hl      ; HL retten
  F601    E1              +             pop     hl              ; RET-Adresse ==> HL
  F602                    +     um1r1:
  F602    ED 73 FCC1      +             ld      (s1ret),sp      ; SP retten                (s3ret),sp
  F606                    +     um1r2:
  F606    31 FC41         +             ld      sp,s1neu        ; SP neu laden             sp,s3neu
  F609    E5              +             push    hl              ; HL ==> Stack
  F60A    2A F936         +             ld      hl,(hlret)      ; HL wieder herstellen
  F60D                    +     um1r3:
  F60D    00              +             nop                     ;                          jp resp0
  F60E    00              +             nop
  F60F    00              +             nop
  F610    C5              +             push    bc
  F611    E5              +             push    hl
  F612    01 04C0         +             ld      bc,004C0h
  F615    21 F61D         +             ld      hl,um1r4
  F618    ED B3           +             otir
  F61A    E1              +             pop     hl
  F61B    C1              +             pop     bc
  F61C    C9              +             ret
  F61D                    +     um1r4:
  F61D    F0              +             DB      0F0H    ;Startbyte
  F61E    03              +             DB      003H    ;wahl   0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F
  F61F    01              +             DB      001H    ;um1   {0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0}
  F620    FF              +             DB      0FFH    ;Endbyte
  F621                    +     um2::
  F621    00              +             nop                     ;                          jp setp0
  F622    00              +             nop
  F623    00              +             nop
  F624    F5              +             push    af
  F625    C5              +             push    bc
  F626    D5              +             push    de
  F627    E5              +             push    hl
  F628    01 04C0         +             ld      bc,004C0h
  F62B    21 F635         +             ld      hl,um21
  F62E    ED B3           +             otir
  F630    E1              +             pop     hl
  F631    D1              +             pop     de
  F632    C1              +             pop     bc
  F633    F1              +             pop     af
  F634    C9              +             ret
  F635                    +     um21:
  F635    F0              +             DB      0F0H    ;Startbyte
  F636    03              +             DB      003H    ;wahl   0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F
  F637    02              +             DB      002H    ;um2   {4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0}
  F638    FF              +             DB      0FFH    ;Endbyte
  F639                    +     um2e:
  F639    CD F621         +             call    um2
  F63C                    +     um2er:
  F63C    ED 7B FCC1      +             ld      sp,(s1ret)
  F640    C9              +             ret
                                        page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-64


                                
                                ; hardware beschreibungstabellen
                                ; ==============================
                                ;
                         C              include IX.MAC
                         C      ; e/a tabellen-aufbau
                         C      ; -------------------
                         C      ;
  0005                   C      isblk   equ     5               ; 0 - geraet arbeitet ungeblockt
  0004                   C      ixrd    equ     4               ; read/write-anspruenge
  0002                   C      ixwr    equ     2
                         C      
  0000                   C      eastat  equ     0               ; bamos-arbeitszellen kmb
  0001                   C      eafehl  equ     1
  0004                   C      eakom   equ     4
  0005                   C      eaep    equ     5
  0007                   C      eaadr   equ     7
  0009                   C      ealen   equ     9
  000A                   C      eabm    equ     10
  000B                   C      eawied  equ     11
  000C                   C      eaverl  equ     12
                         C      
  000D                   C      eadpuf  equ     13              ; directorypufferung kassetten
  000F                   C      eadzei  equ     15
                         C      
  0010                   C      eawovo  equ     16              ; positionierung kassetten
                         C      
  0012                   C      hstbuf  equ     18              ; blockung/entblockung arbeitszellen
  0014                   C      hsttrk  equ     20
  0016                   C      hstsec  equ     22
  0017                   C      hstact  equ     23
  0018                   C      hstwrt  equ     24
  0019                   C      unacnt  equ     25
  001A                   C      unatrk  equ     26
  001C                   C      unasec  equ     28
                         C      
  001D                   C      gelade  equ     29
                         C      
  001E                   C      hrd     equ     30              ; blockung/entblockung parameter
  0020                   C      hwr     equ     32
  0022                   C      blklog  equ     34
  0023                   C      cpmspt  equ     35
  0024                   C      secshf  equ     36
  0025                   C      secmsk  equ     37
                         C      ;
                         C              page    
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-65


                         C      
                         C      ; e/a-tabelle tpa-disk
                         C      ;
  F641    00             C              defb    0               ; ungeblocktes geraet
  F642    A418           C              defw    rdmem
  F644    A402           C              defw    wrmem
  F646                   C      eataba::
                         C      ;
                         C      ; e/a-tabellen kassetten
                         C      ;
  F646    01             C              defb    1               ; geraet arbeitet geblockt
  F647    A4B0           C              defw    rdkmb
  F649    A453           C              defw    wrkmb
  F64B    00 00 30 01    C      eatab1::defb    0,0,pkmb,1      ; laufwerk 1
  F64F    00             C              defb    0               ; ==========
  F650    A7B7           C              defw    kmbep           ;    ep
  F652    0000           C              defw    0               ;    adr
  F654    0000           C              defw    0               ;    len , anzbm
  F656    0000           C              defw    0               ;    anz.versuche , anz. ext.gap
  F658    D000           C              defw    dir1
  F65A    00             C              defb    0               ; anzeiger, ob in directory geschrieben
                         C      ;                               ; wurde ( =1 es wurde )
  F65B    0000           C              defw    0               ; wovor blk/rec
  F65D    2800           C              defw    kasbu1          ; adresse des hostbuffer
  F65F    0000           C              defw    0               ; nr. des pufferinhaltes als hostwert
  F661    00             C              defb    0               ;               - " -
  F662    00             C              defb    0               ; puffer gefuellt (=0 nein)
  F663    00             C              defb    0               ; puffer beschrieben (=1 es wurde)
  F664    00             C              defb    0               ; anzahl der noch unalloc. recs
  F665    0000           C              defw    0               ; spurnr. des naechsten unalloc. recs
  F667    00             C              defb    0               ; sektornr.     - " -
  F668    00             C              defb    0               ; 0 laufwerk entladen; 1 laufwerk geladen
  F669    A4DB           C              defw    hrdkmb          ; leseroutine vom kmb in hostbuffer
  F66B    A486           C              defw    hwrkmb          ; writeroutine vom hostbuffer auf kmb
  F66D    08 10 01 01    C              defb    8,16,1,1        ; parameter blockung/entblockung
                         C      ;
  F671    01             C              defb    1
  F672    A4B0           C              defw    rdkmb
  F674    A453           C              defw    wrkmb
  F676    00 00 30 02    C      eatab2::defb    0,0,pkmb,2      ; laufwerk 2
  F67A    00             C              defb    0               ; ==========
  F67B    A7B7 0000      C              defw    kmbep,0
  F67F    0000 0000      C              defw    0,0
  F683    D800           C              defw    dir2
  F685    00             C              defb    0
  F686    0000           C              defw    0
  F688    2900           C              defw    kasbu2
  F68A    0000           C              defw    0
  F68C    00 00 00 00    C              defb    0,0,0,0
  F690    0000           C              defw    0
  F692    00             C              defb    0
  F693    00             C              defb    0
  F694    A4DB           C              defw    hrdkmb
  F696    A486           C              defw    hwrkmb
  F698    08 10 01 01    C              defb    8,16,1,1
                         C      ;
                         C       if anzakb gt 1
  F69C    01             C              defb    1
  F69D    A4B0           C              defw    rdkmb
  F69F    A453           C              defw    wrkmb
  F6A1    00 00 38 01    C      eatab3::defb    0,0,pkmb2,1     ; laufwerk 3
  F6A5    00             C              defb    0               ; ==========
  F6A6    A7B7 0000      C              defw    kmbep,0
  F6AA    0000 0000      C              defw    0,0
  F6AE    E000           C              defw    dir3
  F6B0    00             C              defb    0
  F6B1    0000           C              defw    0
  F6B3    2A00           C              defw    kasbu3
  F6B5    0000           C              defw    0
  F6B7    00 00 00 00    C              defb    0,0,0,0
  F6BB    0000           C              defw    0
  F6BD    00             C              defb    0
  F6BE    00             C              defb    0
  F6BF    A4DB           C              defw    hrdkmb
  F6C1    A486           C              defw    hwrkmb
  F6C3    08 10 01 01    C              defb    8,16,1,1
                         C      ;
  F6C7    01             C              defb    1
  F6C8    A4B0           C              defw    rdkmb
  F6CA    A453           C              defw    wrkmb
  F6CC    00 00 38 02    C      eatab4::defb    0,0,pkmb2,2     ; laufwerk 4
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-66


  F6D0    00             C              defb    0               ; ==========
  F6D1    A7B7 0000      C              defw    kmbep,0
  F6D5    0000 0000      C              defw    0,0
  F6D9    E800           C              defw    dir4
  F6DB    00             C              defb    0
  F6DC    0000           C              defw    0
  F6DE    2B00           C              defw    kasbu4
  F6E0    0000           C              defw    0
  F6E2    00 00 00 00    C              defb    0,0,0,0
  F6E6    0000           C              defw    0
  F6E8    00             C              defb    0
  F6E9    00             C              defb    0
  F6EA    A4DB           C              defw    hrdkmb
  F6EC    A486           C              defw    hwrkmb
  F6EE    08 10 01 01    C              defb    8,16,1,1
                         C       endif
                         C      ;
                         C       if anzakb gt 2
  F6F2    01             C              defb    1
  F6F3    A4B0           C              defw    rdkmb
  F6F5    A453           C              defw    wrkmb
  F6F7    00 00 58 01    C      eatab5::defb    0,0,pkmb3,1     ; laufwerk 5
  F6FB    00             C              defb    0               ; ==========
  F6FC    A7B7 0000      C              defw    kmbep,0
  F700    0000 0000      C              defw    0,0
  F704    F000           C              defw    dir5
  F706    00             C              defb    0
  F707    0000           C              defw    0
  F709    2C00           C              defw    kasbu5
  F70B    0000           C              defw    0
  F70D    00 00 00 00    C              defb    0,0,0,0
  F711    0000           C              defw    0
  F713    00             C              defb    0
  F714    00             C              defb    0
  F715    A4DB           C              defw    hrdkmb
  F717    A486           C              defw    hwrkmb
  F719    08 10 01 01    C              defb    8,16,1,1
                         C      ;
  F71D    01             C              defb    1
  F71E    A4B0           C              defw    rdkmb
  F720    A453           C              defw    wrkmb
  F722    00 00 58 02    C      eatab6::defb    0,0,pkmb3,2     ; laufwerk 6
  F726    00             C              defb    0               ; ==========
  F727    A7B7 0000      C              defw    kmbep,0
  F72B    0000 0000      C              defw    0,0
  F72F    F800           C              defw    dir6
  F731    00             C              defb    0
  F732    0000           C              defw    0
  F734    2D00           C              defw    kasbu6
  F736    0000           C              defw    0
  F738    00 00 00 00    C              defb    0,0,0,0
  F73C    0000           C              defw    0
  F73E    00             C              defb    0
  F73F    00             C              defb    0
  F740    A4DB           C              defw    hrdkmb
  F742    A486           C              defw    hwrkmb
  F744    08 10 01 01    C              defb    8,16,1,1
                         C       endif
                         C      
                         C       if mindk
                         C      ;
                         C      ; e/a-tabellen minidisk
                         C      ;
                         C              defb    0
                         C              defw    rdmd
                         C              defw    wrmd
                         C      eamd1:: 
                         C      
                         C              defb    0
                         C              defw    rdmd
                         C              defw    wrmd
                         C      eamd2::
                         C      
                         C              defb    0
                         C              defw    rdmd
                         C              defw    wrmd
                         C      eamd3::
                         C      
                         C              defb    0
                         C              defw    rdmd
                         C              defw    wrmd
                         C      eamd4::
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-67


                         C       endif
                         C      
                         C       if stadk
                         C      ;
                         C      ; e/a-tabellen standarddisk
                         C      ;
                         C              defb    0
                         C              defw    rdsd
                         C              defw    wrsd
                         C      easd1::
                         C      
                         C              defb    0
                         C              defw    rdsd
                         C              defw    wrsd
                         C      easd2::
                         C       endif
                         C      
                         C       if zst
                         C      ;
                         C      ; e/a-tabelle zentralstation
                         C      ;
                         C              defb    0
                         C              defw    rdzst
                         C              defw    wrzst
                         C      eazst::
                         C       endif
                         C      
                         C       if tramdk
                         C      ;
                         C      ; e/a-tabelle TRAM-Disk
                         C      ;
                         C              defb    0
                         C              defw    rdtram
                         C              defw    wrtram
                         C      eatram::
                         C       endif
                         C      
                         C       if opsdk
                         C      ;
                         C      ; e/a-tabelle 16k-OPS-Disk
                         C      ;
                         C              defb    0
                         C              defw    rdops
                         C              defw    wrops
                         C      eaops::
                         C       endif
                         C      ;
                         C              page    
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-68


                         C      
  F748                   C      ixtab:: defs    32
                         C      ;
  F768    F646           C      ixtab1::defw    eataba          ; tabelle der ix-adresse
                         C      
  F76A    F64B F676      C              defw    eatab1,eatab2
                         C      
                         C       if anzakb gt 1
  F76E    F6A1 F6CC      C              defw    eatab3,eatab4
                         C       else
                         C              defw    0,0
                         C       endif
                         C      
                         C       if anzakb gt 2
  F772    F6F7 F722      C              defw    eatab5,eatab6
                         C       else
                         C              defw    0,0
                         C       endif
                         C      
                         C       if mindk
                         C              defw    eamd1,eamd2,eamd3,eamd4
                         C       else
  F776    0000 0000      C              defw    0,0,0,0
  F77A    0000 0000      C      
                         C       endif
                         C      
                         C       if stadk
                         C              defw    easd1,easd2
                         C       else
  F77E    0000 0000      C              defw    0,0
                         C       endif
                         C      
                         C       if zst
                         C              defw    eazst
                         C       else
  F782    0000           C              defw    0
                         C       endif
                         C      
                         C       if tramdk
                         C              defw    eatram
                         C       else
  F784    0000           C              defw    0
                         C       endif
                         C      
                         C       if opsdk
                         C              defw    eaops
                         C       else
  F786    0000           C              defw    0
                         C       endif
                         C      ;
                                ;
                         C              include DH.MAC
                         C      ;
                         C      ; T P A   -   Disk              Laufwerk A:
                         C      ; ++++++++++++++++              +++++++++++
                         C      ;
  F788    0000 0000      C      dphad:: defw    0,0             ; keine sektorumrechnung
  F78C    0000 0000      C              defw    0,0
  F790    F941           C              defw    dirbf
  F792    F818           C              defw    dpblkm          ; geraetebeschreibung
  F794    F83D           C              defw    chkm            ; directory-kontrolle
  F796    F836           C              defw    allm
                         C      
                         C      ; kassette 1 + 2 geblockt       Laufwerk B: und C:
                         C      ; +++++++++++++++++++++++       ++++++++++++++++++
                         C      ;
  F798    0000 0000      C      dphc1:: defw    0,0             ; keine sektorumrechnung
  F79C    0000 0000      C              defw    0,0
  F7A0    F941           C              defw    dirbf
  F7A2    F827           C              defw    dpblkc
  F7A4    F853           C              defw    chkc1
  F7A6    F83D           C              defw    allc1
                         C      ;
  F7A8    0000 0000      C      dphc2:: defw    0,0             ; keine sektorumrechnung
  F7AC    0000 0000      C              defw    0,0
  F7B0    F941           C              defw    dirbf
  F7B2    F827           C              defw    dpblkc
  F7B4    F879           C              defw    chkc2
  F7B6    F863           C              defw    allc2
                         C      
                         C      ; kassette 3 + 4 geblockt     Laufwerk D: und E:
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-69


                         C      ; +++++++++++++++++++++++     ++++++++++++++++++
                         C      ;
                         C       if anzakb gt 1
  F7B8    0000 0000      C      dphc3:: defw    0,0             ; keine sektorumrechnung
  F7BC    0000 0000      C              defw    0,0
  F7C0    F941           C              defw    dirbf
  F7C2    F827           C              defw    dpblkc
  F7C4    F89F           C              defw    chkc3
  F7C6    F889           C              defw    allc3
                         C      ;
  F7C8    0000 0000      C      dphc4:: defw    0,0             ; keine sektorumrechnung
  F7CC    0000 0000      C              defw    0,0
  F7D0    F941           C              defw    dirbf
  F7D2    F827           C              defw    dpblkc
  F7D4    F8C5           C              defw    chkc4
  F7D6    F8AF           C              defw    allc4
                         C       endif
                         C      
                         C      ; kassette 5 + 6 geblockt     Laufwerk F: und G:
                         C      ; +++++++++++++++++++++++     ++++++++++++++++++
                         C      ;
                         C       if anzakb gt 2
  F7D8    0000 0000      C      dphc5:: defw    0,0             ; keine sektorumrechnung
  F7DC    0000 0000      C              defw    0,0
  F7E0    F941           C              defw    dirbf
  F7E2    F827           C              defw    dpblkc
  F7E4    F8EB           C              defw    chkc5
  F7E6    F8D5           C              defw    allc5
                         C      ;
  F7E8    0000 0000      C      dphc6:: defw    0,0             ; keine sektorumrechnung
  F7EC    0000 0000      C              defw    0,0
  F7F0    F941           C              defw    dirbf
  F7F2    F827           C              defw    dpblkc
  F7F4    F911           C              defw    chkc6
  F7F6    F8FB           C              defw    allc6
                         C       endif
                         C      
                         C      ; mini - disk 1 bis 4     Laufwerk H: , I: , J: und K:
                         C      ; +++++++++++++++++++     ++++++++++++++++++++++++++++
                         C      ;
                         C       if mindk
                         C      dphh1:: defw    0,0             ;
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkh
                         C              defw    chkm1
                         C              defw    allm1
                         C      ;
                         C      dphi1:: defw    0,0
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkh
                         C              defw    chkm2
                         C              defw    allm2
                         C      ;
                         C      dphj1:: defw    0,0
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkh
                         C              defw    chkm3
                         C              defw    allm3
                         C      ;
                         C      dphk1:: defw    0,0
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkh
                         C              defw    chkm4
                         C              defw    allm4
                         C       endif
                         C      
                         C      ; standard - disk 1 + 2     Laufwerk L: und M:
                         C      ; +++++++++++++++++++++     ++++++++++++++++++
                         C      ;
                         C       if stadk
                         C      dphl1:: defw    0,0
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkl
                         C              defw    chks1
                         C              defw    alls1
                         C      ;
                         C      dphm1:: defw    0,0
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-70


                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkl
                         C              defw    chks2
                         C              defw    alls2
                         C       endif
                         C      
                         C      ; zentralstation             Laufwerk N:
                         C      ; ++++++++++++++             +++++++++++
                         C      ;
                         C       if zst
                         C      dphn1:: defw    0,0
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkn
                         C              defw    chkn
                         C              defw    alln
                         C       endif
                         C      
                         C      ; TRAM - Disk                Laufwerk O:
                         C      ; +++++++++++                +++++++++++
                         C      ;
                         C       if tramdk
                         C      dpho1:: defw    0,0
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblko
                         C              defw    chko
                         C              defw    allo
                         C       endif
                         C      
                         C      ; 16k - OPS - Disk           Laufwerk P:
                         C      ; ++++++++++++++++           +++++++++++
                         C      ;
                         C       if opsdk
                         C      dphp1:: defw    0,0
                         C              defw    0,0
                         C              defw    dirbf
                         C              defw    dpblkp
                         C              defw    chkp
                         C              defw    allp
                         C       endif
                         C      
                         C              page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-71


                         C      
                         C      ;
  F7F8    0000           C      dpha::  defw    0               ; dph geraet a
  F7FA    0000           C      dphb::  defw    0               ;            b
  F7FC    0000           C      dphc::  defw    0               ;            c
  F7FE    0000           C      dphd::  defw    0               ;            d
  F800    0000           C      dphe::  defw    0               ;            e
  F802    0000           C      dphf::  defw    0               ;            f
  F804    0000           C      dphg::  defw    0               ;            g
  F806    0000           C      dphh::  defw    0               ;            h
  F808    0000           C      dphi::  defw    0               ;            i
  F80A    0000           C      dphj::  defw    0               ;            j
  F80C    0000           C      dphk::  defw    0               ;            k
  F80E    0000           C      dphl::  defw    0               ;            l
  F810    0000           C      dphm::  defw    0               ;            m
  F812    0000           C      dphn::  defw    0               ;            n
  F814    0000           C      dpho::  defw    0               ;            o
  F816    0000           C      dphp::  defw    0               ;            p
                         C      ;
                                ;
                         C              include DB.MAC
                         C      ;
                         C      ;       Laufwerk A:
                         C      ;       +++++++++++
  F818                   C      dpblkm::
  F818    0020           C              defw    32      ; sektoren pro spur
  F81A    03 07 00       C              defb    3,7,0   ; 1k blockung
  F81D                   C      sizem::
  F81D    001F           C              defw    31      ; 32k kapazitaet
  F81F    001F           C              defw    31      ; 32 dir. entries
  F821    80 00          C              defb    80h,0   ; 1 belegter block durch dir.
  F823    0000           C              defw    0       ; 0 dir.entries pruefen
  F825    0000           C              defw    0       ; 0 spuren durch system belegt
                         C      
                         C      ;       Laufwerk B: , C: , D: , E: , F: , G:
                         C      ;       ++++++++++++++++++++++++++++++++++++
  F827                   C      dpblkc::
  F827    0010           C              defw    16      ; sektoren pro spur
  F829    03 07 00       C              defb    3,7,0   ; 1k blockung
  F82C    00AF           C              defw    175     ; 176k kapazitaet
  F82E    003F           C              defw    63      ; 64 dir. entries
  F830    C0 00          C              defb    0c0h,0  ; 2 belegte bloecke durch dir.
  F832    0010           C              defw    16      ; 16 dir.entries pruefen
  F834    0000           C              defw    0       ; 0 spuren durch system belegt
                         C      
                         C       if mindk
                         C      ;       Laufwerk H: , I: , J: , K:
                         C      ;       ++++++++++++++++++++++++++
                         C      dpblkh::
                         C              defw    30      ; sektoren pro spur
                         C              defb    3,7,0   ; 1k blockung
                         C              defw    137     ; 138k kapazitaet
                         C              defw    63      ; 64 dir. entries
                         C              defb    0c0h,0  ; 
                         C              defw    16      ; 16 dir.entries pruefen
                         C              defw    3       ; 3 spuren durch system belegt
                         C       endif
                         C      
                         C       if stadk
                         C      ;       Laufwerk L: , M:
                         C      ;       ++++++++++++++++
                         C      dpblkl::
                         C              defw    0
                         C              defb    3,7,0
                         C              defw    0
                         C              defw    63
                         C              defb    0c0h,0
                         C              defw    16
                         C              defw    0
                         C       endif
                         C      
                         C       if zst
                         C      ;       Laufwerk N:
                         C      ;       +++++++++++
                         C      dpblkn::
                         C              defw    0
                         C              defb    3,7,0
                         C              defw    0
                         C              defw    63
                         C              defb    0c0h,0
                         C              defw    16
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-72


                         C              defw    0
                         C       endif
                         C      
                         C       if tramdk
                         C      ;       Laufwerk O:
                         C      ;       +++++++++++
                         C      dpblko::
                         C              defw    32
                         C              defb    3,7,0
                         C              defw    0
                         C              defw    31
                         C              defb    80h,0
                         C              defw    0
                         C              defw    0
                         C       endif
                         C      
                         C       if opsdk
                         C      ;       Laufwerk P:
                         C      ;       +++++++++++
                         C      dpblkp::
                         C              defw    128
                         C              defb    3,7,0
                         C              defw    0
                         C              defw    31
                         C              defb    80h,0
                         C              defw    0
                         C              defw    0
                         C       endif
                         C      ;
                         C              page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-73


                         C      
                         C      ;
                         C      ;
                         C      ;
  F836                   C      allm::  defs    7               ; reicht fuer  56k
  F83D                   C      chkm::  defs    0
                         C      
                         C      
  F83D                   C      allc1:: defs    22              ; reicht fuer 176k
  F853                   C      chkc1:: defs    16
                         C      
  F863                   C      allc2:: defs    22              ; reicht fuer 176k
  F879                   C      chkc2:: defs    16
                         C      
                         C      
                         C       if anzakb gt 1
  F889                   C      allc3:: defs    22              ; reicht fuer 176k
  F89F                   C      chkc3:: defs    16
                         C      
  F8AF                   C      allc4:: defs    22              ; reicht fuer 176k
  F8C5                   C      chkc4:: defs    16
                         C       endif
                         C      
                         C      
                         C       if anzakb gt 2
  F8D5                   C      allc5:: defs    22              ; reicht fuer 176k
  F8EB                   C      chkc5:: defs    16
                         C      
  F8FB                   C      allc6:: defs    22              ; reicht fuer 176k
  F911                   C      chkc6:: defs    16
                         C       endif
                         C      
                         C      
                         C       if mindk
                         C      allm1:: defs    22
                         C      chkm1:: defs    16
                         C      
                         C      allm2:: defs    22
                         C      chkm2:: defs    16
                         C      
                         C      allm3:: defs    22
                         C      chkm3:: defs    16
                         C      
                         C      allm4:: defs    22
                         C      chkm4:: defs    16
                         C       endif
                         C      
                         C      
                         C       if stadk
                         C      alls1:: defs    22
                         C      chks1:: defs    16
                         C      
                         C      alls2:: defs    22
                         C      chks2:: defs    16
                         C       endif
                         C      
                         C      
                         C       if zst
                         C      alln::  defs    129             ; reicht fuer 1M
                         C      chkn::  defs    32              ; reicht fuer 128 dir_entries
                         C       endif
                         C      
                         C      
                         C       if tramdk
                         C      allo::  defs    32              ; reicht fuer 256k
                         C      chko::  defs    0
                         C       endif
                         C      
                         C      
                         C       if opsdk
                         C      allp::  defs    32              ; reicht fuer 256k
                         C      chkp::  defs    0
                         C       endif
                         C      
                         C      
                                ;
                                ;
                                ;
                                        page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-74


                                
                                ;  arbeitszellen
                                ;  =============
                                ;
  F921    0000                  dma::   defw    0
  F923    0000                  trk::   defw    0
  F925    0000                  sec::   defw    0
  F927    00                    dev::   defb    0
                                ;
  F928    00                    readop::defb    0               ; workspace for blocking/deblocking
  F929    00                    rsflag::defb    0
  F92A    00                    wrtype::defb    0
  F92B    00                    erflag::defb    0
  F92C    00                    rderr:: defb    0
  F92D    00                    sechst::defb    0
                                ;
  F92E    0000                  bsaddr::defw    0               ; aktuelle bs-adresse
  F930    00                    qrmode::defb    0               ; 1 spezieller rollmodus
  F931    00                    qroll:: defb    0               ; 1 es wurde rollen verzoegert
  F932    00                    qesc::  defb    0               ; anzeiger fuer steuerfolgen
  0000                          qesc0   equ     0
  0001                          qesc1   equ     1
  0002                          qesc2   equ     2
  F933    20                    umsch:: defb    20h             ; aktuelle shiftmaske
  F934    00                    cont::  defb    0               ; merkzelle fuer control-taste
  F935    00                    syste:: defb    0               ; 1 - kassettenladen/-entladen erlaubt
  F936    0000                  hlret:: defw    0               ; zwischenspeicher fuer register HL
                                ;
  F938    00                    sverz:: defb    0               ; zum verzoegern von const
  F939    00                    sschr:: defb    0               ; 00 - kein schnellschreiben
                                ;
                                ;
  F93A    05 00 00 00           ccppuf::defb    5,0,0,0,0,0,0   ; puffer zur eingabe des lade/entladekommandos
  F93E    00 00 00              
                                ;
  F941                          dirbf   equ     $               ; 128 Byte lang
                                ;
  F9C1                          dmma    equ     dirbf+128       ; 128 Byte lang
                                ;
  FA41                          kmbpuf  equ     dmma+128        ; 100h hilfspuffer zum direkten kmbschreiben
                                ;
                                ;
  FBC1                          spber   equ     kmbpuf+180h
                                ;
  FC41                          s1neu   equ     spber+80h
  FCC1                          s3neu   equ     s1neu+80h
                                ;
  FCC1                          s1ret   equ     s3neu
  FCC3                          s3ret   equ     s1ret+2
                                ;
                                ;
                                ;
                                        .dephase
  18C5*                         abios2::
                                ; \---  Ende : aBIOS -----------------------------------------------------------------------------/
                                        page
'a  B I O S'    MACRO-80 3.44   09-Dec-81       PAGE    1-75


                                
                                ;
                                ;
                                ; /---  Ende : aBIOS -----------------------------------------------------------------------------\
  18C5*                         gosys2::
                                        .phase  gosys0
                                        gosys1
  8000    C5              +             push    bc
  8001    E5              +             push    hl
  8002    01 04C0         +             ld      bc,004C0h
  8005    21 800F         +             ld      hl,$+10
  8008    ED B3           +             otir
  800A    E1              +             pop     hl
  800B    C1              +             pop     bc
  800C    C3 0000         +             jp      0
  800F    F0              +             DB      0F0H    ;Startbyte
  8010    03              +             DB      003H    ;wahl
  8011    03              +             DB      003H    ;GoSys1
  8012    FF              +             DB      0FFH    ;Endbyte
                                        .dephase
  18D8*                         gosys3::
                                ; \---  Ende : aBIOS -----------------------------------------------------------------------------/
                                
                                ; ===  Ende : 0000H nach LOAD =====================================================================
                                ;
                                        title   ''
                                                                ;(c) by Marcus Herbote,   N I L E S   wtz
                                
                                        end     start
''      MACRO-80 3.44   09-Dec-81       PAGE    S


Macros:
DIRG            GOSYS           GOSYS1          MBOOTM          OPSMAC          
S1COM           SYSTA           TA              UM              

Symbols:
F400    ABIOS           1384I*  ABIOS1          18C5I*  ABIOS2          
0C00    ABIOSL          F83DI   ALLC1           F863I   ALLC2           
F889I   ALLC3           F8AFI   ALLC4           F8D5I   ALLC5           
F8FBI   ALLC6           F836I   ALLM            A831    ALLOC           
0003    ANZAKB          A7C3I   ARB             0008    ATR             
A91AI   BIOSXX          0022    BLKLOG          A7D2    BLOCK           
9760I   BOOT            973BI   BOOT00          9791    BOOT03          
97A2    BOOT05          9A2F    BOOTME          99CC    BOOTMS          
F500I   BR00            F506I   BR03            F50CI   BR06            
F512I   BR09            F518I   BR0C            F51EI   BR0F            
F524I   BR12            F52AI   BR15            F530I   BR18            
F56FI   BR1B            F582I   BR1E            F587I   BR21            
F58CI   BR24            F591I   BR27            F597    BR270           
F5AC    BR271           F5B1I   BR2A            F5C8I   BR2D            
F5CEI   BR30            A1D9    BSAD1           A1DF    BSAD2           
A1E4    BSAD3           A1F2    BSAD4           A1FC    BSAD5           
A1FF    BSAD6           F92EI   BSADDR          A1D3    BSADR           
3000    BSANF           A211    BSROL           9AEB    C03             
9B0E    C04             9BA5    C06             9BE9    C061            
9BE1    C062            9BF6    C069            9C59    C07             
9AFA    C08             9C59    C09             9C8A    C10             
9C9C    C11             9CAE    C12             9CC0    C13             
9CD2    C14             9CE4    C17             9D95    C170            
9E0A    C171            9E1B    C172            9DCB    C173            
9E01    C174            9D5F    C175            9E3B    C18             
9D5F    C189            A3FEI   CALLHL          9E44    CBIT4           
9E49    CBIT41          9E4E    CBIT42          9E57    CBIT43          
9E65    CBIT44          DE00    CCP             F93AI   CCPPUF          
A610    CEERRE          A5ED    CEERRO          A58E    CENTL           
A5A4    CENTLE          F853I   CHKC1           F879I   CHKC2           
F89FI   CHKC3           F8C5I   CHKC4           F8EBI   CHKC5           
F911I   CHKC6           F83DI   CHKM            A7F6    CHKUNA          
9AA2I   CI              9FB4I   CI.BELL         9F7FI   CI.CH           
9F75I   CI.KALT         9F79I   CI.STA          9F75I   CI.WARM         
9F93    CI1             9F9D    CI2             9FA5    CI3             
9FAD    CI4             9FB2    CI5             9A6DI   CIBER           
A53C    CLAD            A273    CO.BCU          A0CE    CO.BEL          
A0F2    CO.BS           9FF2    CO.C1           A06F    CO.C10          
A08A    CO.C11          A08F    CO.C12          A099    CO.C13          
A09C    CO.C14          A0A9    CO.C15          A0AD    CO.C16          
9FF7    CO.C2           9FF9    CO.C3           A04A    CO.C4           
A050    CO.C5           A059    CO.C6           A060    CO.C7           
A062    CO.C8           A068    CO.C9           9FDCI   CO.CH           
A118    CO.CLE          A0C2    CO.CR           A2A6    CO.DEG          
A0D4    CO.HOM          A0B5    CO.LF           A0C8    CO.NL           
A132    CO.RG           A272    CO.SCP          A0DD    CO.TB           
A125    CO.UP           A0FC    COBS1           A106    COBS2           
A0B9    COLF1           9A8DI   CONIN           9A9C    CONIN0          
9A9C    CONIN1          9A9C    CONIN3          9E6BI   CONOU           
9E7B    CONOU0          9E7B    CONOU1          9E82    CONOU3          
9A58I   CONST           9A67    CONST0          9A67    CONST1          
9A67    CONST3          F934I   CONT            A13B    CORG1           
A12E    COUP1           0023    CPMSPT          9FCB    CPMTAB          
A671    CPOS            A510    CPOSX           000D    CR              
9A3B    CUBDOS          9A39    CUDEV           0044    DATUM           
A7C6    DEBLCK          9C34    DEFA            9C45    DEFA2           
9FCB    DEGEND          9FBA    DEGTAB          A179    DELL            
A190    DELL1           A19C    DELL2           A1A5    DELL3           
F927I   DEV             4026    DINIT           D000    DIR1            
D800    DIR2            E000    DIR3            E800    DIR4            
F000    DIR5            F800    DIR6            A51D    DIRADR          
F941    DIRBF           9870    DIRDEL          9942    DIRG11          
99CC    DIRG12          98EC    DIRGO           9931    DIRGO1          
98F8    DIRS1           9909    DIRS11          9931    DIRS12          
F921I   DMA             F9C1    DMMA            4029    DOUT            
F827I   DPBLKC          F818I   DPBLKM          F7F8I   DPHA            
F788I   DPHAD           F7FAI   DPHB            F7FCI   DPHC            
F798I   DPHC1           F7A8I   DPHC2           F7B8I   DPHC3           
F7C8I   DPHC4           F7D8I   DPHC5           F7E8I   DPHC6           
F7FEI   DPHD            F800I   DPHE            F802I   DPHF            
F804I   DPHG            F806I   DPHH            F808I   DPHI            
F80AI   DPHJ            F80CI   DPHK            F80EI   DPHL            
F810I   DPHM            F812I   DPHN            F814I   DPHO            
F816I   DPHP            0000    DR54            0007    EAADR           
000A    EABM            000D    EADPUF          0F70    EADR            
000F    EADZEI          0005    EAEP            0001    EAFEHL          
0004    EAKOM           0FA0    EALBL           0F80    EALBS           
''      MACRO-80 3.44   09-Dec-81       PAGE    S-1


0009    EALEN           0000    EASTAT          F64BI   EATAB1          
F676I   EATAB2          F6A1I   EATAB3          F6CCI   EATAB4          
F6F7I   EATAB5          F722I   EATAB6          F646I   EATABA          
000C    EAVERL          000B    EAWIED          0010    EAWOVO          
A61B    EDRUC           A618    ENDRUC          A8FEI   ENDUSE          
A141    EOL             A14B    EOL1            A1AC    EOS             
008A    EQ.BCU          00CE    EQ.BSD          00FF    EQ.CAP          
008B    EQ.DEG          0000    EQ.GRA          00FE    EQ.HEX          
0088    EQ.INI          0081    EQ.LE1          0082    EQ.LE2          
008C    EQ.LE3          008C    EQ.LE4          008C    EQ.LE5          
008C    EQ.LE6          00FD    EQ.LR0          00FC    EQ.LW           
0089    EQ.SCP          0087    EQ.SIO          00CD    EQ.SYS          
F92BI   ERFLAG          0004    ERRANZ          A7C2I   ERRCOU          
001B    ESC             A22C    EVTROL          9C09    EXCH            
9C10    EXCH1           9C1E    EXCH2           0000    FALSE           
A75A    FEHL00          A763    FEHL01          A75C    FEHL0A          
A73B    FEHLER          000C    FF              A876    FILHST          
A65A    FILPAR          0C00    GDMA            001D    GELADE          
F5EE    GETPF1          F5F9    GETPF2          A904    GETPUF          
8000    GOSYS0          18C5I*  GOSYS2          18D8I*  GOSYS3          
F936I   HLRET           F533I   HOME            F557    HOME1           
001E    HRD             A4DB    HRDKMB          A431I   HSADR           
0017    HSTACT          0012    HSTBUF          0016    HSTSEC          
0014    HSTTRK          0018    HSTWRT          0020    HWR             
A486    HWRKMB          A1C2    INCAD           A153    INSL            
A16A    INSL1           9A38    IOBYT           9629    IODIS1          
962C    IODIS2          9617I   IODISP          0005    ISBLK           
0004    IXRD            F748I   IXTAB           F768I   IXTAB1          
0002    IXWR            2800    KASBU1          2900    KASBU2          
2A00    KASBU3          2B00    KASBU4          2C00    KASBU5          
2D00    KASBU6          9C69    KM.LE           9C7D    KM.LE1          
9C87    KM.LE2          A796I   KMB             A7A6    KMB01           
A7AF    KMB02           A7B7    KMBEP           4046    KMBINI          
FA41    KMBPUF          4040    KMBROB          4043    KMBRUC          
A8F8I   KMBUSE          000C    KMBVERS         A7BFI   KMWART          
A62E    KONLEN          A638    KONSENT         4030    LBL             
4033    LBS             9638    LDHLDP          A624    LESEN           
000A    LF              9E9FI   LIST            9EAF    LIST0           
9EB6    LIST1           9EBD    LIST2           9EC4    LIST3           
9E8CI   LISTST          9EA3    LISTX           A2EF    LO.CH           
A2D9I   LO.RESET        9B25    LR011           9B4F    LR012           
9B5C    LR014           9B6B    LR016           9B6C    LR017           
9B7E    LRTXT           9E9B    LSST0           9E9B    LSST1           
9E9B    LSST2           9E9B    LSST3           0043    LWA             
9A7E    M001            9A81    M002            9A88    M003            
9AB7    M012            9ABB    M013            9AC3    M014            
9AD2    M015            9AD3    M016            A40B    M04             
A416    M041            9853    M104            A893    MATCH           
0050    MAXS            0018    MAXZ            0000    MINDK           
9DBA    MON1            9DF0    MON2            9D84    MON3            
A86F    NOMATCH         A82B    NOOVF           A1BF    NROLL           
1384I*  OP11            1384I*  OP12            0000    OPSDK           
0000    ORIG            9B78I   P0              0004    PDTA            
0028    PDTR            FFFF    PIPEQ           0030    PKMB            
0038    PKMB2           0058    PKMB3           00A0    PTAST           
A38FI   PU.CH           A3A2    PU.CH1          A3B7    PU.CH2          
A3A1I   PU1.CH          A3B6I   PU2.CH          9F08I   PUNCH           
9F18    PUNCH0          9F1F    PUNCH1          9F26    PUNCH2          
9F2D    PUNCH3          F932I   QESC            0000    QESC0           
0001    QESC1           0002    QESC2           F930I   QRMODE          
F931I   QROLL           F92CI   RDERR           A8EC    RDH01           
A8F4    RDH02           967CI   RDIR            9695    RDIR1           
A4C6    RDK01           A4E5    RDK02           A4EE    RDK03           
A4F1    RDK04           A4B0I   RDKMB           A418I   RDMEM           
A422I   RDMEM0          9EDA    RDST0           9EDA    RDST1           
9EDA    RDST2           9EDA    RDST3           A3E3I   READ            
9EEE    READ0           9EF4    READ1           A3F9    READ15          
A3FB    READ16          9EFC    READ2           9F02    READ3           
9EE2    READE1          9EDFI   READER          A8E1    READHST         
F928I   READOP          9ECE    READS1          9ECBI   READST          
A264    RESCUR          A26F    RESCUR1         96AEI   RESLA           
96BB    RESLA1          96D3I   RESP0           96E0    RESP1           
9600I   RETA            A8BE    RETMOV          9608I   RETU            
9610I   RETURN          A34BI   RI.ATA          A36CI   RI.ATB          
A301I   RI.CH           A321    RI.CH1          A33D    RI.CH2          
A38D    RI.CTCT         A384    RI.SIOT         A313I   RI1.CH          
A32FI   RI2.CH          A7C5I   RICHTU          9653I   RKMB            
F929I   RSFLAG          F586I   RTN             A610    RUCKSP          
A846    RWOP01          A83A    RWOPER          98D9    S1A             
FFFF    S1EQ            FC41    S1NEU           FCC1    S1RET           
0C90    S2NEU           0C90    S2RET           FCC1    S3NEU           
FCC3    S3RET           9600    SBIOS           006AI*  SBIOS1          
''      MACRO-80 3.44   09-Dec-81       PAGE    S-2


1384I*  SBIOS2          6A00    SBIOSL          00C0    SBST            
965AI   SDIR            9676    SDIR1           F925I   SEC             
F92DI   SECHST          0025    SECMSK          0024    SECSHF          
F5D8    SECTR1          F5CEI   SECTRN          F56FI   SELDSK          
9A2F    SERIAL          A242    SETCUR          A25D    SETCUR1         
A261    SETCUR2         F58CI   SETDMA          F55A    SETIX           
969BI   SETLA           96A8    SETLA1          96C1I   SETP0           
96CE    SETP1           F587I   SETSEC          F582I   SETTRK          
9D28    SIOA            9D38    SIOB            9D48    SIOT1           
F81DI   SIZEM           964DI   SKMB            A550    SP21            
A580    SP25            A583    SP26            A5AF    SP301           
A5BF    SP31            A5E0    SP32            A676    SP40            
A68B    SP41            A6A6    SP42            A6B2    SP43            
A6CC    SP44            A6DE    SP45            A6ED    SP451           
A703    SP46            A708    SP47            A71D    SP48            
0041    SPALT           FBC1    SPBER           A1B7    SROLL           
A1B9    SROLL1          F939I   SSCHR           0000    STADK           
0000*   START           0066*   START1          0000    STR             
F938I   SVERZ           9A35    SYSPA           F935I   SYSTE           
9F3BI   TA1             9F44I   TA2             9F66    TA21            
9F65    TA22            9F63    TA23            0009    TAB             
0000    TALT            9F6FI   TBEL            9F69I   TFE             
9F35I   TINIT           9739I   TRAM            0000    TRAMDK          
F923I   TRK             FFFF    TRUE            4003    TTA1            
4006    TTA2            9738I   TTANZ           4015    TTBEL           
400C    TTFE            4000    TTINIT          973AI   TTRK            
F5E2I   UEND            F5E8I   UGETP           F5DCI   UKMB            
F5FEI   UM1             96E5    UM11            970F    UM12            
F602    UM1R1           F606    UM1R2           F60D    UM1R3           
F61D    UM1R4           F621I   UM2             F635    UM21            
F639    UM2E            9611I   UM2EE           F63C    UM2ER           
9F34    UMERK           F933I   UMSCH           0019    UNACNT          
001C    UNASEC          001A    UNATRK          A7C0I   WAS             
97FDI   WBOOT           A8BC    WMOVE           A3DE    WR15            
A3E0    WR16            0001    WRDIR           A3CBI   WRITE           
A8D4    WRITEHST        A479    WRK01           A483    WRK02           
A453I   WRKMB           A402I   WRMEM           A3FFI   WRMEM0          
F92AI   WRTYPE          0002    WRUAL           0040    ZEIL            
9A8B    ZGROS           9A89    ZKLEIN          0000    ZST             



No Fatal error(s)

