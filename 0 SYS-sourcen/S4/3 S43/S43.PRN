12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1


                                ;**********************************************************************
                                ;  B e t r i e b s s y s t e m     D  E  G  2  0  0  0   Version 4.3
                                ;                                  ---------------------------------
                                ;
                                ;  Systemteil:                     DEG2000 - BIOS
                                ;**********************************************************************
                                ;
                                ;----------------------------------------------------------------------
                                ;  Bearbeiter:   Marcus Herbote     K EAW  /  ZFT - wfvm
                                ;  Stand     :   12. August 1985
                                ;----------------------------------------------------------------------
                                ;  Hinweis zur Implementierung auf  Standard - TAP2/TAP3:
                                ;
                                ;     Folgende Routinen aus dem DEG2000-Betriebssystem Version 1.2
                                ;  werden benutzt
                                ;
                                ;  physischer Teil  Kassettenroutine --- EPROM 40, 44, 48
                                ;  physischer Teil  Tastatur routine --- EPROM 6C
                                ;  physischer Teil  Lochband routine --- EPROM 70
                                ;  physischer Teil  Drucker  routine --- EPROM 7C
                                ;----------------------------------------------------------------------
                                ;  Inhalt
                                ;
                                ;  ..  - generierungsangaben
                                ;  ..  - sprungtabelle
                                ;  ..  - interruptadressen und - behandlungen
                                ;  ..  - speicherumschaltungen
                                ;  ..  - status konsole und drucker
                                ;  ..  - konsoleingabe
                                ;  ..  - konsolausgabe
                                ;  ..  - druckerausgabe
                                ;  ..  - lesereingabe
                                ;  ..  - stanzerausgabe
                                ;  ..  - read / write  hilfsroutinen
                                ;  ..  - read / write
                                ;  ..  - read / write  tpa-disk
                                ;  ..  - read / write  kassetten geblockt
                                ;  ..  - kassettenroutinen laden/entladen/positionieren
                                ;  ..  - boot / wboot
                                ;  ..  - kassettenbedienung laden/entladen
                                ;  ..  - hardwarebeschreibungen
                                ;  ..  - e/a tabellen
                                ;  ..  - arbeitszellen
                                ;
                                ;----------------------------------------------------------------------
                                ;
                                	page	86
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-1


                                
                                ;	Laufwerksaufteilung   DEG2000 ---  S Y S 4
                                ;	==============================================
                                ;
                                ;	 A	-	TPA - Disk
                                ;	----------------------------------------------
                                ;	 B	-	Kassettenlaufwerk 1
                                ;	 C	-	Kassettenlaufwerk 2
                                ;
                                ;	*D	-	Kassettenlaufwerk 3
                                ;	*E	-	Kassettenlaufwerk 4
                                ;
                                ;	*F	-	Kassettenlaufwerk 5
                                ;	*G	-	Kassettenlaufwerk 6
                                ;	----------------------------------------------
                                ;	*H	-	Mini     Diskette 1
                                ;	*I	-	Mini     Diskette 2
                                ;	*J	-	Mini     Diskette 3
                                ;	*K	-	Mini     Diskette 4
                                ;	----------------------------------------------
                                ;	*L	-	Standard Diskette 1
                                ;	*M	-	Standard Diskette 2
                                ;	----------------------------------------------
                                ;	*N	-	Zentralstation
                                ;	*O	-	T R A M   - Pseudodisk
                                ;	*P	-	16k - OPS - Pseudodisk
                                
                                ;	*	Besagt, dass entsprechendes Laufwerk
                                ;		bei der Systemgenerierung ein- bzw. ausgeschlossen
                                ;		werden kann.
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-2


                                
                         C      	include	EQ.ASM
                         C      	title	12.August 85     DEG2000-BIOS    Version 4.3
                         C      ;
  0000                   C      false	equ	0
  FFFF                   C      true	equ	not false
                         C      ;
  FFFF                   C      tap	equ	true		; true   ...     T A P 2 / T A P 3
                         C      				; false  ...     mini T A P
                         C      ;
                         C       if not tap
                         C      tap1	equ	false		; false  ...     miniTAP mit TRAM
                         C       endif				; true   ...     miniTAP mit OPS64
                         C      ;
  0000                   C      talt	equ	false		; false  ...	Tastatur 763x
                         C      				; true   ...	Tastatur 760x
  0000                   C      dr54	equ	false		; system ohne drucker 1154
                         C      ;
                         C      ;
  C600                   C      biosan	equ	0c600h
  2200                   C      biosle	equ	02200h		; 8,5 k
  8000                   C      gosys0	equ	08000h
                         C      ;
  3000                   C      bsanf	equ	03000h		; bildschirmadresse
  0018                   C      maxz	equ	24		; zeilenanzahl
  0050                   C      maxs	equ	80		; spaltenanzahl
                         C      ;
                         C      ; tastaturroutine
                         C      ;
  00A0                   C      ptast	equ	0a0h		; basisadresse der ansteuerung
                         C       if tap
  6EF0                   C      ttinit	equ	06ef0h		; basisadresse der grundroutinen
                         C       else
                         C      ttinit	equ	0db00h
                         C       endif
                         C      ;
                         C      ; druckerroutine
                         C      ;
                         C       if tap
  7C06                   C      dinit	equ	07c06h		; initialisierungsroutine
  7C09                   C      dout	equ	07c09h		; zeichenausgaberoutine
  0F70                   C      eadr	equ	00f70h		; e/a-tabelle
                         C       else
                         C      dinit	equ	0dc06h
                         C      dout	equ	0dc74h
                         C      eadr	equ	00d00h
                         C       endif
                         C      ;
                         C      ; lochbandleser
                         C      ;
                         C       if tap
  7000                   C      lbl	equ	07000h		; zeicheneingaberoutine
  0FA0                   C      ealbl	equ	00fa0h		; e/a-tabelle
                         C       endif
                         C      ;
                         C      ; lochbandstanzer
                         C      ;
                         C       if tap
  7003                   C      lbs	equ	07003h		; zeichenausgaberoutine
  0F80                   C      ealbs	equ	00f80h		; e/a-tabelle
                         C       endif
                         C      ;
                         C      ; robotron kassettenroutine
                         C      ;
  000C                   C      kmbvers	equ	12		; kmb bamos version 1.2
  0001                   C      anzakb	equ	1		; ein doppellaufwerk k 5221
  0030                   C      pkmb	equ	30h		; basisadresse akb
                         C       if anzakb gt 1
                         C      pkmb2	equ	38h
                         C       endif
                         C       if anzakb gt 2
                         C      pkmb3	equ	38h
                         C       endif
                         C       if tap
  4000                   C      kmbrob	equ	04000h
                         C       else
                         C      kmbrob	equ	0dd39h		; eintrittsadresse in bamos kmb
                         C       endif
  46AD                   C      kmbruc	equ	kmbrob+6adh	; eintrittsadresse bereitroutine
  4965                   C      kmbini	equ	kmbrob+965h	; eintrittsadresse initialisierung
                         C      ;
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-3


                         C      ; puffer fuer kassettenpufferung
                         C      ;
  F000                   C      dir1	equ	biosan+biosle+800h  ; puffer fuer directory
  F800                   C      dir2	equ	dir1+800h
                         C       if tap
  2800                   C      kasbu1	equ	02800h		; puffer fuer hostblock
                         C       else
                         C      kasbu1	equ	00e00h
                         C       endif
  2900                   C      kasbu2	equ	kasbu1+100h
                         C       if anzakb gt 1
                         C      kasbu3	equ	kasbu2+100h
                         C      kasbu4	equ	kasbu3+100h
                         C       endif
                         C       if anzakb gt 2
                         C      kasbu5	equ	kasbu4+100h
                         C      kasbu6	equ	kasbu5+100h
                         C       endif
                         C      ;
                         C      ; speicherverteilung
                         C      ;
                         C      ;  f800  ;  biosan+3200   dir2              2,0 k
                         C      ;  f000  ;  biosan+2a00   dir1              2,0 k
                         C      ;  e800  ;  biosan+2200   ccp kopie         2,0 k
                         C      ;  c600  ;  biosan        bios              8,5 k
                         C      ;  b800  ;  biosan-0e00   bdos              3,5 k  =  18k
                         C      ;  b000  ;  biosan-1600   ccp               2,0 k
                         C      ;        ;                tpa_disk
                         C      ;   100  ;                tpa
                         C      ;
                         C      mbootm	macro
                         C      	defb	1ah,'51k   S Y S 4 . 3   release 2'
                         C       if tap
                         C      	defb	'   T A P 2 / T A P 3'
                         C       else
                         C        if tap1
                         C      	defb	'   miniTAP/OPS64'
                         C        else
                         C      	defb	'   miniTAP/TRAM'
                         C        endif
                         C       endif
                         C      	defb	cr,lf,'      D E G  2000   vom 12.August 85 ',lf,lf
                         C      	endm
                         C      ;
                         C      ;
  FFFF                   C      pipeq	equ	true		; generierung der datei "A:PIP.SUB"
                         C      ;
                         C       if pipeq
                         C      dirg	macro
                         C      	defb	'$1:pip p:=$1:xsub.com',cr,lf
                         C      	defb	'go p:s.com=$1:submit.com',cr,lf
                         C      	defb	'go p:=$1:kini.com',cr,lf
                         C      	defb	'go p:=$1:power.com',cr,lf
                         C      	defb	'go o:=$1:m80.com',cr,lf
                         C      	defb	'go o:=$1:l80.com',cr,lf
                         C      	defb	'era pip.sub',cr,lf
                         C      	defb	01ah
                         C      	endm
                         C       endif
                         C      ;
                         C      ;
  0000                   C      mindk	equ	false
  0000                   C      stadk	equ	false
  FFFF                   C      zst	equ	true
                         C       if tap
  FFFF                   C      tramdk	equ	true
  FFFF                   C      opsdk	equ	true
                         C       else
                         C      tramdk	equ	false
                         C      opsdk	equ	false
                         C       endif
                         C      ;
  00CD                   C      eq.sys	equ	0cdh		; ruecksprung in DEG2000 Version 1.2
  00CE                   C      eq.bsd	equ	0ceh		; hardcopy
  00FF                   C      eq.cap	equ	0ffh		; PTAS / STAS
  00FE                   C      eq.hex	equ	0feh		; hexadezimale eingabe eines zeichens
  00FD                   C      eq.lr0	equ	0fdh		; druckerreset
  00FC                   C      eq.lw	equ	0fch		; A := neue laufwerksnummer
  0080                   C      eq.gra	equ	080h		; groesse des geraetes A festlegen
  0081                   C      eq.le1	equ	081h		; laden/entladen kassettenlw 1
  0082                   C      eq.le2	equ	082h		; laden/entladen kassettenlw 2
                         C       if anzakb gt 1
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-4


                         C      eq.le3	equ	083h		; laden/entladen kassettenlw 3
                         C      eq.le4	equ	084h		; laden/entladen kassettenlw 4
                         C       endif
                         C       if anzakb gt 2
                         C      eq.le5	equ	085h		; laden/entladen kassettenlw 5
                         C      eq.lr6	equ	086h		; laden/entladen kassettenlw 6
                         C       endif
                         C       if tap
  0088                   C      eq.sio	equ	088h		; initialisieren ATS-SIO-Kanal A bzw. B
                         C       else
                         C      eq.sio	equ	0
                         C       endif
  0089                   C      eq.ini	equ	089h		; initialisieren laufwerk O , P
  008A                   C      eq.bcu	equ	08ah		; monitor BCU
  008B                   C      eq.deg	equ	08bh		; monitor DEG-SYS4
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-5


                                
                                ;
                                ;----------------------------------------------------------------------
                                ;
  000D                          cr	equ	0dh
  000A                          lf	equ	0ah
  000C                          ff	equ	0ch
  0009                          tab	equ	09h
  001B                          esc	equ	1bh
                                ;
                                ;   generierungsangaben
                                ;   -------------------
                                ;
  0040                          zeil	equ	40h		; adresse der zeilennummer
  0041                          spalt	equ	41h		; adresse der spaltennummer
                                ;
                                ; parameter fuer blockung (stehen in den e/a-tabellen)
                                ;
                                ;blklog	equ	8		; anzahl der recorde in einem logischen block
                                ;cpmspt	equ	16		; sector per track
                                ;blksiz	equ	2		; anzahl der recorde in einem hostblock
                                ;				;   (potenz von 2!!!)
                                ;secshf	equ	1		; 2**secshf = blksiz
                                ;secmsk	equ	1		; schneidet secshf bits hinten heraus
                                ;
  0004                          erranz	equ	4		; anzahl der fehlerwiederholungen
                                ;
                                ; parameter fuer tpa-disk
                                ;
  0042                          simsiz	equ	42h		; adresse auf der groesse des tpa-disk steht
  B000                          simad	equ	biosan-1600h	; 1. adr., die nicht zum tpa-disk gehoert
  0000                          simgr	equ	0		; groesse des tpa-disk in kbyte
                                ;
  0043                          lwa	equ	43h		; laufwerksnummer laufwerk A
                                ;
  0044                          datum	equ	44h		; aktuelles Datum tag/monat/jahr
                                ;
                                	.z80
                                ;
  0000'   21 AF00               start::	ld	hl,biosan-01700h	;SYS4- Speicherbereich loeschen
  0003'   11 AF01               	ld	de,biosan-01700h+1
  0006'   01 38FF               	ld	bc,01700h+biosle-1
  0009'   36 00                 	ld	(hl),0
  000B'   ED B0                 	ldir
  000D'   21 00FD'              	ld	hl,anfang		;BIOS - Teil laden 
  0010'   11 C600               	ld	de,biosan
                                 if opsdk
  0013'   01 1ED3               	ld	bc,op12-anfang
                                 else
                                	ld	bc,ende-anfang
                                 endif
  0016'   ED B0                 	ldir
  0018'   21 0031'              	ld	hl,cca1			;CCP  - Umladeroutine laden
  001B'   11 AF00               	ld	de,biosan-01700h
  001E'   01 0014               	ld	bc,cca2-cca1
  0021'   ED B0                 	ldir
  0023'   21 1FD0'              	ld	hl,gosys2		;Sprung zur Version 1.2
  0026'   11 8000               	ld	de,gosys0
  0029'   01 000D               	ld	bc,gosys3-gosys2
  002C'   ED B0                 	ldir
  002E'   C3 8000               	jp	gosys0
                                
  0031'                         cca1::
                                	.phase	biosan-01700h
  AF00    AF00                  	defw	$
  AF02    43 43 50 20           	defb	'CCP '
  AF06    21 B000               	ld	hl,biosan-01600h
  AF09    11 E800               	ld	de,0e800h
  AF0C    01 0800               	ld	bc,00800h
  AF0F    ED B0                 	ldir
  AF11    C3 000B               	jp	11
                                	.dephase
  0045'                         cca2::
                                
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-6


                                
                                	org	start+100h-3
  00FD'                         anfang:
                                ;
                                ;----------------------------------------------------------------------
                                ;
                                	.phase	biosan
                                ;
  C600    C3 DC74               	jp	boot
  C603    C3 DE5C               	jp	wboot
  C606    C3 C755               	jp	const
  C609    C3 C78A               	jp	conin
  C60C    C3 CBC2               	jp	conou
  C60F    C3 CBF6               	jp	list
  C612    C3 CC5F               	jp	punch
  C615    C3 CC36               	jp	reade
  C618    C3 D235               	jp	home
  C61B    C3 D266               	jp	selds
  C61E    C3 D25C               	jp	settr
  C621    C3 D230               	jp	setse
  C624    C3 D261               	jp	setdm
  C627    C3 D2B4               	jp	read
  C62A    C3 D29C               	jp	write
  C62D    C3 CBE3               	jp	lists
  C630    C3 D279               	jp	sectr
                                ;
  C633    C3 C70F               	jp	return
  C636    C3 C70F               	jp	return
  C639    C3 C70F               	jp	return
  C63C    C3 C70F               	jp	return
  C63F    C3 C70F               	jp	return
  C642    C3 C70F               	jp	return
  C645    C3 C70F               	jp	return
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-7


                                
                                ; interrupt sprungtabelle (beginnt auf xx48h)
                                ; -------------------------------------------
                                ;
                         C      	include	IT.ASM	
                         C      ; interrupt fuer DEG2000-BIOS
                         C      ; ---------------------------
                         C      ;
  C648                   C      	defs	0b8h
                         C      ;io:	defw	0,0		; interruptvektoren system ctc
                         C      ;	defw	kmbrob-260h+0b11h
                         C      ;iocia:	defw	icich		; zeicheninterrupt von tastatur
                         C      ;	defw	kmbrob-260h+06cfh
                         C      ;	defw	kmbrob-260h+0773h
                         C      ;	defw	kmbrob-260h+07c2h
                         C      ;	defw	kmbrob-260h+08b8h
                         C      ;	defw	kmbrob-260h+08d3h
                         C      ;	defw	kmbrob-260h+08eeh
                         C      ;
                         C      ;ioria:	defw	irich		; zeicheninterrupt vom leser
                         C      ;iorib:	defw	irist		; statusinterrupt  vom leser
                         C      ;iopua:	defw	ipuch		; zeicheninterrupt vom stanzer
                         C      ;iopub:	defw	ipust		; statusinterrupt  vom stanzer
                         C      ;ioloa:	defw	0		; zeicheninterrupt vom drucker
                         C      ;iolob:	defw	0		; statusinterrupt  vom drucker
                         C      ;
                                ;
                                ;----------------------------------------------------------------------
                                ;
                                ; stackrettung
                                ; ------------
                                ;	biosan+100h
                                ;
  C700    E3                    reta::	ex	(sp),hl
  C701    D5                    	push	de
  C702    C5                    	push	bc
  C703    DD E5                 	push	ix
  C705    FD E5                 	push	iy
  C707    E9                    	jp	(hl)
                                ;
  C708    FD E1                 retu::	pop	iy
  C70A    DD E1                 	pop	ix
  C70C    C1                    	pop	bc
  C70D    D1                    	pop	de
  C70E    E1                    	pop	hl
  C70F    C9                    return::ret
                                
                                ; Sprungverteiler-Routine
                                ; -----------------------
                                ;
  C710                          iodisp::
  C710    E1                    	pop	hl
  C711    C5                    	push	bc
  C712    D5                    	push	de
  C713    7E                    	ld	a,(hl)
  C714    23                    	inc	hl
  C715    47                    	ld	b,a
  C716    B7                    	or	a
  C717    3A 0003               	ld	a,(3)
  C71A    28 03                 	jr	z,iodis2
  C71C                          iodis1::
  C71C    1F                    	rra
  C71D    10 FD                 	djnz	iodis1
  C71F                          iodis2::
  C71F    E6 03                 	and	3
  C721    17                    	rla
  C722    4F                    	ld	c,a
  C723    09                    	add	hl,bc
  C724    5E                    	ld	e,(hl)
  C725    23                    	inc	hl
  C726    56                    	ld	d,(hl)
  C727    EB                    	ex	de,hl
  C728    D1                    	pop	de
  C729    C1                    	pop	bc
  C72A    E9                    	jp	(hl)
                                ;
                                ; dph-adresse laden
                                ; -----------------
                                ;
  C72B    21 E066               ldhldp:	ld	hl,dpha
  C72E    3A 0043               	ld	a,(lwa)
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-8


  C731    BB                    	cp	e
  C732    C8                    	ret	z
  C733    7B                    	ld	a,e
  C734    87                    	add	a,a
  C735    16 00                 	ld	d,0
  C737    5F                    	ld	e,a
  C738    19                    	add	hl,de
  C739    C9                    	ret
                                ;
                         C      	include	UM.ASM
                         C      ; speicherumschaltungen fuer DEG2000-BIOS     12.08.85
                         C      ; ----------------------------------------------------
                         C       if tap
  C73A                   C      ures12::
  C73A    F5             C      	push	af
  C73B    D3 C4          C      	out	(0c4h),a	; RESET-Sperre aus
  C73D    3E A7          C      	ld	a,10100111b
  C73F    D3 C0          C      	out	(0c0h),a
  C741    3E 84          C      	ld	a,10000100b
  C743    D3 C1          C      	out	(0c1h),a
  C745    D3 C3          C      	out	(0c3h),a	; RESET-Sperre ein
  C747    F1             C      	pop	af
  C748    C9             C      	ret
  C749                   C      uset12::
  C749    F5             C      	push	af
  C74A    D3 C4          C      	out	(0c4h),a	; RESET-Sperre aus
  C74C    AF             C      	xor	a
  C74D    D3 C1          C      	out	(0c1h),a
  C74F    D3 C0          C      	out	(0c0h),a
  C751    D3 C3          C      	out	(0c3h),a	; RESET-Sperre ein
  C753    F1             C      	pop	af
  C754    C9             C      	ret
                         C       else
                         C        if tap1
                         C        else
                         C      ures12::
                         C      	push	af
                         C      	push	bc
                         C      	push	de
                         C      	ld	bc,28h
                         C      	ld	e,4
                         C      	call	up23
                         C      ures13:
                         C      	pop	de
                         C      	pop	bc
                         C      	pop	af
                         C      	ret
                         C      uset12::
                         C      	push	af
                         C      	push	bc
                         C      	push	de
                         C      	ld	bc,28h
                         C      	ld	e,4
                         C      	call	up33
                         C      	jr	ures13
                         C      
                         C      up23:	xor	a
                         C      	call	up39
                         C      	jr	nz,up23
                         C      	ret
                         C      up33:	ld	a,00ch
                         C      	call	up39
                         C      	jr	nz,up33
                         C      	ret
                         C      
                         C      up39:	out	(c),a
                         C      	ld	a,b
                         C      	add	a,10h
                         C      	ld	b,a
                         C      	dec	e
                         C      	ret
                         C        endif
                         C       endif
                         C      ;
                         C      ; umschaltmacros
                         C      ; --------------
                         C      ;
                         C      set12	macro
                         C      	ld	(stkret),sp
                         C      	ld	sp,stk12
                         C      	call	uset12
                         C      	endm
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-9


                         C      ;
                         C      res12	macro
                         C      	call	ures12
                         C      	ld	sp,(stkret)
                         C      	endm
                         C      ;
                         C      ;
                         C      ;
                         C       if tap
                         C      setkmb	macro
                         C      	set12
                         C      	push	af
                         C      	xor	a
                         C      	ld	i,a
                         C      	pop	af
                         C      	endm
                         C      ;
                         C      reskmb	macro
                         C      	push	af
                         C      	ld	a,high biosan
                         C      	ld	i,a
                         C      	pop	af
                         C      	res12
                         C      	endm
                         C       else
                         C      setkmb	macro
                         C      	set12
                         C      	endm
                         C      ;
                         C      reskmb	macro
                         C      	res12
                         C      	endm
                         C       endif
                         C      ;
                         C      ;
                         C      ;
                         C      gosys	macro
                         C      	set12
                         C      	jp	0
                         C      	endm
                         C       if tap
                         C      gosys1	macro
                         C      	gosys
                         C      	endm
                         C       else
                         C        if tap1
                         C      gosys1	macro
                         C      	endm
                         C        else
                         C      gosys1	macro
                         C      	out	(0c4h),a
                         C      	xor	a
                         C      	out	(0c1h),a
                         C      	out	(0c0h),a
                         C      	out	(0c3h),a
                         C      	jp	0
                         C      	endm
                         C        endif
                         C       endif
                         C      ;
                         C      ;
                         C      ;
                         C      ccpcop	macro
                         C      	ld	hl,biosan+biosle
                         C      	ld	de,biosan-1600h
                         C      	ld	bc,800h
                         C      	ldir
                         C      	ld	hl,serial
                         C      	ld	bc,6
                         C      	ldir
                         C      	jr	ccpcp1
                         C      serial::defb	0,16h,0,0,0,0a5h
                         C      ccpcp1::
                         C      	endm
                         C      ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-10


                                
                                ; consol-status
                                ; -------------
                                ;
  C755    CD C700               const::	call	reta		; iobyte  00 00 00 xx
  C758    CD C710               	call	iodisp		;    0, 1, 3  crt:
  C75B    00                    	defb	0		;    2        bat:
  C75C    C764                  	defw	const0
  C75E    C764                  	defw	const1
  C760    CC25                  	defw	reads1
  C762    C764                  	defw	const3
                                
  C764                          const0::
  C764                          const1::
  C764                          const3::
  C764    CD C76A               	call	ciber
  C767    C3 C708               	jp	retu
                                
                                
  C76A                          ciber::				; liefert a = ff wenn taste gedrueckt ist
  C76A    CD CD1D               	call	ci.sta		; liefert zero cond. wenn taste gedrueckt ist
  C76D    20 0F                 	jr	nz,m002
  C76F    3A E09B               	ld	a,(sverz)	; es ist eine taste gedruckt, jedoch
  C772    B7                    	or	a		; beim schnellschreiben verzoegern
  C773    28 06                 	jr	z,m001		;   -> kein schnellschreiben
  C775    3D                    	dec	a
  C776    32 E09B               	ld	(sverz),a
  C779    AF                    	xor	a		; keine taste gedrueckt
  C77A    C9                    	ret
                                ;
  C77B    AF                    m001::	xor	a		; es ist eine taste gedrueckt
  C77C    3D                    	dec	a
  C77D    C9                    	ret
                                ;
  C77E    AF                    m002::	xor	a		; es ist keine taste gedrueckt
  C77F    32 E09B               	ld	(sverz),a	; kein weiteres verzoegern
  C782    32 E09C               	ld	(sschr),a	; kein weiteres schnellschreiben
  C785    C9                    m003::	ret
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-11


                                
                                ; consol eingabe
                                ; --------------
                                ;
                                 if talt
                                zklein::defw	100h
                                zgros::	defw	800h
                                 else
  C786    0200                  zklein::defw	200h		; wartezeit fuer schnellschreiben
  C788    2000                  zgros::	defw	2000h
                                 endif
                                ;
  C78A                          conin::				; iobyte:  00 00 00 xx
  C78A    CD C700               	call	reta		;   0, 1, 3  crt:
  C78D    CD C710               	call	iodisp		;   2        bat:
  C790    00                    	defb	0
  C791    C799                  	defw	conin0
  C793    C799                  	defw	conin1
  C795    CC39                  	defw	reade1
  C797    C799                  	defw	conin3
                                ;
  C799                          conin0::
  C799                          conin1::
  C799                          conin3::
  C799    CD C79F               	call	ci
  C79C    C3 C708               	jp	retu
                                
  C79F                          ci:
  C79F    AF                    	xor	a
  C7A0    32 E09B               	ld	(sverz),a	; damit ciber nicht verzoegert
  C7A3    CD C76A               	call	ciber
  C7A6    28 0C                 	jr	z,m012		; -> taste nicht gedrueckt
  C7A8    3A E09C               	ld	a,(sschr)
  C7AB    B7                    	or	a
  C7AC    28 06                 	jr	z,m012
  C7AE    ED 5B C786            	ld	de,(zklein)
  C7B2    18 04                 	jr	m013
  C7B4    ED 5B C788            m012::	ld	de,(zgros)
  C7B8    CD C76A               m013::	call	ciber		; warten bis taste gedrueckt ist
  C7BB    28 FB                 	jr	z,m013
  C7BD    CD CD23               	call	ci.ch		; zeichen uebernehmen
                                ;
  C7C0    CD C76A               m014::	call	ciber
  C7C3    28 0A                 	jr	z,m015		; -> taste wurde losgelassen
  C7C5    1D                    	dec	e
  C7C6    20 F8                 	jr	nz,m014
  C7C8    15                    	dec	d
  C7C9    20 F5                 	jr	nz,m014
                                ;
  C7CB    3E FF                 	ld	a,0ffh		; es beginnt schnellschreiben
  C7CD    18 01                 	jr	m016
  C7CF    AF                    m015::	xor	a		; kein schnellschreiben
  C7D0    32 E09C               m016::	ld	(sschr),a
  C7D3    32 E09B               	ld	(sverz),a
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-12


                                
                                ;
                                ; bearbeitung der sondertasten
                                ;
                                ;   1. eq.sys   zurueck ins urbetriebssystem (falls vorhanden)
                                ;   2. eq.hex   hexadezimale eingabe eines zeichens
                                ;   3. eq.lr0   druckerreset
                                ;   4. eq.lw    laufwerk A auf anderes phys. definieren
                                ;   5. eq.cap   buchstaben gross/kleinschaltung aendern
                                ;   6. eq.gra   groesse des geraetes a festlegen
                                ;   7. eq.le1   laden/entladen geraet 1
                                ;   8. eq.le2           "             2
                                ;   9. eq.le3           "             3
                                ;      ...
                                ;  14. eq.sio	leser-/stanzer-Kanal auf ATS-Kanal A bzw. B schalten
                                ;  15. eq.ini	init. laufwerk O , P
                                ;  16. eq.bcu	monitorsteuerung BCU
                                ;  17. eq.deg	monitorsteuerung DEG
                                ;  18. eq.bsd   bildschirm drucken
                                ;
  C7D6    78                    	ld	a,b
                                ;
                                 if eq.sys ne 0
  C7D7    FE CD                 	cp	eq.sys		; S Y S ?
  C7D9    20 15                 	jr	nz,c03		; -------
  C7DB    3A E09A               	ld	a,(pf10er)	; zurueck ins urbetriebssystem
  C7DE    3D                    	dec	a
  C7DF    3E 20                 	ld	a,20h
  C7E1    20 0D                 	jr	nz,c03
                                	gosys
  C7E3    ED 73 E306      +     	ld	(stkret),sp
  C7E7    31 E304         +     	ld	sp,stk12
  C7EA    CD C749         +     	call	uset12
  C7ED    C3 0000         +     	jp	0
                                 endif
                                ;
  C7F0                          c03::
                                 if eq.hex ne 0
  C7F0    FE FE                 	cp	eq.hex		; E 1 ?
  C7F2    20 10                 	jr	nz,c04		; -----
  C7F4    CD CB9B               	call	cbit4		; hexaeingabe eines zeichens
  C7F7    B7                    	or	a
  C7F8    17                    	rla
  C7F9    17                    	rla
  C7FA    17                    	rla
  C7FB    17                    	rla
  C7FC    4F                    	ld	c,a
  C7FD    CD CB9B               	call	cbit4
  C800    81                    	add	a,c
  C801    C3 CB92               	jp	c18
                                 endif
                                ;
  C804                          c04::
                                 if eq.lr0 ne 0
  C804    FE FD                 	cp	eq.lr0		; E 2 ?
  C806    C2 C8A4               	jp	nz,c06		; -----
  C809    3A E09A               	ld	a,(pf10er)
  C80C    3D                    	dec	a
  C80D    3E 20                 	ld	a,' '
  C80F    C2 CB92               	jp	nz,c18		; --> nicht erlaubt
  C812    31 E2C4               	ld	sp,spber1
  C815    11 C87D               lr011:	ld	de,lrtxt
  C818    0E 09                 	ld	c,9
  C81A    CD 0005               	call	5
  C81D    11 E09D               	ld	de,ccppuf
  C820    0E 0A                 	ld	c,10
  C822    CD 0005               	call	5
  C825    3A E09E               	ld	a,(ccppuf+1)	; laenge der eingabe
  C828    FE 03                 	cp	3
  C82A    20 E9                 	jr	nz,lr011
  C82C    3A E09F               	ld	a,(ccppuf+2)
  C82F    DD 21 0F73            	ld	ix,eadr+3
  C833    06 00                 	ld	b,0
  C835    FE 30                 	cp	'0'
  C837    28 08                 	jr	z,lr012
  C839    FE 32                 	cp	'2'
  C83B    20 04                 	jr	nz,lr013
  C83D    CB C0                 	set	0,b
  C83F    18 00                 	jr	lr013
  C841                          lr012:
  C841    3A E0A0               lr013:	ld	a,(ccppuf+3)
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-13


  C844    FE 36                 	cp	'6'
  C846    28 08                 	jr	z,lr014
  C848    FE 38                 	cp	'8'
  C84A    20 04                 	jr	nz,lr015
  C84C    CB C8                 	set	1,b
  C84E    18 00                 	jr	lr015
  C850                          lr014:
  C850    3A E0A1               lr015:	ld	a,(ccppuf+4)
  C853    FE 4F                 	cp	'O'
  C855    28 08                 	jr	z,lr016
  C857    FE 4D                 	cp	'M'
  C859    20 04                 	jr	nz,lr016
  C85B    3E FF                 	ld	a,-1
  C85D    18 01                 	jr	lr017
  C85F    AF                    lr016:	xor	a
  C860                          lr017:	set12
  C860    ED 73 E306      +     	ld	(stkret),sp
  C864    31 E304         +     	ld	sp,stk12
  C867    CD C749         +     	call	uset12
  C86A    DD 70 04              	ld	(ix+4),b
  C86D    DD 77 0C              	ld	(ix+12),a
                                	res12
  C870    CD C73A         +     	call	ures12
  C873    ED 7B E306      +     	ld	sp,(stkret)
  C877    CD D0FC               	call	lo.reset	; druckerreset
  C87A    C3 0000               	jp	0
  C87D    0D 0A 44 72           lrtxt::	defb	cr,lf,'Drucker - Parameter { 0|2 6|8 O|M } $'
  C881    75 63 6B 65           
  C885    72 20 2D 20           
  C889    50 61 72 61           
  C88D    6D 65 74 65           
  C891    72 20 7B 20           
  C895    30 7C 32 20           
  C899    36 7C 38 20           
  C89D    4F 7C 4D 20           
  C8A1    7D 20 24              
                                 endif
                                ;
  C8A4                          c06::
                                 if eq.lw ne 0
  C8A4    FE FC                 	cp	eq.lw		; E 3 ?
  C8A6    C2 C952               	jp	nz,c07		; -----
  C8A9    3A E09A               	ld	a,(pf10er)
  C8AC    3D                    	dec	a
  C8AD    3E 20                 	ld	a,' '
  C8AF    C2 CB92               	jp	nz,c18		; --> nicht erlaubt
  C8B2    31 E2C4               	ld	sp,spber1
  C8B5    11 C92D               	ld	de,defa		; laufwerk A := neue laufwerksnummer
  C8B8    0E 09                 	ld	c,9
  C8BA    CD 0005               	call	5		; eingabe anfordern
  C8BD    11 E09D               	ld	de,ccppuf
  C8C0    0E 0A                 	ld	c,10
  C8C2    CD 0005               	call	5		; eingabe
  C8C5    3A E09E               	ld	a,(ccppuf+1)	; laenge der eingabe
  C8C8    B7                    	or	a
  C8C9    28 24                 	jr	z,c069
  C8CB    3A E09F               	ld	a,(ccppuf+2)	; laufwerksangabe
  C8CE    FE 71                 	cp	'q'
  C8D0    30 1D                 	jr	nc,c069
  C8D2    FE 61                 	cp	'a'
  C8D4    38 04                 	jr	c,c062
  C8D6    D6 20                 	sub	20h
  C8D8    18 08                 	jr	c061
  C8DA    FE 51                 c062::	cp	'Q'
  C8DC    30 11                 	jr	nc,c069
  C8DE    FE 41                 	cp	'A'
  C8E0    38 0D                 	jr	c,c069
  C8E2    D6 41                 c061::	sub	41h
  C8E4    F5                    	push	af
  C8E5    CD C917               	call	exch2
  C8E8    F1                    	pop	af
  C8E9    32 0043               	ld	(lwa),a
  C8EC    CD C917               	call	exch2
  C8EF    3A 0043               c069::	ld	a,(lwa)
  C8F2    C6 41                 	add	a,41h
  C8F4    32 C94A               	ld	(defa2+12),a
  C8F7    11 C93E               	ld	de,defa2
  C8FA    0E 09                 	ld	c,9
  C8FC    CD 0005               	call	5
  C8FF    C3 0000               	jp	0
  C902    7E                    exch:	ld	a,(hl)
  C903    EB                    	ex	de,hl
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-14


  C904    46                    	ld	b,(hl)
  C905    77                    	ld	(hl),a
  C906    EB                    	ex	de,hl
  C907    70                    	ld	(hl),b
  C908    C9                    	ret
  C909    E5                    exch1:	push	hl
  C90A    D1                    	pop	de
  C90B    09                    	add	hl,bc
  C90C    CD C902               	call	exch
  C90F    23                    	inc	hl
  C910    13                    	inc	de
  C911    CD C902               	call	exch
  C914    06 00                 	ld	b,0
  C916    C9                    	ret
  C917    3A 0043               exch2:	ld	a,(lwa)
  C91A    B7                    	or	a
  C91B    C8                    	ret	z
  C91C    87                    	add	a,a
  C91D    06 00                 	ld	b,0
  C91F    4F                    	ld	c,a
  C920    21 DFC6               	ld	hl,ixtab
  C923    CD C909               	call	exch1
  C926    21 E066               	ld	hl,dpha
  C929    CD C909               	call	exch1
  C92C    C9                    	ret
  C92D    0D 0A 4C 61           defa::	defb	cr,lf,'Laufwerk A := $'
  C931    75 66 77 65           
  C935    72 6B 20 41           
  C939    20 3A 3D 20           
  C93D    24                    
  C93E    0D 0A 0A 4C           defa2::	defb	cr,lf,lf,'Laufwerk . <=> A$'
  C942    61 75 66 77           
  C946    65 72 6B 20           
  C94A    2E 20 3C 3D           
  C94E    3E 20 41 24           
                                 endif
                                ;
  C952                          c07::
                                 if eq.cap ne 0
  C952    FE FF                 	cp	eq.cap		; E 0 ?
  C954    20 0B                 	jr	nz,c08		; -----
  C956    3A E098               	ld	a,(umsch)	; standard shiftposition aendern
  C959    EE 20                 	xor	20h
  C95B    32 E098               	ld	(umsch),a
  C95E    C3 C79F               	jp	ci
                                 endif
                                ;
  C961                          c08::
                                 if eq.gra ne 0
  C961    FE 80                 	cp	eq.gra		; pf1?
  C963    C2 C9CD               	jp	nz,c09		; ----
  C966    3A E09A               	ld	a,(pf10er)	; tpa - diskgroesse setzen
  C969    3D                    	dec	a
  C96A    3E 20                 	ld	a,' '
  C96C    C2 CB92               	jp	nz,c18		; -> nicht erlaubt
  C96F    31 E2C4               	ld	sp,spber1
  C972    11 C9B8               	ld	de,setams
  C975    0E 09                 	ld	c,9
  C977    CD 0005               	call	5
  C97A    11 E09D               	ld	de,ccppuf
  C97D    0E 0A                 	ld	c,10
  C97F    CD 0005               	call	5
  C982    3A E09E               	ld	a,(ccppuf+1)	; laenge der eingabe
  C985    B7                    	or	a
  C986    CA 0000               	jp	z,0		; keine eingabe = simsiz bleibt unveraendert
  C989    47                    	ld	b,a
  C98A    AF                    	xor	a
  C98B    32 0042               	ld	(simsiz),a
  C98E    21 E09F               	ld	hl,ccppuf+2
  C991    3A 0042               c081::	ld	a,(simsiz)
  C994    87                    	add	a,a
  C995    4F                    	ld	c,a
  C996    87                    	add	a,a
  C997    87                    	add	a,a
  C998    81                    	add	a,c
  C999    86                    	add	a,(hl)
  C99A    D6 30                 	sub	'0'
  C99C    32 0042               	ld	(simsiz),a	; siz := siz*10 + ziffer - ord('0')
  C99F    23                    	inc	hl
  C9A0    10 EF                 	djnz	c081
  C9A2    FE 2B                 	cp	(biosan-1800h) shr 10
  C9A4    38 04                 	jr	c,c082
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-15


  C9A6    AF                    	xor	a
  C9A7    32 0042               	ld	(simsiz),a	; a war zu gross
  C9AA    FE 03                 c082::	cp	3
  C9AC    30 04                 	jr	nc,c083
  C9AE    AF                    	xor	a
  C9AF    32 0042               	ld	(simsiz),a	; simsiz < 3 ist nicht erlaubt
  C9B2    CD DC93               c083::	call	dirdel
  C9B5    C3 0000               	jp	0
  C9B8    0D 0A 47 72           setams::defb	cr,lf,'Groesse TPA-Disk: $'
  C9BC    6F 65 73 73           
  C9C0    65 20 54 50           
  C9C4    41 2D 44 69           
  C9C8    73 6B 3A 20           
  C9CC    24                    
                                 endif
                                ;
  C9CD    FE 81                 c09::	cp	eq.le1		; pf2?
  C9CF    20 2D                 	jr	nz,c10		; ----
  C9D1    DD 21 DF66            	ld	ix,eatab1	; kassettenlaufwerk 1
  C9D5    1E 01                 	ld	e,1
  C9D7    CD C72B               	call	ldhldp
  C9DA    11 E016               	ld	de,dphc1
                                ;
  C9DD    E5                    km.le::	push	hl		; kassette laden/entladen
  C9DE    D5                    	push	de
  C9DF    DD 7E 1D              	ld	a,(ix+gelade)
  C9E2    B7                    	or	a
  C9E3    20 0C                 	jr	nz,km.le1	; -> entladen
  C9E5    CD D42A               	call	clad		; laden
  C9E8    D1                    	pop	de
  C9E9    E1                    	pop	hl
  C9EA    20 0F                 	jr	nz,km.le2	; -> fehler beim laden
  C9EC    73                    	ld	(hl),e		; geraet als geladen in dph-tabelle eintragen
  C9ED    23                    	inc	hl
  C9EE    72                    	ld	(hl),d
  C9EF    18 0A                 	jr	km.le2
                                ;
  C9F1    CD D487               km.le1::call	centl		; b entladen
  C9F4    D1                    	pop	de
  C9F5    E1                    	pop	hl
  C9F6    36 00                 	ld	(hl),0		; geraet aus dph-tabelle streichen
  C9F8    23                    	inc	hl
  C9F9    36 00                 	ld	(hl),0
  C9FB    C3 C79F               km.le2::jp	ci
                                ;
  C9FE    FE 82                 c10::	cp	eq.le2		; pf3?
  CA00    20 0E                 	jr	nz,c11		; ----
  CA02    DD 21 DF91            	ld	ix,eatab2	; kassettenlaufwerk 2
  CA06    1E 02                 	ld	e,2
  CA08    CD C72B               	call	ldhldp
  CA0B    11 E026               	ld	de,dphc2
  CA0E    18 CD                 	jr	km.le
                                ;
  CA10                          c11::
                                 if anzakb gt 1
                                	cp	eq.le3		; pf4?
                                	jr	nz,c12		; ----
                                	ld	ix,eatab3	; kassettenlaufwerk 3
                                	ld	e,3
                                	call	ldhldp
                                	ld	de,dphc3
                                	jr	km.le
                                ;
                                c12::	cp	eq.le4		; pf5?
                                	jr	nz,c13		; ----
                                	ld	ix,eatab4	; kassettenlaufwerk 4
                                	ld	e,4
                                	call	ldhldp
                                	ld	de,dphc4
                                	jr	km.le
                                 endif
                                ;
  CA10                          c13::
                                 if anzakb gt 2
                                	cp	eq.le5		; pf6?
                                	jr	nz,c14		; ----
                                	ld	ix,eatab5	; kassettenlaufwerk 5
                                	ld	e,5
                                	call	ldhldp
                                	ld	de,dphc5
                                	jr	km.le
                                ;
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-16


                                c14::	cp	eq.le6		; pf7?
                                	jr	nz,c17		; ----
                                	ld	ix,eatab6	; kassettenlaufwerk 6
                                	ld	e,6
                                	call	ldhldp
                                	ld	de,dphc6
                                	jr	km.le
                                 endif
                                ;
  CA10                          c17::
                                 if eq.sio ne 0
  CA10    FE 88                 	cp	eq.sio		; pf9?
  CA12    C2 CA85               	jp	nz,c189		; ----
  CA15    3A E09A               	ld	a,(pf10er)	; init. ATS-Kanal A bzw. B
  CA18    3D                    	dec	a
  CA19    3E 20                 	ld	a,' '
  CA1B    C2 CB92               	jp	nz,c18		; --> nicht erlaubt
  CA1E    31 E2C4               	ld	sp,spber1
  CA21    11 CA6E               	ld	de,siot1
  CA24    0E 09                 	ld	c,9
  CA26    CD 0005               	call	5
  CA29    11 E09D               	ld	de,ccppuf
  CA2C    0E 0A                 	ld	c,10
  CA2E    CD 0005               	call	5
  CA31    3A E09E               	ld	a,(ccppuf+1)
  CA34    B7                    	or	a
  CA35    CA 0000               	jp	z,0
  CA38    3A E09F               	ld	a,(ccppuf+2)
  CA3B    FE 61                 	cp	'a'
  CA3D    28 0F                 	jr	z,sioa
  CA3F    FE 41                 	cp	'A'
  CA41    28 0B                 	jr	z,sioa
  CA43    FE 62                 	cp	'b'
  CA45    28 17                 	jr	z,siob
  CA47    FE 42                 	cp	'B'
  CA49    28 13                 	jr	z,siob
  CA4B    C3 0000               	jp	0
  CA4E    CD D1A5               sioa:	call	ri.ata
  CA51    3A 0003               	ld	a,(3)
  CA54    E6 C3                 	and	11000011b
  CA56    F6 28                 	or	00101000b
  CA58    32 0003               	ld	(3),a
  CA5B    C3 0000               	jp	0
  CA5E    CD D1C6               siob:	call	ri.atb
  CA61    3A 0003               	ld	a,(3)
  CA64    E6 C3                 	and	11000011b
  CA66    F6 3C                 	or	00111100b
  CA68    32 0003               	ld	(3),a
  CA6B    C3 0000               	jp	0
  CA6E    0D 0A 41 54           siot1:	defb	cr,lf,'ATS-Kanal { A|B } : $'
  CA72    53 2D 4B 61           
  CA76    6E 61 6C 20           
  CA7A    7B 20 41 7C           
  CA7E    42 20 7D 20           
  CA82    3A 20 24              
                                 endif
                                ;
  CA85                          c189:
                                 if eq.ini ne 0   and   ( tramdk or opsdk )
  CA85    FE 89                 	cp	eq.ini		; pf10?
  CA87    20 60                 	jr	nz,c170		; -----
  CA89    3A E09A               	ld	a,(pf10er)	; init. laufwerk O , P
  CA8C    3D                    	dec	a
  CA8D    3E 20                 	ld	a,' '
  CA8F    C2 CB92               	jp	nz,c18		; --> nicht erlaubt
  CA92    31 E2C4               	ld	sp,spber1
  CA95    11 CACE               	ld	de,int1		
  CA98    0E 09                 	ld	c,9
  CA9A    CD 0005               	call	5
  CA9D    11 E09D               	ld	de,ccppuf
  CAA0    0E 0A                 	ld	c,10
  CAA2    CD 0005               	call	5		; eingabe des laufwerkes
  CAA5    3A E09E               	ld	a,(ccppuf+1)
  CAA8    B7                    	or	a
  CAA9    CA 0000               	jp	z,0
  CAAC    3A E09F               	ld	a,(ccppuf+2)	; laufwerksangabe
  CAAF    FE 6F                 	cp	'o'
  CAB1    28 0F                 	jr	z,ino1
  CAB3    FE 4F                 	cp	'O'
  CAB5    28 0B                 	jr	z,ino1
  CAB7    FE 70                 	cp	'p'
  CAB9    28 0D                 	jr	z,inp2
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-17


  CABB    FE 50                 	cp	'P'
  CABD    28 09                 	jr	z,inp2
  CABF    C3 0000               	jp	0
                                
  CAC2                          ino1:
                                 if tramdk
  CAC2    CD D9BB               	call	md.ino
                                 endif
  CAC5    C3 0000               	jp	0
  CAC8                          inp2:
                                 if opsdk
  CAC8    CD DAF6               	call	md.inp
                                 endif
  CACB    C3 0000               	jp	0
                                
  CACE    0D 0A 49 6E           int1:	db	cr,lf,'Init Laufwerk { O|P } : $'
  CAD2    69 74 20 4C           
  CAD6    61 75 66 77           
  CADA    65 72 6B 20           
  CADE    7B 20 4F 7C           
  CAE2    50 20 7D 20           
  CAE6    3A 20 24              
                                 endif
                                ;
  CAE9                          c170::
                                 if eq.bcu ne 0
  CAE9    FE 8A                 	cp	eq.bcu		; pf11?
  CAEB    20 2B                 	jr	nz,c173		; -----
  CAED    3A E09A               	ld	a,(pf10er)	; monitor BCU
  CAF0    3D                    	dec	a
  CAF1    3E 20                 	ld	a,' '
  CAF3    C2 CB92               	jp	nz,c18		; -> nicht erlaubt
  CAF6    31 E2C4               	ld	sp,spber1
  CAF9    CD D096               	call	co.bcu
  CAFC    11 CB07               	ld	de,mon1
  CAFF    0E 09                 	ld	c,9
  CB01    CD 0005               	call	5
  CB04    C3 0000               	jp	0
  CB07    0D 0A 6D 6F           mon1:	db	cr,lf,'monitor  B C U$'
  CB0B    6E 69 74 6F           
  CB0F    72 20 20 42           
  CB13    20 43 20 55           
  CB17    24                    
                                 endif
                                ;
  CB18                          c173::
                                 if eq.deg ne 0
  CB18    FE 8B                 	cp	eq.deg		; pf12?
  CB1A    20 2B                 	jr	nz,c174		; -----
  CB1C    3A E09A               	ld	a,(pf10er)	; monitor DEG
  CB1F    3D                    	dec	a
  CB20    3E 20                 	ld	a,' '
  CB22    C2 CB92               	jp	nz,c18		; -> nicht erlaubt
  CB25    31 E2C4               	ld	sp,spber1
  CB28    CD D0C9               	call	co.deg
  CB2B    11 CB36               	ld	de,mon2
  CB2E    0E 09                 	ld	c,9
  CB30    CD 0005               	call	5
  CB33    C3 0000               	jp	0
  CB36    0D 0A 6D 6F           mon2:	db	cr,lf,'monitor  D E G$'
  CB3A    6E 69 74 6F           
  CB3E    72 20 20 44           
  CB42    20 45 20 47           
  CB46    24                    
                                 endif
                                ;
  CB47                          c174::
                                 if eq.bsd ne 0
  CB47    FE CE                 	cp	eq.bsd		; H C P ?
  CB49    20 47                 	jr	nz,c18		; -------
  CB4B    06 18                 	ld	b,maxz		; bildschirminhalt ausdrucken
  CB4D    21 3000               	ld	hl,bsanf
  CB50    C5                    c171::	push	bc
  CB51    E5                    	push	hl
  CB52    3E 0A                 	ld	a,lf
  CB54    4F                    	ld	c,a
  CB55    CD D128               	call	lo.ch
  CB58    3E 0D                 	ld	a,cr
  CB5A    4F                    	ld	c,a
  CB5B    CD D128               	call	lo.ch
  CB5E    E1                    	pop	hl
  CB5F    06 50                 	ld	b,maxs
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-18


  CB61    C5                    c172::	push	bc
                                	set12
  CB62    ED 73 E306      +     	ld	(stkret),sp
  CB66    31 E304         +     	ld	sp,stk12
  CB69    CD C749         +     	call	uset12
  CB6C    7E                    	ld	a,(hl)
                                	res12
  CB6D    CD C73A         +     	call	ures12
  CB70    ED 7B E306      +     	ld	sp,(stkret)
  CB74    23                    	inc	hl
  CB75    E5                    	push	hl
  CB76    E6 7F                 	and	07fh
  CB78    4F                    	ld	c,a
  CB79    CD D128               	call	lo.ch
  CB7C    E1                    	pop	hl
  CB7D    C1                    	pop	bc
  CB7E    10 E1                 	djnz	c172
  CB80    C1                    	pop	bc
  CB81    10 CD                 	djnz	c171
  CB83    3E 0A                 	ld	a,lf
  CB85    4F                    	ld	c,a
  CB86    CD D128               	call	lo.ch
  CB89    3E 0D                 	ld	a,cr
  CB8B    4F                    	ld	c,a
  CB8C    CD D128               	call	lo.ch
  CB8F    C3 C79F               	jp	ci
                                 endif
                                ;
  CB92    47                    c18::	ld	b,a
  CB93    AF                    	xor	a
  CB94    32 E09A               	ld	(pf10er),a
  CB97    78                    	ld	a,b
  CB98    E6 7F                 	and	07fh		; paritaet loeschen
  CB9A    C9                    	ret
                                ;
                                ;----------------------------------------------------------------------
                                ;
                                 if eq.hex ne 0
  CB9B    C5                    cbit4::	push	bc
  CB9C    AF                    	xor	a
  CB9D    32 E09B               	ld	(sverz),a
  CBA0    CD C76A               cbit41::call	ciber		; warten bis taste losgelassen
  CBA3    20 FB                 	jr	nz,cbit41
  CBA5    CD C76A               cbit42::call	ciber		; warten bis taste gedrueckt
  CBA8    28 FB                 	jr	z,cbit42
                                ;
  CBAA    CD CD23               	call	ci.ch		; zeichen uebernehmen
  CBAD    47                    	ld	b,a
  CBAE    CD C76A               cbit43::call	ciber		; warten bis taste losgelassen
  CBB1    20 FB                 	jr	nz,cbit43
  CBB3    78                    	ld	a,b
  CBB4    E6 7F                 	and	7fh
  CBB6    FE 41                 	cp	41h
  CBB8    38 02                 	jr	c,cbit44
  CBBA    D6 07                 	sub	7
  CBBC    D6 30                 cbit44::sub	30h
  CBBE    E6 0F                 	and	0fh
  CBC0    C1                    	pop	bc
  CBC1    C9                    	ret
                                 endif
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-19


                                
                                ; console ausgabe
                                ; ---------------
                                ;
  CBC2                          conou::				; iobyte:   00 00 00 xx
  CBC2    CD C700               	call	reta		;   0, 1  crt:
  CBC5    F5                    	push	af		;   2     bat:
  CBC6    CD C710               	call	iodisp		;   3     crt: + lpt:
  CBC9    00                    	defb	0
  CBCA    CBD2                  	defw	conou0
  CBCC    CBD2                  	defw	conou1
  CBCE    CBFA                  	defw	listx
  CBD0    CBD9                  	defw	conou3
                                
  CBD2                          conou0::
  CBD2                          conou1::
  CBD2    CD CD7E               	call	co.ch
  CBD5    F1                    	pop	af
  CBD6    C3 C708               	jp	retu
                                
  CBD9                          conou3::
  CBD9    CD CD7E               	call	co.ch
  CBDC    CD D128               	call	lo.ch
  CBDF    F1                    	pop	af
  CBE0    C3 C708               	jp	retu
                                
                                ; drucker ausgabe
                                ; ---------------
                                ;
  CBE3    CD C700               lists::	call	reta
  CBE6    CD C710               	call	iodisp
  CBE9    06                    	defb	6
  CBEA    CBF2                  	defw	lsst0
  CBEC    CBF2                  	defw	lsst1
  CBEE    CBF2                  	defw	lsst2
  CBF0    CBF2                  	defw	lsst3
                                
  CBF2                          lsst0::
  CBF2                          lsst1::
  CBF2                          lsst2::
  CBF2                          lsst3::
  CBF2    AF                    	xor	a		; immer bereit
  CBF3    C3 C708               	jp	retu
                                
                                
  CBF6                          list::				; iobyte:  xx 00 00 00
  CBF6    CD C700               	call	reta		;   0			ATS-Kanal A
  CBF9    F5                    	push	af		;   1        crt:
  CBFA    CD C710               listx::	call	iodisp		;   2	     lpt:
  CBFD    06                    	defb	6		;   3			ATS-Kanal B
  CBFE    CC06                  	defw	list0
  CC00    CC0D                  	defw	list1
  CC02    CC14                  	defw	list2
  CC04    CC1B                  	defw	list3
                                
  CC06                          list0::
  CC06    CD D206               	call	pu1.ch
  CC09    F1                    	pop	af
  CC0A    C3 C708               	jp	retu
  CC0D                          list1::
  CC0D    CD CD7E               	call	co.ch
  CC10    F1                    	pop	af
  CC11    C3 C708               	jp	retu
  CC14                          list2::
  CC14    CD D128               	call	lo.ch
  CC17    F1                    	pop	af
  CC18    C3 C708               	jp	retu
  CC1B                          list3::
  CC1B    CD D21B               	call	pu2.ch
  CC1E    F1                    	pop	af
  CC1F    C3 C708               	jp	retu
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-20


                                
                                ; leser eingabe
                                ; -------------
                                ;
  CC22    CD C700               readst::call	reta
  CC25    CD C710               reads1::call	iodisp
  CC28    02                    	defb	2
  CC29    CC31                  	defw	rdst0
  CC2B    CC31                  	defw	rdst1
  CC2D    CC31                  	defw	rdst2
  CC2F    CC31                  	defw	rdst3
                                
  CC31                          rdst0::
  CC31                          rdst1::
  CC31                          rdst2::
  CC31                          rdst3::
  CC31    AF                    	xor	a
  CC32    3D                    	dec	a
  CC33    C3 C708               	jp	retu
                                
                                
  CC36                          reade::				; iobyte:   00 00 xx 00
  CC36    CD C700               	call	reta		;   0     crt:
  CC39    CD C710               reade1::call	iodisp		;   1     ptr:
  CC3C    02                    	defb	2		;   2	  ur1:	ATS-Kanal A
  CC3D    CC45                  	defw	read0		;   3	  ur2:	ATS-Kanal B
  CC3F    CC4B                  	defw	read1
  CC41    CC53                  	defw	read2
  CC43    CC59                  	defw	read3
                                
                                
  CC45                          read0::
  CC45    CD CD23               	call	ci.ch
  CC48    C3 C708               	jp	retu
                                
  CC4B                          read1::
  CC4B    CD D150               	call	ri.ch
  CC4E    E6 7F                 	and	7fh
  CC50    C3 C708               	jp	retu
                                
  CC53                          read2::
  CC53    CD D16D               	call	ri1.ch
  CC56    C3 C708               	jp	retu
                                
  CC59                          read3::
  CC59    CD D189               	call	ri2.ch
  CC5C    C3 C708               	jp	retu
                                ;
                                ; stanzer ausgabe
                                ; ---------------
                                ;
  CC5F                          punch::				; iobyte:   00 xx 00 00
  CC5F    CD C700               	call	reta		;   0        crt:
  CC62    F5                    	push	af		;   1        ptp:
  CC63    CD C710               	call	iodisp		;   2        up1:	ATS-Kanal A
  CC66    04                    	defb	4		;   3	     up2:	ATS-Kanal B
  CC67    CC6F                  	defw	punch0
  CC69    CC76                  	defw	punch1
  CC6B    CC7D                  	defw	punch2
  CC6D    CC84                  	defw	punch3
                                
  CC6F                          punch0::
  CC6F    CD CD7E               	call	co.ch
  CC72    F1                    	pop	af
  CC73    C3 C708               	jp	retu
                                
  CC76                          punch1::
  CC76    CD D1E9               	call	pu.ch
  CC79    F1                    	pop	af
  CC7A    C3 C708               	jp	retu
                                
  CC7D                          punch2::
  CC7D    CD D206               	call	pu1.ch
  CC80    F1                    	pop	af
  CC81    C3 C708               	jp	retu
                                
  CC84                          punch3::
  CC84    CD D21B               	call	pu2.ch
  CC87    F1                    	pop	af
  CC88    C3 C708               	jp	retu
                                ;
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-21


                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-22


                                
                         C      	include	CI.ASM
                         C      ; tastaturbedienung ueber DEG2000 Version 1.2  ---  EPROM 6C
                         C      ; ----------------------------------------------------------
                         C      ;
  6EF3                   C      tta1	equ	ttinit+3
  6EF6                   C      tta2	equ	ttinit+6
  6EFC                   C      ttfe	equ	ttinit+12
  6F05                   C      ttbel	equ	ttinit+15h
                         C      ;
  CC8B    FF             C      umerk:	defb	0ffh
                         C      ;
                         C      ;
                         C      ta	macro	up
                         C      	ld	a,ptast
                         C      	set12
                         C      	call	up
                         C      	res12
                         C      	endm
                         C      ;
  CC8C                   C      tinit::	ta	ttinit
  CC8C    3E A0          C+     	ld	a,ptast
  CC8E    ED 73 E306     C+     	ld	(stkret),sp
  CC92    31 E304        C+     	ld	sp,stk12
  CC95    CD C749        C+     	call	uset12
  CC98    CD 6EF0        C+     	call	ttinit
  CC9B    CD C73A        C+     	call	ures12
  CC9E    ED 7B E306     C+     	ld	sp,(stkret)
  CCA2    C9             C      	ret
                         C      ;
  CCA3                   C      ta1::	ta	tta1
  CCA3    3E A0          C+     	ld	a,ptast
  CCA5    ED 73 E306     C+     	ld	(stkret),sp
  CCA9    31 E304        C+     	ld	sp,stk12
  CCAC    CD C749        C+     	call	uset12
  CCAF    CD 6EF3        C+     	call	tta1
  CCB2    CD C73A        C+     	call	ures12
  CCB5    ED 7B E306     C+     	ld	sp,(stkret)
  CCB9    32 CC8B        C      	ld	(umerk),a
  CCBC    C9             C      	ret
                         C      ;
  CCBD                   C      ta2::	ta	tta2
  CCBD    3E A0          C+     	ld	a,ptast
  CCBF    ED 73 E306     C+     	ld	(stkret),sp
  CCC3    31 E304        C+     	ld	sp,stk12
  CCC6    CD C749        C+     	call	uset12
  CCC9    CD 6EF6        C+     	call	tta2
  CCCC    CD C73A        C+     	call	ures12
  CCCF    ED 7B E306     C+     	ld	sp,(stkret)
  CCD3    C5             C      	push	bc
  CCD4    47             C      	ld	b,a
                         C       if not talt
  CCD5    3A CC8B        C      	ld	a,(umerk)
  CCD8    CB 57          C      	bit	2,a
  CCDA    20 0C          C      	jr	nz,ta21
                         C       endif
  CCDC    78             C      	ld	a,b
                         C       if talt
                         C      	cp	0f0h
                         C       else
  CCDD    FE 60          C      	cp	60h
                         C       endif
  CCDF    30 07          C      	jr	nc,ta21
                         C       if talt
                         C      	cp	0d0h
                         C       else
  CCE1    FE 40          C      	cp	40h
                         C       endif
  CCE3    38 03          C      	jr	c,ta21
                         C       if talt
                         C      	sub	0d0h
                         C       else
  CCE5    D6 40          C      	sub	40h
                         C       endif
  CCE7    47             C      	ld	b,a
  CCE8    78             C      ta21:	ld	a,b
  CCE9    C1             C      	pop	bc
  CCEA    C9             C      	ret
                         C      ;
  CCEB                   C      tfe::	ta	ttfe
  CCEB    3E A0          C+     	ld	a,ptast
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-23


  CCED    ED 73 E306     C+     	ld	(stkret),sp
  CCF1    31 E304        C+     	ld	sp,stk12
  CCF4    CD C749        C+     	call	uset12
  CCF7    CD 6EFC        C+     	call	ttfe
  CCFA    CD C73A        C+     	call	ures12
  CCFD    ED 7B E306     C+     	ld	sp,(stkret)
  CD01    C9             C      	ret
                         C      ;
  CD02                   C      tbel::	ta	ttbel
  CD02    3E A0          C+     	ld	a,ptast
  CD04    ED 73 E306     C+     	ld	(stkret),sp
  CD08    31 E304        C+     	ld	sp,stk12
  CD0B    CD C749        C+     	call	uset12
  CD0E    CD 6F05        C+     	call	ttbel
  CD11    CD C73A        C+     	call	ures12
  CD14    ED 7B E306     C+     	ld	sp,(stkret)
  CD18    C9             C      	ret
                         C      ;
                         C      ;
  CD19                   C      ci.kalt::
  CD19                   C      ci.warm::
  CD19    CD CC8C        C      	call	tinit
  CD1C    C9             C      	ret
                         C      ;
                         C      ;
  CD1D                   C      ci.sta::
  CD1D    C5             C      	push	bc
  CD1E    CD CCA3        C      	call	ta1		; taste       gedrueckt --> z=1
  CD21    C1             C      	pop	bc
  CD22    C9             C      	ret			; taste nicht gedrueckt --> z=0
                         C      ;
                         C      ;
  CD23                   C      ci.ch::
  CD23    CD CCBD        C      	call	ta2
  CD26    21 CD5E        C      	ld	hl,degtab
  CD29    01 0010        C      	ld	bc,degend-degtab
  CD2C    ED B1          C      	cpir
  CD2E    20 07          C      	jr	nz,ci1
  CD30    01 000F        C      	ld	bc,cpmtab-degtab-1
  CD33    09             C      	add	hl,bc
  CD34    7E             C      	ld	a,(hl)
  CD35    18 1F          C      	jr	ci5
  CD37    F5             C      ci1:	push	af
  CD38    3A CC8B        C      	ld	a,(umerk)
  CD3B    CB 57          C      	bit	2,a
  CD3D    C1             C      	pop	bc
  CD3E    78             C      	ld	a,b
  CD3F    28 15          C      	jr	z,ci5
  CD41    FE 41          C      ci2:	cp	41h		; gross- / kleinumwandlung
  CD43    38 04          C      	jr	c,ci3
  CD45    FE 5B          C      	cp	5bh
  CD47    38 08          C      	jr	c,ci4
  CD49    FE 61          C      ci3:	cp	61h
  CD4B    38 09          C      	jr	c,ci5
  CD4D    FE 7B          C      	cp	7bh
  CD4F    30 05          C      	jr	nc,ci5
  CD51    47             C      ci4:	ld	b,a
  CD52    3A E098        C      	ld	a,(umsch)	; maske fuer umwandlung
  CD55    A8             C      	xor	b
  CD56    47             C      ci5:	ld	b,a
  CD57    C9             C      	ret
                         C      ;
                         C      ;
  CD58                   C      ci.bell::
  CD58    06 40          C      	ld	b,40h
  CD5A    CD CD02        C      	call	tbel
  CD5D    C9             C      	ret
                         C      ;
                         C      ; umschluesseltabelle
                         C      ;
  CD5E    B1 F0 F1       C      degtab:	defb	0b1h,0f0h,0f1h
  CD61    B2 F2 F3       C      	defb	0b2h,0f2h,0f3h
  CD64    F4 F5 F6       C      	defb	0f4h,0f5h,0f6h
  CD67    F7 F8 F9       C      	defb	0f7h,0f8h,0f9h
  CD6A    1E FA FB B0    C      	defb	01eh,0fah,0fbh,0b0h
  CD6E                   C      degend:
  CD6E    09 1B 7F       C      cpmtab:	defb	009h,01bh,07fh
  CD71    09 0A 15       C      	defb	009h,00ah,015h
  CD74    17 05 12       C      	defb	017h,005h,012h
  CD77    08 0C 04       C      	defb	008h,00ch,004h
  CD7A    0D 1A 18 03    C      	defb	00dh,01ah,018h,003h
                         C      ;
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-24


                                	
                                
                                
                         C      	include	CO.ASM
                         C      ;
                         C      ; direkte cursorbedienung
                         C      ;
                         C      ;  1b 01,0d  CR    zum Zeilenanfang
                         C      ;  1b 02,0a  LF    Kursor eine Zeile tiefer; evt. rollen
                         C      ;  1b 1e     HOME  Kursor in Zeile 1, Spalte 1
                         C      ;  08        BS    setzt Kursor eine Position zurueck; in homepos. wirkungslos
                         C      ;  1b 10     EOS   loescht den Bildschirm ab Kursorpos. bis Bildschirmende
                         C      ;  1b 0b     UP    setzt den Kursor zyklisch eine Zeile hoeher
                         C      ;  1b 0c     RIGHT setzt den Kursor zyklische eine Position weiter
                         C      ;  1b 1f     NL    setzt Kursor in die naechste Zeile auf den Anfang
                         C      ;  09        TAB   setzt Kursor auf naechste durch 8 teilbare Position
                         C      ;  1a        CLEAR loescht den gesamten Bildschirm und setzt Kursor home
                         C      ;  1b ':'    EOS   loescht den Bildschirm und laesst Kursor unveraendert
                         C      ;  1b 'R'    DELL  stellt Kursor auf Z.anf., loescht die Zeile und rollt Z. nach
                         C      ;  1b 'E'    INSL  stellt Kursor auf Z.anf., rollt Zeilen eins tiefer und loescht die Zeile
                         C      ;  1b 'T'    EOL   loescht die Zeile ab Kursorposition bis Zeilenende
                         C      ;  1b '=' rc POS   positioniert den Kursor auf Zeile r-20h und Spalte c-20h
                         C      ;  1b '1'    SRMOD setzt speziellen Rollmodus
                         C      ;  1b '0'    RRMOD setzt normalen   Rollmodus
                         C      ;
  CD7E    CD D07D        C      co.ch::	call	rescur
  CD81    C5             C      	push	bc		; zeichen in c muss erhalten bleiben
  CD82    79             C      	ld	a,c
  CD83    21 E097        C      	ld	hl,qesc
  CD86    CB 46          C      	bit	qesc0,(hl)	; lauft steuerfolge?
  CD88    20 0B          C      	jr	nz,m106		; -> ja
  CD8A    FE 1B          C      	cp	esc		; beginnt steuerfolge?
  CD8C    20 7D          C      	jr	nz,m108		; -> nein
                         C      ;
  CD8E    CB C6          C      	set	qesc0,(hl)	; es beginnt steuerfolge
  CD90    CB 8E          C      co.c1::	res	qesc1,(hl)
  CD92    C3 CF02        C      	jp	m19y
                         C      ;
  CD95    CB 4E          C      m106::	bit	qesc1,(hl)	; ist steuerzeichen schon eingetroffen?
  CD97    20 4D          C      co.c2::	jr	nz,m107		; -> ja, es folgt r oder c
  CD99    FE 3D          C      	cp	'='		; nein, es folgt steuerzeichen
  CD9B    28 67          C      	jr	z,m1078		; -> 1b '=' rc
  CD9D    CD D046        C      	call	evtrol		; evtl. verzoegertes rollen ausfuehren
  CDA0    CB 86          C      	res	qesc0,(hl)	; bearbeitung der steuerfolge beendet
  CDA2    FE 54          C      	cp	'T'
  CDA4    CA CF07        C      	jp	z,m20		; -> EOL
  CDA7    FE 45          C      	cp	'E'
  CDA9    CA CF29        C      	jp	z,m21		; -> INS LINE
  CDAC    FE 52          C      	cp	'R'
  CDAE    CA CF60        C      	jp	z,m22		; -> DEL LINE
  CDB1    FE 3A          C      	cp	':'
  CDB3    CA CFB5        C      	jp	z,m23		; -> EOS
  CDB6    FE 1F          C      	cp	1fh		; nl
  CDB8    CA CEA2        C      	jp	z,m16
  CDBB    FE 01          C      	cp	1		; cr-ersatz
  CDBD    CA CE9C        C      	jp	z,m15
  CDC0    FE 02          C      	cp	2		; lf-ersatz
  CDC2    CA CE90        C      	jp	z,m14
  CDC5    FE 1E          C      	cp	1eh		; home
  CDC7    CA CEAE        C      	jp	z,m18
  CDCA    FE 10          C      	cp	10h		; eos
  CDCC    CA CEC1        C      	jp	z,m19
  CDCF    FE 0B          C      	cp	0bh		; up
  CDD1    CA CEE4        C      	jp	z,m19a
  CDD4    FE 0C          C      	cp	0ch		; right
  CDD6    CA CEF0        C      	jp	z,m19b
  CDD9    FE 31          C      	cp	'1'		; spezieller Rollmodus an
  CDDB    CA CFC0        C      	jp	z,m24
  CDDE    FE 30          C      	cp	'0'		; normaler   Rollmodus an
  CDE0    CA CFC8        C      	jp	z,m25
  CDE3    C3 CE2B        C      	jp	m109		; -> nicht auswertbares steuerzeichen
                         C      ;
  CDE6    CB 56          C      m107::	bit	qesc2,(hl)	; 1b '=' r c
  CDE8    CB D6          C      	set	qesc2,(hl)
  CDEA    20 09          C      	jr	nz,m1072	; -> es ist c eingetroffen
  CDEC    D6 20          C      co.c3::	sub	20h
  CDEE    38 0C          C      	jr	c,m1074		; -> zeile war <= 1fh
  CDF0    32 0040        C      	ld	(zeil),a
  CDF3    18 09          C      	jr	m1076
  CDF5    D6 20          C      m1072::	sub	20h
  CDF7    38 03          C      	jr	c,m1074		; -> spalte war <= 1fh
  CDF9    32 0041        C      	ld	(spalt),a
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-25


  CDFC    CB 86          C      m1074::	res	qesc0,(hl)	; bearbeitung ist beendet
  CDFE    CD CFDC        C      m1076::	call	bsadr
  CE01    C3 CEFE        C      	jp	m19x
                         C      ;
  CE04    CB CE          C      m1078::	set	qesc1,(hl)
  CE06    CB 96          C      	res	qesc2,(hl)	; es wird r erwartet
  CE08    C3 CEFE        C      	jp	m19x
                         C      ;
                         C      ;--------------------------------
                         C      ;
  CE0B    CD D046        C      m108::	call	evtrol		; evtl. verzoegertes rollen ausfuehren
  CE0E    FE 07          C      	cp	7		; bell
  CE10    CA CEA8        C      	jp	z,m17
  CE13    FE 08          C      	cp	8		; backspace
  CE15    CA CE6C        C      	jp	z,m12
  CE18    FE 0A          C      	cp	lf		; lf
  CE1A    CA CE90        C      	jp	z,m14
  CE1D    FE 0D          C      	cp	cr		; cr
  CE1F    CA CE9C        C      	jp	z,m15
  CE22    FE 09          C      	cp	tab
  CE24    28 20          C      	jr	z,m11
  CE26    FE 1A          C      co.c4::	cp	1ah		; clear
  CE28    CA CEB7        C      	jp	z,m185
  CE2B    2A E093        C      m109::	ld	hl,(bsaddr)
                         C      	set12
  CE2E    ED 73 E306     C+     	ld	(stkret),sp
  CE32    31 E304        C+     	ld	sp,stk12
  CE35    CD C749        C+     	call	uset12
  CE38    77             C      	ld	(hl),a		; zeichen auf bildschirm schreiben
                         C      	res12
  CE39    CD C73A        C+     	call	ures12
  CE3C    ED 7B E306     C+     	ld	sp,(stkret)
  CE40    CD CFCB        C      	call	incad		; schreiben in letzte pos. rollt nicht!!
  CE43    C3 CF02        C      	jp	m19y
                         C      ;
                         C      ;
  CE46    2A E093        C      m11::	ld	hl,(bsaddr)	; tab
                         C      	set12
  CE49    ED 73 E306     C+     	ld	(stkret),sp
  CE4D    31 E304        C+     	ld	sp,stk12
  CE50    CD C749        C+     	call	uset12
  CE53    36 20          C      	ld	(hl),20h
                         C      	res12
  CE55    CD C73A        C+     	call	ures12
  CE58    ED 7B E306     C+     	ld	sp,(stkret)
  CE5C    CD CFCB        C      	call	incad
  CE5F    3A 0041        C      	ld	a,(spalt)
  CE62    E6 07          C      	and	7
  CE64    CA CF02        C      	jp	z,m19y
  CE67    CD D046        C      	call	evtrol		; evtl. verzoegertes rollen ausfuehren
  CE6A    18 DA          C      	jr	m11
                         C      ;
  CE6C    3A 0041        C      m12::	ld	a,(spalt)	; backspace
  CE6F    B7             C      	or	a
  CE70    28 0D          C      	jr	z,m13
  CE72    3D             C      	dec	a
  CE73    32 0041        C      	ld	(spalt),a
  CE76    2A E093        C      m121::	ld	hl,(bsaddr)
  CE79    2B             C      	dec	hl
  CE7A    22 E093        C      	ld	(bsaddr),hl
  CE7D    18 7F          C      	jr	m19x
                         C      ;
  CE7F    3A 0040        C      m13::	ld	a,(zeil)
  CE82    B7             C      	or	a
  CE83    28 79          C      	jr	z,m19x		; -> bs nicht ausfuehrbar, da homeposition
  CE85    3D             C      	dec	a
  CE86    32 0040        C      	ld	(zeil),a
  CE89    3E 4F          C      	ld	a,maxs-1
  CE8B    32 0041        C      	ld	(spalt),a
  CE8E    18 E6          C      	jr	m121
                         C      ;
  CE90    21 0040        C      m14::	ld	hl,zeil		; lf
  CE93    34             C      	inc	(hl)
  CE94    CD CFDC        C      m141::	call	bsadr		; evtl. rollen ausfuehren
  CE97    CD D046        C      	call	evtrol
  CE9A    18 66          C      	jr	m19y
                         C      ;
  CE9C    AF             C      m15::	xor	a		; cr
  CE9D    32 0041        C      	ld	(spalt),a
  CEA0    18 F2          C      	jr	m141
                         C      ;
  CEA2    21 0040        C      m16::	ld	hl,zeil		; nl
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-26


  CEA5    34             C      	inc	(hl)
  CEA6    18 F4          C      	jr	m15
                         C      ;
  CEA8    CD CD58        C      m17::	call	ci.bell
  CEAB    C3 CF02        C      	jp	m19y
                         C      ;
  CEAE    AF             C      m18::	xor	a		; home
  CEAF    32 0040        C      	ld	(zeil),a
  CEB2    32 0041        C      	ld	(spalt),a
  CEB5    18 DD          C      	jr	m141
                         C      ;
  CEB7    AF             C      m185::	xor	a		; clear
  CEB8    32 0040        C      	ld	(zeil),a
  CEBB    32 0041        C      	ld	(spalt),a
  CEBE    CD CFDC        C      	call	bsadr
                         C      ;
  CEC1    2A E093        C      m19::	ld	hl,(bsaddr)	; eos ab cursorposition
                         C      	set12
  CEC4    ED 73 E306     C+     	ld	(stkret),sp
  CEC8    31 E304        C+     	ld	sp,stk12
  CECB    CD C749        C+     	call	uset12
  CECE    36 20          C      m191::	ld	(hl),20h
  CED0    23             C      	inc	hl
  CED1    7C             C      	ld	a,h
  CED2    FE 37          C      	cp	high (bsanf+maxz*maxs)
  CED4    20 F8          C      	jr	nz,m191
  CED6    7D             C      	ld	a,l
  CED7    FE 80          C      	cp	low (bsanf+maxz*maxs)
  CED9    20 F3          C      	jr	nz,m191
                         C      	res12
  CEDB    CD C73A        C+     	call	ures12
  CEDE    ED 7B E306     C+     	ld	sp,(stkret)
  CEE2    18 1A          C      	jr	m19x
                         C      ;
  CEE4    21 0040        C      m19a::	ld	hl,zeil		; up
  CEE7    7E             C      	ld	a,(hl)
  CEE8    B7             C      	or	a
  CEE9    20 02          C      	jr	nz,m19a1	; -> cursor stand nicht in 1. zeile
  CEEB    36 18          C      	ld	(hl),maxz
  CEED    35             C      m19a1::	dec	(hl)
  CEEE    18 A4          C      	jr	m141
                         C      ;
  CEF0    3A 0041        C      m19b::	ld	a,(spalt)	; right zyklisch in zeile
  CEF3    3C             C      	inc	a
  CEF4    FE 50          C      	cp	maxs
  CEF6    20 01          C      	jr	nz,m19b1
  CEF8    AF             C      	xor	a
  CEF9    32 0041        C      m19b1::	ld	(spalt),a
  CEFC    18 96          C      	jr	m141
                         C      ;
  CEFE    AF             C      m19x::	xor	a
  CEFF    32 E096        C      	ld	(qroll),a
  CF02    C1             C      m19y::	pop	bc
  CF03    CD D05C        C      	call	setcur
  CF06    C9             C      	ret
                         C      ;
                         C      ;-----------------------------------------
                         C      ;
  CF07    21 0041        C      m20::	ld	hl,spalt	; EOL
  CF0A    3E 50          C      	ld	a,maxs
  CF0C    96             C      	sub	(hl)
  CF0D    47             C      	ld	b,a
  CF0E    2A E093        C      	ld	hl,(bsaddr)
                         C      	set12
  CF11    ED 73 E306     C+     	ld	(stkret),sp
  CF15    31 E304        C+     	ld	sp,stk12
  CF18    CD C749        C+     	call	uset12
  CF1B    36 20          C      m201::	ld	(hl),20h
  CF1D    23             C      	inc	hl
  CF1E    10 FB          C      	djnz	m201
                         C      	res12
  CF20    CD C73A        C+     	call	ures12
  CF23    ED 7B E306     C+     	ld	sp,(stkret)
  CF27    18 D5          C      	jr	m19x
                         C      ;
  CF29    AF             C      m21::	xor	a		; INS LINE
  CF2A    32 0041        C      	ld	(spalt),a
  CF2D    CD CFDC        C      	call	bsadr
  CF30    21 0040        C      	ld	hl,zeil
  CF33    3E 18          C      	ld	a,maxz
  CF35    96             C      	sub	(hl)
  CF36    3D             C      	dec	a
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-27


  CF37    28 CE          C      	jr	z,m20		; -> kursor stand in letzter zeile; diese loeschen
  CF39    47             C      	ld	b,a
  CF3A    21 0000        C      	ld	hl,0
  CF3D    11 0050        C      	ld	de,maxs
  CF40    19             C      m211::	add	hl,de		; anzahl der zeilen bestimmen, die nach
  CF41    10 FD          C      	djnz	m211		; unten gerollt werden muessen
  CF43    44             C      	ld	b,h
  CF44    4D             C      	ld	c,l
  CF45    21 372F        C      	ld	hl,bsanf+maxz*maxs-1-maxs
  CF48    11 377F        C      	ld	de,bsanf+maxz*maxs-1
                         C      	set12
  CF4B    ED 73 E306     C+     	ld	(stkret),sp
  CF4F    31 E304        C+     	ld	sp,stk12
  CF52    CD C749        C+     	call	uset12
  CF55    ED B8          C      	lddr
                         C      	res12
  CF57    CD C73A        C+     	call	ures12
  CF5A    ED 7B E306     C+     	ld	sp,(stkret)
  CF5E    18 A7          C      	jr	m20		; -> zeile loeschen, in der cursor steht
                         C      ;
  CF60    AF             C      m22::	xor	a		; DEL LINE
  CF61    32 0041        C      	ld	(spalt),a
  CF64    CD CFDC        C      	call	bsadr
  CF67    21 0040        C      	ld	hl,zeil
  CF6A    3E 18          C      	ld	a,maxz
  CF6C    96             C      	sub	(hl)
  CF6D    3D             C      	dec	a
  CF6E    28 24          C      	jr	z,m222		; -> kursor stand in letzter zeile
  CF70    47             C      	ld	b,a
  CF71    21 0000        C      	ld	hl,0
  CF74    11 0050        C      	ld	de,maxs
  CF77    19             C      m221::	add	hl,de		; anzahl der zeilen bestimmen, die nach
  CF78    10 FD          C      	djnz	m221		; oben gerollt werden muessen
  CF7A    44             C      	ld	b,h
  CF7B    4D             C      	ld	c,l
  CF7C    2A E093        C      	ld	hl,(bsaddr)
  CF7F    EB             C      	ex	de,hl
  CF80    19             C      	add	hl,de
                         C      	set12
  CF81    ED 73 E306     C+     	ld	(stkret),sp
  CF85    31 E304        C+     	ld	sp,stk12
  CF88    CD C749        C+     	call	uset12
  CF8B    ED B0          C      	ldir
                         C      	res12
  CF8D    CD C73A        C+     	call	ures12
  CF90    ED 7B E306     C+     	ld	sp,(stkret)
  CF94    21 3730        C      m222::	ld	hl,bsanf+maxz*maxs-maxs ; letzte zeile loeschen
  CF97    11 3731        C      	ld	de,bsanf+maxz*maxs-maxs+1
  CF9A    01 004F        C      	ld	bc,maxs-1
  CF9D                   C      m223:
                         C      	set12
  CF9D    ED 73 E306     C+     	ld	(stkret),sp
  CFA1    31 E304        C+     	ld	sp,stk12
  CFA4    CD C749        C+     	call	uset12
  CFA7    36 20          C      	ld	(hl),20h
  CFA9    ED B0          C      	ldir
                         C      	res12
  CFAB    CD C73A        C+     	call	ures12
  CFAE    ED 7B E306     C+     	ld	sp,(stkret)
  CFB2    C3 CEFE        C      	jp	m19x
                         C      ;
  CFB5    21 3000        C      m23::	ld	hl,bsanf	; eos, cursor bleibt unveraendert
  CFB8    11 3001        C      	ld	de,bsanf+1
  CFBB    01 077F        C      	ld	bc,maxz*maxs-1
  CFBE    18 DD          C      	jr	m223
                         C      ;
  CFC0    3E 01          C      m24::	ld	a,1		; spezieller rollmodus an
  CFC2    32 E095        C      m241::	ld	(qrmode),a
  CFC5    C3 CF02        C      	jp	m19y
                         C      ;
  CFC8    AF             C      m25::	xor	a		; normaler   rollmodus an
  CFC9    18 F7          C      	jr	m241
                         C      ;
                         C      ;-----------------------------------------------
                         C      ;
  CFCB    21 0041        C      incad::	ld	hl,spalt
  CFCE    34             C      	inc	(hl)
  CFCF    7E             C      	ld	a,(hl)
  CFD0    FE 50          C      	cp	maxs
  CFD2    20 08          C      	jr	nz,bsadr
  CFD4    AF             C      	xor	a
  CFD5    77             C      	ld	(hl),a
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-28


  CFD6    21 0040        C      	ld	hl,zeil
  CFD9    34             C      	inc	(hl)
  CFDA    18 00          C      	jr	bsadr
                         C      ;
                         C      ;-----------------------------------------------
                         C      ;
                         C      ; die position zeil/spalt durch evtl. rollen in den bildschirmbereich
                         C      ; bringen und physische adresse der position berechnen; dabei rollen
                         C      ; in letzter position verzoegern, statt dessen qroll stellen, damit vor
                         C      ; der naechsten ausgabe oder setcur gerollt werden kann
                         C      ;
  CFDC    F5             C      bsadr::	push	af
  CFDD    C5             C      	push	bc
  CFDE    D5             C      	push	de
  CFDF    3A 0040        C      	ld	a,(zeil)
  CFE2    FE 18          C      m30::	cp	maxz
  CFE4    38 15          C      	jr	c,m31
  CFE6    28 05          C      	jr	z,m307		; -> es koennte letzte position gewesen sein
  CFE8    CD D01A        C      m303::	call	bsrol
  CFEB    18 F5          C      	jr	m30
  CFED    3A 0041        C      m307::	ld	a,(spalt)	; ist spalte = 0?
  CFF0    B7             C      	or	a
  CFF1    3E 18          C      	ld	a,maxz
  CFF3    20 F3          C      	jr	nz,m303		; -> nein, rollen
  CFF5    3D             C      	dec	a
  CFF6    21 E096        C      	ld	hl,qroll	; rollmerker setzen
  CFF9    36 01          C      	ld	(hl),1
  CFFB    47             C      m31::	ld	b,a		; physische adresse berechnen
  CFFC    21 0000        C      	ld	hl,0
  CFFF    11 0050        C      	ld	de,maxs
  D002    B7             C      	or	a
  D003    28 03          C      	jr	z,m33
  D005    19             C      m32::	add	hl,de
  D006    10 FD          C      	djnz	m32
  D008    3A 0041        C      m33::	ld	a,(spalt)
  D00B    4F             C      	ld	c,a
  D00C    06 00          C      	ld	b,0
  D00E    09             C      	add	hl,bc
  D00F    01 3000        C      	ld	bc,bsanf
  D012    09             C      	add	hl,bc
  D013    D1             C      	pop	de
  D014    C1             C      	pop	bc
  D015    F1             C      	pop	af
  D016    22 E093        C      	ld	(bsaddr),hl
  D019    C9             C      	ret
                         C      ;
                         C      ;-----------------------------------------------
                         C      ;
  D01A    11 3000        C      bsrol::	ld	de,bsanf	; bild hochschieben
  D01D    21 3050        C      	ld	hl,bsanf+maxs
  D020    01 0730        C      	ld	bc,maxs*(maxz-1)
                         C      	set12
  D023    ED 73 E306     C+     	ld	(stkret),sp
  D027    31 E304        C+     	ld	sp,stk12
  D02A    CD C749        C+     	call	uset12
  D02D    ED B0          C      	ldir
  D02F    62             C      	ld	h,d
  D030    6B             C      	ld	l,e
  D031    13             C      	inc	de		; letzte zeile loeschen
  D032    01 004F        C      	ld	bc,maxs-1
  D035    36 20          C      	ld	(hl),20h
  D037    ED B0          C      	ldir
                         C      	res12
  D039    CD C73A        C+     	call	ures12
  D03C    ED 7B E306     C+     	ld	sp,(stkret)
                         C      ;
  D040    21 0040        C      	ld	hl,zeil
  D043    35             C      	dec	(hl)
  D044    7E             C      	ld	a,(hl)
  D045    C9             C      	ret
                         C      ;
                         C      ;-----------------------------------------------
                         C      ;
  D046    E5             C      evtrol::push	hl
  D047    21 E096        C      	ld	hl,qroll
  D04A    CB 46          C      	bit	0,(hl)
  D04C    CB 86          C      	res	0,(hl)
  D04E    E1             C      	pop	hl
  D04F    C8             C      	ret	z
  D050    F5             C      	push	af
  D051    C5             C      	push	bc
  D052    D5             C      	push	de
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-29


  D053    E5             C      	push	hl
  D054    CD D01A        C      	call	bsrol
  D057    E1             C      	pop	hl
  D058    D1             C      	pop	de
  D059    C1             C      	pop	bc
  D05A    F1             C      	pop	af
  D05B    C9             C      	ret
                         C      ;
                         C      ;-----------------------------------------------
                         C      ;
  D05C    E5             C      setcur::push	hl
  D05D    21 E095        C      	ld	hl,qrmode
  D060    CB 46          C      	bit	0,(hl)
  D062    CC D046        C      	call	z,evtrol	; evtl. verzoegertes rollen ausfuehren
  D065    2A E093        C      	ld	hl,(bsaddr)
                         C      	set12
  D068    ED 73 E306     C+     	ld	(stkret),sp
  D06C    31 E304        C+     	ld	sp,stk12
  D06F    CD C749        C+     	call	uset12
  D072    CB FE          C      	set	7,(hl)
                         C      	res12
  D074    CD C73A        C+     	call	ures12
  D077    ED 7B E306     C+     	ld	sp,(stkret)
  D07B    E1             C      	pop	hl
  D07C    C9             C      	ret
                         C      ;
  D07D    E5             C      rescur::push	hl
  D07E    2A E093        C      	ld	hl,(bsaddr)
                         C      	set12
  D081    ED 73 E306     C+     	ld	(stkret),sp
  D085    31 E304        C+     	ld	sp,stk12
  D088    CD C749        C+     	call	uset12
  D08B    CB BE          C      	res	7,(hl)
                         C      	res12
  D08D    CD C73A        C+     	call	ures12
  D090    ED 7B E306     C+     	ld	sp,(stkret)
  D094    E1             C      	pop	hl
  D095    C9             C      	ret
                         C      ;
  D096    3E CE          C      co.bcu::ld	a,0ceh
  D098    32 CD91        C      	ld	(co.c1+1),a
  D09B    21 CD99        C      	ld	hl,co.c2+2
  D09E    22 CD93        C      	ld	(co.c1+3),hl
  D0A1    3E 18          C      	ld	a,018h
  D0A3    32 CD97        C      	ld	(co.c2),a
  D0A6    21 96CB        C      	ld	hl,096cbh
  D0A9    22 CD99        C      	ld	(co.c2+2),hl
  D0AC    3E C3          C      	ld	a,0c3h
  D0AE    32 CD9B        C      	ld	(co.c2+4),a
  D0B1    21 CF02        C      	ld	hl,m19y
  D0B4    22 CD9C        C      	ld	(co.c2+5),hl
  D0B7    21 0000        C      	ld	hl,0
  D0BA    22 CDEC        C      	ld	(co.c3),hl
  D0BD    22 CDF5        C      	ld	(m1072),hl
  D0C0    3E 0C          C      	ld	a,00ch
  D0C2    32 CE27        C      	ld	(co.c4+1),a
  D0C5    32 DDAF        C      	ld	(bootms),a
  D0C8    C9             C      	ret
                         C      ;
  D0C9    3E 8E          C      co.deg::ld	a,08eh
  D0CB    32 CD91        C      	ld	(co.c1+1),a
  D0CE    21 CF02        C      	ld	hl,m19y
  D0D1    22 CD93        C      	ld	(co.c1+3),hl
  D0D4    3E 20          C      	ld	a,020h
  D0D6    32 CD97        C      	ld	(co.c2),a
  D0D9    21 3DFE        C      	ld	hl,03dfeh	;cp '='
  D0DC    22 CD99        C      	ld	(co.c2+2),hl
  D0DF    3E 28          C      	ld	a,28h		;jr z,m1078
  D0E1    32 CD9B        C      	ld	(co.c2+4),a
  D0E4    21 CD67        C      	ld	hl,0cd67h
  D0E7    22 CD9C        C      	ld	(co.c2+5),hl
  D0EA    21 20D6        C      	ld	hl,020d6h	;sub 20h
  D0ED    22 CDEC        C      	ld	(co.c3),hl
  D0F0    22 CDF5        C      	ld	(m1072),hl
  D0F3    3E 1A          C      	ld	a,01ah
  D0F5    32 CE27        C      	ld	(co.c4+1),a
  D0F8    32 DDAF        C      	ld	(bootms),a
  D0FB    C9             C      	ret
                         C      ;
                                
                                
                                
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-30


                         C      	include	LO.ASM
                         C      ; druckerausgabe ueber   DEG2000 Version 1.2 ---  EPROM 7C
                         C      ; --------------------------------------------------------
                         C      ;
  D0FC                   C      lo.reset::
  D0FC    DD E5          C      	push	ix
                         C      	setkmb
  D0FE    ED 73 E306     C+     	ld	(stkret),sp
  D102    31 E304        C+     	ld	sp,stk12
  D105    CD C749        C+     	call	uset12
  D108    F5             C+     	push	af
  D109    AF             C+     	xor	a
  D10A    ED 47          C+     	ld	i,a
  D10C    F1             C+     	pop	af
  D10D    DD 21 0F73     C      	ld	ix,eadr+3
  D111    DD 36 03 58    C      	ld	(ix+3),058h		;l(ir)
  D115    CD 7C06        C      	call	dinit
                         C      	reskmb
  D118    F5             C+     	push	af
  D119    3E C6          C+     	ld	a,high biosan
  D11B    ED 47          C+     	ld	i,a
  D11D    F1             C+     	pop	af
  D11E    CD C73A        C+     	call	ures12
  D121    ED 7B E306     C+     	ld	sp,(stkret)
  D125    DD E1          C      	pop	ix
  D127    C9             C      	ret
                         C      ;
  D128                   C      lo.ch:
  D128    DD E5          C      	push	ix
                         C      	setkmb
  D12A    ED 73 E306     C+     	ld	(stkret),sp
  D12E    31 E304        C+     	ld	sp,stk12
  D131    CD C749        C+     	call	uset12
  D134    F5             C+     	push	af
  D135    AF             C+     	xor	a
  D136    ED 47          C+     	ld	i,a
  D138    F1             C+     	pop	af
  D139    DD 21 0F73     C      	ld	ix,eadr+3
                         C       if dr54
                         C      	push	af
                         C      	ld	a,c
                         C      	cp	00dh
                         C      	jr	z,loch1
                         C      	cp	00ah
                         C      	jr	nz,loch2
                         C      	ld	c,01eh
                         C      loch2:
                         C       endif
  D13D    CD 7C09        C      	call	dout
                         C       if dr54
                         C      loch1:	pop	af
                         C       endif
                         C      	reskmb
  D140    F5             C+     	push	af
  D141    3E C6          C+     	ld	a,high biosan
  D143    ED 47          C+     	ld	i,a
  D145    F1             C+     	pop	af
  D146    CD C73A        C+     	call	ures12
  D149    ED 7B E306     C+     	ld	sp,(stkret)
  D14D    DD E1          C      	pop	ix
  D14F    C9             C      	ret
                         C      ;
                                
                                
                                
                         C      	include	RI.ASM
                         C      ; lochbandleserbedienung ueber  DEG2000 Version 1.2  --- EPROM 70
                         C      ; ---------------------------------------------------------------
                         C      ;
                         C       if tap
  D150    DD E5          C      ri.ch::	push	ix
                         C      	set12
  D152    ED 73 E306     C+     	ld	(stkret),sp
  D156    31 E304        C+     	ld	sp,stk12
  D159    CD C749        C+     	call	uset12
  D15C    DD 21 0FA3     C      	ld	ix,ealbl+3
  D160    CD 7000        C      	call	lbl
                         C      	res12
  D163    CD C73A        C+     	call	ures12
  D166    ED 7B E306     C+     	ld	sp,(stkret)
  D16A    DD E1          C      	pop	ix
  D16C    C9             C      	ret
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-31


                         C       else
                         C      ri.ch::	ld	a,1ah
                         C      	ret
                         C       endif
                         C      ;
                         C      ; S I O -  uebertragung ueber die ATS
                         C      ; -----------------------------------
                         C      ;
                         C       if eq.sio ne 0
  D16D                   C      ri1.ch::			;ATS-Kanal A (Passiv)
  D16D    C5             C      	push	bc
  D16E    E5             C      	push	hl
                         C      	rept	4		;SIO-Empfangspuffer leeren
                         C      	in	a,(ptast+10h)
                         C      	endm
  D16F    DB B0          C+     	in	a,(ptast+10h)
  D171    DB B0          C+     	in	a,(ptast+10h)
  D173    DB B0          C+     	in	a,(ptast+10h)
  D175    DB B0          C+     	in	a,(ptast+10h)
  D177    3E 10          C      	ld	a,010h		;Bereitschaftszeichen ausgeben
  D179    D3 B0          C      	out	(ptast+10h),a
  D17B    AF             C      ri.ch1:	xor	a		;warten auf Eingabezeichen
  D17C    D3 B1          C      	out	(ptast+11h),a
  D17E    DB B1          C      	in	a,(ptast+11h)
  D180    CB 47          C      	bit	0,a
  D182    28 F7          C      	jr	z,ri.ch1
  D184    DB B0          C      	in	a,(ptast+10h)	;Eingabezeichen einlesen
  D186    E1             C      	pop	hl
  D187    C1             C      	pop	bc
  D188    C9             C      	ret
                         C      ;
                         C      ;
                         C      ;
  D189                   C      ri2.ch::			;ATS-Kanal B (Aktiv)
  D189    C5             C      	push	bc
  D18A    E5             C      	push	hl
                         C      	rept	4		;SIO-Empfangspuffer leeren
                         C      	in	a,(ptast+12h)
                         C      	endm
  D18B    DB B2          C+     	in	a,(ptast+12h)
  D18D    DB B2          C+     	in	a,(ptast+12h)
  D18F    DB B2          C+     	in	a,(ptast+12h)
  D191    DB B2          C+     	in	a,(ptast+12h)
  D193    3E 10          C      	ld	a,010h		;Bereitschaftszeichen ausgeben
  D195    D3 B2          C      	out	(ptast+12h),a
  D197    AF             C      ri.ch2:	xor	a		;warten auf Eingabezeichen
  D198    D3 B3          C      	out	(ptast+13h),a
  D19A    DB B3          C      	in	a,(ptast+13h)
  D19C    CB 47          C      	bit	0,a
  D19E    28 F7          C      	jr	z,ri.ch2
  D1A0    DB B2          C      	in	a,(ptast+12h)	;Eingabezeichen einlesen
  D1A2    E1             C      	pop	hl
  D1A3    C1             C      	pop	bc
  D1A4    C9             C      	ret
                         C      ;
                         C      ;
                         C      ;
  D1A5                   C      ri.ata::
  D1A5    21 D1DE        C      	ld	hl,ri.siot	;SIO initialisieren
  D1A8    06 09          C      	ld	b,9
  D1AA    0E B1          C      	ld	c,ptast+11h
  D1AC    ED B3          C      	otir
  D1AE    06 02          C      	ld	b,2		;CTC initialisieren
  D1B0    0E B8          C      	ld	c,ptast+18h
  D1B2    ED B3          C      	otir
  D1B4    21 D1E7        C      	ld	hl,ri.ctct
  D1B7    06 02          C      	ld	b,2
  D1B9    0E B9          C      	ld	c,ptast+19h
  D1BB    ED B3          C      	otir
                         C      	rept	4		;SIO-Empfangspuffer leeren
                         C      	in	a,(ptast+10h)
                         C      	endm
  D1BD    DB B0          C+     	in	a,(ptast+10h)
  D1BF    DB B0          C+     	in	a,(ptast+10h)
  D1C1    DB B0          C+     	in	a,(ptast+10h)
  D1C3    DB B0          C+     	in	a,(ptast+10h)
  D1C5    C9             C      	ret
                         C      ;
  D1C6                   C      ri.atb::
  D1C6    21 D1DE        C      	ld	hl,ri.siot	;SIO initialisieren
  D1C9    06 09          C      	ld	b,9
  D1CB    0E 13          C      	ld	c,13h
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-32


  D1CD    ED B3          C      	otir
  D1CF    06 02          C      	ld	b,2		;CTC initialisieren
  D1D1    0E BA          C      	ld	c,ptast+1ah
  D1D3    ED B3          C      	otir
                         C      	rept	4		;SIO-Empfangspuffer leeren
                         C      	in	a,(ptast+12h)
                         C      	endm
  D1D5    DB B2          C+     	in	a,(ptast+12h)
  D1D7    DB B2          C+     	in	a,(ptast+12h)
  D1D9    DB B2          C+     	in	a,(ptast+12h)
  D1DB    DB B2          C+     	in	a,(ptast+12h)
  D1DD    C9             C      	ret
                         C      ;
  D1DE    D0 04 44 01    C      ri.siot:db	0d0h,4,44h,1,0,3,0c1h,35h,68h
  D1E2    00 03 C1 35    C      
  D1E6    68             C      
  D1E7    07 01          C      ri.ctct:db	7,1
                         C      ;
                         C      ;
                         C       else
                         C      ri1.ch::
                         C      ri2.ch::
                         C      	ld	a,01ah
                         C      	ret
                         C       endif
                         C      ;
                                
                                
                                
                         C      	include	PU.ASM
                         C      ; lochbandstanzerbedienung ueber  DEG2000 Version 1.2  ---  EPROM 70
                         C      ; ------------------------------------------------------------------
                         C      ;
                         C       if tap
  D1E9    DD E5          C      pu.ch::	push	ix
                         C      	set12
  D1EB    ED 73 E306     C+     	ld	(stkret),sp
  D1EF    31 E304        C+     	ld	sp,stk12
  D1F2    CD C749        C+     	call	uset12
  D1F5    DD 21 0F83     C      	ld	ix,ealbs+3
  D1F9    CD 7003        C      	call	lbs
                         C      	res12
  D1FC    CD C73A        C+     	call	ures12
  D1FF    ED 7B E306     C+     	ld	sp,(stkret)
  D203    DD E1          C      	pop	ix
  D205    C9             C      	ret
                         C       else
                         C      pu.ch::	ret
                         C       endif
                         C      ;
                         C      ; S I O -  uebertragung ueber ATS
                         C      ; -------------------------------
                         C      ;
                         C       if eq.sio ne 0
  D206                   C      pu1.ch::			;ATS-Kanal A (Passiv)
  D206    F5             C      	push	af
  D207    AF             C      pu.ch1:	xor	a		;warten auf Bereitschaftszeichen
  D208    D3 B1          C      	out	(ptast+11h),a
  D20A    DB B1          C      	in	a,(ptast+11h)
  D20C    CB 47          C      	bit	0,a
  D20E    28 F7          C      	jr	z,pu.ch1
  D210    DB B0          C      	in	a,(ptast+10h)
  D212    FE 10          C      	cp	010h
  D214    20 F1          C      	jr	nz,pu.ch1
  D216    79             C      	ld	a,c		;Ausgabezeichen ausgeben
  D217    D3 B0          C      	out	(ptast+10h),a
  D219    F1             C      	pop	af
  D21A    C9             C      	ret
                         C      ;
                         C      ;
                         C      ;
  D21B                   C      pu2.ch::			;ATS-Kanal B (Aktiv)
  D21B    F5             C      	push	af
  D21C    AF             C      pu.ch2:	xor	a		;warten auf Bereitschaftszeichen
  D21D    D3 B3          C      	out	(ptast+13h),a
  D21F    DB B3          C      	in	a,(ptast+13h)
  D221    CB 47          C      	bit	0,a
  D223    28 F7          C      	jr	z,pu.ch2
  D225    DB B2          C      	in	a,(ptast+12h)
  D227    FE 10          C      	cp	10h
  D229    20 F1          C      	jr	nz,pu.ch2
  D22B    79             C      	ld	a,c		;Ausgabezeichen ausgeben
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-33


  D22C    D3 B2          C      	out	(ptast+12h),a
  D22E    F1             C      	pop	af
  D22F    C9             C      	ret
                         C      ;
                         C      ;
                         C       else
                         C      pu1.ch::
                         C      pu2.ch::
                         C      	ret
                         C       endif
                         C      ;
                                
                                
                                
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-34


                                
                                ; read/write hilfsroutinen
                                ; ------------------------
                                ;
  D230    ED 43 E08A            setse::	ld	(sec),bc	; set sector
  D234    C9                    	ret
                                ;
  D235    CD C700               home::	call	reta		; head home
  D238    01 0000               	ld	bc,0
  D23B    CD D25C               	call	settr
  D23E    CD D287               	call	setix
  D241    28 16                 	jr	z,home1		; -> geraet nicht vorhanden
  D243    DD 7E FB              	ld	a,(ix-isblk)	; arbeitet geraet mit blockung?
  D246    B7                    	or	a
  D247    28 10                 	jr	z,home1		; -> nein
  D249    DD 7E 17              	ld	a,(ix+hstact)	; ist hostbuffer aktiv?
  D24C    B7                    	or	a
  D24D    28 0A                 	jr	z,home1		; -> nein
  D24F    DD 7E 18              	ld	a,(ix+hstwrt)	; wurde in hostbuffer geschrieben?
  D252    B7                    	or	a
  D253    20 04                 	jr	nz,home1	; -> ja
  D255    DD 36 17 00           	ld	(ix+hstact),0	; flush hostbuffer
  D259    C3 C708               home1::	jp	retu
                                ;
  D25C    ED 43 E088            settr::	ld	(trk),bc	; set track
  D260    C9                    	ret
                                ;
  D261    ED 43 E086            setdm::	ld	(dma),bc	; set memory address
  D265    C9                    	ret
                                ;
  D266    79                    selds::	ld	a,c		; select disk
  D267    C5                    	push	bc
  D268    32 E08C               	ld	(dev),a
  D26B    87                    	add	a,a
  D26C    4F                    	ld	c,a
  D26D    06 00                 	ld	b,0
  D26F    21 E066               	ld	hl,dpha
  D272    09                    	add	hl,bc
  D273    7E                    	ld	a,(hl)
  D274    23                    	inc	hl
  D275    66                    	ld	h,(hl)
  D276    6F                    	ld	l,a
  D277    C1                    	pop	bc
  D278    C9                    	ret
                                ;
  D279    7A                    sectr::	ld	a,d		; translate sector
  D27A    B3                    	or	e		; wenn de=0, dann keine transformation
  D27B    28 06                 	jr	z,sectr1
  D27D    EB                    	ex	de,hl
  D27E    09                    	add	hl,bc
  D27F    6E                    	ld	l,(hl)
  D280    26 00                 	ld	h,0
  D282    C9                    	ret
  D283    60                    sectr1::ld	h,b
  D284    69                    	ld	l,c
  D285    23                    	inc	hl
  D286    C9                    	ret
                                ;
  D287    3A E08C               setix::	ld	a,(dev)		; e/a-tabellenadresse nach ix laden
  D28A    5F                    	ld	e,a
  D28B    16 00                 	ld	d,0
  D28D    21 DFC6               	ld	hl,ixtab
  D290    19                    	add	hl,de
  D291    19                    	add	hl,de
  D292    5E                    	ld	e,(hl)
  D293    23                    	inc	hl
  D294    56                    	ld	d,(hl)
  D295    7B                    	ld	a,e
  D296    B2                    	or	d
  D297    C8                    	ret	z		; -> geraet nicht vorhanden
  D298    D5                    	push	de
  D299    DD E1                 	pop	ix
  D29B    C9                    	ret
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-35


                                
                                ; massespeicher lesen/schreiben
                                ; -----------------------------
                                ;
                                ; aufteilung auf die physischen geraete
                                ;
  D29C    CD C700               write::	call	reta
  D29F    CD D287               	call	setix
  D2A2    28 0B                 	jr	z,wr15
  D2A4    DD 6E FE              	ld	l,(ix-ixwr)
  D2A7    DD 66 FF              	ld	h,(ix-ixwr+1)
  D2AA    CD DC73               	call	callhl		; writeroutine aufrufen
  D2AD    18 02                 	jr	wr16
                                ;
  D2AF    3E 01                 wr15::	ld	a,1		; fehler: falsches geraet
  D2B1    C3 C708               wr16::	jp	retu
                                ;
                                ;----------------------------------------------------------------------
                                ;
  D2B4    CD C700               read::	call	reta
  D2B7    CD D287               	call	setix
  D2BA    28 F3                 	jr	z,wr15		; -> geraet nicht vorhanden
  D2BC    DD 6E FC              	ld	l,(ix-ixrd)
  D2BF    DD 66 FD              	ld	h,(ix-ixrd+1)
  D2C2    CD DC73               	call	callhl		; readroutine aufrufen
  D2C5    18 EA                 	jr	wr16
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-36


                                
                                ; lesen / schreiben im tpa-disk
                                ;
  D2C7    3A 0042               wrmem::	ld	a,(simsiz)
  D2CA    B7                    	or	a
  D2CB    28 21                 	jr	z,wrmem0	; -> kein sim.disk
  D2CD    CD D2FE               	call	hsadr		; hs-adresse des simulierten floppy-sektors
  D2D0    38 1C                 	jr	c,m05
  D2D2    EB                    	ex	de,hl
  D2D3    2A E086               	ld	hl,(dma)
  D2D6    01 0080               m04::	ld	bc,80h		; vom sim.disk in den hs uebertragen
  D2D9    ED B0                 m041::	ldir
  D2DB    AF                    	xor	a
  D2DC    C9                    	ret
  D2DD    3A 0042               rdmem::	ld	a,(simsiz)
  D2E0    B7                    	or	a
  D2E1    28 0E                 	jr	z,rdmem0	; -> keim sim.disk
  D2E3    CD D2FE               	call	hsadr
  D2E6    38 06                 	jr	c,m05
  D2E8    ED 5B E086            	ld	de,(dma)
  D2EC    18 E8                 	jr	m04
  D2EE                          m05:
  D2EE    3E 01                 wrmem0::ld	a,1
  D2F0    C9                    	ret			; schreibfehler
  D2F1    2A E086               rdmem0::ld	hl,(dma)
  D2F4    5D                    	ld	e,l
  D2F5    54                    	ld	d,h
  D2F6    13                    	inc	de
  D2F7    36 E5                 	ld	(hl),0e5h
  D2F9    01 007F               	ld	bc,127
  D2FC    18 DB                 	jr	m041
                                ;
  D2FE    ED 5B E088            hsadr::	ld	de,(trk)
  D302    21 0000               	ld	hl,0
  D305    06 1A                 	ld	b,26
  D307    19                    hsad1::	add	hl,de
  D308    10 FD                 	djnz	hsad1
  D30A    ED 4B E08A            	ld	bc,(sec)
  D30E    09                    	add	hl,bc
  D30F    29                    	add	hl,hl
  D310    29                    	add	hl,hl
  D311    29                    	add	hl,hl
  D312    29                    	add	hl,hl
  D313    29                    	add	hl,hl
  D314    29                    	add	hl,hl
  D315    29                    	add	hl,hl		; hl := 128*(26*trk+sec)
  D316    3A 0042               	ld	a,(simsiz)
  D319    87                    	add	a,a
  D31A    87                    	add	a,a
  D31B    ED 44                 	neg
  D31D    47                    	ld	b,a
  D31E    0E 00                 	ld	c,0		; bc := - simsiz*1024
  D320    09                    	add	hl,bc
  D321    01 AF80               	ld	bc,simad-80h
  D324    09                    	add	hl,bc
  D325    3E AF                 	ld	a,0+(high simad)-1 ; simulierter disk bis max. simad-1
  D327    BC                    	cp	h
  D328    C9                    	ret
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-37


                                
                         C      	include	KR.ASM
                         C      ; lesen / schreiben kassetten geblockt
                         C      ;
                         C      ; schreiben
                         C      ; +++++++++
                         C      ;
  D329    DD 7E 1D       C      wrkmb::	ld	a,(ix+gelade)	; test, ob kassette noch geladen ist
  D32C    B7             C      	or	a
  D32D    28 2D          C      	jr	z,wrk02		; -> nein
  D32F    3A E088        C      	ld	a,(trk)
  D332    B7             C      	or	a
  D333    C2 DB1F        C      	jp	nz,block	; -> nicht nach dir im hs schreiben
                         C      ;
  D336    CD D40B        C      	call	diradr
  D339    EB             C      	ex	de,hl		; in dpuf schreiben
  D33A    2A E086        C      	ld	hl,(dma)
  D33D    DD 36 0F 01    C      	ld	(ix+eadzei),1	; es wurde in directory geschrieben
  D341    06 80          C      	ld	b,128
  D343    7E             C      wrk01::	ld	a,(hl)
                         C      	set12
  D344    ED 73 E306     C+     	ld	(stkret),sp
  D348    31 E304        C+     	ld	sp,stk12
  D34B    CD C749        C+     	call	uset12
  D34E    12             C      	ld	(de),a
                         C      	res12
  D34F    CD C73A        C+     	call	ures12
  D352    ED 7B E306     C+     	ld	sp,(stkret)
  D356    23             C      	inc 	hl
  D357    13             C      	inc	de
  D358    10 E9          C      	djnz	wrk01
  D35A    AF             C      	xor	a
  D35B    C9             C      	ret
                         C      ;
  D35C    AF             C      wrk02::	xor	a
  D35D    3C             C      	inc	a
  D35E    C9             C      	ret
                         C      ;
  D35F    CD D3FE        C      hwrkmb::call	cposx
  D362    20 F8          C      	jr	nz,wrk02	; -> fehler melden
  D364    DD 36 09 01    C      	ld	(ix+ealen),1
  D368    DD 36 0A 00    C      	ld	(ix+ealen+1),0
  D36C    DD 7E 12       C      	ld	a,(ix+hstbuf)
  D36F    DD 77 07       C      	ld	(ix+eaadr),a
  D372    DD 7E 13       C      	ld	a,(ix+hstbuf+1)
  D375    DD 77 08       C      	ld	(ix+eaadr+1),a
                         C       if kmbvers eq 13
                         C      	ld	a,80h		; schreiben ohne fehlerwiederholung
                         C       else
  D378    3E 00          C      	ld	a,0		; schreiben mit fehlerwiederholung
                         C       endif
  D37A    CD D6E3        C      	call	kmb
  D37D    C8             C      	ret	z		; -> alles ok
  D37E    3A E091        C      	ld	a,(rderr)	; weiterer versuch?
  D381    3D             C      	dec	a
  D382    32 E091        C      	ld	(rderr),a
  D385    20 D8          C      	jr	nz,hwrkmb
  D387    18 D3          C      	jr	wrk02		; -> nein
                         C      ;
                         C      	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-38


                         C      
                         C      ; lesen
                         C      ; +++++
                         C      ;
  D389    DD 7E 1D       C      rdkmb::	ld	a,(ix+gelade)	; test, ob kassette noch geladen ist
  D38C    B7             C      	or	a
  D38D    28 CD          C      	jr	z,wrk02
  D38F    3A E088        C      	ld	a,(trk)
  D392    B7             C      	or	a
  D393    C2 DB13        C      	jp	nz,deblck	; -> nicht aus hs lesen
  D396    ED 5B E086     C      	ld	de,(dma)	; aus dpuf lesen
  D39A    CD D40B        C      	call	diradr
  D39D    06 80          C      	ld	b,128
  D39F                   C      rdk01::	set12
  D39F    ED 73 E306     C+     	ld	(stkret),sp
  D3A3    31 E304        C+     	ld	sp,stk12
  D3A6    CD C749        C+     	call	uset12
  D3A9    7E             C      	ld	a,(hl)
                         C      	res12
  D3AA    CD C73A        C+     	call	ures12
  D3AD    ED 7B E306     C+     	ld	sp,(stkret)
  D3B1    12             C      	ld	(de),a
  D3B2    23             C      	inc	hl
  D3B3    13             C      	inc	de
  D3B4    10 E9          C      	djnz	rdk01
  D3B6    AF             C      	xor	a
  D3B7    C9             C      	ret
                         C      ;
  D3B8    CD D3FE        C      hrdkmb::call	cposx
  D3BB    20 0E          C      	jr	nz,rdk03	; -> fehler melden
  D3BD    CD D53E        C      	call	lesen
  D3C0    28 0C          C      	jr	z,rdk04
  D3C2    3A E091        C      rdk02::	ld	a,(rderr)	; weitere versuch?
  D3C5    3D             C      	dec	a
  D3C6    32 E091        C      	ld	(rderr),a
  D3C9    20 ED          C      	jr	nz,hrdkmb	; -> ja
  D3CB    AF             C      rdk03::	xor	a		; fehler melden
  D3CC    3C             C      	inc	a
  D3CD    C9             C      	ret
  D3CE    DD 7E 09       C      rdk04::	ld	a,(ix+ealen)
  D3D1    FE 01          C      	cp	1
  D3D3    20 ED          C      	jr	nz,rdk02
  D3D5    47             C      	ld	b,a
  D3D6    DD 7E 0A       C      	ld	a,(ix+ealen+1)
  D3D9    B7             C      	or	a
  D3DA    20 E6          C      	jr	nz,rdk02
  D3DC    4F             C      	ld	c,a
  D3DD    DD 6E 07       C      	ld	l,(ix+eaadr)
  D3E0    DD 66 08       C      	ld	h,(ix+eaadr+1)
  D3E3    DD 5E 12       C      	ld	e,(ix+hstbuf)
  D3E6    DD 56 13       C      	ld	d,(ix+hstbuf+1)
                         C      	set12
  D3E9    ED 73 E306     C+     	ld	(stkret),sp
  D3ED    31 E304        C+     	ld	sp,stk12
  D3F0    CD C749        C+     	call	uset12
  D3F3    ED B0          C      	ldir
                         C      	res12
  D3F5    CD C73A        C+     	call	ures12
  D3F8    ED 7B E306     C+     	ld	sp,(stkret)
  D3FC    AF             C      	xor	a
  D3FD    C9             C      	ret
                         C      ;
                         C      	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-39


                         C      
                         C      ; unterprogramme lesen/schreiben
                         C      ; ++++++++++++++++++++++++++++++
                         C      ;
  D3FE    DD 6E 16       C      cposx::	ld	l,(ix+hstsec)
  D401    DD 66 14       C      	ld	h,(ix+hsttrk)
  D404    22 D723        C      	ld	(was),hl
  D407    CD D5AD        C      	call	cpos
  D40A    C9             C      	ret
                         C      ;
                         C      ;----------------------------------------------------------------------
                         C      ;
  D40B    3A E088        C      diradr::ld	a,(trk)		; in hl diradr bilden
  D40E    6F             C      	ld	l,a
  D40F    26 00          C      	ld	h,0
  D411    29             C      	add	hl,hl
  D412    29             C      	add	hl,hl
  D413    29             C      	add	hl,hl
  D414    29             C      	add	hl,hl		; 16*trk
  D415    ED 4B E08A     C      	ld	bc,(sec)
  D419    0B             C      	dec	bc
  D41A    09             C      	add	hl,bc		; 16*trk + sec - 1
  D41B    29             C      	add	hl,hl
  D41C    29             C      	add	hl,hl
  D41D    29             C      	add	hl,hl
  D41E    29             C      	add	hl,hl
  D41F    29             C      	add	hl,hl
  D420    29             C      	add	hl,hl
  D421    29             C      	add	hl,hl
  D422    DD 4E 0D       C      	ld	c,(ix+eadpuf)	; bc = dpuf
  D425    DD 46 0E       C      	ld	b,(ix+eadpuf+1)
  D428    09             C      	add	hl,bc
  D429    C9             C      	ret
                         C      ;
                         C      	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-40


                         C      
                         C      ;   kassettenroutinen   laden / entladen / positionieren
                         C      ;   ----------------------------------------------------
                         C      ;
                         C      ; kassette laden geblockt
                         C      ; +++++++++++++++++++++++
                         C      ;
  D42A    3E 31          C      clad::	ld	a,31h		; reservieren ein
  D42C    CD D6E3        C      	call	kmb
  D42F    DD CB 00 66    C      	bit	4,(ix+eastat)
  D433    20 47          C      	jr	nz,sp26
                         C      ;
  D435    CD D514        C      	call	rucksp		; rueckspulen
  D438    CD D51C        C      	call	endruc		; auf ende warten
                         C      ;
  D43B    CD D596        C      	call	filpar
  D43E    D5             C      sp21::	push	de		; dirpufferadresse
  D43F    CD DC5C        C      	call	readhst		; 8 mal 256 byte lesen
  D442    D1             C      	pop	de
  D443    20 34          C      	jr	nz,sp25		; -> fehler
  D445    DD 6E 12       C      	ld	l,(ix+hstbuf)
  D448    DD 66 13       C      	ld	h,(ix+hstbuf+1)
  D44B    01 0100        C      	ld	bc,256
                         C      	set12
  D44E    ED 73 E306     C+     	ld	(stkret),sp
  D452    31 E304        C+     	ld	sp,stk12
  D455    CD C749        C+     	call	uset12
  D458    ED B0          C      	ldir			; von hostbuf auf cpu in dirbuf uebertr.
                         C      	res12
  D45A    CD C73A        C+     	call	ures12
  D45D    ED 7B E306     C+     	ld	sp,(stkret)
  D461    DD 34 16       C      	inc	(ix+hstsec)
  D464    DD CB 16 5E    C      	bit	3,(ix+hstsec)	; 0/8 schon erreicht?
  D468    28 D4          C      	jr	z,sp21		; -> nein
                         C      ;
  D46A    AF             C      	xor	a		; laden ok
  D46B    DD 77 0F       C      	ld	(ix+eadzei),a	; in directory wurde noch nicht geschrieben
  D46E    DD 77 17       C      	ld	(ix+hstact),a	; host buffer inactive
  D471    DD 77 19       C      	ld	(ix+unacnt),a	; no unallocated recs
  D474    DD 36 1D 01    C      	ld	(ix+gelade),1	; kassette ist geladen
  D478    C9             C      	ret
                         C      ;
                         C      ;--------------------------------
                         C      ;
  D479    CD D514        C      sp25::	call	rucksp		; fehler beim laden
  D47C    3E 41          C      sp26::	ld	a,41h		; reservieren aus
  D47E    CD D6E3        C      	call	kmb
  D481    AF             C      	xor	a
  D482    DD 77 1D       C      	ld	(ix+gelade),a	; kassette ist nicht geladen
  D485    3C             C      	inc	a
  D486    C9             C      	ret
                         C      ;
                         C      	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-41


                         C      
                         C      ; kassette entladen geblockt
                         C      ; ++++++++++++++++++++++++++
                         C      ;
  D487    DD 7E 17       C      centl::	ld	a,(ix+hstact)	; ist puffer aktiv?
  D48A    B7             C      	or	a
  D48B    28 1B          C      	jr	z,sp301		; -> nein
  D48D    DD 7E 18       C      	ld	a,(ix+hstwrt)	; wurde in puffer geschrieben?
  D490    B7             C      	or	a
  D491    28 15          C      	jr	z,sp301
  D493    CD DC4F        C      	call	writehst	; ja, puffer entleeren
  D496    28 10          C      	jr	z,sp301
  D498    21 D4F1        C      	ld	hl,ceerro
  D49B    06 23          C      	ld	b,ceerre-ceerro
  D49D    C5             C      centle::push	bc
  D49E    4E             C      	ld	c,(hl)
  D49F    23             C      	inc	hl
  D4A0    E5             C      	push	hl
  D4A1    CD CD7E        C      	call	co.ch
  D4A4    E1             C      	pop	hl
  D4A5    C1             C      	pop	bc
  D4A6    10 F5          C      	djnz	centle
  D4A8    DD 7E 0F       C      sp301::	ld	a,(ix+eadzei)	; wurde directory veraendert?
  D4AB    B7             C      	or	a
  D4AC    28 36          C      	jr	z,sp32		; -> nein
  D4AE    CD D514        C      	call	rucksp		; rueckspulen
  D4B1    CD D51C        C      	call	endruc		; auf ende warten
  D4B4    CD D596        C      	call	filpar
  D4B7    EB             C      	ex	de,hl		; dirpufferadresse
  D4B8    DD 5E 12       C      sp31::	ld	e,(ix+hstbuf)	; aus dirpuffer in host buffer uebertragen
  D4BB    DD 56 13       C      	ld	d,(ix+hstbuf+1)
  D4BE    01 0100        C      	ld	bc,256
                         C      	set12
  D4C1    ED 73 E306     C+     	ld	(stkret),sp
  D4C5    31 E304        C+     	ld	sp,stk12
  D4C8    CD C749        C+     	call	uset12
  D4CB    ED B0          C      	ldir			; aus dirbuf in hostbuf auf cpu uebertragen
                         C      	res12
  D4CD    CD C73A        C+     	call	ures12
  D4D0    ED 7B E306     C+     	ld	sp,(stkret)
  D4D4    E5             C      	push	hl
  D4D5    CD DC4F        C      	call	writehst
  D4D8    E1             C      	pop	hl
  D4D9    20 9E          C      	jr	nz,sp25		; -> fehler
  D4DB    DD 34 16       C      	inc	(ix+hstsec)
  D4DE    DD CB 16 5E    C      	bit	3,(ix+hstsec)	; 0/8 erreicht?
  D4E2    28 D4          C      	jr	z,sp31		; -> nein
                         C      ;
  D4E4    CD D514        C      sp32::	call	rucksp		; rueckspulen
  D4E7    3E 41          C      	ld	a,41h		; reservieren aus
  D4E9    CD D6E3        C      	call	kmb
  D4EC    DD 36 1D 00    C      	ld	(ix+gelade),0	; kassette ist nicht geladen
  D4F0    C9             C      	ret
                         C      ;
  D4F1    0A 46 65 68    C      ceerro::defb	lf,'Fehler beim Entladen des Puffers',cr,lf
  D4F5    6C 65 72 20    C      
  D4F9    62 65 69 6D    C      
  D4FD    20 45 6E 74    C      
  D501    6C 61 64 65    C      
  D505    6E 20 64 65    C      
  D509    73 20 50 75    C      
  D50D    66 66 65 72    C      
  D511    73 0D 0A       C      
  D514                   C      ceerre::
                         C      	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-42


                         C      
                         C      ; up's
                         C      ; ++++
                         C      ;
  D514    3E 21          C      rucksp::ld	a,21h
  D516    CD D6E3        C      	call	kmb
  D519    20 F9          C      	jr	nz,rucksp
  D51B    C9             C      	ret
  D51C                   C      endruc::setkmb 
  D51C    ED 73 E306     C+     	ld	(stkret),sp
  D520    31 E304        C+     	ld	sp,stk12
  D523    CD C749        C+     	call	uset12
  D526    F5             C+     	push	af
  D527    AF             C+     	xor	a
  D528    ED 47          C+     	ld	i,a
  D52A    F1             C+     	pop	af
  D52B    CD 46AD        C      edruc:	call	kmbruc		; kmb-bereitroutine
  D52E    38 FB          C      	jr	c,edruc		; -> nicht bereit
                         C      	reskmb
  D530    F5             C+     	push	af
  D531    3E C6          C+     	ld	a,high biosan
  D533    ED 47          C+     	ld	i,a
  D535    F1             C+     	pop	af
  D536    CD C73A        C+     	call	ures12
  D539    ED 7B E306     C+     	ld	sp,(stkret)
  D53D    C9             C      	ret
  D53E    AF             C      lesen::	xor	a
  D53F    32 D728        C      	ld	(richtu),a
                         C       if kmbvers eq 13
                         C      	ld	a,82h		; lesen ohne fehlerwiederholung
                         C       else
  D542    3E 02          C      	ld	a,2
                         C       endif
  D544    CD D6E3        C      	call	kmb
  D547    C9             C      	ret
  D548    DD 7E 09       C      konlen::ld	a,(ix+ealen)
  D54B    B8             C      	cp	b
  D54C    C0             C      	ret	nz
  D54D    DD 7E 0A       C      	ld	a,(ix+ealen+1)
  D550    B9             C      	cp	c
  D551    C9             C      	ret
  D552    C5             C      konsent::push	bc
  D553    01 000C        C      	ld	bc,12
  D556    CD D548        C      	call	konlen
  D559    C1             C      	pop	bc
  D55A    C0             C      	ret	nz
  D55B    E5             C      	push	hl
  D55C    DD 6E 07       C      	ld	l,(ix+eaadr)	; iy := (adr)
  D55F    DD 66 08       C      	ld	h,(ix+eaadr+1)
  D562    22 D726        C      	ld	(arb),hl
  D565    FD 2A D726     C      	ld	iy,(arb)
  D569    E1             C      	pop	hl
                         C      	set12
  D56A    ED 73 E306     C+     	ld	(stkret),sp
  D56E    31 E304        C+     	ld	sp,stk12
  D571    CD C749        C+     	call	uset12
  D574    FD 7E 01       C      	ld	a,(iy+1)
                         C      	res12
  D577    CD C73A        C+     	call	ures12
  D57A    ED 7B E306     C+     	ld	sp,(stkret)
  D57E    BA             C      	cp	d
  D57F    C0             C      	ret	nz
                         C      	set12
  D580    ED 73 E306     C+     	ld	(stkret),sp
  D584    31 E304        C+     	ld	sp,stk12
  D587    CD C749        C+     	call	uset12
  D58A    FD 7E 02       C      	ld	a,(iy+2)
                         C      	res12
  D58D    CD C73A        C+     	call	ures12
  D590    ED 7B E306     C+     	ld	sp,(stkret)
  D594    BB             C      	cp	e
  D595    C9             C      	ret
  D596    DD 36 16 00    C      filpar::ld	(ix+hstsec),0
  D59A    DD 36 14 00    C      	ld	(ix+hsttrk),0
  D59E    DD 36 10 00    C      	ld	(ix+eawovo),0
  D5A2    DD 36 11 00    C      	ld	(ix+eawovo+1),0
  D5A6    DD 5E 0D       C      	ld	e,(ix+eadpuf)
  D5A9    DD 56 0E       C      	ld	d,(ix+eadpuf+1)
  D5AC    C9             C      	ret
                         C      	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-43


                         C      
                         C      ; kassette positionieren
                         C      ; ++++++++++++++++++++++
                         C      ;
  D5AD    3E 04          C      cpos::	ld	a,erranz	; nach erranz fehlversuchen abbruch
  D5AF    32 D725        C      	ld	(errcou),a
                         C      ;
  D5B2    ED 4B D723     C      sp40::	ld	bc,(was)
  D5B6    DD 5E 10       C      	ld	e,(ix+eawovo)
  D5B9    DD 56 11       C      	ld	d,(ix+eawovo+1)
  D5BC    7B             C      	ld	a,e		; steht mb vor bandmarke?
  D5BD    FE 08          C      	cp	8
  D5BF    38 06          C      	jr	c,sp41
                         C      ;
  D5C1    CD D53E        C      	call	lesen		; ja
  D5C4    14             C      	inc	d
  D5C5    1E 00          C      	ld	e,0
                         C      ;
  D5C7    78             C      sp41::	ld	a,b
  D5C8    BA             C      	cp	d
  D5C9    20 4F          C      	jr	nz,sp45
  D5CB    79             C      	ld	a,c
  D5CC    BB             C      	cp	e
  D5CD    20 1F          C      	jr	nz,sp43
                         C      ;
                         C      ; === was = wovor
                         C      ;
  D5CF    CD D53E        C      	call	lesen
  D5D2    20 0E          C      	jr	nz,sp42		; -> fehler: beim lesen
  D5D4    CD D552        C      	call	konsent
  D5D7    20 09          C      	jr	nz,sp42		; -> fehler: mb stand an falscher stelle
                         C      ;
  D5D9    1C             C      	inc	e
  D5DA    DD 73 10       C      	ld	(ix+eawovo),e
  D5DD    DD 72 11       C      	ld	(ix+eawovo+1),d
  D5E0    AF             C      	xor	a
  D5E1    C9             C      	ret
                         C      ;
                         C      ;----------------
                         C      ;
  D5E2    CD D677        C      sp42::	call	fehler		; fehlerbehandlung
  D5E5    21 D725        C      	ld	hl,errcou	; nochmaliger versuch?
  D5E8    35             C      	dec	(hl)
  D5E9    20 C7          C      	jr	nz,sp40		; -> ja
                         C      ;
  D5EB    AF             C      	xor	a		; fehler zurueckmelden
  D5EC    3C             C      	inc	a
  D5ED    C9             C      	ret
                         C      ;
                         C      ;----------------
                         C      ;
  D5EE    79             C      sp43::	ld	a,c
  D5EF    BB             C      	cp	e
  D5F0    30 16          C      	jr	nc,sp44
                         C      ;
                         C      ; === was.blk = wovor.blk  and  was.rec < wovor.rec
                         C      ;
  D5F2    3E 01          C      	ld	a,1
  D5F4    32 D728        C      	ld	(richtu),a
  D5F7    3E 15          C      	ld	a,15h		; 2 bloecke ruecksetzen
  D5F9    CD D6E3        C      	call	kmb
  D5FC    20 E4          C      	jr	nz,sp42		; -> fehler: beim record ruecksetzen
  D5FE    3E 15          C      	ld	a,15h
  D600    CD D6E3        C      	call	kmb
  D603    20 DD          C      	jr	nz,sp42		; -> fehler: beim record ruecksetzen
  D605    1D             C      	dec	e		; wovor.rec := wovor.rec - 1
  D606    18 BF          C      	jr	sp41
                         C      ;
                         C      ;----------------
                         C      ;
                         C      ; === was.blk = wovor.blk  and  was.rec > wovor.rec
                         C      ;
  D608    CD D53E        C      sp44::	call	lesen
  D60B    20 D5          C      	jr	nz,sp42		; -> fehler: beim lesen
                         C      ;
  D60D    CD D552        C      	call	konsent
  D610    20 D0          C      	jr	nz,sp42		; -> fehler: mb stand an falscher stelle
                         C      ;
  D612    CD D53E        C      	call	lesen
  D615    20 CB          C      	jr	nz,sp42		; -> fehler: beim lesen
                         C      ;
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-44


  D617    1C             C      	inc	e		; wovor.rec := wovor.rec + 1
  D618    18 AD          C      	jr	sp41
                         C      ;
                         C      ;----------------
                         C      ;
  D61A    30 23          C      sp45::	jr	nc,sp46
                         C      ;
                         C      ; === was.blk < wovor.blk
                         C      ;
  D61C    7A             C      	ld	a,d
  D61D    90             C      	sub	b
  D61E    F5             C      	push	af
  D61F    3A D725        C      	ld	a,(errcou)	; falls nur noch erranz/2 Versuche ausstehen
  D622    FE 02          C      	cp	erranz/2	; um eine bandmarke mehr zuruecksetzen
  D624    38 03          C      	jr	c,sp451
  D626    F1             C      	pop	af
  D627    3C             C      	inc	a
  D628    F5             C      	push	af
  D629    F1             C      sp451::	pop	af		; evtl. bei bedarf inc a
  D62A    3C             C      	inc	a
  D62B    DD 77 0A       C      	ld	(ix+eabm),a	; (anzbm) := wovor - was + 1
  D62E    3E 01          C      	ld	a,1
  D630    32 D728        C      	ld	(richtu),a
  D633    3E 75          C      	ld	a,75h		; um wovor-was+1 bm ruecksetzen
  D635    CD D6E3        C      	call	kmb
  D638    20 A8          C      	jr	nz,sp42		; -> fehler: beim bm-ruecksetzen
                         C      ;
  D63A    50             C      	ld	d,b
  D63B    AF             C      	xor	a
  D63C    5F             C      	ld	e,a		; wovor := was.blk / 0
  D63D    18 88          C      	jr	sp41
                         C      ;
                         C      ;----------------
                         C      ;
  D63F    7A             C      sp46::	ld	a,d
  D640    3C             C      	inc	a
  D641    B8             C      	cp	b
  D642    20 15          C      	jr	nz,sp48
                         C      ;
                         C      ; === was.blk = wovor.blk+1
                         C      ;
  D644    CD D53E        C      sp47::	call	lesen
  D647    20 99          C      	jr	nz,sp42		; -> fehler: beim lesen
                         C      ;
  D649    C5             C      	push	bc
  D64A    01 0000        C      	ld	bc,0
  D64D    CD D548        C      	call	konlen
  D650    C1             C      	pop	bc
  D651    20 F1          C      	jr	nz,sp47		; -> keine bandmarke, weitermachen
                         C      ;
  D653    14             C      	inc	d
  D654    AF             C      	xor	a
  D655    5F             C      	ld	e,a		; wovor := wovor.blk+1 / 0
  D656    C3 D5C7        C      	jp	sp41
                         C      ;
                         C      ;----------------
                         C      ;
                         C      ; === was.blk > wovor.blk+1
                         C      ;
  D659    3A D725        C      sp48::	ld	a,(errcou)	; falls nur noch erranz/2 fehlversuche
  D65C    FE 02          C      	cp	erranz/2	; langsam vorpositionieren
  D65E    38 E4          C      	jr	c,sp47
  D660    78             C      	ld	a,b
  D661    92             C      	sub	d
  D662    DD 77 0A       C      	ld	(ix+eabm),a	; (anzbm) := was - wovor
  D665    AF             C      	xor	a
  D666    32 D728        C      	ld	(richtu),a
  D669    3E 71          C      	ld	a,71h		; um was-wovor bm vorsetzen
  D66B    CD D6E3        C      	call	kmb
  D66E    C2 D5E2        C      	jp	nz,sp42		; -> fehler: beim bm-vorsetzen
                         C      ;
  D671    50             C      	ld	d,b
  D672    AF             C      	xor	a
  D673    5F             C      	ld	e,a		; wovor := was.blk / 0
  D674    C3 D5C7        C      	jp	sp41
                         C      ;
                         C      ;----------------------------------------------------------------------
                         C      ;
  D677    3E 16          C      fehler::ld	a,16h		; fehlerbehandlung
  D679    DD BE 01       C      	cp	(ix+eafehl)	; ----------------
  D67C    20 21          C      	jr	nz,fehl01	; ende der aufzeichnungen auf dieser seite
  D67E    3A D728        C      	ld	a,(richtu)
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-45


  D681    B7             C      	or	a
  D682    28 12          C      	jr	z,fehl00
  D684    CD D514        C      	call	rucksp		; am anfang zur sicherheit ruckspulen
  D687    CD D51C        C      	call	endruc
  D68A    3E 41          C      	ld	a,41h		; reservieren aus
  D68C    CD D6E3        C      	call	kmb
  D68F    3E 31          C      	ld	a,31h		; reservieren ein
  D691    CD D6E3        C      	call	kmb
  D694    18 09          C      	jr	fehl01
  D696    06 10          C      fehl00::ld	b,10h		; um 16 saetze zuruecksetzen
  D698    3E 0F          C      fehl0a::ld	a,15
  D69A    CD D6E3        C      	call	kmb
  D69D    10 F9          C      	djnz	fehl0a
                         C      ;
  D69F    CD D53E        C      fehl01::call	lesen
  D6A2    20 D3          C      	jr	nz,fehler
  D6A4    01 000C        C      	ld	bc,12
  D6A7    CD D548        C      	call	konlen		;   solange lesen bis sent gefunden
  D6AA    20 CB          C      	jr	nz,fehler	;   dann vor sent setzen und wovor
                         C      ;
  D6AC    DD 6E 07       C      	ld	l,(ix+eaadr)	; iy := (adr)
  D6AF    DD 66 08       C      	ld	h,(ix+eaadr+1)
  D6B2    22 D726        C      	ld	(arb),hl
  D6B5    FD 2A D726     C      	ld	iy,(arb)
                         C      	set12
  D6B9    ED 73 E306     C+     	ld	(stkret),sp
  D6BD    31 E304        C+     	ld	sp,stk12
  D6C0    CD C749        C+     	call	uset12
  D6C3    FD 56 01       C      	ld	d,(iy+1)
  D6C6    FD 5E 02       C      	ld	e,(iy+2)
                         C      	res12
  D6C9    CD C73A        C+     	call	ures12
  D6CC    ED 7B E306     C+     	ld	sp,(stkret)
  D6D0    DD 73 10       C      	ld	(ix+eawovo),e
  D6D3    DD 72 11       C      	ld	(ix+eawovo+1),d
                         C      ;
  D6D6    3E 01          C      	ld	a,1
  D6D8    32 D728        C      	ld	(richtu),a
  D6DB    3E 15          C      	ld	a,15h
  D6DD    CD D6E3        C      	call	kmb		; einen record ruecksetzen
  D6E0    20 95          C      	jr	nz,fehler	; -> fehler: beim record ruecksetzen
  D6E2    C9             C      	ret
                         C      ;
                         C      ;----------------------------------------------------------------------
                         C      ;
  D6E3    DD 77 04       C      kmb::	ld	(ix+eakom),a	; (kom) := a
  D6E6    C5             C      	push	bc
  D6E7    D5             C      	push	de
  D6E8    E5             C      	push	hl
  D6E9    AF             C      	xor	a
  D6EA    32 D722        C      	ld	(kmwart),a
                         C      	setkmb
  D6ED    ED 73 E306     C+     	ld	(stkret),sp
  D6F1    31 E304        C+     	ld	sp,stk12
  D6F4    CD C749        C+     	call	uset12
  D6F7    F5             C+     	push	af
  D6F8    AF             C+     	xor	a
  D6F9    ED 47          C+     	ld	i,a
  D6FB    F1             C+     	pop	af
  D6FC    CD 4000        C      	call	kmbrob
  D6FF    3A D722        C      kmb01::	ld	a,(kmwart)
  D702    B7             C      	or	a
  D703    28 FA          C      	jr	z,kmb01
                         C      	reskmb
  D705    F5             C+     	push	af
  D706    3E C6          C+     	ld	a,high biosan
  D708    ED 47          C+     	ld	i,a
  D70A    F1             C+     	pop	af
  D70B    CD C73A        C+     	call	ures12
  D70E    ED 7B E306     C+     	ld	sp,(stkret)
                         C      ;
  D712    E1             C      kmb02::	pop	hl
  D713    D1             C      	pop	de
  D714    C1             C      	pop	bc
  D715    DD CB 00 7E    C      	bit	7,(ix+eastat)
  D719    C9             C      	ret
                         C      ;
  D71A    F5             C      kmbep::	push	af
  D71B    3E 01          C      	ld	a,1
  D71D    32 D722        C      	ld	(kmwart),a
  D720    F1             C      	pop	af
  D721    C9             C      	ret
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-46


                         C      ;
                         C      ;----------------------------------------------------------------------
                         C      ;
  D722    00             C      kmwart::defb	0		; 0 - kmb arbeitet noch; 1 - kmb fertig
  D723    0000           C      was::	defw	0
  D725    00             C      errcou::defb	0		; zaehler fuer fehlversuche
  D726    0000           C      arb::	defw	0
  D728    00             C      richtu::defb	0		; 0 - es wurde vorwaerts   gelesen
                         C      				; 1 - es wurde rueckwaerts gelesen
                         C      ;
                         C      ;
                         C      ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-47


                                
                                 if mindk or stadk
                                	include	FL.ASM
                                 endif
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-48


                                
                                 if zst or tramdk or opsdk
                         C      	include	MD.ASm
                         C      ; routinen fuer   1. zentralstation
                         C      ;                 2.      TRAM - Disk
                         C      ;                 3. 16k - OPS - Disk
                         C      ; -----------------------------------
                         C      ;
                         C       if opsdk
                         C      opsmac	macro
                         C      op1111::
                         C      	ld	(opssp1),sp
                         C      	ld	sp,opssp
                         C      	ld	hl,zsm
                         C      	ld	de,zsm+1
                         C      	ld	bc,7
                         C      	ld	(hl),0
                         C      	ldir
                         C      	out	(0c4h),a
                         C      	ld	a,00111100b
                         C      	out	(0c0h),a
                         C      	ld	hl,0c000h
                         C      	ld	d,01000011b
                         C      	ld	ix,zsm
                         C      	ld	b,8
                         C      ops1:	ld	a,d
                         C      	and	00011100b
                         C      	rrca
                         C      	rrca
                         C      	inc	a
                         C      	push	bc
                         C      	ld	b,a
                         C      	ld	a,10000000b
                         C      	rlca
                         C      	djnz	$-1
                         C      	pop	bc
                         C      	out	(0c2h),a
                         C      	ld	hl,0c000h
                         C      	ld	a,(hl)
                         C      	ld	c,a
                         C      	cpl
                         C      	ld	(hl),a
                         C      	cp	(hl)
                         C      	ld	a,c
                         C      	ld	(hl),a
                         C      	jr	nz,ops2
                         C      	ld	(ix+0),d
                         C      ops2:	ld	a,d
                         C      	add	a,4
                         C      	ld	d,a
                         C      	xor	a
                         C      	out	(0c2h),a
                         C      	inc	ix
                         C      	djnz	ops1
                         C      	xor	a
                         C      	out	(0c0h),a
                         C      	out	(0c3h),a
                         C      	ld	hl,zsm
                         C      	ld	bc,800h
                         C      ops3:	ld	a,(hl)
                         C      	or	a
                         C      	inc	hl
                         C      	jr	z,ops4
                         C      	inc	c
                         C      ops4:	djnz	ops3
                         C      	ld	a,c
                         C      	ld	sp,(opssp1)
                         C      	jp	ops13
                         C      
                         C      opszu:	push	bc
                         C      	push	hl
                         C      	ld	a,(trk)
                         C      	ld	b,a
                         C      	inc	b
                         C      	out	(0c4h),a
                         C      	ld	a,00110000b
                         C      	out	(0c0h),a
                         C      	ld	hl,zsm
                         C      opsz1:	ld	a,(hl)
                         C      	inc	hl
                         C      	or	a
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-49


                         C      	jr	z,opsz1
                         C      	djnz	opsz1
                         C      	dec	hl
                         C      	ld	a,(hl)
                         C      	and	00011100b
                         C      	rrca
                         C      	rrca
                         C      	inc	a
                         C      	ld	b,a
                         C      	ld	a,10000000b
                         C      	rlca
                         C      	djnz	$-1
                         C      	out	(0c2h),a
                         C      	pop	hl
                         C      	pop	bc
                         C      	ret
                         C      
                         C      opsab:	xor	a
                         C      	out	(0c2h),a
                         C      	out	(0c0h),a
                         C      	out	(0c3h),a
                         C      	ret
                         C      
                         C      inp1:	xor	a
                         C      	ld	(trk),a
                         C      	ld	(opssp1),sp
                         C      	ld	sp,opssp
                         C      	call	opszu
                         C      	ld	hl,0c000h
                         C      	ld	de,0c001h
                         C      	ld	bc,007ffh
                         C      	ld	(hl),0e5h
                         C      	ldir
                         C      	ld	hl,0c000h
                         C      	ld	de,0c001h
                         C      	ld	bc,01fh
                         C      	ld	(hl),0
                         C      	ldir
                         C      	ld	hl,opssp
                         C      	ld	de,0c000h
                         C      	ld	bc,12
                         C      	ldir
                         C      	call	opsab
                         C      	ld	sp,(opssp1)
                         C      	jp	inp9
                         C      
                         C      wro1:	ld	(opssp1),sp
                         C      	ld	sp,opssp
                         C      	push	hl
                         C      	ld	hl,trdma
                         C      	ld	de,opdma
                         C      	ld	bc,128
                         C      	ldir
                         C      	call	opszu
                         C      	ld	hl,opdma
                         C      	pop	de
                         C      	ld	bc,128
                         C      	ldir
                         C      	call	opsab
                         C      	ld	sp,(opssp1)
                         C      	jp	wro2
                         C      
                         C      rdo1:	ld	(opssp1),sp
                         C      	ld	sp,opssp
                         C      	call	opszu
                         C      	ld	de,opdma
                         C      	ld	bc,128
                         C      	ldir
                         C      	call	opsab
                         C      	ld	hl,opdma
                         C      	ld	de,trdma
                         C      	ld	bc,128
                         C      	ldir
                         C      	ld	sp,(opssp1)
                         C      	jp	rdo2
                         C      
                         C      zsm:	defs	8
                         C      opdma:	defs	128
                         C      opssp1:	defw	0
                         C      	defs	10h
                         C      opssp	equ	$
                         C      	endm
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-50


                         C       endif
                         C      ;
                         C      ;
                         C      ;
  D729                   C      md.kalt::
                         C       if tramdk
  D729    3E 28          C      	ld	a,28h
  D72B    32 D9FB        C      	ld	(tram),a
  D72E    AF             C      	xor	a
  D72F    32 D9FA        C      	ld	(ttanz),a
  D732    06 04          C      	ld	b,4
  D734    C5             C      mdk20:	push	bc
  D735    AF             C      	xor	a
  D736    CD D93B        C      	call	up11
  D739    CD D95D        C      	call	up21
  D73C    ED 73 E306     C      	ld	(stkret),sp
  D740    31 E304        C      	ld	sp,stk12
  D743    CD D990        C      	call	up2
  D746    21 4000        C      	ld	hl,04000h
  D749    7E             C      	ld	a,(hl)
  D74A    57             C      	ld	d,a
  D74B    2F             C      	cpl
  D74C    77             C      	ld	(hl),a
  D74D    BE             C      	cp	(hl)
  D74E    7A             C      	ld	a,d
  D74F    77             C      	ld	(hl),a
  D750    CD D9A7        C      	call	up3
  D753    ED 7B E306     C      	ld	sp,(stkret)
  D757    C1             C      	pop	bc
  D758    20 12          C      	jr	nz,mdk21
  D75A    3A D9FA        C      	ld	a,(ttanz)
  D75D    C6 04          C      	add	a,4
  D75F    32 D9FA        C      	ld	(ttanz),a
  D762    3A D9FB        C      	ld	a,(tram)
  D765    D6 08          C      	sub	8
  D767    32 D9FB        C      	ld	(tram),a
  D76A    10 C8          C      	djnz	mdk20
                         C      ;
  D76C    3A D9FA        C      mdk21:	ld	a,(ttanz)
  D76F    B7             C      	or	a
  D770    28 11          C      	jr	z,mdk22
  D772    26 00          C      	ld	h,0		; laufwerkskapazitaet bestimmen
  D774    6F             C      	ld	l,a
                         C      	rept	4
                         C      	add	hl,hl
                         C      	endm
  D775    29             C+     	add	hl,hl
  D776    29             C+     	add	hl,hl
  D777    29             C+     	add	hl,hl
  D778    29             C+     	add	hl,hl
  D779    2B             C      	dec	hl
U D77A    22 0005        C      	ld	(dpblko+5),hl
  D77D    21 E046        C      	ld	hl,dpho1	; laufwerk aktivieren
  D780    22 E082        C      	ld	(dpho),hl
  D783                   C      mdk22:
                         C       endif
                         C      
                         C       if opsdk
                         C      	set12
  D783    ED 73 E306     C+     	ld	(stkret),sp
  D787    31 E304        C+     	ld	sp,stk12
  D78A    CD C749        C+     	call	uset12
  D78D    21 E311        C      	ld	hl,biosxx
  D790    11 0C00        C      	ld	de,00c00h
  D793    01 01C2        C      	ld	bc,op12-op11
  D796    ED B0          C      	ldir
  D798    21 DCE2        C      	ld	hl,dirgo
  D79B    01 000C        C      	ld	bc,12
  D79E    ED B0          C      	ldir
  D7A0    C3 0C00        C      	jp	00c00h
                         C      
  D7A3                   C      ops13:	res12
  D7A3    CD C73A        C+     	call	ures12
  D7A6    ED 7B E306     C+     	ld	sp,(stkret)
  D7AA    32 DB12        C      	ld	(zsma),a
  D7AD    B7             C      	or	a
  D7AE    28 11          C      	jr	z,ops5
  D7B0    26 00          C      	ld	h,0
  D7B2    6F             C      	ld	l,a
                         C      	rept	4
                         C      	add	hl,hl
                         C      	endm
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-51


  D7B3    29             C+     	add	hl,hl
  D7B4    29             C+     	add	hl,hl
  D7B5    29             C+     	add	hl,hl
  D7B6    29             C+     	add	hl,hl
  D7B7    2B             C      	dec	hl
U D7B8    22 0005        C      	ld	(dpblkp+5),hl
  D7BB    21 E056        C      	ld	hl,dphp1
  D7BE    22 E084        C      	ld	(dphp),hl
  D7C1                   C      ops5:
                         C       endif
                         C      
                         C       if zst
  D7C1    CD D1A5        C      	call	ri.ata
  D7C4    AF             C      mdw3:	xor	a		; warten bis keine Daten mehr da
  D7C5    D3 B1          C      	out	(ptast+11h),a
  D7C7    DB B1          C      	in	a,(ptast+11h)
  D7C9    CB 47          C      	bit	0,a
  D7CB    28 04          C      	jr	z,mdw2
  D7CD    DB B0          C      	in	a,(ptast+10h)
  D7CF    18 F3          C      	jr	mdw3
  D7D1                   C      mdw2:
                         C       endif
                         C      
  D7D1                   C      md.warm::
                         C       if zst
  D7D1    AF             C      	xor	a
  D7D2    D3 B1          C      	out	(ptast+11h),a
  D7D4    DB B1          C      	in	a,(ptast+11h)
  D7D6    CB 47          C      	bit	0,a
  D7D8    28 36          C      	jr	z,mdw1
  D7DA    DB B0          C      	in	a,(ptast+10h)
  D7DC    FE 11          C      	cp	11h		; DC1
  D7DE    20 30          C      	jr	nz,mdw1
  D7E0    D3 B0          C      	out	(ptast+10h),a
  D7E2    21 0014        C      	ld	hl,00014h	; DC4 NUL
  D7E5    CD D820        C      	call	ldpuhl
  D7E8    CD D817        C      	call	ldhlri
  D7EB    CD D817        C      	call	ldhlri		; sec/trk
U D7EE    22 0000        C      	ld	(dpblkn),hl
  D7F1    CD D817        C      	call	ldhlri		; kapazitaet
U D7F4    22 0005        C      	ld	(dpblkn+5),hl
  D7F7    CD D817        C      	call	ldhlri		; anzahl_dir_entries
U D7FA    22 0007        C      	ld	(dpblkn+7),hl
  D7FD    CD D817        C      	call	ldhlri		; dir_bloecke
U D800    22 0009        C      	ld	(dpblkn+9),hl
  D803    CD D817        C      	call	ldhlri		; dir_entries_pruefen
U D806    22 000B        C      	ld	(dpblkn+11),hl
  D809    21 E036        C      	ld	hl,dphn1
  D80C    22 E080        C      	ld	(dphn),hl
  D80F    C9             C      	ret
  D810    21 0000        C      mdw1:	ld	hl,0
U D813    22 0005        C      	ld	(dpblkn+5),hl
  D816    C9             C      	ret
                         C      
  D817    CD D16D        C      ldhlri:	call	ri1.ch
  D81A    6F             C      	ld	l,a
  D81B    CD D16D        C      	call	ri1.ch
  D81E    67             C      	ld	h,a
  D81F    C9             C      	ret
  D820    4D             C      ldpuhl:	ld	c,l
  D821    CD D206        C      	call	pu1.ch
  D824    4C             C      	ld	c,h
  D825    CD D206        C      	call	pu1.ch
                         C       endif
                         C      
  D828    C9             C      	ret
                         C      ;
                         C      ; 1.  routinen fuer    Z e n t r a l s t a t i o n
                         C      ; ------------------------------------------------
                         C      ;
                         C       if zst
  D829                   C      wrzst::
U D829    2A 0005        C      	ld	hl,(dpblkn+5)
  D82C    7C             C      	ld	a,h
  D82D    B5             C      	or	l
  D82E    CA D2EE        C      	jp	z,wrmem0
  D831    3E 11          C      	ld	a,11h
  D833    D3 B0          C      	out	(ptast+10h),a
  D835    21 0112        C      	ld	hl,00112h	; DC2 01
  D838    CD D820        C      	call	ldpuhl
  D83B    2A E088        C      	ld	hl,(trk)	; trk
  D83E    CD D820        C      	call	ldpuhl
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-52


  D841    2A E08A        C      	ld	hl,(sec)	; sec
  D844    CD D820        C      	call	ldpuhl
  D847    CD D16D        C      wrz1:	call	ri1.ch		; DC2
  D84A    CD D16D        C      	call	ri1.ch		; Quittierung
                         C      				; = 1  ...  nicht verfuegbar
                         C      				; = 2  ...        verfuegbar
  D84D    FE 02          C      	cp	2
  D84F    DA D2EE        C      	jp	c,wrmem0
  D852    21 0212        C      	ld	hl,00212h	; DC2 02
  D855    CD D820        C      	call	ldpuhl
  D858    2A E086        C      	ld	hl,(dma)
  D85B    06 80          C      	ld	b,128
  D85D    4E             C      wrz2:	ld	c,(hl)
  D85E    23             C      	inc	hl
  D85F    CD D206        C      	call	pu1.ch
  D862    10 F9          C      	djnz	wrz2
  D864    AF             C      	xor	a
  D865    C9             C      	ret
                         C      
                         C      
  D866                   C      rdzst::
U D866    2A 0005        C      	ld	hl,(dpblkn+5)
  D869    7C             C      	ld	a,h
  D86A    B5             C      	or	l
  D86B    CA D2F1        C      	jp	z,rdmem0
  D86E    3E 11          C      	ld	a,11h		; DC1
  D870    D3 B0          C      	out	(ptast+10h),a
  D872    21 0113        C      	ld	hl,00113h	; DC3 01
  D875    CD D820        C      	call	ldpuhl
  D878    2A E088        C      	ld	hl,(trk)	; trk
  D87B    CD D820        C      	call	ldpuhl	
  D87E    2A E08A        C      	ld	hl,(sec)	; sec
  D881    CD D820        C      	call	ldpuhl
  D884    CD D16D        C      rdz1:	call	ri1.ch		; DC3
  D887    CD D16D        C      	call	ri1.ch		; Qittierung
                         C      				; = 1  ...  nicht verfuegbar
                         C      				; = 2  ...        verfuegbar; es folgen
                         C      				;           die Daten
  D88A    FE 02          C      	cp	2
  D88C    DA D2EE        C      	jp	c,wrmem0
  D88F    2A E086        C      	ld	hl,(dma)
  D892    06 80          C      	ld	b,128
  D894    CD D16D        C      rdz2:	call	ri1.ch
  D897    77             C      	ld	(hl),a
  D898    23             C      	inc	hl
  D899    10 F9          C      	djnz	rdz2
  D89B    AF             C      	xor	a
  D89C    C9             C      	ret
                         C       endif
                         C      ;
                         C      ; 2.  routinen fuer    T R A M   -   P s e u d o d i s k
                         C      ; ------------------------------------------------------
                         C      ;
                         C       if tramdk
  D89D                   C      wrtram::
  D89D    3A D9FA        C      	ld	a,(ttanz)	; trkanz > 0 ?
  D8A0    B7             C      	or	a
  D8A1    CA D2EE        C      	jp	z,wrmem0	; nein
  D8A4    CD D906        C      	call	tdadr
  D8A7    DA D2EE        C      	jp	c,wrmem0
  D8AA    ED 73 E306     C      	ld	(stkret),sp
  D8AE    31 E304        C      	ld	sp,stk12
  D8B1    E5             C      	push	hl
  D8B2    2A E086        C      	ld	hl,(dma)
  D8B5    11 D9FD        C      	ld	de,trdma
  D8B8    01 0080        C      	ld	bc,128
  D8BB    ED B0          C      	ldir
  D8BD    CD D990        C      	call	up2
  D8C0    21 D9FD        C      	ld	hl,trdma
  D8C3    D1             C      	pop	de
  D8C4    01 0080        C      	ld	bc,128
  D8C7    ED B0          C      	ldir
  D8C9    CD D9A7        C      	call	up3
  D8CC    ED 7B E306     C      	ld	sp,(stkret)
  D8D0    AF             C      	xor	a
  D8D1    C9             C      	ret
                         C      ;
  D8D2                   C      rdtram::
  D8D2    3A D9FA        C      	ld	a,(ttanz)	; trkanz > 0 ?
  D8D5    B7             C      	or	a
  D8D6    CA D2F1        C      	jp	z,rdmem0	; nein
  D8D9    CD D906        C      	call	tdadr
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-53


  D8DC    DA D2EE        C      	jp	c,wrmem0
  D8DF    ED 73 E306     C      	ld	(stkret),sp
  D8E3    31 E304        C      	ld	sp,stk12
  D8E6    CD D990        C      	call	up2
  D8E9    11 D9FD        C      	ld	de,trdma
  D8EC    01 0080        C      	ld	bc,128
  D8EF    ED B0          C      	ldir
  D8F1    CD D9A7        C      	call	up3
  D8F4    21 D9FD        C      	ld	hl,trdma
  D8F7    ED 5B E086     C      	ld	de,(dma)
  D8FB    01 0080        C      	ld	bc,128
  D8FE    ED B0          C      	ldir
  D900    ED 7B E306     C      	ld	sp,(stkret)
  D904    AF             C      	xor	a
  D905    C9             C      	ret
                         C      ;
                         C      ;
  D906    3A E088        C      tdadr::	ld	a,(trk)		; trk = > trkanz
  D909    21 D9FA        C      	ld	hl,ttanz
  D90C    BE             C      	cp	(hl)
  D90D    3F             C      	ccf
  D90E    D8             C      	ret	c		; ja
  D90F    23             C      	inc	hl
  D910    36 28          C      	ld	(hl),28h	; tram - adresse
  D912    D6 04          C      tdadr1:	sub	4
  D914    38 0A          C      	jr	c,tdadr2
                         C      	rept	8
                         C      	dec	(hl)
                         C      	endm
  D916    35             C+     	dec	(hl)
  D917    35             C+     	dec	(hl)
  D918    35             C+     	dec	(hl)
  D919    35             C+     	dec	(hl)
  D91A    35             C+     	dec	(hl)
  D91B    35             C+     	dec	(hl)
  D91C    35             C+     	dec	(hl)
  D91D    35             C+     	dec	(hl)
  D91E    18 F2          C      	jr	tdadr1
                         C      
  D920    C6 04          C      tdadr2:	add	a,4
  D922    23             C      	inc	hl
  D923    77             C      	ld	(hl),a		; ttrk
  D924    CD D93B        C      	call	up11
  D927    CD D95D        C      	call	up21
  D92A    2A E08A        C      	ld	hl,(sec)
                         C      	rept	7
                         C      	add	hl,hl
                         C      	endm
  D92D    29             C+     	add	hl,hl
  D92E    29             C+     	add	hl,hl
  D92F    29             C+     	add	hl,hl
  D930    29             C+     	add	hl,hl
  D931    29             C+     	add	hl,hl
  D932    29             C+     	add	hl,hl
  D933    29             C+     	add	hl,hl
  D934    11 3F80        C      	ld	de,03f80h
  D937    19             C      	add	hl,de
  D938    37             C      	scf
  D939    3F             C      	ccf
  D93A    C9             C      	ret
                         C      ;
                         C      ;
                         C      ;
  D93B    06 40          C      up11:	ld	b,40h		; a <==  TRAM-Track   0 ... 3
  D93D    87             C      up12:	add	a,a
  D93E    87             C      	add	a,a
  D93F    16 10          C      	ld	d,16
  D941    F5             C      up13:	push	af
  D942    3A D9FB        C      	ld	a,(tram)
  D945    4F             C      	ld	c,a
  D946    F1             C      	pop	af
  D947    0C             C      	inc	c
  D948    0C             C      	inc	c
  D949    ED 79          C      up14:	out	(c),a
  D94B    3C             C      	inc	a
  D94C    5F             C      	ld	e,a
  D94D    78             C      	ld	a,b
  D94E    C6 10          C      	add	a,10h
  D950    47             C      	ld	b,a
  D951    7B             C      	ld	a,e
  D952    15             C      	dec	d
  D953    20 F4          C      	jr	nz,up14
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-54


  D955    06 00          C      up15:	ld	b,0
  D957    1E 10          C      	ld	e,16
  D959    CD D980        C      	call	up33
  D95C    C9             C      	ret
                         C      
  D95D    06 40          C      up21:	ld	b,40h
  D95F    1E 04          C      up22:	ld	e,4
  D961    3A D9FB        C      up23:	ld	a,(tram)
  D964    4F             C      	ld	c,a
  D965    AF             C      up24:	xor	a
  D966    ED 79          C      	out	(c),a
  D968    78             C      	ld	a,b
  D969    C6 10          C      	add	a,10h
  D96B    47             C      	ld	b,a
  D96C    1D             C      	dec	e
  D96D    20 F6          C      	jr	nz,up24
  D96F    C9             C      	ret
                         C      
  D970    F5             C      up25:	push	af
  D971    3A D9FB        C      	ld	a,(tram)
  D974    4F             C      	ld	c,a
  D975    F1             C      	pop	af
  D976    0C             C      	inc	c
  D977    0C             C      	inc	c
  D978    0C             C      	inc	c
  D979    ED 79          C      	out	(c),a
  D97B    C9             C      	ret
                         C      ;
  D97C    06 40          C      up31:	ld	b,40h
  D97E    1E 04          C      up32:	ld	e,4
  D980    3A D9FB        C      up33:	ld	a,(tram)
  D983    4F             C      	ld	c,a
  D984    3E 0C          C      up35:	ld	a,00ch
  D986    ED 79          C      	out	(c),a
  D988    78             C      	ld	a,b
  D989    C6 10          C      	add	a,10h
  D98B    47             C      	ld	b,a
  D98C    1D             C      	dec	e
  D98D    20 F5          C      	jr	nz,up35
  D98F    C9             C      	ret
                         C      ;
  D990    F5             C      up2:	push	af
  D991    C5             C      	push	bc
  D992    D3 C4          C      	out	(0c4h),a		; RESET-Sperre aus
  D994    3E 80          C      	ld	a,10000000b
  D996    D3 C1          C      	out	(0c1h),a
  D998    D3 C3          C      	out	(0c3h),a		; RESET-Sperre ein
  D99A    3E 01          C      	ld	a,1
  D99C    CD D970        C      	call	up25
  D99F    D5             C      	push	de
  D9A0    CD D95D        C      	call	up21
  D9A3    D1             C      up4:	pop	de
  D9A4    C1             C      	pop	bc
  D9A5    F1             C      	pop	af
  D9A6    C9             C      	ret
                         C      ;
  D9A7    F5             C      up3:	push	af
  D9A8    C5             C      	push	bc
  D9A9    AF             C      	xor	a
  D9AA    CD D970        C      	call	up25
  D9AD    D3 C4          C      	out	(0c4h),a		; RESET-Sperre aus
  D9AF    3E 84          C      	ld	a,10000100b
  D9B1    D3 C1          C      	out	(0c1h),a
  D9B3    D3 C3          C      	out	(0c3h),a		; RESET-Sperre ein
  D9B5    D5             C      	push	de
  D9B6    CD D97C        C      	call	up31
  D9B9    18 E8          C      	jr	up4
                         C      ;
                         C      ;
  D9BB                   C      md.ino::
  D9BB    3A D9FA        C      	ld	a,(ttanz)
  D9BE    B7             C      	or	a
  D9BF    CA 0000        C      	jp	z,0
  D9C2    3E 28          C      	ld	a,28h
  D9C4    32 D9FB        C      	ld	(tram),a
  D9C7    AF             C      	xor	a
  D9C8    CD D93B        C      	call	up11
  D9CB    CD D95D        C      	call	up21
  D9CE    CD D990        C      	call	up2
  D9D1    21 4000        C      	ld	hl,04000h
  D9D4    11 4001        C      	ld	de,04001h
  D9D7    01 07FF        C      	ld	bc,007ffh
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-55


  D9DA    36 E5          C      	ld	(hl),0e5h
  D9DC    ED B0          C      	ldir
  D9DE    21 4000        C      	ld	hl,04000h
  D9E1    11 4001        C      	ld	de,04001h
  D9E4    01 001F        C      	ld	bc,01fh
  D9E7    36 00          C      	ld	(hl),0
  D9E9    ED B0          C      	ldir
  D9EB    21 DCE2        C      	ld	hl,dirgo
  D9EE    11 4000        C      	ld	de,04000h
  D9F1    01 000C        C      	ld	bc,12
  D9F4    ED B0          C      	ldir
  D9F6    CD D9A7        C      	call	up3
  D9F9    C9             C      	ret
                         C      ;
                         C      ;
                         C      ;
  D9FA    00             C      ttanz::	defb	0		; TRAM - Trackanzahl
  D9FB    00             C      tram::	defb	0		; TRAM - Adresse
  D9FC    00             C      ttrk::	defb	0		; TRAM - Track
  D9FD                   C      trdma::	defs	128
                         C       endif
                         C      ;
                         C      ; 3.  routinen fuer	16k - O P S   -   P s e u d o d i s k
                         C      ; -----------------------------------------------------------
                         C      ;
                         C       if opsdk
  DA7D                   C      wrops::
  DA7D    3A DB12        C      	ld	a,(zsma)
  DA80    B7             C      	or	a
  DA81    CA D2EE        C      	jp	z,wrmem0
  DA84    CD DADC        C      	call	opadr
  DA87    DA D2EE        C      	jp	c,wrmem0
  DA8A    E5             C      	push	hl
  DA8B    2A E086        C      	ld	hl,(dma)
  DA8E    11 D9FD        C      	ld	de,trdma
  DA91    01 0080        C      	ld	bc,128
  DA94    ED B0          C      	ldir
  DA96    E1             C      	pop	hl
                         C      	set12
  DA97    ED 73 E306     C+     	ld	(stkret),sp
  DA9B    31 E304        C+     	ld	sp,stk12
  DA9E    CD C749        C+     	call	uset12
  DAA1    C3 0CD8        C      	jp	wro1
                         C      
  DAA4                   C      wro2:	res12
  DAA4    CD C73A        C+     	call	ures12
  DAA7    ED 7B E306     C+     	ld	sp,(stkret)
  DAAB    AF             C      	xor	a
  DAAC    C9             C      	ret
                         C      
  DAAD                   C      rdo2:	res12
  DAAD    CD C73A        C+     	call	ures12
  DAB0    ED 7B E306     C+     	ld	sp,(stkret)
  DAB4    21 D9FD        C      	ld	hl,trdma
  DAB7    ED 5B E086     C      	ld	de,(dma)
  DABB    01 0080        C      	ld	bc,128
  DABE    ED B0          C      	ldir
  DAC0    AF             C      	xor	a
  DAC1    C9             C      	ret
                         C      
  DAC2                   C      rdops::
  DAC2    3A DB12        C      	ld	a,(zsma)
  DAC5    B7             C      	or	a
  DAC6    CA D2F1        C      	jp	z,rdmem0
  DAC9    CD DADC        C      	call	opadr
  DACC    DA D2F1        C      	jp	c,rdmem0
                         C      	set12
  DACF    ED 73 E306     C+     	ld	(stkret),sp
  DAD3    31 E304        C+     	ld	sp,stk12
  DAD6    CD C749        C+     	call	uset12
  DAD9    C3 0D01        C      	jp	rdo1
                         C      
  DADC    3A E088        C      opadr::	ld	a,(trk)
  DADF    21 DB12        C      	ld	hl,zsma
  DAE2    BE             C      	cp	(hl)
  DAE3    3F             C      	ccf
  DAE4    D8             C      	ret	c
  DAE5    2A E08A        C      	ld	hl,(sec)
                         C      	rept	7
                         C      	add	hl,hl
                         C      	endm
  DAE8    29             C+     	add	hl,hl
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-56


  DAE9    29             C+     	add	hl,hl
  DAEA    29             C+     	add	hl,hl
  DAEB    29             C+     	add	hl,hl
  DAEC    29             C+     	add	hl,hl
  DAED    29             C+     	add	hl,hl
  DAEE    29             C+     	add	hl,hl
  DAEF    11 BF80        C      	ld	de,0bf80h
  DAF2    19             C      	add	hl,de
  DAF3    37             C      	scf
  DAF4    3F             C      	ccf
  DAF5    C9             C      	ret
                         C      
  DAF6                   C      md.inp::
  DAF6    3A DB12        C      	ld	a,(zsma)
  DAF9    B7             C      	or	a
  DAFA    CA 0000        C      	jp	z,0
                         C      	set12
  DAFD    ED 73 E306     C+     	ld	(stkret),sp
  DB01    31 E304        C+     	ld	sp,stk12
  DB04    CD C749        C+     	call	uset12
  DB07    C3 0C9B        C      	jp	inp1
                         C      
  DB0A                   C      inp9:	res12
  DB0A    CD C73A        C+     	call	ures12
  DB0D    ED 7B E306     C+     	ld	sp,(stkret)
  DB11    C9             C      	ret
                         C      
  DB12    00             C      zsma:	defb	0
                         C      
                         C       endif
                         C      ;
                                 endif
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-57


                                
                         C      	include	BK.ASM
  0001                   C      wrdir	equ	1		; write to directory
  0002                   C      wrual	equ	2		; write to unallocated
                         C      ;
                         C      ;********************************
                         C      ;
                         C      ;   eintritt deblocking
                         C      ;      ix zeigt auf parametertab.
                         C      ;
                         C      ;********************************
                         C      ;
  DB13    3E 01          C      deblck::ld	a,1
  DB15    32 E08D        C      	ld	(readop),a	; read operation
  DB18    3E 02          C      	ld	a,wrual
  DB1A    32 E08F        C      	ld	(wrtype),a	; treat as unalloc
  DB1D    18 5F          C      	jr	alloc
                         C      ;
                         C      ;-----------------------------------
                         C      ;
                         C      ;********************************
                         C      ;
                         C      ;   eintritt blocking
                         C      ;      ix zeigt auf parametertab.
                         C      ;
                         C      ;********************************
                         C      ;
  DB1F    AF             C      block::	xor	a
  DB20    32 E08D        C      	ld	(readop),a	; write operation
  DB23    79             C      	ld	a,c
  DB24    32 E08F        C      	ld	(wrtype),a	; writetype
  DB27    FE 02          C      	cp	wrual
  DB29    20 18          C      	jr	nz,chkuna
                         C      ;
                         C      ;;;;	ld	a,(sec)		; write to unallocated
                         C      ;;;;	dec	a
                         C      ;;;;	ld	c,a
  DB2B    DD 7E 22       C      	ld	a,(ix+blklog)
                         C      ;;;;	push	af
                         C      ;;;;	dec	a
                         C      ;;;;	and	c
                         C      ;;;;	ld	c,a
                         C      ;;;;	pop	af
                         C      ;;;;	sub	c
  DB2E    DD 77 19       C      	ld	(ix+unacnt),a
  DB31    3A E088        C      	ld	a,(trk)
  DB34    DD 77 1A       C      	ld	(ix+unatrk),a
  DB37    3A E089        C      	ld	a,(trk+1)
  DB3A    DD 77 1B       C      	ld	(ix+unatrk+1),a
  DB3D    3A E08A        C      	ld	a,(sec)
  DB40    DD 77 1C       C      	ld	(ix+unasec),a
                         C      ;
  DB43    DD 7E 19       C      chkuna::	ld	a,(ix+unacnt)	; any unallocated remain?
  DB46    B7             C      	or	a
  DB47    28 35          C      	jr	z,alloc		; -> no
                         C      ;
  DB49    DD 35 19       C      	dec	(ix+unacnt)	; unallocated records remain
  DB4C    3A E088        C      	ld	a,(trk)
  DB4F    DD BE 1A       C      	cp	(ix+unatrk)
  DB52    20 2A          C      	jr	nz,alloc	; -> not the same track
  DB54    3A E089        C      	ld	a,(trk+1)
  DB57    DD BE 1B       C      	cp	(ix+unatrk+1)
  DB5A    20 22          C      	jr	nz,alloc	; -> not the same track
  DB5C    3A E08A        C      	ld	a,(sec)
  DB5F    DD BE 1C       C      	cp	(ix+unasec)
  DB62    20 1A          C      	jr	nz,alloc	; -> not the same sector
                         C      ;
  DB64    DD 34 1C       C      	inc	(ix+unasec)	; match, incr. for future
  DB67    DD BE 23       C      	cp	(ix+cpmspt)	; in SYS4 sind sek. von 1 bis cpmspt nummeriert
  DB6A    38 0C          C      	jr	c,noovf
                         C      ;
  DB6C    DD 36 1C 01    C      	ld	(ix+unasec),1	; track overflow
  DB70    DD 34 1A       C      	inc	(ix+unatrk)
  DB73    20 03          C      	jr	nz,noovf
  DB75    DD 34 1B       C      	inc	(ix+unatrk+1)
                         C      ;
  DB78    AF             C      noovf::	xor	a		; match found, mark as unnecessary read
  DB79    32 E08E        C      	ld	(rsflag),a
  DB7C    18 09          C      	jr	rwoper
                         C      ;
  DB7E    DD 36 19 00    C      alloc::	ld	(ix+unacnt),0
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-58


  DB82    3E 01          C      	ld	a,1
  DB84    32 E08E        C      	ld	(rsflag),a	; mark as must preread
                         C      ;
  DB87    AF             C      rwoper::xor	a
  DB88    32 E090        C      	ld	(erflag),a	; no errors (yet)
  DB8B    DD 7E 24       C      	ld	a,(ix+secshf)
  DB8E    47             C      	ld	b,a
  DB8F    3A E08A        C      	ld	a,(sec)
  DB92    3D             C      	dec	a
  DB93    CB 3F          C      rwop01::srl	a
  DB95    10 FC          C      	djnz	rwop01
  DB97    32 E092        C      	ld	(sechst),a
                         C      ;
  DB9A    DD 7E 17       C      	ld	a,(ix+hstact)	; host buffer active?
  DB9D    DD 36 17 01    C      	ld	(ix+hstact),1
  DBA1    B7             C      	or	a
  DBA2    28 1F          C      	jr	z,filhst	; -> no
                         C      ;
  DBA4    3A E088        C      	ld	a,(trk)		; propper sector in buffer?
  DBA7    DD BE 14       C      	cp	(ix+hsttrk)
U DBAA    20 54          C      	jr	nz,nomatch
  DBAC    3A E089        C      	ld	a,(trk+1)
  DBAF    DD BE 15       C      	cp	(ix+hsttrk+1)
U DBB2    20 4C          C      	jr	nz,nomatch
  DBB4    3A E092        C      	ld	a,(sechst)
  DBB7    DD BE 16       C      	cp	(ix+hstsec)
  DBBA    28 24          C      	jr	z,match
                         C      ;
  DBBC    DD 7E 18       C      nomatc::ld	a,(ix+hstwrt)	; host written?
  DBBF    B7             C      	or	a
  DBC0    C4 DC4F        C      	call	nz,writehst	; yes, write host buffer
                         C      ;
  DBC3    3A E092        C      filhst::ld	a,(sechst)
  DBC6    DD 77 16       C      	ld	(ix+hstsec),a
  DBC9    3A E088        C      	ld	a,(trk)
  DBCC    DD 77 14       C      	ld	(ix+hsttrk),a
  DBCF    3A E089        C      	ld	a,(trk+1)
  DBD2    DD 77 15       C      	ld	(ix+hsttrk+1),a
  DBD5    DD 36 18 00    C      	ld	(ix+hstwrt),0	; no pending write
  DBD9    3A E08E        C      	ld	a,(rsflag)
  DBDC    B7             C      	or	a
  DBDD    C4 DC5C        C      	call	nz,readhst	; read host buffer
                         C      ;
  DBE0    3A E08A        C      match::	ld	a,(sec)
  DBE3    3D             C      	dec	a
  DBE4    DD A6 25       C      	and	(ix+secmsk)
  DBE7    6F             C      	ld	l,a
  DBE8    26 00          C      	ld	h,0
                         C      	rept	7
                         C      	add	hl,hl
                         C      	endm
  DBEA    29             C+     	add	hl,hl
  DBEB    29             C+     	add	hl,hl
  DBEC    29             C+     	add	hl,hl
  DBED    29             C+     	add	hl,hl
  DBEE    29             C+     	add	hl,hl
  DBEF    29             C+     	add	hl,hl
  DBF0    29             C+     	add	hl,hl
  DBF1    DD 5E 12       C      	ld	e,(ix+hstbuf)
  DBF4    DD 56 13       C      	ld	d,(ix+hstbuf+1)
  DBF7    19             C      	add	hl,de
  DBF8    ED 5B E086     C      	ld	de,(dma)
  DBFC    06 80          C      	ld	b,128
  DBFE    3A E08D        C      	ld	a,(readop)	; which way?
  DC01    B7             C      	or	a
  DC02    20 1E          C      	jr	nz,rmove	; -> read
                         C      ;
  DC04    DD 36 18 01    C      	ld	(ix+hstwrt),1	; host buffer written
  DC08    EB             C      	ex	de,hl
  DC09    7E             C      wmove::	ld	a,(hl)		; uebertragen nach hostbuffer auf cpu-karte
                         C      	set12
  DC0A    ED 73 E306     C+     	ld	(stkret),sp
  DC0E    31 E304        C+     	ld	sp,stk12
  DC11    CD C749        C+     	call	uset12
  DC14    12             C      	ld	(de),a
                         C      	res12
  DC15    CD C73A        C+     	call	ures12
  DC18    ED 7B E306     C+     	ld	sp,(stkret)
  DC1C    23             C      	inc	hl
  DC1D    13             C      	inc	de
  DC1E    10 E9          C      	djnz	wmove
  DC20    18 17          C      	jr	retmov
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-59


                         C      ;
  DC22                   C      rmove::	set12			; uebertragen vom hostbuffer auf cpu-karte
  DC22    ED 73 E306     C+     	ld	(stkret),sp
  DC26    31 E304        C+     	ld	sp,stk12
  DC29    CD C749        C+     	call	uset12
  DC2C    7E             C      	ld	a,(hl)
                         C      	res12
  DC2D    CD C73A        C+     	call	ures12
  DC30    ED 7B E306     C+     	ld	sp,(stkret)
  DC34    12             C      	ld	(de),a
  DC35    23             C      	inc	hl
  DC36    13             C      	inc	de
  DC37    10 E9          C      	djnz	rmove
  DC39    3A E08F        C      retmov::ld	a,(wrtype)	; write type to directory?
  DC3C    FE 01          C      	cp	wrdir
  DC3E    3A E090        C      	ld	a,(erflag)
  DC41    C0             C      	ret	nz		; -> no
  DC42    B7             C      	or	a		; errors?
  DC43    C0             C      	ret	nz		; -> yes
  DC44    CD DC4F        C      	call	writehst
  DC47    DD 36 18 00    C      	ld	(ix+hstwrt),0
  DC4B    3A E090        C      	ld	a,(erflag)
  DC4E    C9             C      	ret
                         C      ;
                         C      ;----------------------------------------------------------------------
                         C      ;
                         C      ; up's fuer host read/write
                         C      ; -------------------------
                         C      ;
  DC4F                   C      writehst::
  DC4F    3E 04          C      	ld	a,erranz	; erranz fehlversuche
  DC51    32 E091        C      	ld	(rderr),a
  DC54    DD 6E 20       C      	ld	l,(ix+hwr)
  DC57    DD 66 21       C      	ld	h,(ix+hwr+1)
  DC5A    18 0B          C      	jr	rdh01
                         C      ;
                         C      ;-------------------------------
                         C      ;
  DC5C                   C      readhst::
  DC5C    3E 04          C      	ld	a,erranz	; erranz fehlversuche
  DC5E    32 E091        C      	ld	(rderr),a
  DC61    DD 6E 1E       C      	ld	l,(ix+hrd)
  DC64    DD 66 1F       C      	ld	h,(ix+hrd+1)
  DC67    CD DC73        C      rdh01::	call	callhl
  DC6A    3E 00          C      	ld	a,0
  DC6C    28 01          C      	jr	z,rdh02
  DC6E    3C             C      	inc	a
  DC6F    32 E090        C      rdh02::	ld	(erflag),a
  DC72    C9             C      	ret
                         C      ;
                                ;-------------------------------
                                ;
  DC73    E9                    callhl::jp	(hl)
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-60


                                
                                ; kaltstart
                                ; ---------
                                ;
  DC74    31 E2A4               boot::	ld	sp,spber
  DC77    ED 73 E306            	ld	(stkret),sp
  DC7B    F3                    	di
                                	res12			; speicherumschaltungen initialisieren
  DC7C    CD C73A         +     	call	ures12
  DC7F    ED 7B E306      +     	ld	sp,(stkret)
                                ;
  DC83    3E 00                 	ld	a,simgr		; groesse des sim.disk
  DC85    32 0042               	ld	(simsiz),a
  DC88    21 0003               	ld	hl,3
  DC8B    36 95                 	ld	(hl),95h	; iobyte
  DC8D    23                    	inc	hl
  DC8E    36 00                 	ld	(hl),0		; default dev.
  DC90    C3 DD89               	jp	boot01
                                
                                ; verzeichnis A: loeschen
                                ; -----------------------
                                ;
  DC93    3A 0042               dirdel::ld	a,(simsiz)
  DC96    B7                    	or	a
  DC97    C8                    	ret	z
  DC98    87                    	add	a,a
  DC99    87                    	add	a,a
  DC9A    ED 44                 	neg
  DC9C    67                    	ld	h,a
  DC9D    2E 00                 	ld	l,0
  DC9F    01 B000               	ld	bc,simad
  DCA2    09                    	add	hl,bc
  DCA3    E5                    	push	hl
  DCA4    D1                    	pop	de
  DCA5    13                    	inc	de
  DCA6    01 07FF               	ld	bc,7ffh
  DCA9    36 E5                 	ld	(hl),0e5h
  DCAB    E5                    	push	hl
  DCAC    ED B0                 	ldir
  DCAE    E1                    	pop	hl
  DCAF    E5                    	push	hl
  DCB0    E5                    	push	hl
  DCB1    D1                    	pop	de
  DCB2    13                    	inc	de
                                 if pipeq
  DCB3    01 003F               	ld	bc,3fh
                                 else
                                	ld	bc,1fh
                                 endif
  DCB6    36 00                 	ld	(hl),0
  DCB8    ED B0                 	ldir
  DCBA    D1                    	pop	de
  DCBB    D5                    	push	de
  DCBC    21 DCE2               	ld	hl,dirgo
  DCBF    01 000C               	ld	bc,12
  DCC2    ED B0                 	ldir
  DCC4    E1                    	pop	hl
                                 if pipeq
  DCC5    E5                    	push	hl
  DCC6    11 0020               	ld	de,32
  DCC9    19                    	add	hl,de
  DCCA    EB                    	ex	de,hl
  DCCB    21 DCEE               	ld	hl,dirgo1
  DCCE    01 0011               	ld	bc,17
  DCD1    ED B0                 	ldir
  DCD3    E1                    	pop	hl
  DCD4    11 0800               	ld	de,800h
  DCD7    19                    	add	hl,de
  DCD8    EB                    	ex	de,hl
  DCD9    21 DCFF               	ld	hl,dirg11
  DCDC    01 008A               	ld	bc,dirg12-dirg11
  DCDF    ED B0                 	ldir
                                 endif
  DCE1    C9                    	ret
                                
  DCE2    00 47 4F 20           dirgo:	defb	0,'GO      ',0c3h,'OM'
  DCE6    20 20 20 20           
  DCEA    20 C3 4F 4D           
                                 if pipeq
  DCEE    00 50 49 50           dirgo1:	defb	0,'PIP     SUB',0,0,0,2,2
  DCF2    20 20 20 20           
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-61


  DCF6    20 53 55 42           
  DCFA    00 00 00 02           
  DCFE    02                    
  DCFF                          dirg11:	dirg
  DCFF    24 31 3A 70     +     	defb	'$1:pip p:=$1:xsub.com',cr,lf
  DD03    69 70 20 70     +     
  DD07    3A 3D 24 31     +     
  DD0B    3A 78 73 75     +     
  DD0F    62 2E 63 6F     +     
  DD13    6D 0D 0A        +     
  DD16    67 6F 20 70     +     	defb	'go p:s.com=$1:submit.com',cr,lf
  DD1A    3A 73 2E 63     +     
  DD1E    6F 6D 3D 24     +     
  DD22    31 3A 73 75     +     
  DD26    62 6D 69 74     +     
  DD2A    2E 63 6F 6D     +     
  DD2E    0D 0A           +     
  DD30    67 6F 20 70     +     	defb	'go p:=$1:kini.com',cr,lf
  DD34    3A 3D 24 31     +     
  DD38    3A 6B 69 6E     +     
  DD3C    69 2E 63 6F     +     
  DD40    6D 0D 0A        +     
  DD43    67 6F 20 70     +     	defb	'go p:=$1:power.com',cr,lf
  DD47    3A 3D 24 31     +     
  DD4B    3A 70 6F 77     +     
  DD4F    65 72 2E 63     +     
  DD53    6F 6D 0D 0A     +     
  DD57    67 6F 20 6F     +     	defb	'go o:=$1:m80.com',cr,lf
  DD5B    3A 3D 24 31     +     
  DD5F    3A 6D 38 30     +     
  DD63    2E 63 6F 6D     +     
  DD67    0D 0A           +     
  DD69    67 6F 20 6F     +     	defb	'go o:=$1:l80.com',cr,lf
  DD6D    3A 3D 24 31     +     
  DD71    3A 6C 38 30     +     
  DD75    2E 63 6F 6D     +     
  DD79    0D 0A           +     
  DD7B    65 72 61 20     +     	defb	'era pip.sub',cr,lf
  DD7F    70 69 70 2E     +     
  DD83    73 75 62 0D     +     
  DD87    0A              +     
  DD88    1A              +     	defb	01ah
  DD89                          dirg12:
                                 endif
                                ;
  DD89    CD DC93               boot01::call	dirdel
                                ;
                                ; bildschirm initialisieren
                                ; -------------------------
                                ;
  DD8C    AF                    	xor	a
  DD8D    32 E095               	ld	(qrmode),a
  DD90    32 E096               	ld	(qroll),a
  DD93    32 E097               	ld	(qesc),a
  DD96    21 3000               	ld	hl,bsanf
  DD99    22 E093               	ld	(bsaddr),hl
  DD9C    21 DDAF               	ld	hl,bootms
  DD9F    06 5B                 	ld	b,bootme-bootms
  DDA1    C5                    boot03::push	bc
  DDA2    7E                    	ld	a,(hl)
  DDA3    23                    	inc	hl
  DDA4    4F                    	ld	c,a
  DDA5    E5                    	push	hl
  DDA6    CD CD7E               	call	co.ch
  DDA9    E1                    	pop	hl
  DDAA    C1                    	pop	bc
  DDAB    10 F4                 	djnz	boot03
  DDAD    18 5B                 	jr	boot04
                                ;
  DDAF                          bootms::mbootm
  DDAF    1A 35 31 6B     +     	defb	1ah,'51k   S Y S 4 . 3   release 2'
  DDB3    20 20 20 53     +     
  DDB7    20 59 20 53     +     
  DDBB    20 34 20 2E     +     
  DDBF    20 33 20 20     +     
  DDC3    20 72 65 6C     +     
  DDC7    65 61 73 65     +     
  DDCB    20 32           +     
  DDCD    20 20 20 54     +     	defb	'   T A P 2 / T A P 3'
  DDD1    20 41 20 50     +     
  DDD5    20 32 20 2F     +     
  DDD9    20 54 20 41     +     
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-62


  DDDD    20 50 20 33     +     
  DDE1    0D 0A 20 20     +     	defb	cr,lf,'      D E G  2000   vom 12.August 85 ',lf,lf
  DDE5    20 20 20 20     +     
  DDE9    44 20 45 20     +     
  DDED    47 20 20 32     +     
  DDF1    30 30 30 20     +     
  DDF5    20 20 76 6F     +     
  DDF9    6D 20 31 32     +     
  DDFD    2E 41 75 67     +     
  DE01    75 73 74 20     +     
  DE05    38 35 20 0A     +     
  DE09    0A              +     
  DE0A                          bootme::
  DE0A                          boot04::
                                ;
                                ; geraetezustand initialisieren
                                ; -----------------------------
                                ;
  DE0A    21 E066               	ld	hl,dpha		; geraete a bis p entladen
  DE0D    06 20                 	ld	b,32
  DE0F    36 00                 boot05::ld	(hl),0
  DE11    23                    	inc	hl
  DE12    10 FB                 	djnz	boot05
  DE14    21 E006               	ld	hl,dphad	; a ist tpa-disk
  DE17    22 E066               	ld	(dpha),hl
  DE1A    21 DFE6               	ld	hl,ixtab1
  DE1D    11 DFC6               	ld	de,ixtab
  DE20    01 0020               	ld	bc,32
  DE23    ED B0                 	ldir
  DE25    AF                    	xor	a		; a ist a
  DE26    32 0043               	ld	(lwa),a
                                ;
                                ; kassetten initialisieren
                                ; ------------------------
                                ;
                                	set12
  DE29    ED 73 E306      +     	ld	(stkret),sp
  DE2D    31 E304         +     	ld	sp,stk12
  DE30    CD C749         +     	call	uset12
  DE33    DD 21 DF66            	ld	ix,eatab1
  DE37    CD 4965               	call	kmbini
                                 if anzakb gt 1
                                	ld	ix,eatab3
                                	call	kmbini
                                 endif
                                 if anzakb gt 2
                                	ld	ix,eatab5
                                	call	kmbini
                                 endif
                                	res12
  DE3A    CD C73A         +     	call	ures12
  DE3D    ED 7B E306      +     	ld	sp,(stkret)
                                
  DE41    3E 10                 	ld	a,10h		; status nicht bereit setzen
  DE43    32 DF66               	ld	(eatab1),a
  DE46    32 DF91               	ld	(eatab2),a
                                 if anzakb gt 1
                                	ld	(eatab3),a
                                	ld	(eatab4),a
                                 endif
                                 if anzakb gt 2
                                	ld	(eatab5),a
                                	ld	(eatab6),a
                                 endif
                                ;
                                ; gereate kaltinitialisierung
                                ; ---------------------------
                                ;
  DE49    CD CD19               	call	ci.kalt		; Tastatur
                                 if mindk or stadk
                                	call	fl.kalt		; Floppy initialisieren
                                 endif
                                 if zst or tramdk or opsdk
  DE4C    CD D729               	call	md.kalt		; simulierten disk initialisieren
                                 endif
  DE4F    AF                    	xor	a
  DE50    32 E09B               	ld	(sverz),a
  DE53    32 E09C               	ld	(sschr),a
  DE56    32 DF83               	ld	(eatab1+gelade),a
  DE59    32 DFAE               	ld	(eatab2+gelade),a
                                 if anzakb gt 1
                                	ld	(eatab3+gelade),a
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-63


                                	ld	(eatab4+gelade),a
                                 endif
                                 if anzakb gt 2
                                	ld	(eatab5+gelade),a
                                	ld	(eatab6+gelade),a
                                 endif
                                ;
                                ;----------------------------------------------------------------------
                                ;
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-64


                                
                                ; warmstart
                                ; ---------
                                ;
  DE5C    F3                    wboot::	di
  DE5D    31 E2A4               	ld	sp,spber
  DE60    ED 73 E306            	ld	(stkret),sp
                                	res12
  DE64    CD C73A         +     	call	ures12
  DE67    ED 7B E306      +     	ld	sp,(stkret)
  DE6B    01 0080               	ld	bc,80h
  DE6E    CD D261               	call	setdm
                                ;
                                ; geraete warminitialisierung
                                ; ---------------------------
                                ;
  DE71    CD CD19               	call	ci.warm
                                 if mindk or stadk
                                	call	fl.warm		; zum motor ausschalten
                                 endif
                                 if zst or tramdk or opsdk
  DE74    CD D7D1               	call	md.warm
                                 endif
  DE77    AF                    	xor	a
  DE78    32 E095               	ld	(qrmode),a
                                ;
  DE7B    3E 01                 	ld	a,1		; kassettenladen/-entladen erlauben
  DE7D    32 E09A               	ld	(pf10er),a
                                ;
                                ; ccp und bdos umkopieren
                                ; -----------------------
                                ;
                                	ccpcop
  DE80    21 E800         +     	ld	hl,biosan+biosle
  DE83    11 B000         +     	ld	de,biosan-1600h
  DE86    01 0800         +     	ld	bc,800h
  DE89    ED B0           +     	ldir
  DE8B    21 DE95         +     	ld	hl,serial
  DE8E    01 0006         +     	ld	bc,6
  DE91    ED B0           +     	ldir
  DE93    18 06           +     	jr	ccpcp1
  DE95    00 16 00 00     +     serial::defb	0,16h,0,0,0,0a5h
  DE99    00 A5           +     
  DE9B                    +     ccpcp1::
                                ;
                                ; systemanspruenge setzen
                                ; -----------------------
                                ;
  DE9B    21 B806               	ld	hl,biosan-0e00h+6
  DE9E    22 DEF9               	ld	(cubdos),hl
  DEA1    3A 0042               	ld	a,(simsiz)
  DEA4    3D                    	dec	a
U DEA5    32 0000               	ld	(sizem),a	; groesse des sim.disk in paramtabelle eintragen
  DEA8    3C                    	inc	a
  DEA9    28 16                 	jr	z,noadev	; -> kein simulierter disk
  DEAB    87                    	add	a,a
  DEAC    87                    	add	a,a
  DEAD    ED 44                 	neg
  DEAF    67                    	ld	h,a
  DEB0    2E 00                 	ld	l,0
  DEB2    01 AF86               	ld	bc,simad-80h+6
  DEB5    09                    	add	hl,bc
  DEB6    22 DEF9               	ld	(cubdos),hl
  DEB9    36 C3                 	ld	(hl),0c3h
  DEBB    23                    	inc	hl
  DEBC    36 06                 	ld	(hl),low (biosan-0e00h+6)
  DEBE    23                    	inc	hl
  DEBF    36 B8                 	ld	(hl),high (biosan-0e00h+6)
  DEC1                          noadev::
                                ;
  DEC1    3A 0003               	ld	a,(3)
  DEC4    32 DEF6               	ld	(iobyt),a
  DEC7    3A 0004               	ld	a,(4)		; pruefen, ob current dev. gueltig ist
  DECA    57                    	ld	d,a
  DECB    4F                    	ld	c,a
  DECC    06 00                 	ld	b,0
  DECE    21 E066               	ld	hl,dpha
  DED1    09                    	add	hl,bc
  DED2    09                    	add	hl,bc
  DED3    7E                    	ld	a,(hl)
  DED4    23                    	inc	hl
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-65


  DED5    B6                    	or	(hl)
  DED6    28 01                 	jr	z,m104		; -> nicht gueltige current dev.
  DED8    7A                    	ld	a,d
  DED9    32 DEF7               m104::	ld	(cudev),a	; aktuelles geraet
  DEDC    21 DEF3               	ld	hl,syspa
  DEDF    11 0000               	ld	de,0
  DEE2    01 0017               	ld	bc,23
  DEE5    ED B0                 	ldir
  DEE7    4F                    	ld	c,a
                                ;
                                ; interruptsystem setzen
                                ; ----------------------
                                ;
  DEE8    3E C6                 	ld	a,high biosan
  DEEA    ED 47                 	ld	i,a
  DEEC    ED 5E                 	im 2
  DEEE    FB                    	ei
  DEEF    79                    	ld	a,c
  DEF0    C3 B000               	jp	biosan-1600h	; ===> ccp
                                ;
                                ; Werte stehen nach Init ab Adresse 0000   
                                ; --------------------------------------
                                ;
  DEF3    C3 C603               syspa::	jp	biosan+3	; -> wboot
  DEF6    95                    iobyt::	defb	095h		; list=lpt:/punch=ptp:/reader=ptr:/console=crt:
  DEF7    00                    cudev::	defb	0		; current device
  DEF8    C3                    	defb	0c3h		; jp
  DEF9    AF86                  cubdos::defw	simad-80h+6-(simgr*1024)
                                ;
  DEFB    C3 DF0A               	jp	kmbuse		; 0008h eintritt bamos kmb
  DEFE    C3 DF19               	jp	enduse		; 000bh	warten auf kmb-bereitschaft
  DF01    C3 DF28               	jp	getpuf		; 000eh aus kmb-puffer in ram laden
  DF04    E124                  	defw	kmbpuf		; 0011h adresse eines hilfspuffers
  DF06    DF66                  	defw	eatab1		; 0013h	adresse e/a-tabelle 1
  DF08    DF91                  	defw	eatab2		; 0015h adresse e/a-tabelle 2
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-66


                                
                                ; user-unterprogramme
                                ; -------------------
                                ;
                                ; erhaelt in ix die adresse der e/a-tabelle
                                ;         in a  das kmb-kommando
                                ; fuehrt dann das kmb-kommando aus und wartet auf die beendigung
                                ;
  DF0A    ED 73 E304            kmbuse::ld	(spret),sp
  DF0E    31 E2C4               	ld	sp,spber1
  DF11    CD D6E3               	call	kmb
  DF14    ED 7B E304            	ld	sp,(spret)
  DF18    C9                    	ret
                                ;
                                ; erhaelt in ix die adresse der e/a-tabelle
                                ; wartet dann auf das ende des rueckspulens
                                ;
  DF19    ED 73 E304            enduse::ld	(spret),sp
  DF1D    31 E2C4               	ld	sp,spber1
  DF20    CD D51C               	call	endruc
  DF23    ED 7B E304            	ld	sp,(spret)
  DF27    C9                    	ret
                                ;
                                ; erhaelt in ix die adresse der e/a-tabelle
                                ;         in de die adresse des zielbereiches, in den aus dem kassetten-
                                ;               puffer der e/a-tabelle uebertragen werden soll
                                ; uebertraegt dann aus dem kmb-puffer in den nutzerpuffer
                                ;
  DF28    ED 73 E304            getpuf::ld	(spret),sp
  DF2C    31 E2C4               	ld	sp,spber1
  DF2F    DD 6E 07              	ld	l,(ix+eaadr)
  DF32    DD 66 08              	ld	h,(ix+eaadr+1)
  DF35    DD 46 09              	ld	b,(ix+ealen)
  DF38    DD 4E 0A              	ld	c,(ix+ealen+1)
  DF3B    78                    getpu1::ld	a,b
  DF3C    B1                    	or	c
  DF3D    28 18                 	jr	z,getpu2
                                	set12
  DF3F    ED 73 E306      +     	ld	(stkret),sp
  DF43    31 E304         +     	ld	sp,stk12
  DF46    CD C749         +     	call	uset12
  DF49    7E                    	ld	a,(hl)
                                	res12
  DF4A    CD C73A         +     	call	ures12
  DF4D    ED 7B E306      +     	ld	sp,(stkret)
  DF51    12                    	ld	(de),a
  DF52    23                    	inc	hl
  DF53    13                    	inc	de
  DF54    0B                    	dec	bc
  DF55    18 E4                 	jr	getpu1
                                ;
  DF57    ED 7B E304            getpu2::ld	sp,(spret)
  DF5B    C9                    	ret
                                ;
                                ;-------------------
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-67


                                
                                ; hardware beschreibungstabellen
                                ; ------------------------------
                         C      	include	IX.ASM
                         C      ; e/a tabellen-aufbau
                         C      ; -------------------
                         C      ;
  0005                   C      isblk	equ	5		; 0 - geraet arbeitet ungeblockt
  0004                   C      ixrd	equ	4		; read/write-anspruenge
  0002                   C      ixwr	equ	2
                         C      
  0000                   C      eastat	equ	0		; bamos-arbeitszellen kmb
  0001                   C      eafehl	equ	1
  0004                   C      eakom	equ	4
  0005                   C      eaep	equ	5
  0007                   C      eaadr	equ	7
  0009                   C      ealen	equ	9
  000A                   C      eabm	equ	10
  000B                   C      eawied	equ	11
  000C                   C      eaverl	equ	12
                         C      
  000D                   C      eadpuf	equ	13		; directorypufferung kassetten
  000F                   C      eadzei	equ	15
                         C      
  0010                   C      eawovo	equ	16		; positionierung kassetten
                         C      
  0012                   C      hstbuf	equ	18		; blockung/entblockung arbeitszellen
  0014                   C      hsttrk	equ	20
  0016                   C      hstsec	equ	22
  0017                   C      hstact	equ	23
  0018                   C      hstwrt	equ	24
  0019                   C      unacnt	equ	25
  001A                   C      unatrk	equ	26
  001C                   C      unasec	equ	28
                         C      
  001D                   C      gelade	equ	29
                         C      
  001E                   C      hrd	equ	30		; blockung/entblockung parameter
  0020                   C      hwr	equ	32
  0022                   C      blklog	equ	34
  0023                   C      cpmspt	equ	35
  0024                   C      secshf	equ	36
  0025                   C      secmsk	equ	37
                         C      ;
                         C      	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-68


                         C      
                         C      ; e/a-tabelle tpa-disk
                         C      ;
  DF5C    00             C      	defb	0		; ungeblocktes geraet
  DF5D    D2DD           C      	defw	rdmem
  DF5F    D2C7           C      	defw	wrmem
  DF61                   C      eataba::
                         C      ;
                         C      ; e/a-tabellen kassetten
                         C      ;
  DF61    01             C      	defb	1		; geraet arbeitet geblockt
  DF62    D389           C      	defw	rdkmb
  DF64    D329           C      	defw	wrkmb
  DF66    00 00 30 01    C      eatab1::defb	0,0,pkmb,1	; laufwerk 1
  DF6A    00             C      	defb	0		; ==========
  DF6B    D71A           C      	defw	kmbep		;    ep
  DF6D    0000           C      	defw	0		;    adr
  DF6F    0000           C      	defw	0		;    len , anzbm
  DF71    0000           C      	defw	0		;    anz.versuche , anz. ext.gap
  DF73    F000           C      	defw	dir1
  DF75    00             C      	defb	0		; anzeiger, ob in directory geschrieben
                         C      ;				; wurde ( =1 es wurde )
  DF76    0000           C      	defw	0		; wovor blk/rec
  DF78    2800           C      	defw	kasbu1		; adresse des hostbuffer
  DF7A    0000           C      	defw	0		; nr. des pufferinhaltes als hostwert
  DF7C    00             C      	defb	0		;               - " -
  DF7D    00             C      	defb	0		; puffer gefuellt (=0 nein)
  DF7E    00             C      	defb	0		; puffer beschrieben (=1 es wurde)
  DF7F    00             C      	defb	0		; anzahl der noch unalloc. recs
  DF80    0000           C      	defw	0		; spurnr. des naechsten unalloc. recs
  DF82    00             C      	defb	0		; sektornr.     - " -
  DF83    00             C      	defb	0		; 0 laufwerk entladen; 1 laufwerk geladen
  DF84    D3B8           C      	defw	hrdkmb		; leseroutine vom kmb in hostbuffer
  DF86    D35F           C      	defw	hwrkmb		; writeroutine vom hostbuffer auf kmb
  DF88    08 10 01 01    C      	defb	8,16,1,1	; parameter blockung/entblockung
                         C      ;
  DF8C    01             C      	defb	1
  DF8D    D389           C      	defw	rdkmb
  DF8F    D329           C      	defw	wrkmb
  DF91    00 00 30 02    C      eatab2::defb	0,0,pkmb,2	; laufwerk 2
  DF95    00             C      	defb	0		; ==========
  DF96    D71A 0000      C      	defw	kmbep,0
  DF9A    0000 0000      C      	defw	0,0
  DF9E    F800           C      	defw	dir2
  DFA0    00             C      	defb	0
  DFA1    0000           C      	defw	0
  DFA3    2900           C      	defw	kasbu2
  DFA5    0000           C      	defw	0
  DFA7    00 00 00 00    C      	defb	0,0,0,0
  DFAB    0000           C      	defw	0
  DFAD    00             C      	defb	0
  DFAE    00             C      	defb	0
  DFAF    D3B8           C      	defw	hrdkmb
  DFB1    D35F           C      	defw	hwrkmb
  DFB3    08 10 01 01    C      	defb	8,16,1,1
                         C      ;
                         C       if anzakb gt 1
                         C      	defb	1
                         C      	defw	rdkmb
                         C      	defw	wrkmb
                         C      eatab3::defb	0,0,pkmb2,1	; laufwerk 3
                         C      	defb	0		; ==========
                         C      	defw	kmbep,0
                         C      	defw	0,0
                         C      	defw	dir3
                         C      	defb	0
                         C      	defw	0
                         C      	defw	kasbu3
                         C      	defw	0
                         C      	defb	0,0,0,0
                         C      	defw	0
                         C      	defb	0
                         C      	defb	0
                         C      	defw	hrdkmb
                         C      	defw	hwrkmb
                         C      	defb	8,16,1,1
                         C      ;
                         C      	defb	1
                         C      	defw	rdkmb
                         C      	defw	wrkmb
                         C      eatab4::defb	0,0,pkmb2,2	; laufwerk 4
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-69


                         C      	defb	0		; ==========
                         C      	defw	kmbep,0
                         C      	defw	0,0
                         C      	defw	dir4
                         C      	defb	0
                         C      	defw	0
                         C      	defw	kasbu4
                         C      	defw	0
                         C      	defb	0,0,0,0
                         C      	defw	0
                         C      	defb	0
                         C      	defb	0
                         C      	defw	hrdkmb
                         C      	defw	hwrkmb
                         C      	defb	8,16,1,1
                         C       endif
                         C      ;
                         C       if anzakb gt 2
                         C      	defb	1
                         C      	defw	rdkmb
                         C      	defw	wrkmb
                         C      eatab5::defb	0,0,pkmb3,1	; laufwerk 5
                         C      	defb	0		; ==========
                         C      	defw	kmbep,0
                         C      	defw	0,0
                         C      	defw	dir5
                         C      	defb	0
                         C      	defw	0
                         C      	defw	kasbu5
                         C      	defw	0
                         C      	defb	0,0,0,0
                         C      	defw	0
                         C      	defb	0
                         C      	defb	0
                         C      	defw	hrdkmb
                         C      	defw	hwrkmb
                         C      	defb	8,16,1,1
                         C      ;
                         C      	defb	1
                         C      	defw	rdkmb
                         C      	defw	wrkmb
                         C      eatab6::defb	0,0,pkmb3,2	; laufwerk 6
                         C      	defb	0		; ==========
                         C      	defw	kmbep,0
                         C      	defw	0,0
                         C      	defw	dir6
                         C      	defb	0
                         C      	defw	0
                         C      	defw	kasbu6
                         C      	defw	0
                         C      	defb	0,0,0,0
                         C      	defw	0
                         C      	defb	0
                         C      	defb	0
                         C      	defw	hrdkmb
                         C      	defw	hwrkmb
                         C      	defb	8,16,1,1
                         C       endif
                         C      
                         C       if mindk
                         C      ;
                         C      ; e/a-tabellen minidisk
                         C      ;
                         C      	defb	0
                         C      	defw	rdmd
                         C      	defw	wrmd
                         C      eamd1::	
                         C      
                         C      	defb	0
                         C      	defw	rdmd
                         C      	defw	wrmd
                         C      eamd2::
                         C      
                         C      	defb	0
                         C      	defw	rdmd
                         C      	defw	wrmd
                         C      eamd3::
                         C      
                         C      	defb	0
                         C      	defw	rdmd
                         C      	defw	wrmd
                         C      eamd4::
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-70


                         C       endif
                         C      
                         C       if stadk
                         C      ;
                         C      ; e/a-tabellen standarddisk
                         C      ;
                         C      	defb	0
                         C      	defw	rdsd
                         C      	defw	wrsd
                         C      easd1::
                         C      
                         C      	defb	0
                         C      	defw	rdsd
                         C      	defw	wrsd
                         C      easd2::
                         C       endif
                         C      
                         C       if zst
                         C      ;
                         C      ; e/a-tabelle zentralstation
                         C      ;
  DFB7    00             C      	defb	0
  DFB8    D866           C      	defw	rdzst
  DFBA    D829           C      	defw	wrzst
  DFBC                   C      eazst::
                         C       endif
                         C      
                         C       if tramdk
                         C      ;
                         C      ; e/a-tabelle TRAM-Disk
                         C      ;
  DFBC    00             C      	defb	0
  DFBD    D8D2           C      	defw	rdtram
  DFBF    D89D           C      	defw	wrtram
  DFC1                   C      eatram::
                         C       endif
                         C      
                         C       if opsdk
                         C      ;
                         C      ; e/a-tabelle 16k-OPS-Disk
                         C      ;
  DFC1    00             C      	defb	0
  DFC2    DAC2           C      	defw	rdops
  DFC4    DA7D           C      	defw	wrops
  DFC6                   C      eaops::
                         C       endif
                         C      ;
                         C      	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-71


                         C      
  DFC6                   C      ixtab::	defs	32
                         C      ;
  DFE6    DF61           C      ixtab1::defw	eataba		; tabelle der ix-adresse
                         C      
  DFE8    DF66 DF91      C      	defw	eatab1,eatab2
                         C      
                         C       if anzakb gt 1
                         C      	defw	eatab3,eatab4
                         C       else
  DFEC    0000 0000      C      	defw	0,0
                         C       endif
                         C      
                         C       if anzakb gt 2
                         C      	defw	eatab5,eatab6
                         C       else
  DFF0    0000 0000      C      	defw	0,0
                         C       endif
                         C      
                         C       if mindk
                         C      	defw	eamd1,eamd2,eamd3,eamd4
                         C       else
  DFF4    0000 0000      C      	defw	0,0,0,0
  DFF8    0000 0000      C      
                         C       endif
                         C      
                         C       if stadk
                         C      	defw	easd1,easd2
                         C       else
  DFFC    0000 0000      C      	defw	0,0
                         C       endif
                         C      
                         C       if zst
  E000    DFBC           C      	defw	eazst
                         C       else
                         C      	defw	0
                         C       endif
                         C      
                         C       if tramdk
  E002    DFC1           C      	defw	eatram
                         C       else
                         C      	defw	0
                         C       endif
                         C      
                         C       if opsdk
  E004    DFC6           C      	defw	eaops
                         C       else
                         C      	defw	0
                         C       endif
                         C      ;
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-72


                                
                         C      	include	DH.ASM
                         C      ;
                         C      ; T P A   -   Disk		Laufwerk A:
                         C      ; ++++++++++++++++		+++++++++++
                         C      ;
  E006    0000 0000      C      dphad::	defw	0,0		; keine sektorumrechnung
  E00A    0000 0000      C      	defw	0,0
  E00E    E0A4           C      	defw	dirbf
U E010    0000           C      	defw	dpblkm		; geraetebeschreibung
U E012    0000           C      	defw	chkm		; directory-kontrolle
U E014    0000           C      	defw	allm
                         C      
                         C      ; kassette 1 + 2 geblockt	Laufwerk B: und C:
                         C      ; +++++++++++++++++++++++	++++++++++++++++++
                         C      ;
  E016    0000 0000      C      dphc1::	defw	0,0		; keine sektorumrechnung
  E01A    0000 0000      C      	defw	0,0
  E01E    E0A4           C      	defw	dirbf
U E020    0000           C      	defw	dpblkc
U E022    0000           C      	defw	chkc1
U E024    0000           C      	defw	allc1
                         C      ;
  E026    0000 0000      C      dphc2::	defw	0,0		; keine sektorumrechnung
  E02A    0000 0000      C      	defw	0,0
  E02E    E0A4           C      	defw	dirbf
U E030    0000           C      	defw	dpblkc
U E032    0000           C      	defw	chkc2
U E034    0000           C      	defw	allc2
                         C      
                         C      ; kassette 3 + 4 geblockt     Laufwerk D: und E:
                         C      ; +++++++++++++++++++++++     ++++++++++++++++++
                         C      ;
                         C       if anzakb gt 1
                         C      dphc3::	defw	0,0		; keine sektorumrechnung
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkc
                         C      	defw	chkc3
                         C      	defw	allc3
                         C      ;
                         C      dphc4::	defw	0,0		; keine sektorumrechnung
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkc
                         C      	defw	chkc4
                         C      	defw	allc4
                         C       endif
                         C      
                         C      ; kassette 5 + 6 geblockt     Laufwerk F: und G:
                         C      ; +++++++++++++++++++++++     ++++++++++++++++++
                         C      ;
                         C       if anzakb gt 2
                         C      dphc5::	defw	0,0		; keine sektorumrechnung
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkc
                         C      	defw	chkc5
                         C      	defw	allc5
                         C      ;
                         C      dphc6::	defw	0,0		; keine sektorumrechnung
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkc
                         C      	defw	chkc6
                         C      	defw	allc6
                         C       endif
                         C      
                         C      ; mini - disk 1 bis 4     Laufwerk H: , I: , J: und K:
                         C      ; +++++++++++++++++++     ++++++++++++++++++++++++++++
                         C      ;
                         C       if mindk
                         C      dphh1::	defw	0,0		;
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkh
                         C      	defw	chkm1
                         C      	defw	allm1
                         C      ;
                         C      dphi1::	defw	0,0
                         C      	defw	0,0
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-73


                         C      	defw	dirbf
                         C      	defw	dpblkh
                         C      	defw	chkm2
                         C      	defw	allm2
                         C      ;
                         C      dphj1::	defw	0,0
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkh
                         C      	defw	chkm3
                         C      	defw	allm3
                         C      ;
                         C      dphk1::	defw	0,0
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkh
                         C      	defw	chkm4
                         C      	defw	allm4
                         C       endif
                         C      
                         C      ; standard - disk 1 + 2     Laufwerk L: und M:
                         C      ; +++++++++++++++++++++     ++++++++++++++++++
                         C      ;
                         C       if stadk
                         C      dphl1::	defw	0,0
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkl
                         C      	defw	chks1
                         C      	defw	alls1
                         C      ;
                         C      dphm1::	defw	0,0
                         C      	defw	0,0
                         C      	defw	dirbf
                         C      	defw	dpblkl
                         C      	defw	chks2
                         C      	defw	alls2
                         C       endif
                         C      
                         C      ; zentralstation             Laufwerk N:
                         C      ; ++++++++++++++             +++++++++++
                         C      ;
                         C       if zst
  E036    0000 0000      C      dphn1::	defw	0,0
  E03A    0000 0000      C      	defw	0,0
  E03E    E0A4           C      	defw	dirbf
U E040    0000           C      	defw	dpblkn
U E042    0000           C      	defw	chkn
U E044    0000           C      	defw	alln
                         C       endif
                         C      
                         C      ; TRAM - Disk                Laufwerk O:
                         C      ; +++++++++++                +++++++++++
                         C      ;
                         C       if tramdk
  E046    0000 0000      C      dpho1::	defw	0,0
  E04A    0000 0000      C      	defw	0,0
  E04E    E0A4           C      	defw	dirbf
U E050    0000           C      	defw	dpblko
U E052    0000           C      	defw	chko
U E054    0000           C      	defw	allo
                         C       endif
                         C      
                         C      ; 16k - OPS - Disk           Laufwerk P:
                         C      ; ++++++++++++++++           +++++++++++
                         C      ;
                         C       if opsdk
  E056    0000 0000      C      dphp1::	defw	0,0
  E05A    0000 0000      C      	defw	0,0
  E05E    E0A4           C      	defw	dirbf
U E060    0000           C      	defw	dpblkp
U E062    0000           C      	defw	chkp
U E064    0000           C      	defw	allp
                         C       endif
                         C      
                         C      	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-74


                         C      
                         C      ;
  E066    0000           C      dpha::	defw	0		; dph geraet a
  E068    0000           C      dphb::	defw	0		;            b
  E06A    0000           C      dphc::	defw	0		;            c
  E06C    0000           C      dphd::	defw	0		;            d
  E06E    0000           C      dphe::	defw	0		;	     e
  E070    0000           C      dphf::	defw	0		;	     f
  E072    0000           C      dphg::	defw	0		;	     g
  E074    0000           C      dphh::	defw	0		;	     h
  E076    0000           C      dphi::	defw	0		;	     i
  E078    0000           C      dphj::	defw	0		;	     j
  E07A    0000           C      dphk::	defw	0		;	     k
  E07C    0000           C      dphl::	defw	0		;	     l
  E07E    0000           C      dphm::	defw	0		;	     m
  E080    0000           C      dphn::	defw	0		;	     n
  E082    0000           C      dpho::	defw	0		;	     o
  E084    0000           C      dphp::	defw	0		;	     p
                         C      ;
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-75


                                
V                               	include	DB.ASM
                                	page
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-76


                                
                                ;  arbeitszellen
                                ;  =============
                                ;
                                ;
  E086    0000                  dma::	defw	0
  E088    0000                  trk::	defw	0
  E08A    0000                  sec::	defw	0
  E08C    00                    dev::	defb	0
                                ;
  E08D    00                    readop::defb	0		; workspace for blocking/deblocking
  E08E    00                    rsflag::defb	0
  E08F    00                    wrtype::defb	0
  E090    00                    erflag::defb	0
  E091    00                    rderr::	defb	0
  E092    00                    sechst::defb	0
                                ;
  E093    0000                  bsaddr::defw	0		; aktuelle bs-adresse
  E095    00                    qrmode::defb	0		; 1 spezieller rollmodus
  E096    00                    qroll::	defb	0		; 1 es wurde rollen verzoegert
  E097    00                    qesc::	defb	0		; anzeiger fuer steuerfolgen
  0000                          qesc0	equ	0
  0001                          qesc1	equ	1
  0002                          qesc2	equ	2
  E098    20                    umsch::	defb	20h		; aktuelle shiftmaske
  E099    00                    cont::	defb	0		; merkzelle fuer control-taste
  E09A    00                    pf10er::defb	0		; 1 - kassettenladen/-entladen erlaubt
                                ;
  E09B    00                    sverz::	defb	0		; zum verzoegern von const
  E09C    00                    sschr::	defb	0		; 00 - kein schnellschreiben
                                ;
  E09D    05 00 00 00           ccppuf::defb	5,0,0,0,0,0,0	; puffer zur eingabe des lade/entladekommandos
  E0A1    00 00 00              
                                ;
  E0A4                          dirbf::	defs	128
                                ;
  E124                          kmbpuf::defs	100h		; hilfspuffer zum direkten kmbschreiben
                                ;
                                ;
                                ;
  E224                          	defs	80h		; davon ?? benutzt
  E2A4                          spber::	defs	0
                                
  E2A4                          	defs	20h		; davon ?? benutzt
  E2C4                          spber1::defs	0
                                
  E2C4                          	defs	40h
  E304                          stk12::	defs	0
                                
  E304                          spret::	defs	2
  E306    E304                  stkret::defw	stk12
                                ;
                                	page	
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-77


                                
                                
  E308    E308                  	defw	$
  E30A    53 59 53 34           	defb	'SYS4'
                                 if not tap
                                	ld	hl,biosan
                                	ld	(00c02h),hl
                                 endif
  E30E    C3 C600               	jp	biosan
                                
  E311                          biosxx::
                                	.dephase
  1E0E'                         ende::
                                
                                 if opsdk
  1E0E'                         op11::
                                	.phase	00c00h
                                	opsmac
  0C00                    +     op1111::
  0C00    ED 73 0DB0      +     	ld	(opssp1),sp
  0C04    31 0DC2         +     	ld	sp,opssp
  0C07    21 0D28         +     	ld	hl,zsm
  0C0A    11 0D29         +     	ld	de,zsm+1
  0C0D    01 0007         +     	ld	bc,7
  0C10    36 00           +     	ld	(hl),0
  0C12    ED B0           +     	ldir
  0C14    D3 C4           +     	out	(0c4h),a
  0C16    3E 3C           +     	ld	a,00111100b
  0C18    D3 C0           +     	out	(0c0h),a
  0C1A    21 C000         +     	ld	hl,0c000h
  0C1D    16 43           +     	ld	d,01000011b
  0C1F    DD 21 0D28      +     	ld	ix,zsm
  0C23    06 08           +     	ld	b,8
  0C25    7A              +     ops1:	ld	a,d
  0C26    E6 1C           +     	and	00011100b
  0C28    0F              +     	rrca
  0C29    0F              +     	rrca
  0C2A    3C              +     	inc	a
  0C2B    C5              +     	push	bc
  0C2C    47              +     	ld	b,a
  0C2D    3E 80           +     	ld	a,10000000b
  0C2F    07              +     	rlca
  0C30    10 FD           +     	djnz	$-1
  0C32    C1              +     	pop	bc
  0C33    D3 C2           +     	out	(0c2h),a
  0C35    21 C000         +     	ld	hl,0c000h
  0C38    7E              +     	ld	a,(hl)
  0C39    4F              +     	ld	c,a
  0C3A    2F              +     	cpl
  0C3B    77              +     	ld	(hl),a
  0C3C    BE              +     	cp	(hl)
  0C3D    79              +     	ld	a,c
  0C3E    77              +     	ld	(hl),a
  0C3F    20 03           +     	jr	nz,ops2
  0C41    DD 72 00        +     	ld	(ix+0),d
  0C44    7A              +     ops2:	ld	a,d
  0C45    C6 04           +     	add	a,4
  0C47    57              +     	ld	d,a
  0C48    AF              +     	xor	a
  0C49    D3 C2           +     	out	(0c2h),a
  0C4B    DD 23           +     	inc	ix
  0C4D    10 D6           +     	djnz	ops1
  0C4F    AF              +     	xor	a
  0C50    D3 C0           +     	out	(0c0h),a
  0C52    D3 C3           +     	out	(0c3h),a
  0C54    21 0D28         +     	ld	hl,zsm
  0C57    01 0800         +     	ld	bc,800h
  0C5A    7E              +     ops3:	ld	a,(hl)
  0C5B    B7              +     	or	a
  0C5C    23              +     	inc	hl
  0C5D    28 01           +     	jr	z,ops4
  0C5F    0C              +     	inc	c
  0C60    10 F8           +     ops4:	djnz	ops3
  0C62    79              +     	ld	a,c
  0C63    ED 7B 0DB0      +     	ld	sp,(opssp1)
  0C67    C3 D7A3         +     	jp	ops13
  0C6A    C5              +     opszu:	push	bc
  0C6B    E5              +     	push	hl
  0C6C    3A E088         +     	ld	a,(trk)
  0C6F    47              +     	ld	b,a
  0C70    04              +     	inc	b
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-78


  0C71    D3 C4           +     	out	(0c4h),a
  0C73    3E 30           +     	ld	a,00110000b
  0C75    D3 C0           +     	out	(0c0h),a
  0C77    21 0D28         +     	ld	hl,zsm
  0C7A    7E              +     opsz1:	ld	a,(hl)
  0C7B    23              +     	inc	hl
  0C7C    B7              +     	or	a
  0C7D    28 FB           +     	jr	z,opsz1
  0C7F    10 F9           +     	djnz	opsz1
  0C81    2B              +     	dec	hl
  0C82    7E              +     	ld	a,(hl)
  0C83    E6 1C           +     	and	00011100b
  0C85    0F              +     	rrca
  0C86    0F              +     	rrca
  0C87    3C              +     	inc	a
  0C88    47              +     	ld	b,a
  0C89    3E 80           +     	ld	a,10000000b
  0C8B    07              +     	rlca
  0C8C    10 FD           +     	djnz	$-1
  0C8E    D3 C2           +     	out	(0c2h),a
  0C90    E1              +     	pop	hl
  0C91    C1              +     	pop	bc
  0C92    C9              +     	ret
  0C93    AF              +     opsab:	xor	a
  0C94    D3 C2           +     	out	(0c2h),a
  0C96    D3 C0           +     	out	(0c0h),a
  0C98    D3 C3           +     	out	(0c3h),a
  0C9A    C9              +     	ret
  0C9B    AF              +     inp1:	xor	a
  0C9C    32 E088         +     	ld	(trk),a
  0C9F    ED 73 0DB0      +     	ld	(opssp1),sp
  0CA3    31 0DC2         +     	ld	sp,opssp
  0CA6    CD 0C6A         +     	call	opszu
  0CA9    21 C000         +     	ld	hl,0c000h
  0CAC    11 C001         +     	ld	de,0c001h
  0CAF    01 07FF         +     	ld	bc,007ffh
  0CB2    36 E5           +     	ld	(hl),0e5h
  0CB4    ED B0           +     	ldir
  0CB6    21 C000         +     	ld	hl,0c000h
  0CB9    11 C001         +     	ld	de,0c001h
  0CBC    01 001F         +     	ld	bc,01fh
  0CBF    36 00           +     	ld	(hl),0
  0CC1    ED B0           +     	ldir
  0CC3    21 0DC2         +     	ld	hl,opssp
  0CC6    11 C000         +     	ld	de,0c000h
  0CC9    01 000C         +     	ld	bc,12
  0CCC    ED B0           +     	ldir
  0CCE    CD 0C93         +     	call	opsab
  0CD1    ED 7B 0DB0      +     	ld	sp,(opssp1)
  0CD5    C3 DB0A         +     	jp	inp9
  0CD8    ED 73 0DB0      +     wro1:	ld	(opssp1),sp
  0CDC    31 0DC2         +     	ld	sp,opssp
  0CDF    E5              +     	push	hl
  0CE0    21 D9FD         +     	ld	hl,trdma
  0CE3    11 0D30         +     	ld	de,opdma
  0CE6    01 0080         +     	ld	bc,128
  0CE9    ED B0           +     	ldir
  0CEB    CD 0C6A         +     	call	opszu
  0CEE    21 0D30         +     	ld	hl,opdma
  0CF1    D1              +     	pop	de
  0CF2    01 0080         +     	ld	bc,128
  0CF5    ED B0           +     	ldir
  0CF7    CD 0C93         +     	call	opsab
  0CFA    ED 7B 0DB0      +     	ld	sp,(opssp1)
  0CFE    C3 DAA4         +     	jp	wro2
  0D01    ED 73 0DB0      +     rdo1:	ld	(opssp1),sp
  0D05    31 0DC2         +     	ld	sp,opssp
  0D08    CD 0C6A         +     	call	opszu
  0D0B    11 0D30         +     	ld	de,opdma
  0D0E    01 0080         +     	ld	bc,128
  0D11    ED B0           +     	ldir
  0D13    CD 0C93         +     	call	opsab
  0D16    21 0D30         +     	ld	hl,opdma
  0D19    11 D9FD         +     	ld	de,trdma
  0D1C    01 0080         +     	ld	bc,128
  0D1F    ED B0           +     	ldir
  0D21    ED 7B 0DB0      +     	ld	sp,(opssp1)
  0D25    C3 DAAD         +     	jp	rdo2
  0D28                    +     zsm:	defs	8
  0D30                    +     opdma:	defs	128
  0DB0    0000            +     opssp1:	defw	0
  0DB2                    +     	defs	10h
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	1-79


                                	.dephase
  1FD0'                         op12::
                                 endif
                                
  1FD0'                         gosys2::
                                	.phase	gosys0
                                	gosys1
  8000    ED 73 E306      +     	ld	(stkret),sp
  8004    31 E304         +     	ld	sp,stk12
  8007    CD C749         +     	call	uset12
  800A    C3 0000         +     	jp	0
                                	.dephase
  1FDD'                         gosys3::
                                
                                	end	start
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	S


Macros:
CCPCOP          DIRG            GOSYS           GOSYS1          MBOOTM          
OPSMAC          RES12           RESKMB          SET12           SETKMB          
TA              

Symbols:
0000U	ALLC1           0000U	ALLC2           0000U	ALLM            
0000U	ALLN            0000U	ALLO            DB7EI 	ALLOC           
0000U	ALLP            00FD'	ANFANG          0001 	ANZAKB          
D726I 	ARB             C600 	BIOSAN          2200 	BIOSLE          
E311I 	BIOSXX          0022 	BLKLOG          DB1FI 	BLOCK           
DC74I 	BOOT            DD89I 	BOOT01          DDA1I 	BOOT03          
DE0AI 	BOOT04          DE0FI 	BOOT05          DE0AI 	BOOTME          
DDAFI 	BOOTMS          E093I 	BSADDR          CFDCI 	BSADR           
3000 	BSANF           D01AI 	BSROL           C7F0I 	C03             
C804I 	C04             C8A4I 	C06             C8E2I 	C061            
C8DAI 	C062            C8EFI 	C069            C952I 	C07             
C961I 	C08             C991I 	C081            C9AAI 	C082            
C9B2I 	C083            C9CDI 	C09             C9FEI 	C10             
CA10I 	C11             CA10I 	C13             CA10I 	C17             
CAE9I 	C170            CB50I 	C171            CB61I 	C172            
CB18I 	C173            CB47I 	C174            CB92I 	C18             
CA85 	C189            DC73I 	CALLHL          CB9BI 	CBIT4           
CBA0I 	CBIT41          CBA5I 	CBIT42          CBAEI 	CBIT43          
CBBCI 	CBIT44          0031I'	CCA1            0045I'	CCA2            
DE9BI 	CCPCP1          E09DI 	CCPPUF          D514I 	CEERRE          
D4F1I 	CEERRO          D487I 	CENTL           D49DI 	CENTLE          
0000U	CHKC1           0000U	CHKC2           0000U	CHKM            
0000U	CHKN            0000U	CHKO            0000U	CHKP            
DB43I 	CHKUNA          C79F 	CI              CD58I 	CI.BELL         
CD23I 	CI.CH           CD19I 	CI.KALT         CD1DI 	CI.STA          
CD19I 	CI.WARM         CD37 	CI1             CD41 	CI2             
CD49 	CI3             CD51 	CI4             CD56 	CI5             
C76AI 	CIBER           D42AI 	CLAD            D096I 	CO.BCU          
CD90I 	CO.C1           CD97I 	CO.C2           CDECI 	CO.C3           
CE26I 	CO.C4           CD7EI 	CO.CH           D0C9I 	CO.DEG          
C78AI 	CONIN           C799I 	CONIN0          C799I 	CONIN1          
C799I 	CONIN3          CBC2I 	CONOU           CBD2I 	CONOU0          
CBD2I 	CONOU1          CBD9I 	CONOU3          C755I 	CONST           
C764I 	CONST0          C764I 	CONST1          C764I 	CONST3          
E099I 	CONT            0023 	CPMSPT          CD6E 	CPMTAB          
D5ADI 	CPOS            D3FEI 	CPOSX           000D 	CR              
DEF9I 	CUBDOS          DEF7I 	CUDEV           0044 	DATUM           
DB13I 	DEBLCK          C92DI 	DEFA            C93EI 	DEFA2           
CD6E 	DEGEND          CD5E 	DEGTAB          E08CI 	DEV             
7C06 	DINIT           F000 	DIR1            F800 	DIR2            
D40BI 	DIRADR          E0A4I 	DIRBF           DC93I 	DIRDEL          
DCFF 	DIRG11          DD89 	DIRG12          DCE2 	DIRGO           
DCEE 	DIRGO1          E086I 	DMA             7C09 	DOUT            
0000U	DPBLKC          0000U	DPBLKM          0000U	DPBLKN          
0000U	DPBLKO          0000U	DPBLKP          E066I 	DPHA            
E006I 	DPHAD           E068I 	DPHB            E06AI 	DPHC            
E016I 	DPHC1           E026I 	DPHC2           E06CI 	DPHD            
E06EI 	DPHE            E070I 	DPHF            E072I 	DPHG            
E074I 	DPHH            E076I 	DPHI            E078I 	DPHJ            
E07AI 	DPHK            E07CI 	DPHL            E07EI 	DPHM            
E080I 	DPHN            E036I 	DPHN1           E082I 	DPHO            
E046I 	DPHO1           E084I 	DPHP            E056I 	DPHP1           
0000 	DR54            0007 	EAADR           000A 	EABM            
000D 	EADPUF          0F70 	EADR            000F 	EADZEI          
0005 	EAEP            0001 	EAFEHL          0004 	EAKOM           
0FA0 	EALBL           0F80 	EALBS           0009 	EALEN           
DFC6I 	EAOPS           0000 	EASTAT          DF66I 	EATAB1          
DF91I 	EATAB2          DF61I 	EATABA          DFC1I 	EATRAM          
000C 	EAVERL          000B 	EAWIED          0010 	EAWOVO          
DFBCI 	EAZST           D52B 	EDRUC           1E0EI'	ENDE            
D51CI 	ENDRUC          DF19I 	ENDUSE          008A 	EQ.BCU          
00CE 	EQ.BSD          00FF 	EQ.CAP          008B 	EQ.DEG          
0080 	EQ.GRA          00FE 	EQ.HEX          0089 	EQ.INI          
0081 	EQ.LE1          0082 	EQ.LE2          00FD 	EQ.LR0          
00FC 	EQ.LW           0088 	EQ.SIO          00CD 	EQ.SYS          
E090I 	ERFLAG          0004 	ERRANZ          D725I 	ERRCOU          
001B 	ESC             D046I 	EVTROL          C902 	EXCH            
C909 	EXCH1           C917 	EXCH2           0000 	FALSE           
D696I 	FEHL00          D69FI 	FEHL01          D698I 	FEHL0A          
D677I 	FEHLER          000C 	FF              DBC3I 	FILHST          
D596I 	FILPAR          001D 	GELADE          DF3BI 	GETPU1          
DF57I 	GETPU2          DF28I 	GETPUF          8000 	GOSYS0          
1FD0I'	GOSYS2          1FDDI'	GOSYS3          D235I 	HOME            
D259I 	HOME1           001E 	HRD             D3B8I 	HRDKMB          
D307I 	HSAD1           D2FEI 	HSADR           0017 	HSTACT          
0012 	HSTBUF          0016 	HSTSEC          0014 	HSTTRK          
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	S-1


0018 	HSTWRT          0020 	HWR             D35FI 	HWRKMB          
CFCBI 	INCAD           CAC2 	INO1            0C9B 	INP1            
CAC8 	INP2            DB0A 	INP9            CACE 	INT1            
DEF6I 	IOBYT           C71CI 	IODIS1          C71FI 	IODIS2          
C710I 	IODISP          0005 	ISBLK           0004 	IXRD            
DFC6I 	IXTAB           DFE6I 	IXTAB1          0002 	IXWR            
2800 	KASBU1          2900 	KASBU2          C9DDI 	KM.LE           
C9F1I 	KM.LE1          C9FBI 	KM.LE2          D6E3I 	KMB             
D6FFI 	KMB01           D712I 	KMB02           D71AI 	KMBEP           
4965 	KMBINI          E124I 	KMBPUF          4000 	KMBROB          
46AD 	KMBRUC          DF0AI 	KMBUSE          000C 	KMBVERS         
D722I 	KMWART          D548I 	KONLEN          D552I 	KONSENT         
7000 	LBL             7003 	LBS             C72B 	LDHLDP          
D817 	LDHLRI          D820 	LDPUHL          D53EI 	LESEN           
000A 	LF              CBF6I 	LIST            CC06I 	LIST0           
CC0DI 	LIST1           CC14I 	LIST2           CC1BI 	LIST3           
CBE3I 	LISTS           CBFAI 	LISTX           D128 	LO.CH           
D0FCI 	LO.RESET        C815 	LR011           C841 	LR012           
C841 	LR013           C850 	LR014           C850 	LR015           
C85F 	LR016           C860 	LR017           C87DI 	LRTXT           
CBF2I 	LSST0           CBF2I 	LSST1           CBF2I 	LSST2           
CBF2I 	LSST3           0043 	LWA             C77BI 	M001            
C77EI 	M002            C785I 	M003            C7B4I 	M012            
C7B8I 	M013            C7C0I 	M014            C7CFI 	M015            
C7D0I 	M016            D2D6I 	M04             D2D9I 	M041            
D2EE 	M05             DED9I 	M104            CD95I 	M106            
CDE6I 	M107            CDF5I 	M1072           CDFCI 	M1074           
CDFEI 	M1076           CE04I 	M1078           CE0BI 	M108            
CE2BI 	M109            CE46I 	M11             CE6CI 	M12             
CE76I 	M121            CE7FI 	M13             CE90I 	M14             
CE94I 	M141            CE9CI 	M15             CEA2I 	M16             
CEA8I 	M17             CEAEI 	M18             CEB7I 	M185            
CEC1I 	M19             CECEI 	M191            CEE4I 	M19A            
CEEDI 	M19A1           CEF0I 	M19B            CEF9I 	M19B1           
CEFEI 	M19X            CF02I 	M19Y            CF07I 	M20             
CF1BI 	M201            CF29I 	M21             CF40I 	M211            
CF60I 	M22             CF77I 	M221            CF94I 	M222            
CF9D 	M223            CFB5I 	M23             CFC0I 	M24             
CFC2I 	M241            CFC8I 	M25             CFE2I 	M30             
CFE8I 	M303            CFEDI 	M307            CFFBI 	M31             
D005I 	M32             D008I 	M33             DBE0I 	MATCH           
0050 	MAXS            0018 	MAXZ            D9BBI 	MD.INO          
DAF6I 	MD.INP          D729I 	MD.KALT         D7D1I 	MD.WARM         
D734 	MDK20           D76C 	MDK21           D783 	MDK22           
D810 	MDW1            D7D1 	MDW2            D7C4 	MDW3            
0000 	MINDK           CB07 	MON1            CB36 	MON2            
DEC1I 	NOADEV          DBBCI 	NOMATC          0000U	NOMATCH         
DB78I 	NOOVF           1E0EI'	OP11            0C00I 	OP1111          
1FD0I'	OP12            DADCI 	OPADR           0D30 	OPDMA           
0C25 	OPS1            D7A3 	OPS13           0C44 	OPS2            
0C5A 	OPS3            0C60 	OPS4            D7C1 	OPS5            
0C93 	OPSAB           FFFF 	OPSDK           0DC2 	OPSSP           
0DB0 	OPSSP1          0C7A 	OPSZ1           0C6A 	OPSZU           
E09AI 	PF10ER          FFFF 	PIPEQ           0030 	PKMB            
00A0 	PTAST           D1E9I 	PU.CH           D207 	PU.CH1          
D21C 	PU.CH2          D206I 	PU1.CH          D21BI 	PU2.CH          
CC5FI 	PUNCH           CC6FI 	PUNCH0          CC76I 	PUNCH1          
CC7DI 	PUNCH2          CC84I 	PUNCH3          E097I 	QESC            
0000 	QESC0           0001 	QESC1           0002 	QESC2           
E095I 	QRMODE          E096I 	QROLL           E091I 	RDERR           
DC67I 	RDH01           DC6FI 	RDH02           D39FI 	RDK01           
D3C2I 	RDK02           D3CBI 	RDK03           D3CEI 	RDK04           
D389I 	RDKMB           D2DDI 	RDMEM           D2F1I 	RDMEM0          
0D01 	RDO1            DAAD 	RDO2            DAC2I 	RDOPS           
CC31I 	RDST0           CC31I 	RDST1           CC31I 	RDST2           
CC31I 	RDST3           D8D2I 	RDTRAM          D884 	RDZ1            
D894 	RDZ2            D866I 	RDZST           D2B4I 	READ            
CC45I 	READ0           CC4BI 	READ1           CC53I 	READ2           
CC59I 	READ3           CC36I 	READE           CC39I 	READE1          
DC5CI 	READHST         E08DI 	READOP          CC25I 	READS1          
CC22I 	READST          D07DI 	RESCUR          C700I 	RETA            
DC39I 	RETMOV          C708I 	RETU            C70FI 	RETURN          
D1A5I 	RI.ATA          D1C6I 	RI.ATB          D150I 	RI.CH           
D17B 	RI.CH1          D197 	RI.CH2          D1E7 	RI.CTCT         
D1DE 	RI.SIOT         D16DI 	RI1.CH          D189I 	RI2.CH          
D728I 	RICHTU          DC22I 	RMOVE           E08EI 	RSFLAG          
D514I 	RUCKSP          DB93I 	RWOP01          DB87I 	RWOPER          
E08AI 	SEC             E092I 	SECHST          0025 	SECMSK          
0024 	SECSHF          D279I 	SECTR           D283I 	SECTR1          
D266I 	SELDS           DE95I 	SERIAL          C9B8I 	SETAMS          
D05CI 	SETCUR          D261I 	SETDM           D287I 	SETIX           
D230I 	SETSE           D25CI 	SETTR           B000 	SIMAD           
12.August 85     DEG2000-BIOS    Version 4.3	MACRO-80 3.44	09-Dec-81	PAGE	S-2


0000 	SIMGR           0042 	SIMSIZ          CA4E 	SIOA            
CA5E 	SIOB            CA6E 	SIOT1           0000U	SIZEM           
D43EI 	SP21            D479I 	SP25            D47CI 	SP26            
D4A8I 	SP301           D4B8I 	SP31            D4E4I 	SP32            
D5B2I 	SP40            D5C7I 	SP41            D5E2I 	SP42            
D5EEI 	SP43            D608I 	SP44            D61AI 	SP45            
D629I 	SP451           D63FI 	SP46            D644I 	SP47            
D659I 	SP48            0041 	SPALT           E2A4I 	SPBER           
E2C4I 	SPBER1          E304I 	SPRET           E09CI 	SSCHR           
0000 	STADK           0000I'	START           E304I 	STK12           
E306I 	STKRET          E09BI 	SVERZ           DEF3I 	SYSPA           
CCA3I 	TA1             CCBDI 	TA2             CCE8 	TA21            
0009 	TAB             0000 	TALT            FFFF 	TAP             
CD02I 	TBEL            D906I 	TDADR           D912 	TDADR1          
D920 	TDADR2          CCEBI 	TFE             CC8CI 	TINIT           
D9FBI 	TRAM            FFFF 	TRAMDK          D9FDI 	TRDMA           
E088I 	TRK             FFFF 	TRUE            6EF3 	TTA1            
6EF6 	TTA2            D9FAI 	TTANZ           6F05 	TTBEL           
6EFC 	TTFE            6EF0 	TTINIT          D9FCI 	TTRK            
CC8B 	UMERK           E098I 	UMSCH           0019 	UNACNT          
001C 	UNASEC          001A 	UNATRK          D93B 	UP11            
D93D 	UP12            D941 	UP13            D949 	UP14            
D955 	UP15            D990 	UP2             D95D 	UP21            
D95F 	UP22            D961 	UP23            D965 	UP24            
D970 	UP25            D9A7 	UP3             D97C 	UP31            
D97E 	UP32            D980 	UP33            D984 	UP35            
D9A3 	UP4             C73AI 	URES12          C749I 	USET12          
D723I 	WAS             DE5CI 	WBOOT           DC09I 	WMOVE           
D2AFI 	WR15            D2B1I 	WR16            0001 	WRDIR           
D29CI 	WRITE           DC4FI 	WRITEHST        D343I 	WRK01           
D35CI 	WRK02           D329I 	WRKMB           D2C7I 	WRMEM           
D2EEI 	WRMEM0          0CD8 	WRO1            DAA4 	WRO2            
DA7DI 	WROPS           D89DI 	WRTRAM          E08FI 	WRTYPE          
0002 	WRUAL           D847 	WRZ1            D85D 	WRZ2            
D829I 	WRZST           0040 	ZEIL            C788I 	ZGROS           
C786I 	ZKLEIN          0D28 	ZSM             DB12 	ZSMA            
FFFF 	ZST             



33 Fatal error(s)


RITEHST        D343I 	WRK01           
D35CI 	WRK02           D329I 	WR