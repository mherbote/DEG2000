	TITLE	'Kommandos: KRDx und KWRx'	PAGE;	PN	KH;**********************************************************************;;   Kommando:;        KRDx...Block einlesen und anzeigen;               zusaetlich werden die entsprechenden Puffer-;               adressen angezeigt.;        KWRx...Block schreiben, standardmaessig nach 'KRDx';               Ansonsten muessen Blockadresse und Blocklaenge in der;               Verstaendigungstabelle eingetragen werden.;;**********************************************************************	DW	$	DB	'KRD1'	JR	KH.RDSTA;	DW	$	DB	'KRD2'KH.RDSTA:	CALL	U1.KTINI	;Initialisierung E/A-Tab.	LD	A,(UE.BWSA+325H)	AND	0FH	LD	(IX+3),A	;Subadresse eintragenKH.RES:	CALL	UR.KRE	;ReservierenKH.RD1:	LD	(IX+4),02H	;Block wiedergeben	CALL	UF.EXEC	LD	A,(IX+9)	OR	(IX+10)	JP	Z,KH.RDBM	CALL	KH.BILO	CALL	KH.ANZBL	;Block anzeigenKH.RD3:	CALL	UR.TAREP	;Tastaturabfrage	CP	089H	JR	Z,KH.RD1	;---> P 10	CP	08BHKH.RD6:	CALL	Z,KH.RD2	;---> P 12	JR	Z,KH.RD1	CP	0CDHKH.RD4:	JR	Z,KH.SYSRT	;---> SYS	CP	85H	CALL	Z,KH.KBRS	;---> P 6	CP	86H	LD	(IX+10),1	PUSH	AF	CALL	Z,UR.KLV	;---> P 7	POP	AF	JR	Z,KH.RD3	CP	87H	PUSH	AF	CALL	Z,UR.KRA	;---> P 8	POP	AF	JR	Z,KH.RD3	CP	88H	PUSH	AF	CALL	Z,UR.KLR	;---> P 9	POP	AF	JR	Z,KH.RD3	CP	0E2H	;CTRL,US,B : BM SCHREIBEN	PUSH	AF	CALL	Z,UR.KBM	POP	AF	JP	Z,KH.RD3	CP	83H	JP	Z,KH.RES	;---> P 4	CP	84H	CALL	Z,UR.KRWW	;---> P 5	JP	KH.RD3KH.SYSRT:	CALL	KH.BILO	;Systemruecksprung	RETKH.RD2:	PUSH	AF	;Flags retten	CALL	UR.KBR	;Block ruecksetzen	CALL	UR.KBR	POP	AF	RETKH.RDBM:	CALL	KH.BILO	LD	HL,UA.ZKBM	;"Bandmarke"	LD	DE,UE.BWSA	LD	BC,9	LDIR	JP	KH.RD3KH.ANZBL:	CALL	KH.BILOKH.ANZB1:	LD	HL,UE.PUF	CALL	KH.AZBLD	;Bild anzeigen (24 Zeilen)	RET		; IN...HL:=akt. PufferadresseKH.AZBLD:	LD	B,24	; 24 Zeilen anzeigen	LD	DE,UE.BWSAKH.AZBL1:	PUSH	BC	CALL	KH.AZ1Z	; 1 Zeile anzeigen	POP	BC	PUSH	HL	;akt. Pufferadresse retten	EX	DE,HL	LD	DE,80	ADD	HL,DE	;neuen Zeilenanfang berechnen	EX	DE,HL	POP	HL	DJNZ	KH.AZBL1	RET;                                IN...HL:= Pufferadresse;                                     DE:= ZeilenanfangKH.AZ1Z:	PUSH	DE	;eine Zeile anzeigen	PUSH	HL	PUSH	DE	POP	HL	LD	BC,64	ADD	HL,BC	PUSH	HL	POP	BC	;BC:= Anfang ASCII-Darstellung	POP	HL	CALL	KH.AZADR	;Adresse anzeigen	INC	DE	INC	DE	CALL	KH.AZ4BY	;1. Vierergruppe	INC	DE	INC	DE	CALL	KH.AZ4BY	;2.      "	INC	DE	INC	DE	CALL	KH.AZ4BY	;3.      "	INC	DE	INC	DE	CALL	KH.AZ4BY	;4.      "	POP	DE	RETKH.AZADR:	LD	A,H	;Anzeige der Adresse	CALL	UC.CVBX+2	LD	A,L	CALL	UC.CVBX+2	RETKH.AZ4BY:	XOR	A	;Anzeige einer Vierergruppe	LD	(UB.PAR1),AKH.AZ4B0:	LD	A,(HL)	PUSH	AF	CALL	UC.CVBX+2	;Code als Hexadezimalzahl	POP	AF	INC	DE	INC	HL	CP	20H	JR	C,KH.AZ4B1	;nicht darstellbar	CP	7FH	JR	NC,KH.AZ4B1	;nicht darstellbarKH.AZ4B3:	LD	(BC),A	;Code als ASCII-Zeichen	INC	BC	CALL	KH.BLEVG	;Test auf Blockende	LD	A,(UB.PAR1)	INC	A	CP	4	RET	Z	LD	(UB.PAR1),A	JR	KH.AZ4B0KH.AZ4B1:	LD	A,07FH	JR	KH.AZ4B3KH.BLEVG:	PUSH	DE	;Blockendetest	PUSH	HL	LD	DE,UE.PUF	;DE:= Pufferanfang	OR	A	SBC	HL,DE	;HL:= Anzahl der angezeigten	EX	DE,HL	CALL	XY.LIDX	DB	9	OR	A	SBC	HL,DE	POP	HL	POP	DE	JR	Z,KH.BLEV1	RETKH.BLEV1:	LD	B,12KH.BLEV2:	INC	SP	DJNZ	KH.BLEV2	RET		;---> Anzeige beendet;*********************************************************************	DW	$	DB	'KWR1'	JR	KH.WRSTA;	DW	$	DB	'KWR2'KH.WRSTA:	LD	A,(UE.BWSA+325H)	LD	IX,UB.KTAB	;Block aufzeichnen	BIT	2,(IX)	JR	Z,$+9	PUSH	AF	LD	A,19H	CALL	UF.ERANZ	POP	AF	AND	0FH	LD	(IX+3),A	LD	(IX+4),00H	CALL	UF.EXEC	CALL	UR.KBR	JP	KH.RD1KH.KBRS:	CALL	UR.KBR	CALL	KH.BILO	POP	DE	RET;----------------------------------------------------KH.BILO:	LD	HL,3000H	LD	BC,800H	LD	(HL),20H	PUSH	HL	POP	DE	INC	DE	LDIR	RET;------------------------------------------------------;	END