	TITLE	'Laden von MRES-P-Dateien'	PAGE;	PN	LD;***********************************************************;;        Laden von MRES-P-Dateien;;***********************************************************	DW	$	DB	'LOAD'	LD	A,(UE.BWSA+327H)	CALL	U1.TST	RET	C	CALL	U1.KTINI	LD	(IX+3),A	CALL	U1.BILO	LD	A,13	LD	(UB.ZN),ALD.DATN:	LD	HL,UA.ZKDAT	;Dateiname ?	CALL	UR.MIMO	RET	C	CALL	UR.KRE	CALL	UR.KRWW	CALL	U1.DSVG	LD	A,01H	CP	B	JR	Z,LD.LD21	;NEU INITIALISIERTE KASSETTELD.LD2:	CALL	UK.KBW	CALL	U1.NMVGL	;Dateiname vergleichen	JR	C,LD.DATFU	;---> Datei gefunden	DJNZ	LD.LD2LD.LD21:	LD	A,91H	;Datei nicht vorhanden	CALL	UF.ERANZ	;FEHLERANZEIGE	RETLD.DATFU:	LD	A,(UE.PUF+6)	;TYP	CP	'O'	PUSH	AF	LD	HL,UE.PUF+23	LD	A,(HL)	PUSH	AF	LD	B,A	INC	B	CALL	UR.POSIK	;Positionieren	CALL	UK.KBW	POP	AF	LD	HL,UE.PUF	CP	(HL)	JR	Z,LD.DATPO	;Datei richtig positioniert	POP	AF	LD	A,94H	CALL	UF.ERANZ	RETLD.DATPO:	POP	AF	JP	Z,RL.BEG	LD	A,(UE.BWSA+329H)	CP	'V'	JR	NZ,LD.LD3	LD	HL,UA.ZKLAD	;Ladeadresse ?	CALL	UR.MIMO	JP	C,LD.DATN	CALL	U1.PRADR	;ADRESSE EINGEGEBEN	JR	C,$-12	EX	DE,HL	LD	HL,UB.PAR1	CALL	UC.CVXALD.LD4:	CALL	UK.KLPFB	CALL	UK.GETK	CALL	UK.GETK	LD	H,A	CALL	UK.GETK	LD	L,A	LD	A,D	OR	E	JR	Z,LD.LD5	LD	DE,(UB.PAR1)	EX	DE,HL	OR	A	SBC	HL,DE	EX	DE,HL	;DE:= Verschiebung zur erstenLD.LD5:	CALL	UR.KBR	CALL	LD.LADER	LD	(UB.PAR2),HL	LD	HL,UE.BWSA+329H	LD	B,4	LD	A,(HL)	CP	'S'	JR	Z,LD.START	INC	HL	DJNZ	$-6	CALL	UR.KRW	CALL	UR.KRA	RETLD.START:	CALL	UR.KRW	CALL	UR.KRA	LD	HL,(UB.PAR2)	JP	(HL)LD.LD3:	LD	DE,0	JR	LD.LD4;--------------------------------------------------------------LD.LADER:	CALL	UK.KLPFBLD.LAD2:	CALL	UK.GETK	CP	0	JR	Z,LD.LDEND	LD	B,A	CALL	UK.GETK	LD	H,A	CALL	UK.GETK	LD	L,A	ADD	HL,DELD.LAD1:	CALL	UK.GETK	LD	(HL),A	CP	(HL)	JR	NZ,LD.LADF	INC	HL	DJNZ	LD.LAD1	JR	LD.LAD2LD.LDEND:	CALL	UK.GETK	LD	H,A	CALL	UK.GETK	LD	L,A	RETLD.LADF:	LD	A,93H	CALL	UF.ERANZ	RET;----------------------------------------------------------------------;	END