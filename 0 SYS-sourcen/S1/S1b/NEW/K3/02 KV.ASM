	TITLE	'Anzeigen und Aendern des MRES-Verzeichnisses'	PAGE;	PN	KV;----------------------------------------------------------------------;;    ANZEIGEN UND AENDERN DES VERZEICHNISSES VON MRES KASSETTEN;;----------------------------------------------------------------------	DW	$	DB	'DIR '	LD	A,(UE.BWSA+326H)	CALL	U1.TST	RET	C	CALL	U1.KTINI	LD	(IX+3),A	CALL	U1.BILO	CALL	UR.KRE	CALL	UR.KRWW	CALL	U1.DSVG	PUSH	BC;----------------------------------------------------------------------	CALL	U1.KBR4	;KASS.NAME,NR.,KOMMENTAR ANZEIGEN	LD	(IX+4),02H	CALL	UF.EXEC	LD	HL,UE.PUF+4	LD	DE,3240H	;=8.ZEILE,16.SPALTE	LD	B,6	CALL	UC.DKONV	LD	HL,UE.PUF+37	INC	DE	INC	DE	LD	B,3	CALL	UC.DKONV	INC	DE	INC	DE	LD	B,11	CALL	UC.DKONV	LD	HL,3290H	LD	A,'='	LD	(HL),A	PUSH	HL	POP	DE	INC	DE	LD	BC,23	LDIR;----------------------------------------------------------------------	LD	B,3	;POSITIONIEREN VOR DS-SATZ	CALL	UF.EXEC	DJNZ	$-3	CALL	U1.VERIN	CALL	UR.KRWW	LD	B,7	CALL	U1.VORS1	POP	BC	DEC	B	CALL	KV.ANZ	INC	B	DEC	B	JP	Z,KV.KRW	INC	B	PUSH	BC;----------------------------------------------------------------------KV.ANF:	DEC	B	LD	A,B	LD	E,B	SUB	9	JR	C,$+7	LD	C,9	LD	B,C	JR	$+5	LD	B,E	LD	C,B	XOR	A	PUSH	AF	;A=RESTL.ANZAHL ODER 0	PUSH	BC	LD	HL,UB.SATZ	LD	(HL),00H	INC	HL	LD	(HL),55	INC	HL	LD	(HL),80H	INC	HL	LD	B,55	LD	A,20H	CALL	U1.TR	;AUSGABESATZ LOESCHEN	LD	A,13	LD	(UB.ZN),A	CALL	U1.BILO	LD	DE,UB.SATZ+18	PUSH	DE	LD	HL,BC.VTABE+32	;ADR. VERZ.TABELLE	PUSH	HL;---------------------------MAX 9 SAETZE ANZEIGEN----------------------KV.ZLTR:	CALL	KV.BSTR	;VTABE-->UB.SATZ	POP	DE	;VERZ.ADR.	POP	HL	;ADR.AUSGABESATZ	PUSH	HL	PUSH	DE	LD	BC,18	OR	A	SBC	HL,BC	CALL	UR.MIMO	;ANZEIGE EINE ZEILE	POP	HL	;VERZ.ADR	POP	DE	LD	BC,32	ADD	HL,BC	POP	BC	DEC	B	JR	Z,$+7	PUSH	BC	PUSH	DE	PUSH	HL	;NEUE VERZ.TAB ADR	JR	KV.ZLTR;----------------------------------------------------------------------	LD	B,C	;ANZAHL DER ANGEZEIGTEN ZEILEN	LD	A,(UB.ZN)	SUB	B	LD	(UB.ZN),A	;KURSOR AUF ANFANG 12.ZEILE	PUSH	BC	PUSH	DE	PUSH	HL;------------------------VERZ. ZEIGER AUF 1.ANGEZEIGTE EINTR.	PUSH	BC	LD	BC,32	OR	A	SBC	HL,BC	POP	BC	DJNZ	$-8	PUSH	HL;----------------------------------------------------------------------KV.TABTR:	LD	HL,UA.LD	CALL	UR.MIMO	;KURSOR AUF ANF.12.ZEILE	JP	C,KV.ZEIHO	POP	DE	PUSH	DE	;ZIELADR.IN VTAB	CALL	KV.SPTR	;ZEILE WIEDER IN SPEICHER	POP	HL	;ZIELADR.IN VTAB	LD	BC,32	ADD	HL,BC	POP	IY	POP	DE	POP	BC	DEC	B	JR	Z,$+9	PUSH	BC	PUSH	DE	PUSH	IY	PUSH	HL	JR	KV.TABTR;--------------------WEITERBLAETTERN ODER AUSGABE----------------------	POP	AF	OR	A	JR	Z,KV.AUSG	;KEINE WEITEREN ANZEIGEN	SUB	9	JR	C,$+7	LD	B,9	LD	C,B	JR	$+7	ADD	A,9	LD	B,A	LD	C,B	XOR	A	PUSH	AF	PUSH	BC	PUSH	DE	PUSH	HL	LD	A,13	LD	(UB.ZN),A	CALL	U1.BILO	POP	HL	POP	DE	PUSH	DE	PUSH	HL	JP	KV.ZLTR;----------------------------------------------------------------------KV.ZEIHO:	LD	HL,UB.ZN	LD	A,(HL)	SUB	15	JR	C,$+23	;WENN IN 12. ZEILE SYS GEDRUECKT	DEC	(HL)	DEC	(HL)	;ZEILENNR.-2	POP	HL	LD	BC,32	OR	A	SBC	HL,BC	;VERZ.ZEIGER RUECKSETZEN	POP	IY	POP	DE	POP	BC	INC	B	PUSH	BC	PUSH	DE	PUSH	IY	PUSH	HL	JR	$+3	DEC	(HL)	JP	KV.TABTR;----------------------------------------------------------------------KV.AUSG:	PUSH	HL	LD	HL,UA.ZRSCH	CALL	UR.MIMO	LD	A,(HL)	POP	HL	CP	'J'	JR	Z,$+19	LD	HL,UA.ANZWD	CALL	UR.MIMO	LD	A,(HL)	CP	'J'	POP	BC	JP	NZ,KV.KRW	PUSH	BC	JP	KV.ANF;--------------------------------Dateien am Ende loeschen ? ---------	CALL	KV.SBC	JR	NZ,$+54	LD	A,(BC.VTABE+3)	DEC	A	LD	E,A	LD	D,0	LD	A,1	ADD	A,D	LD	D,A	DEC	E	JR	Z,$+7	CALL	KV.SBC	JR	Z,$-10	POP	BC	;D: Anzahl zu loeschender Dateien	LD	A,C	SUB	D	LD	(UE.PUF+1),A	;DS-Satz korrigieren	LD	A,B	SUB	D	LD	(UE.PUF+3),A	CALL	UR.KBR	CALL	UR.KBR	CALL	UR.KBV	LD	(IX+4),08H	CALL	UF.EXEC	;und schreiben	LD	B,A	DEC	B	JR	Z,$+34	INC	B	PUSH	BC;-------------------------------------Verzeichnis schreiben -----------	POP	BC	DEC	B	LD	HL,BC.VTABE+32	PUSH	BC	LD	DE,UE.PUF	LD	BC,32	LDIR	CALL	UR.KBV	CALL	UR.KBR	LD	(IX+4),08H	;OHNE RAW	CALL	UF.EXEC	POP	BC	DJNZ	$-23;---------------------------------------------------------------------KV.KRW:	CALL	UR.KRW	CALL	UR.KRA	LD	A,(UE.BWSA+328H)	CP	'D'	RET	NZ	LD	HL,UE.BWSA+23DH	NOP	CALL	KV.DRU1	LD	HL,UE.BWSA+28DH	CALL	KV.DRU1	CALL	UE.PRINT	LD	HL,UB.DTAB	LD	DE,UB.DTAB+1	LD	BC,40	LD	(HL),20H	LDIR	LD	A,(BC.VTABE+3)	LD	B,A	DEC	B	LD	HL,BC.VTABE	LD	DE,32KV.P1:	PUSH	BC	ADD	HL,DE	PUSH	HL	PUSH	DE	LD	DE,UB.DTAB	CALL	KV.BSTR	LD	HL,UB.DTAB	LD	B,40	CALL	KV.DRU	POP	DE	POP	HL	POP	BC	DJNZ	KV.P1	RETKV.DRU1:	LD	B,30KV.DRU:	LD	A,(HL)	INC	HL	CALL	KV.KO02	DJNZ	KV.DRU	LD	A,1EH	CALL	UE.PRINT	RET;KV.KO02:	RES	7,A	;FUER KV17 (DRUCKERAUSGABE)	CP	20H	JR	NC,$+4	LD	A,2AH	JP	UE.PRINT;---------------------------------------------------------------------KV.BSTR:	LD	BC,6	;Aufbereitung des Verz.Satzes	PUSH	BC	LDIR		;Transport VTABE--->UB.SATZ	INC	DE	INC	DE	INC	DE	LD	BC,2	LDIR	INC	DE	INC	DE	INC	DE	POP	BC	PUSH	BC	LDIR	INC	DE	INC	DE	INC	DE	POP	BC	LDIR	INC	DE	INC	DE	INC	DE	LD	BC,3	LDIR	INC	DE	INC	DE	INC	DE	LD	L,(HL)	;Konvertierung Labelnummer	LD	H,0	CALL	UC.CVBD2	RET;----------------------------------------------------------------------KV.SPTR:	LD	A,(HL)	CP	09H	;Soll Satz geloescht werden?	JR	NZ,$+4	XOR	A	LD	(HL),A	LD	BC,6	PUSH	BC	LDIR		;Ruecktransport BWSA--->VTABE	INC	HL	INC	HL	INC	HL	LD	BC,2	LDIR	INC	HL	INC	HL	INC	HL	POP	BC	PUSH	BC	LDIR	INC	HL	INC	HL	INC	HL	POP	BC	LDIR	INC	HL	INC	HL	INC	HL	LD	BC,3	LDIR	INC	HL	INC	HL	INC	HL	PUSH	DE	EX	DE,HL	CALL	KV.DBCVM	LD	A,L	POP	HL	LD	(HL),A	RET;----------------------------------------------------------------------KV.DBCVM:	LD	B,2	;FELDLAENGE	CALL	UC.CVDB	;KONVERTIER. DEZI-->BINAER	RET	NC		;OHNE FEHLER	RET	NZ	INC	DE	;1.ZEICHEN WAR KEINE DEZ.ZAHL	DJNZ	$-6	RET;----------------------------------------------------------------------KV.SBC:	LD	BC,32	OR	A	SBC	HL,BC	LD	A,(HL)	CP	00H	RET	;---------------------------------------------------------------------KV.ANZ:	PUSH	BC	LD	L,B	LD	H,0	LD	DE,3332H	CALL	UC.CVBD3	INC	DE	INC	DE	LD	HL,KV.AVZS	LD	BC,17	LDIR	POP	BC	RET;-----------------------------------------------------------------------KV.AVZS:	DB	'Verzeichnissaetze';----------------------------------------------------------------------;	END