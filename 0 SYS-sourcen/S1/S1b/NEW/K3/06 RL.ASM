	TITLE	'Relativloader fuer O-Dateien'	PAGE;	PN	RL;----------------------------------------------------------------------;;     RELATIVLOADER FUER O-DATEIEN;;----------------------------------------------------------------------RL.BEG:	LD	HL,UA.ZKBEG	;BEGINN ?	CALL	UR.MIMO	JP	C,LD.DATN	CALL	U1.PRADR	JR	C,RL.BEG	EX	DE,HL	LD	HL,UB.PATAB	CALL	UC.CVXARL.UG:	CALL	UK.KBW	LD	HL,(UB.PATAB)	;BGADR---->HL	LD	C,001H	;LADEN BLOCKZAEHLER MIT			;ANFANGSWERT	CALL	RL.UP6	; AUFRUF EINGABE-UP;********** TEST BEFEHLSKENNZEICHENBYTE *******************************RL.M16:	BIT	3,D	;TEST ORG-BEFEHL	JP	NZ,RL.OB	;JA--->FEHLER	BIT	4,D	;TEST BER -BEFEHL	JP	NZ,RL.M10	LD	A,007H	AND	D	;TEST BEFEHLS LAENGE=0 ?	JP	Z,RL.M11	LD	B,A	;BEFEHLSLAENGE-->BRL.M12:	CALL	RL.UP6	LD	(HL),D	INC	HL	DJNZ	RL.M12	;EINGABE BEFEHL	CALL	RL.UP6	BIT	7,D	;TEST BEFEHLSKENNZEICHENBYTE ?	JR	NZ,RL.M16	; JA;******* TEST ADRESSKENNZEICHENBYTE ***********************************	BIT	5,D	;TEST OB REL.ADR. FOLGT	JP	Z,RL.RA	;NEIN-->FEHLER	BIT	6,D	;FOLGT BEZUGNAHME AUF			;SYMBOLVERZEICHNIS	JP	NZ,RL.SV	;JA--->FEHLER	BIT	2,D	;MINUS ?	JP	NZ,RL.MNRL.M17:	LD	A,003H	AND	D	;TEST ADRESSLAENGE	PUSH	AF	PUSH	HL	CALL	RL.UP6	LD	H,D	;ADRESSE ---->HL	CALL	RL.UP6	LD	L,D	PUSH	BC	PUSH	HL	LD	HL,UB.PATAB	LD	C,(HL)	;BEGINN(LADE)ADRESSE--->BC	INC	HL	LD	B,(HL)	POP	HL	ADD	HL,BC	;ERMITTELN SPEICHERADRESSE	EX	DE,HL	;SP.ADR.--->DE	POP	BC	POP	HL	POP	AF	JR	Z,RL.M13	BIT	0,A	;NUR L-TEIL DER ADRESSE ?	JR	Z,RL.M14	; JA;********** ADRESSE IN SPEICHER EINTRAGEN *****************************RL.M13:	LD	(HL),E	PUSH	AF	LD	A,E	CP	(HL)	JP	NZ,RL.ECHO	POP	AF	INC	HL	CP	003H	JR	Z,RL.M14	OR	A	;NUR H-TEIL DER ADRESSE ?	JR	NZ,RL.M15	; JARL.M14:	LD	(HL),D	PUSH	AF	LD	A,D	CP	(HL)	JR	NZ,RL.ECHO	POP	AF	INC	HLRL.M15:	CALL	RL.UP6	BIT	7,D	; TEST BEFEHLSKENNZEICHENBYTE	JR	NZ,RL.M16	JP	RL.BF	; NEIN--->FEHLER;----------------------------------------------------------------------RL.M10:	CALL	RL.UP6	;BEI BER-BEFEHL ADDIEREN DER	PUSH	DE	;DEF. BEREICHSLAENGE ZU	CALL	RL.UP6	;ADRESSE	LD	A,D	POP	DE	LD	E,A	ADD	HL,DE	CALL	RL.UP6	JP	RL.M16RL.M11:	CALL	RL.UP6	;BEI BFL=0 SPRUNG ZUM TEST	JP	RL.M17	;ADRESSKENNZEICHENBYTE;******* UP ZUR ZEICHENWEISE EINGABE DER O-DATEI **********************RL.UP6:	CALL	UK.GETK	LD	D,A	DEC	C	;REDUZIEREN BLOCKLAENGE	RET	NZ		;RET BEI UNGLEICH NULL	AND	A	;IST NAECHSTE BLOCKLAENGE NULL ?	JR	Z,RL.M21	;JA-->VERZWEIGUNG ENDEBEH	LD	C,A	;NEIN-->EINTRAGEN BLKLAENGE	INC	C	JR	RL.UP6;*********** ENDEBEHANDLUNG *******************************************RL.M21:	POP	DE	PUSH	HL	LD	A,15	LD	(UB.ZN),A	LD	HL,UA.ZKEND+3	LD	DE,3460H	LD	BC,16	LDIR	LD	HL,UB.ZN	INC	(HL)	POP	HL	DEC	HL	LD	DE,3470H	;HINTER AUSSCHRIFT ENDE	CALL	UC.CVHLX	LD	HL,UA.STADR	;STARTADRESSE ?	CALL	UR.MIMO	RET	C	EX	DE,HL	LD	HL,UB.PATAB+2	CALL	UC.CVXA	;STARTADR.-->BINAER	LD	A,(UE.BWSA+329H)	CP	'S'	JR	NZ,$+6	LD	HL,(UB.PATAB+2)	JP	(HL)	CALL	UR.KRW	CALL	UR.KRA	RET;---------------------------------------------------------------------RL.ECHO:	POP	DE	LD	A,93H	JR	RL.FMELDRL.DATNV:	LD	A,91H	JR	RL.FMELDRL.OB:	LD	A,96H	JR	RL.FMELDRL.RA:	LD	A,97H	JR	RL.FMELDRL.SV:	LD	A,98H	JR	RL.FMELDRL.MN:	LD	A,99H	JR	RL.FMELDRL.BF:	LD	A,9AHRL.FMELD:	CALL	UF.ERANZ	RET;----------------------------------------------------------------------;	END