	TITLE	'Kopieren von MRES-Kassetten Teil 2'	PAGE;	PN	KY;---------------------------------------------------------------------;;          KOPIEREN VON MRES-KASSETTEN           TEIL 2;;--------------------------------------------------------------------KY.MD:	CALL	U1.BILO	LD	HL,UA.KOPFR	CALL	KY.SATR	LD	A,13	LD	(UB.ZN),A	LD	HL,BC.VTABE+32	LD	IY,BC.TAB2	LD	(IY+0),0FFH	LD	A,(BC.VTABE+3)	LD	B,A	DEC	B;--------------------------------ABFRAGEZYKLUS------------------------KY.DFR:	PUSH	BC	LD	DE,UB.SATZ+26	LD	BC,6	LDIR	INC	DE	INC	DE	LD	BC,2	LDIR	LD	BC,24	ADD	HL,BC	PUSH	HL	LD	HL,UB.SATZ	CALL	UR.MIMO	CALL	C,KU.ZEIR	CALL	KY.JHL	;BEI KOPIJ WIRD J GESETZT	LD	A,(HL)	CP	'J'	CALL	NZ,KU.TAB2L	POP	HL	LD	BC,9	OR	A	SBC	HL,BC	LD	A,(HL)	LD	(IY+0),A	INC	IY	LD	(IY+0),0FFH	ADD	HL,BC	LD	A,(BC.VTABA+3)	CP	01H	JR	Z,KY.EZYK1	PUSH	HL	LD	BC,32	OR	A	SBC	HL,BC	EX	DE,HL	POP	HL	LD	IX,BC.VTABA	LD	B,A	DEC	BKY.VZVGL:	PUSH	BC	LD	BC,32	ADD	IX,BC	PUSH	IX	LD	B,7	PUSH	DEKY.SVGL:	LD	A,(DE)	CP	(IX+0)	JR	NZ,KY.NDA	INC	IX	INC	DE	DJNZ	KY.SVGL	CALL	KU.DD	;DATEI SCHON VORHANDENKY.NDA:	POP	DE	POP	IX	POP	BC	DJNZ	KY.VZVGLKY.EZYK1:	POP	BC	DJNZ	KY.DFR;---------------------------------------------------------------------KY.ATAA:	LD	B,3	;WARTESCHLEIFE FUER	LD	HL,0FFFFH	DEC	HL	LD	A,H	OR	L	JR	NZ,$-3	DJNZ	$-8	LD	HL,UA.EABFR	CALL	KY.SATR	LD	HL,UB.SATZ	CALL	UR.MIMO	JR	C,$-6	CALL	KY.JHL	LD	A,(HL)	CP	'J'	JP	NZ,KY.MD;--------------------------------Labelnummern fuer Ausgabe ---------KY.ATAB:	LD	B,0	LD	HL,BC.TAB2	LD	DE,BC.TAB3	LD	A,(HL)	CP	0FFH	;KEINE DATEI KOPIEREN	JP	Z,KX.ENDR	LD	A,(BC.VTABA+1)KY.ATABE:	LD	(DE),A	INC	HL	INC	DE	INC	B	PUSH	AF	LD	A,(HL)	CP	0FFH	JR	Z,KY.WEI	POP	AF	INC	A	JR	KY.ATABE;------------------------------TAB:NR DER VERZ.EINTRAGUNGEN (EING.)------KY.WEI:	POP	AF	PUSH	BC	XOR	A	LD	D,A	LD	A,(BC.VTABE+3)	LD	B,A	DEC	B	LD	HL,BC.TAB2	LD	IY,BC.TAB2A	LD	IX,BC.VTABE+32KY.ZYK:	INC	D	LD	A,(HL)	CP	(IX+23)	JR	NZ,KY.NE	LD	A,D	LD	(IY+0),A	LD	(IY+1),0FFH	INC	HL	INC	IYKY.NE:	PUSH	BC	LD	BC,32	ADD	IX,BC	POP	BC	DJNZ	KY.ZYK;------------------------------------AUFBAU AUSGABEVERZ.-----	LD	A,(BC.VTABA+3)	LD	B,A	CP	01H	JR	Z,KY.EVZ	LD	HL,BC.VTABA	CALL	KU.VVOR	JR	KY.EVZ1KY.EVZ:	LD	HL,BC.VTABA+32KY.EVZ1:	LD	IX,BC.TAB2A	LD	IY,BC.TAB3	EX	DE,HL	LD	HL,BC.VTABE+32	LD	A,(IX+0)	CP	01H	JR	Z,KY.VSTR	DEC	A	LD	B,A	CALL	KU.VVORKY.VSTR:	LD	BC,32	LDIR	LD	A,(IY+0)	EX	DE,HL	LD	BC,9	OR	A	SBC	HL,BC	LD	(HL),A	ADD	HL,BC	EX	DE,HL	LD	A,(IX+1)	CP	0FFH	JR	Z,KY.COPY	SUB	(IX+0)	DEC	A	LD	B,A	CP	00H	CALL	NZ,KU.VVOR	INC	IY	INC	IX	JR	KY.VSTR;------------------------------------VERZ.SCHREIBEN (NUR NEUE SAETZE)---KY.COPY:	LD	IX,UB.KTAB	CALL	U1.KTIN1	LD	(IX+10),20H	CALL	U1.AUS	LD	A,(BC.VTABA+3)	LD	B,A	CALL	UR.KBV	;AUSGABEKASSETTE	DEC	A	JR	NZ,$-4	;VORSTELLEN BIS HINTER LETZTEN ALTEN	LD	HL,BC.VTABA	;VERZ.SATZ	LD	DE,32	ADD	HL,DE	DJNZ	$-4	;AUSGABEVERZ.ZEIGER	POP	BC	LD	A,B	PUSH	AFKY.VSCHR:	LD	DE,UE.PUF	LD	BC,32	LDIR	CALL	UR.KBV	CALL	UR.KBR	LD	(IX+5),08H	CALL	UF.EXEC	DEC	A	JR	NZ,KY.VSCHR;----------------------------------------------------------------	LD	DE,33FAH	;''ES WIRD KOPIERT''	LD	HL,KY.EWK	LD	BC,16	LDIR;------------------------------KOPIEREN--------------------------	LD	HL,BC.TAB2	LD	DE,BC.TAB3	LD	IY,BC.TAB2A	LD	A,(DE)	LD	B,A	INC	B	CALL	UR.POSIK	LD	A,(HL)	LD	B,A	INC	BKY.KOPV:	CALL	U1.EIN	CALL	UR.POSIKKY.KOP:	CALL	U1.BREAD	LD	A,(HL)	CP	01H	CALL	Z,U1.VSX;------------------------ANZEIGE WELCHE DATEI KOPIERT WIRD-------------	PUSH	HL	PUSH	DE	LD	A,(IY+0)	LD	B,A	DEC	B	LD	HL,BC.VTABE+32	CP	01H	JR	Z,KY.KOPAN	CALL	KU.VVORKY.KOPAN:	LD	DE,34F0H	LD	BC,6	LDIR	INC	DE	INC	DE	LD	BC,2	LDIR	INC	IY	POP	DE	POP	HL;--------------------------------------------------------------------	LD	A,(DE)	CP	01H	CALL	Z,U1.VS1	LD	(UE.PUF),A	CALL	U1.BWRIT	CALL	U1.COPB	INC	HL	LD	A,(HL)	CP	0FFH	JR	Z,KY.EOV	DEC	HL	SUB	(HL)	INC	HL	INC	DE	LD	B,A	CP	01H	JR	NZ,KY.KOPV	JR	KY.KOP;-------------------------------------------------------------KY.EOV:	CALL	U1.VSX	LD	A,(BC.VTABA+1)	LD	B,A	POP	AF	PUSH	AF	ADD	A,B	LD	(UE.PUF),A	CALL	U1.KTIN1	LD	(IX+10),20H	CALL	U1.BWRIT	CALL	UR.KSL	CALL	KX.ENDR	CALL	UR.KRE	CALL	U1.DSVG	POP	AF	PUSH	AF	ADD	A,C	;NEXT RECORD UND	LD	(UE.PUF+1),A	POP	AF	ADD	A,B	;ANZAHL VERZ.EINTR. KORRIGIEREN	LD	(UE.PUF+3),A	CALL	UR.KBR	LD	(IX+4),08H	CALL	UF.EXEC	;NEUEN DS-SATZ SCHREIBEN	CALL	UR.KRW	CALL	UR.KRA	RET;---------------------------------------------------------------KY.EWK:	DB	'Es wird kopiert:';---------------------------------------------------------------KY.JHL:	LD	A,(UB.PAR2)	CP	'J'	JR	NZ,$+3	LD	(HL),A	RET;--------------------------------------------------------------KY.SATR:	LD	DE,UB.SATZ	LD	BC,54	LDIR	LD	A,(UE.BWSA+326H)	CP	'J'	CALL	Z,KY.AJ	LD	(UB.PAR2),A	RETKY.AJ:	PUSH	AF	XOR	A	LD	(UB.SATZ),A	POP	AF	RET;--------------------------------------------------------------;	END