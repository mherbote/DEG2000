	TITLE	'Allgemeine Unterprogramme'	PAGE;	PN	U1;----------------------------------------------------------------------;;        Allgemeine Unterprogramme;;----------------------------------------------------------------------U1.RSAVE:	EX	(SP),HL	;Register retten (nicht AF)	PUSH	DE	PUSH	BC	PUSH	IY	PUSH	IX	JP	(HL)U1.RRST:	POP	HL	;Register wieder herstellen	POP	IX	POP	IY	POP	BC	POP	DE	EX	(SP),HL	RETU1.CLRB:	PUSH	HL	;Bereich loeschen	PUSH	DE	PUSH	BC	PUSH	HL	;IN:  HL= Bereichsanfang	POP	DE	;     BC= Bereichslaenge	INC	DE	XOR	A	LD	(HL),A	DEC	BC	LDIR	POP	BC	POP	DE	POP	HL	RET;----------------------------------------------------------------------U1.KBR4:	PUSH	BC	LD	B,4	CALL	UR.KBR	DJNZ	$-3	POP	BC	RET;----------------------------------------------------------------------U1.WAIT:	; PUSH	AF	; CALL	UE.BERT	; JR	C,$-3	; POP	AF	RET;--------------------------------------------------------------------U1.BREAD:	CALL	U1.EIN	;BLOCK LESEN VON EINGABE	LD	(IX+4),02H	CALL	UF.EXEC	RETU1.BWRIT:	CALL	U1.AUS	;BLOCK SCHREIBEN AUF AUSGABE	LD	(IX+4),00H	CALL	UF.EXEC	RETU1.COPB2:	PUSH	AF	SCF	JR	$+4U1.COPB:	PUSH	AF	OR	A	CALL	U1.EIN	LD	(IX+4),02H	CALL	C,KX.EXEC2	CALL	NC,UF.EXEC	PUSH	AF	CALL	U1.AUS	LD	A,(IX+9)	OR	(IX+10)	JR	Z,$+10	CALL	U1.BWRIT	POP	AF	JR	C,$-34	JR	NC,$-32	CALL	UR.KBM	POP	AF	POP	AF	RETU1.EIN:	PUSH	AF	LD	A,(BC.TAB1)	LD	(IX+3),A	POP	AF	RETU1.AUS:	PUSH	AF	LD	A,(BC.TAB1+1)	LD	(IX+3),A	POP	AF	RET;----------------------------------------------------------------------U1.VS1:	PUSH	HL	PUSH	BC	PUSH	AF	LD	A,01H	;1.DATEIVORSATZ IM PUFFER	JR	$+6U1.VSX:	PUSH	HL	PUSH	BC	PUSH	AF	XOR	A	;00-DATEIVORSATZ IM PUFFER	LD	B,32	LD	HL,UE.PUF	CALL	U1.TR	POP	AF	POP	BC	POP	HL	RET;----------------------------------------------------------------------U1.DSVG:	PUSH	HL	PUSH	DE	PUSH	AF	LD	B,7	;MRES KASSETTE ?	CALL	U1.VORS1	LD	DE,UE.PUF+6	LD	HL,UA.DS+6	LD	B,14	LD	A,(DE)	CP	(HL)	JR	NZ,$+18	INC	DE	INC	HL	DJNZ	$-6	LD	A,(UE.PUF+1)	LD	C,A	;C <-- NEXT RECORD	LD	A,(UE.PUF+3)	LD	B,A	;B <-- ANZ.VERZ.EINTRAG.	POP	AF	POP	DE	POP	HL	RET	POP	AF	POP	DE	POP	HL	POP	IY	LD	A,90H	CALL	UF.ERANZ	JP	UE.SYSTB;----------------------------------------------------------------------U1.NMVGL:	PUSH	BC	PUSH	DE	PUSH	HL	LD	B,6	LD	DE,UE.PUF	LD	A,(DE)	CP	(HL)	;HL:ZU SUCHENDER PROGR.NAME	JR	NZ,$+14	INC	HL	INC	DE	DJNZ	$-6	LD	A,(UE.PUF+23)	;LABELNR. -->A	SCF		;CY=1,WENN PROGR. GEFUNDEN	POP	HL	POP	DE	POP	BC	RET	OR	A	JR	$-5;----------------------------------------------------------------------U1.KTINI:	PUSH	HL	PUSH	BC	PUSH	AF	CALL	U1.BILO	;UNTERE HAELFTE BS LOESCHEN	LD	IX,UB.KTAB	;ADR. STEUERTAB. F.KASS.ROUTINE	PUSH	IX	POP	HL	XOR	A	LD	B,27	CALL	U1.TR	;TAB. AUF 00 LOESCHEN	LD	(IX+3),30H;	CALL	UE.KINI	JR	$+5U1.KTIN1:	PUSH	HL	PUSH	BC	PUSH	AF;	LD	(IX+11),7	;ANZAHL LESE/SCHREIBWDHLGNN;	LD	(IX+12),4	;ANZAHL	LD	HL,UE.PUF	CALL	XY.STDX	DB	7	;SYSTEMPUFFERADR.-->TAB	LD	HL,UE.KPUFF	CALL	XY.STDX	DB	25	;E/A PUFFERADR.-->TAB	;???	POP	AF	POP	BC	POP	HL	RET;----------------------------------------------------------------------U1.VERIN:	PUSH	HL	PUSH	BC	PUSH	AF	LD	DE,BC.VTABE	;VERZ. EINGABEGER. EINLESEN	JR	$+5U1.VERNI:	PUSH	HL	PUSH	BC	PUSH	AF	LD	A,(UE.PUF+3)	;ANZ. DATEIEN-->B	LD	B,A	PUSH	BC	LD	HL,UE.PUF	LD	BC,32	LDIR	CALL	UF.EXEC	POP	BC	DJNZ	$-13	POP	AF	POP	BC	POP	HL	RET;----------------------------------------------------------------------U1.VORST:	PUSH	BC	CALL	UR.KRWW	LD	B,6	JR	$+3U1.VORS1:	PUSH	BC	LD	(IX+4),02H	CALL	UF.EXEC	DJNZ	$-3	POP	BC	RET;----------------------------------------------------------------------U1.VZS:	PUSH	DE	PUSH	BC	PUSH	HL	PUSH	AF	CALL	UR.KBV	CALL	UR.KBR	LD	DE,UE.PUF	LD	BC,6	LDIR		;PROGR.NAME --> PUFFER	LD	A,(UB.PAR2)	;DATEITYP	LD	(DE),A	INC	DE	LD	A,'D'	LD	(DE),A	INC	DE	LD	A,(UB.PAR3)	CP	7FH	JR	NZ,$+17	LD	HL,UA.KOMMT	;FRAGE KOMMENTAR WENN PAR3=7F	CALL	UR.MIMO	LD	BC,6	LDIR	LD	B,9	JR	$+4	LD	B,15	LD	A,' '	LD	(DE),A	INC	DE	DJNZ	$-2	LD	A,(UB.PAR1)	LD	(DE),A	INC	DE	LD	B,8	XOR	A	LD	(DE),A	INC	DE	DJNZ	$-2	LD	HL,32	CALL	XY.STIDX	DB	9	LD	(IX+4),00H	CALL	UF.EXEC	POP	AF	POP	HL	POP	BC	POP	DE	RET;----------------------------------------------------------------------U1.TR:	LD	(HL),A	;A=INHALT	INC	HL	DJNZ	U1.TR	;B=ANZAHL	RET;----------------------------------------------------------------------U1.INFO:	LD	BC,14	LDIR	RETU1.BILO:	CALL	U1.RSAVE	LD	HL,3370H	LD	BC,1120	LD	(HL),20H	LD	D,H	LD	E,L	INC	DE	LDIR	CALL	U1.RRST	RET;----------------------------------------------------------------------U1.TST:	OR	A	SUB	30H	LD	B,A	DEC	B	RET	Z	DEC	B	RET	Z	SCF	RET;----------------------------------------------------------------------U1.PRADR:	PUSH	HL	PUSH	BC	LD	B,4	LD	A,(HL)	CP	' '	JR	Z,$+9	INC	HL	DJNZ	$-6	OR	A	POP	BC	POP	HL	RET	SCF	LD	HL,UB.ZN	DEC	(HL)	JR	$-8;---------------------------------------------------------------------U1.KRWE:	CALL	UR.KRE	CALL	UR.KRWW	RET;---------------------------------------------------------------------;	END